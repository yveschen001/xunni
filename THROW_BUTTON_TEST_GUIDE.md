# 丟漂流瓶按鈕功能測試指南

> **測試日期**：2025-11-22  
> **功能**：為丟漂流瓶添加按鈕輸入方式

---

## 🎯 測試目標

驗證用戶可以通過兩種方式輸入漂流瓶內容：
1. **方法 1**：點擊「🍾 丟漂流瓶」按鈕
2. **方法 2**：長按訊息選擇「回覆」

---

## 📋 測試前準備

### 1. 部署到 Staging 環境
```bash
pnpm deploy:staging
```

### 2. 準備測試帳號
- 確保測試帳號已完成註冊
- 確保測試帳號有丟瓶配額

---

## 🧪 測試場景

### ✅ 場景 1：使用按鈕輸入（新功能）

**步驟**：
1. 發送 `/throw` 指令
2. 觀察訊息內容：
   - ✅ 應該看到「🍾 **丟漂流瓶** #THROW」標題
   - ✅ 應該看到規則說明
   - ✅ 應該看到「💡 **兩種輸入方式**」提示
   - ✅ 應該看到兩個按鈕：
     - 🍾 丟漂流瓶
     - 🏠 返回主選單
3. 點擊「🍾 丟漂流瓶」按鈕
4. 觀察反應：
   - ✅ 應該看到彈出提示「💡 請在下方輸入框輸入內容」
   - ✅ 應該看到新訊息「📝 請輸入你的漂流瓶內容：」
   - ✅ **輸入框應該自動切換到「回覆」模式**（重點！）
5. 在輸入框中輸入測試內容（例如：「測試按鈕輸入功能」）
6. 發送訊息
7. 觀察結果：
   - ✅ 應該看到「🍾 **正在丟出你的漂流瓶...**」進度訊息
   - ✅ 應該看到「🍾 漂流瓶已丟出！」成功訊息
   - ✅ 配額應該減少 1

**預期結果**：✅ 瓶子成功丟出

---

### ✅ 場景 2：使用長按回覆（現有功能）

**步驟**：
1. 發送 `/throw` 指令
2. **長按**「🍾 **丟漂流瓶** #THROW」訊息
3. 在彈出選單中選擇「回覆」
4. 在輸入框中輸入測試內容（例如：「測試長按回覆功能」）
5. 發送訊息
6. 觀察結果：
   - ✅ 應該看到「🍾 **正在丟出你的漂流瓶...**」進度訊息
   - ✅ 應該看到「🍾 漂流瓶已丟出！」成功訊息
   - ✅ 配額應該減少 1

**預期結果**：✅ 瓶子成功丟出

---

### ✅ 場景 3：會話過期處理

**步驟**：
1. 發送 `/throw` 指令
2. **等待 5 分鐘**（讓 session 過期）
3. 點擊「🍾 丟漂流瓶」按鈕
4. 觀察反應：
   - ✅ 應該看到彈出提示「⚠️ 會話已過期，請重新開始：/throw」
   - ✅ 不應該進入輸入狀態

**預期結果**：✅ 友善的錯誤提示

---

### ✅ 場景 4：配額用完處理

**步驟**：
1. 丟瓶子直到配額用完
2. 發送 `/throw` 指令
3. 觀察訊息：
   - ✅ 應該看到「❌ 今日漂流瓶配額已用完」
   - ✅ 應該看到配額說明和升級 VIP 提示
   - ✅ **不應該**看到「🍾 丟漂流瓶」按鈕

**預期結果**：✅ 配額用完時不顯示輸入按鈕

---

### ✅ 場景 5：內容驗證

**步驟**：
1. 發送 `/throw` 指令
2. 點擊「🍾 丟漂流瓶」按鈕
3. 輸入**不符合規則**的內容：
   - 測試 1：輸入「123」（少於 5 個字符）
   - 測試 2：輸入包含連結的內容（例如：「https://example.com」）
   - 測試 3：輸入超過 250 個字符的內容
4. 觀察反應：
   - ✅ 應該看到「⚠️ **內容未通過檢查**」提示
   - ✅ 應該看到具體的錯誤原因
   - ✅ 應該看到友善的引導訊息

**預期結果**：✅ 正確的驗證和友善的錯誤提示

---

## 📊 測試結果記錄表

| 場景 | 測試日期 | 測試人員 | 結果 | 備註 |
|------|---------|---------|------|------|
| 場景 1：按鈕輸入 | | | ⏳ 待測試 | |
| 場景 2：長按回覆 | | | ⏳ 待測試 | |
| 場景 3：會話過期 | | | ⏳ 待測試 | |
| 場景 4：配額用完 | | | ⏳ 待測試 | |
| 場景 5：內容驗證 | | | ⏳ 待測試 | |

---

## 🔍 關鍵檢查點

### UI/UX 檢查
- [ ] 按鈕文字清晰（🍾 丟漂流瓶）
- [ ] 提示訊息友善（💡 兩種輸入方式）
- [ ] ForceReply 訊息清晰（📝 請輸入你的漂流瓶內容：）
- [ ] 輸入框自動切換到回覆模式
- [ ] 彈出提示友善（💡 請在下方輸入框輸入內容）

### 功能檢查
- [ ] 按鈕點擊後正確進入輸入狀態
- [ ] 用戶輸入的內容正確處理
- [ ] 會話過期時正確提示
- [ ] 配額用完時不顯示按鈕
- [ ] 內容驗證正確執行

### 兼容性檢查
- [ ] 不影響現有的長按回覆功能
- [ ] 兩種方式處理邏輯一致
- [ ] 錯誤處理友善且一致

---

## 🐛 常見問題排查

### 問題 1：點擊按鈕後沒有反應
**可能原因**：
- Session 已過期
- 用戶未完成註冊
- Callback handler 未正確註冊

**排查步驟**：
1. 檢查 Cloudflare Logs
2. 確認 `throw_input` callback 是否被觸發
3. 確認用戶 session 狀態

---

### 問題 2：輸入框沒有切換到回覆模式
**可能原因**：
- ForceReply 訊息發送失敗
- Telegram 客戶端版本過舊

**排查步驟**：
1. 檢查 Cloudflare Logs 中的 ForceReply 發送結果
2. 確認 Telegram 客戶端版本
3. 嘗試更新 Telegram 客戶端

---

### 問題 3：輸入內容後沒有處理
**可能原因**：
- Router 檢測邏輯未包含 ForceReply 訊息
- Session 已過期

**排查步驟**：
1. 檢查 `src/router.ts` 中的回覆檢測邏輯
2. 確認是否包含「📝 請輸入你的漂流瓶內容：」檢測
3. 檢查 session 狀態

---

## 📝 測試報告模板

```markdown
## 丟漂流瓶按鈕功能測試報告

**測試日期**：YYYY-MM-DD  
**測試人員**：XXX  
**測試環境**：Staging / Production

### 測試結果
- 場景 1：✅ / ❌
- 場景 2：✅ / ❌
- 場景 3：✅ / ❌
- 場景 4：✅ / ❌
- 場景 5：✅ / ❌

### 發現的問題
1. [問題描述]
2. [問題描述]

### 建議
1. [建議內容]
2. [建議內容]

### 總體評價
✅ 通過 / ⚠️ 有問題但可接受 / ❌ 需要修復
```

---

## ✅ 驗收標準

功能可以上線的條件：
- [x] 所有 5 個測試場景通過
- [x] 無嚴重 Bug
- [x] UI/UX 友善且清晰
- [x] 不影響現有功能
- [x] 錯誤處理完善

---

**測試準備人員**：AI Assistant  
**文檔版本**：v1.0.0  
**最後更新**：2025-11-22

