# XunNi UI/UX 和 Emoji 使用規範

> **版本**：v1.0.0  
> **最後更新**：2025-11-21  
> **狀態**：✅ 待審核

---

## 📋 目錄

1. [總覽](#總覽)
2. [Emoji 使用規範](#emoji-使用規範)
3. [訊息類型分類](#訊息類型分類)
4. [Callback Query Answer 規範](#callback-query-answer-規範)
5. [Send Message 規範](#send-message-規範)
6. [錯誤訊息規範](#錯誤訊息規範)
7. [成功訊息規範](#成功訊息規範)
8. [通知訊息規範](#通知訊息規範)
9. [實施計劃](#實施計劃)
10. [測試保護機制](#測試保護機制)

---

## 總覽

### 🎯 目標

建立統一的 UI/UX 和 Emoji 使用規範，確保：
1. ✅ 所有用戶可見訊息使用正確的 Emoji
2. ✅ 不同類型的訊息有明確的視覺區分
3. ✅ 用戶體驗一致且友好
4. ✅ 新功能開發時有明確的規範可遵循

### 📊 當前狀況

| 項目 | 狀態 | 完成度 |
|------|------|--------|
| Callback Query Answer | ⚠️ 需改進 | 60% |
| Send Message | ⚠️ 需改進 | 70% |
| 錯誤訊息 | ⚠️ 需改進 | 65% |
| 成功訊息 | ✅ 良好 | 85% |
| 通知訊息 | ✅ 良好 | 80% |

---

## Emoji 使用規範

### 1. 狀態類型 Emoji

#### **✅ 成功（Success）**
**使用場景**：操作成功完成

**範例**：
- `✅ 註冊完成！`
- `✅ 設定已保存`
- `✅ 操作成功`

**使用位置**：
- Callback Query Answer
- 成功訊息的開頭

---

#### **❌ 錯誤（Error）**
**使用場景**：系統錯誤、資料不存在、格式錯誤、操作失敗

**範例**：
- `❌ 用戶不存在`
- `❌ 發生錯誤`
- `❌ 格式錯誤`
- `❌ 無效的資料`

**使用位置**：
- Callback Query Answer（錯誤情況）
- 錯誤訊息的開頭

**注意**：不要用於「權限限制」、「流程提示」、「狀態提示」

---

#### **⚠️ 警告（Warning）**
**使用場景**：權限限制、流程提示、狀態提示、需要注意的情況

**範例**：
- `⚠️ 此功能僅限 VIP 會員使用`
- `⚠️ 請先完成註冊流程`
- `⚠️ 會話已過期，請重新開始`
- `⚠️ 請先完成上一個操作`
- `⚠️ 額度不足`
- `⚠️ 今日配額已用完`

**使用位置**：
- Callback Query Answer（警告情況）
- 警告訊息的開頭

**重要**：這是最容易混淆的類型，請仔細區分「錯誤」和「警告」

---

#### **💡 提示（Info/Tip）**
**使用場景**：友好提示、建議、說明

**範例**：
- `💡 提示：每個對話都是獨立的`
- `💡 使用 /help 查看更多指令`
- `💡 升級 VIP 可獲得更多功能`

**使用位置**：
- 訊息內容中（不在開頭）

---

### 2. 操作類型 Emoji

#### **🚫 封鎖/禁止（Block/Forbidden）**
**使用場景**：封鎖、禁止、拒絕

**範例**：
- `🚫 已封鎖`
- `🚫 內容包含敏感詞彙`
- `🚫 操作被拒絕`

**使用位置**：
- Callback Query Answer（封鎖操作）
- 封鎖確認訊息

---

#### **⛔ 嚴重禁止（Critical Forbidden）**
**使用場景**：違規、嚴重違反規則、帳號封禁

**範例**：
- `⛔ 內容違反社群規範`
- `⛔ 帳號已被封禁`
- `⛔ 嚴重違規行為`

**使用位置**：
- 嚴重違規通知
- 封禁通知

---

#### **🚨 舉報（Report）**
**使用場景**：舉報、報告

**範例**：
- `🚨 已舉報`
- `🚨 舉報已提交`
- `🚨 感謝您的舉報`

**使用位置**：
- Callback Query Answer（舉報操作）
- 舉報確認訊息

---

#### **🗑️ 刪除（Delete）**
**使用場景**：刪除、清除

**範例**：
- `🗑️ 草稿已刪除`
- `🗑️ 已清除`
- `🗑️ 資料已刪除`

**使用位置**：
- Callback Query Answer（刪除操作）
- 刪除確認訊息

---

#### **⏳ 處理中（Processing）**
**使用場景**：正在處理、等待中、加載中

**範例**：
- `⏳ 正在處理...`
- `⏳ 正在發送...`
- `⏳ 請稍候...`
- `⏳ 正在加載...`

**使用位置**：
- Callback Query Answer（處理中）
- 進度訊息

---

#### **❓ 未知（Unknown）**
**使用場景**：未知操作、無法識別

**範例**：
- `❓ 未知的操作`
- `❓ 無法識別的指令`

**使用位置**：
- Callback Query Answer（未知操作）

---

### 3. 功能類型 Emoji

#### **💳 支付（Payment）**
**使用場景**：支付、交易

**範例**：
- `💳 正在準備支付...`
- `💳 支付成功`
- `💳 交易完成`

---

#### **💎 VIP 專屬（VIP）**
**使用場景**：VIP 相關

**範例**：
- `💎 VIP 用戶無需觀看廣告`
- `💎 VIP 專屬功能`
- `💎 升級 VIP`

---

#### **✏️ 輸入提示（Input）**
**使用場景**：需要用戶輸入

**範例**：
- `✏️ 請輸入新的內容`
- `✏️ 請輸入暱稱`
- `✏️ 請輸入生日`

---

#### **🎯 任務（Task）**
**使用場景**：任務相關

**範例**：
- `🎯 任務已完成`
- `🎯 開始任務`
- `🎯 任務中心`

---

#### **🎁 獎勵（Reward）**
**使用場景**：獎勵、禮物

**範例**：
- `🎁 獎勵已領取`
- `🎁 獲得獎勵`
- `🎁 +1 額度`

---

#### **📺 廣告（Ad）**
**使用場景**：廣告相關

**範例**：
- `📺 正在加載廣告...`
- `📺 廣告觀看完成`
- `📺 觀看廣告獲得額度`

---

#### **📢 公告（Announcement）**
**使用場景**：系統公告、廣播

**範例**：
- `📢 系統公告`
- `📢 重要通知`
- `📢 維護通知`

---

#### **🎉 慶祝（Celebration）**
**使用場景**：註冊完成、重要成就

**範例**：
- `🎉 註冊完成！`
- `🎉 漂流瓶已丟出！`
- `🎉 生日快樂！`

---

#### **🌊 漂流瓶（Bottle）**
**使用場景**：丟瓶子相關

**範例**：
- `🌊 等待有緣人撿起...`
- `🌊 漂流瓶系統`

---

#### **🎣 撿瓶子（Catch）**
**使用場景**：撿瓶子相關

**範例**：
- `🎣 撿起漂流瓶`
- `🎣 有新的瓶子！`

---

#### **💬 對話（Chat）**
**使用場景**：對話、聊天相關

**範例**：
- `💬 有人撿起了你的瓶子！`
- `💬 對話列表`
- `💬 開始聊天`

---

#### **👤 個人資料（Profile）**
**使用場景**：個人資料相關

**範例**：
- `👤 個人資料`
- `👤 查看資料`

---

#### **📊 統計（Stats）**
**使用場景**：統計、數據相關

**範例**：
- `📊 統計數據`
- `📊 今日已丟：3/3`

---

#### **⚙️ 設定（Settings）**
**使用場景**：設定相關

**範例**：
- `⚙️ 設定`
- `⚙️ 推送設定`

---

#### **🏠 主選單（Menu）**
**使用場景**：主選單

**範例**：
- `🏠 主選單`
- `🏠 返回主選單`

---

#### **📖 幫助（Help）**
**使用場景**：幫助、說明

**範例**：
- `📖 XunNi 指令列表`
- `📖 幫助`

---

#### **📜 規則（Rules）**
**使用場景**：規則、條款

**範例**：
- `📜 XunNi 遊戲規則`
- `📜 服務條款`

---

## 國際化 (i18n) 與 RTL 規範

### 1. Emoji 與 i18n

**原則**：
- Emoji 是通用的 Unicode 字符，不受語言影響。
- ✅ **Emoji 是最完美的國際化語言！**
- **Emoji 位置**：通常放在開頭（左側），這樣在 LTR 和 RTL 語言中都最先看到。
- **間距**：Emoji 與文字之間必須有空格，避免黏在一起。

### 2. RTL (Right-to-Left) 支援

**Telegram 行為**：
- Telegram 會根據訊息內容自動檢測方向。
- 如果訊息以 RTL 字符（如阿拉伯文）開頭，整個訊息會靠右對齊。
- 如果訊息以 Emoji 開頭，可能會影響自動檢測。

**最佳實踐**：
1. **LTR 語言（英文、中文等）**：
   `✅ Success`
   `❌ Error`

2. **RTL 語言（阿拉伯文、希伯來文等）**：
   - 推薦將 Emoji 放在訊息開頭（右側），與 LTR 保持一致的視覺體驗。
   - 或者由翻譯者決定 Emoji 位置。

**實施策略**：
- ❌ **不要**在代碼中硬編碼 Emoji（如 `'✅ ' + i18n.t('key')`）。
- ✅ **應該**將 Emoji 放入 i18n 翻譯文件中：
  ```json
  // en.json
  "success": "✅ Success",
  
  // ar.json
  "success": "✅ تم بنجاح"
  ```
- 這樣可以確保 RTL 語言的正確顯示和排版。

### 3. Emoji 間距規範

**原則**：
- Emoji 與文字之間必須保留 **1 個空格**。
- 避免視覺擁擠。

**範例**：
- ✅ `✅ 成功`
- ❌ `✅成功`

---

## 訊息類型分類

### 1. Callback Query Answer（上方提示）

**特點**：
- 短暫顯示在 Telegram 介面最上方
- 應該簡短（建議 1-10 個字）
- 必須有 Emoji
- 用於即時反饋

**格式**：
```
[Emoji] [簡短描述]
```

**範例**：
```typescript
// ✅ 好的範例
await telegram.answerCallbackQuery(callbackQuery.id, '✅ 已保存');
await telegram.answerCallbackQuery(callbackQuery.id, '⚠️ 會話已過期');
await telegram.answerCallbackQuery(callbackQuery.id, '🚫 已封鎖');

// ❌ 不好的範例
await telegram.answerCallbackQuery(callbackQuery.id, '已保存'); // 缺少 Emoji
await telegram.answerCallbackQuery(callbackQuery.id, '✅ 您的設定已經成功保存到資料庫中'); // 太長
```

---

### 2. Send Message（完整訊息）

**特點**：
- 完整的訊息內容
- 可以多行
- 應該有清楚的結構
- 開頭應該有 Emoji

**格式**：
```
[Emoji] **[標題]**

[內容]

[提示/下一步]
```

**範例**：
```typescript
// ✅ 好的範例
await telegram.sendMessage(
  chatId,
  `🎉 **漂流瓶已丟出！**\n\n` +
  `瓶子 ID：#${bottleId}\n\n` +
  `🌊 等待有緣人撿起...\n` +
  `📊 今日已丟：${quotaDisplay}\n\n` +
  `💡 使用 /chats 查看所有對話`
);

// ❌ 不好的範例
await telegram.sendMessage(
  chatId,
  `漂流瓶已丟出，瓶子 ID 是 ${bottleId}，今日已丟 ${quotaDisplay}`
); // 缺少 Emoji，格式混亂
```

---

### 3. 錯誤訊息

**特點**：
- 必須清楚說明錯誤原因
- 提供解決方案或下一步操作
- 語氣友好，不責怪用戶

**格式**：
```
[Emoji] **[錯誤類型]**

[錯誤說明]

[解決方案/下一步]
```

**範例**：
```typescript
// ✅ 好的範例
await telegram.sendMessage(
  chatId,
  `😔 **抱歉，處理時遇到了一些問題**\n\n` +
  `💡 請稍後再試，或使用 /help 聯繫我們\n\n` +
  `🔄 重新嘗試：/throw`
);

// ❌ 不好的範例
await telegram.sendMessage(chatId, '❌ 錯誤'); // 太簡短，沒有說明
await telegram.sendMessage(chatId, '❌ 你的操作失敗了'); // 責怪用戶
```

---

## Callback Query Answer 規範

### 成功類型

```typescript
// 資料設定成功
✅ 已保存
✅ 暱稱已設定
✅ 性別已保存
✅ 生日已保存
✅ MBTI 已設定為 ${mbtiType}
✅ 語言已更新為：${languageName}

// 操作確認
✅ 已確認！
✅ 註冊完成！
✅ 操作成功

// 篩選操作
✅ 篩選完成
✅ 已清除 MBTI 選擇
✅ 已清除星座選擇

// 草稿操作
✅ 繼續編輯草稿
✅ 開始新的漂流瓶

// 測驗操作
✅ 開始測驗
✅ 已跳過
✅ 已記錄

// 安全操作
✅ 安全確認完成
```

---

### 錯誤類型

```typescript
// 資料不存在（真正的錯誤）
❌ 用戶不存在
❌ 對話不存在
❌ 草稿不存在或已過期

// 資訊錯誤（真正的錯誤）
❌ 對話資訊錯誤
❌ 無效的語言代碼
❌ 無效的 MBTI 類型
❌ 生日格式錯誤
❌ 未知的性別選項

// 系統錯誤（真正的錯誤）
❌ 發生錯誤
❌ 操作失敗
❌ 無法獲取聊天 ID
```

---

### 警告類型

```typescript
// 權限限制（不是錯誤！）
⚠️ 此功能僅限 VIP 會員使用
⚠️ 請先完成註冊流程

// 狀態提示（不是錯誤！）
⚠️ 會話已過期，請重新開始
⚠️ 請先完成上一支廣告
⚠️ 額度不足
⚠️ 今日配額已用完

// 流程提示（不是錯誤！）
⚠️ 當前不在性別選擇步驟
⚠️ 請先完成前面的步驟
```

---

### 特定操作類型

```typescript
// 封鎖
🚫 已封鎖

// 舉報
🚨 已舉報
🚨 舉報已提交

// 刪除
🗑️ 草稿已刪除
🗑️ 已清除

// 處理中
⏳ 正在處理...
⏳ 正在發送...
⏳ 正在加載...

// 支付
💳 正在準備支付...

// VIP
💎 VIP 用戶無需觀看廣告

// 輸入提示
✏️ 請輸入新的內容

// 取消
❌ 已取消

// 未知
❓ 未知的操作
```

---

## Send Message 規範

### 成功訊息

#### **丟瓶子成功（免費用戶）**
```typescript
🎉 漂流瓶已丟出！

瓶子 ID：#${bottleId}

🌊 等待有緣人撿起...
📊 今日已丟：${quotaDisplay}

💎 **升級 VIP 可獲得三倍曝光機會！**
一次丟瓶子 = 3 個對象，大幅提升配對成功率

使用 /vip 了解更多
```

#### **丟瓶子成功（VIP 用戶 - 智能配對成功）**
```typescript
✨ **VIP 特權啟動！智能配對成功！**

🎯 **第 1 個配對已完成：**
👤 對方：${matcherNickname}
💬 對話標識符：${conversationIdentifier}

📨 **另外 2 個槽位等待中：**
• 槽位 2：公共池（等待撿起）
• 槽位 3：公共池（等待撿起）

💡 你可能會收到 **最多 3 個對話**！
📊 今日已丟：${quotaDisplay}

使用 /chats 查看所有對話

💬 **請長按此訊息，選擇「回覆」後輸入內容和對方開始聊天**
```

---

### 錯誤訊息

#### **通用錯誤**
```typescript
😔 **抱歉，處理時遇到了一些問題**

💡 請稍後再試，或使用 /help 聯繫我們

🔄 重新嘗試：/throw
```

#### **額度不足**
```typescript
⚠️ **今日額度已用完**

📊 今日已丟：${used}/${total}

💡 **獲得更多額度的方式：**
• 🎯 完成任務（使用 /tasks 查看）
• 📺 觀看廣告（每次 +1）
• 🎁 邀請好友（每人 +1）
• 💎 升級 VIP（每天 30 個）

使用 /quota 查看詳細額度狀態
```

---

### 通知訊息

#### **配對成功通知**
```typescript
💬 **有人撿起了你的瓶子！**

🎯 **這是你的第 ${slotNumber} 個配對**
👤 對方：${partnerNickname}
💬 對話標識符：${conversationIdentifier}

使用 /chats 查看所有對話

💬 **請長按此訊息，選擇「回覆」後輸入內容和對方開始聊天**
```

#### **VIP 到期提醒**
```typescript
⚠️ **VIP 即將到期**

💎 您的 VIP 會員將於 ${expireDate} 到期

💡 **VIP 權益：**
• 三倍曝光機會（1 次丟瓶 = 3 個對象）
• 解鎖對方清晰頭像
• 每天 30 個漂流瓶配額
• 可篩選 MBTI、星座、血型
• 34 種語言自動翻譯
• 無廣告體驗

使用 /vip 立即續費
```

---

## 實施計劃

### Phase 1：審計和文檔（已完成）✅
1. ✅ 審計所有 Callback Query Answer
2. ✅ 審計所有 Send Message
3. ✅ 創建完整的 Emoji 使用規範
4. ✅ 創建優化改善計劃

---

### Phase 2：優先修復（P0）⚠️
**預估時間**：3-4 小時

1. **區分「錯誤 ❌」和「警告 ⚠️」**
   - 修改約 50 處
   - 文件：
     - `src/telegram/handlers/throw_advanced.ts`
     - `src/telegram/handlers/edit_profile.ts`
     - `src/telegram/handlers/onboarding_callback.ts`
     - `src/telegram/handlers/draft.ts`
     - `src/telegram/handlers/ad_reward.ts`

2. **為所有提示添加 Emoji**
   - 修改約 30 處
   - 文件：
     - `src/router.ts`
     - `src/telegram/handlers/conversation_actions.ts`

3. **添加敏感內容檢測提示**
   - 新增功能
   - 文件：
     - `src/telegram/handlers/throw.ts`
     - `src/domain/risk.ts`

---

### Phase 3：場景優化（P1）⚠️
**預估時間**：2-3 小時

1. **為特定場景添加場景 Emoji**
   - 封鎖：🚫
   - 舉報：🚨
   - 刪除：🗑️
   - 支付：💳
   - 處理中：⏳

2. **統一「取消」操作的 Emoji**
   - 統一使用 ❌

3. **統一「處理中」操作的 Emoji**
   - 統一使用 ⏳

---

### Phase 4：文檔和規範（P2）📝
**預估時間**：1-2 小時

1. **更新開發規範**
   - 在 `doc/DEVELOPMENT_STANDARDS.md` 中添加 Emoji 使用要求

2. **創建檢查清單**
   - 新功能開發時的 Emoji 檢查清單

3. **Code Review 指南**
   - 添加 Emoji 使用檢查項目

---

## 測試保護機制

### 1. 單元測試保護

**目標**：確保修改不會破壞現有功能

**策略**：
```typescript
// 在修改前，為關鍵功能添加測試
describe('Callback Query Answer', () => {
  it('should have emoji in success message', () => {
    const message = '✅ 已保存';
    expect(message).toMatch(/^[✅❌⚠️💡🚫⛔🚨🗑️⏳💳💎✏️🎯🎁📺❓]/);
  });

  it('should use warning emoji for permission errors', () => {
    const message = '⚠️ 此功能僅限 VIP 會員使用';
    expect(message).toStartWith('⚠️');
  });
});
```

---

### 2. Smoke Test 保護

**目標**：確保核心功能正常運作

**策略**：
- 在修改前執行完整的 Smoke Test
- 在修改後再次執行 Smoke Test
- 對比結果，確保無回歸

---

### 3. 手動測試清單

**目標**：確保用戶體驗不受影響

**清單**：
- [ ] 註冊流程：每一步都有正確的提示
- [ ] 丟瓶子：成功訊息正確顯示
- [ ] 撿瓶子：成功訊息正確顯示
- [ ] 配對通知：Emoji 正確
- [ ] 錯誤訊息：Emoji 正確且友好
- [ ] 警告訊息：Emoji 正確且清楚
- [ ] VIP 功能：提示正確
- [ ] 任務系統：提示正確
- [ ] 廣告系統：提示正確

---

### 4. 回歸測試

**目標**：確保修改不會破壞其他功能

**策略**：
- 使用 Git 分支進行修改
- 每個 Phase 完成後進行回歸測試
- 發現問題立即回滾
- 修復後再次測試

---

### 5. 漸進式部署

**目標**：降低風險，快速發現問題

**策略**：
1. **Phase 1**：先修改 10% 的提示
2. **測試**：確認無問題
3. **Phase 2**：再修改 30% 的提示
4. **測試**：確認無問題
5. **Phase 3**：修改剩餘的提示
6. **最終測試**：完整回歸測試

---

## 附錄

### A. Emoji 快速參考

| Emoji | 類型 | 使用場景 |
|-------|------|---------|
| ✅ | 成功 | 操作成功完成 |
| ❌ | 錯誤 | 系統錯誤、資料不存在 |
| ⚠️ | 警告 | 權限限制、流程提示 |
| 💡 | 提示 | 友好提示、建議 |
| 🚫 | 封鎖 | 封鎖、禁止 |
| ⛔ | 嚴重禁止 | 違規、封禁 |
| 🚨 | 舉報 | 舉報、報告 |
| 🗑️ | 刪除 | 刪除、清除 |
| ⏳ | 處理中 | 正在處理、等待中 |
| 💳 | 支付 | 支付、交易 |
| 💎 | VIP | VIP 相關 |
| ✏️ | 輸入 | 需要用戶輸入 |
| 🎯 | 任務 | 任務相關 |
| 🎁 | 獎勵 | 獎勵、禮物 |
| 📺 | 廣告 | 廣告相關 |
| ❓ | 未知 | 未知操作 |
| 📢 | 公告 | 系統公告 |
| 🎉 | 慶祝 | 註冊完成、成就 |
| 🌊 | 漂流瓶 | 丟瓶子相關 |
| 🎣 | 撿瓶子 | 撿瓶子相關 |
| 💬 | 對話 | 對話、聊天 |
| 👤 | 個人資料 | 個人資料相關 |
| 📊 | 統計 | 統計、數據 |
| ⚙️ | 設定 | 設定相關 |
| 🏠 | 主選單 | 主選單 |
| 📖 | 幫助 | 幫助、說明 |
| 📜 | 規則 | 規則、條款 |

---

### B. 常見錯誤範例

#### **錯誤 1：混淆「錯誤」和「警告」**

❌ **錯誤**：
```typescript
await telegram.answerCallbackQuery(callbackQuery.id, '❌ 此功能僅限 VIP 會員使用');
```

✅ **正確**：
```typescript
await telegram.answerCallbackQuery(callbackQuery.id, '⚠️ 此功能僅限 VIP 會員使用');
```

---

#### **錯誤 2：缺少 Emoji**

❌ **錯誤**：
```typescript
await telegram.answerCallbackQuery(callbackQuery.id, '已取消');
```

✅ **正確**：
```typescript
await telegram.answerCallbackQuery(callbackQuery.id, '❌ 已取消');
```

---

#### **錯誤 3：使用錯誤的 Emoji**

❌ **錯誤**：
```typescript
await telegram.answerCallbackQuery(callbackQuery.id, '✅ 已封鎖');
```

✅ **正確**：
```typescript
await telegram.answerCallbackQuery(callbackQuery.id, '🚫 已封鎖');
```

---

### C. Code Review 檢查清單

- [ ] 所有 `answerCallbackQuery` 都有 Emoji
- [ ] 「錯誤 ❌」和「警告 ⚠️」使用正確
- [ ] 特定操作使用場景 Emoji（🚫、🚨、🗑️ 等）
- [ ] 訊息簡短清楚（Callback Query Answer）
- [ ] 訊息結構清晰（Send Message）
- [ ] 錯誤訊息友好且提供解決方案
- [ ] 符合本規範的格式要求

---

**版本歷史**：
- v1.0.0 (2025-11-21)：初版發布

**維護者**：XunNi 開發團隊

