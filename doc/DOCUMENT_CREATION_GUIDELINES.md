# XunNi 文檔創建規範

## 1. 原則

### 1.1 優先更新現有文檔

**規則**：
- ✅ **優先更新現有文檔**，而不是創建新文檔
- ✅ **合併相關內容**到主文檔（SPEC.md）中
- ✅ **僅創建獨立詳細設計文檔**當內容非常複雜且需要單獨維護時

### 1.2 文檔分類

**核心文檔**（必須存在）：
- `SPEC.md` - 專案規格書（所有功能的主要描述）
- `README.md` - 文檔索引

**詳細設計文檔**（僅在內容非常複雜時創建）：
- `TRANSLATION_STRATEGY.md` - 翻譯策略（複雜的降級邏輯、成本監控）
- `ROADMAP.md` - 三階段路線圖（獨立的規劃文檔）
- `ONBOARDING_FLOW.md` - 註冊流程（10 步流程，內容豐富）

**不應該創建的文檔**（應該合併到 SPEC.md）：
- ❌ `USER_BLOCKING.md` - 用戶封鎖（內容簡單，應在 SPEC.md 5.10 節）
- ❌ `USER_RIGHTS.md` - 用戶權利（內容簡單，應在 SPEC.md 5.11 節）
- ❌ `DATA_RETENTION.md` - 資料保留（應在 SPEC.md 第 7 節）
- ❌ `AI_MODERATION.md` - AI 審核（應在 SPEC.md 4.3 節）

---

## 2. 文檔創建決策流程

### 2.1 是否創建新文檔？

**創建新文檔的條件**（全部滿足）：
1. ✅ 內容非常複雜（> 500 行詳細設計）
2. ✅ 需要獨立的版本管理（例如：路線圖）
3. ✅ 需要單獨的維護和更新（例如：翻譯策略的成本計算）
4. ✅ 多個團隊需要參考（例如：ONBOARDING_FLOW.md）

**不創建新文檔的條件**（任一滿足）：
1. ❌ 內容簡單（< 200 行）
2. ❌ 與現有文檔內容重複
3. ❌ 可以合併到 SPEC.md 中
4. ❌ 僅是實作範例（應在 SPEC.md 中簡要說明，詳細代碼在代碼庫中）

### 2.2 合併到 SPEC.md 的內容

**應該在 SPEC.md 中的內容**：
- 所有功能的基本描述和流程
- 資料庫 Schema（第 3 節）
- 業務邏輯概述（第 4 節）
- 所有 Telegram 指令（第 5 節）
- 資料保留策略（第 7 節）
- 環境變數（第 9 節）

**可以在獨立文檔中的內容**：
- 非常複雜的實作細節（TRANSLATION_STRATEGY.md）
- 獨立的規劃文檔（ROADMAP.md）
- 詳細的流程設計（ONBOARDING_FLOW.md）

---

## 3. 文檔引用規範

### 3.1 SPEC.md 中的引用

**引用格式**：
```
**詳細設計請參考**：[文檔名稱]（僅簡要說明）
```

**範例**：
```
### 5.10 /block（封鎖功能）

**功能說明**：...
**資料庫表**：`user_blocks`（見 3.4.1 節）
（不再引用 USER_BLOCKING.md，因為內容已合併）
```

### 3.2 獨立文檔中的引用

**引用格式**：
```
詳細實作請參考：SPEC.md 第 X 節
```

**範例**（TRANSLATION_STRATEGY.md）：
```
## 1. 概述

設計多層級翻譯策略，VIP 使用者使用 OpenAI，免費使用者使用 Google Translate。

詳細的翻譯流程和資料庫設計請參考：SPEC.md 第 5.5 節（對話消息轉發）。
```

---

## 4. 文檔維護規範

### 4.1 更新優先級

1. **SPEC.md** - 始終保持最新，包含所有功能的基本描述
2. **詳細設計文檔** - 僅在內容發生重大變化時更新
3. **README.md** - 每次新增/刪除文檔時更新索引

### 4.2 刪除重複文檔

**檢查清單**：
- [ ] 內容是否已在 SPEC.md 中？
- [ ] 內容是否簡單（< 200 行）？
- [ ] 是否與其他文檔重複？

**如果以上任一為是，則**：
1. 將內容合併到 SPEC.md
2. 更新 SPEC.md 中的引用
3. 刪除重複文檔
4. 更新 README.md 索引

---

## 5. 文檔結構規範

### 5.1 SPEC.md 結構

```
1. 專案總覽
2. 技術棧與專案結構
3. 資料庫 Schema
4. 主要業務邏輯
5. 使用流程與 Telegram 指令
6. 星座運勢推播
7. 資料保留與清理策略（新增）
8. 外部資格查詢 API
9. 廣告播放
10. 環境變數與 wrangler 設定
11. 測試規範
12. 開發順序建議
```

### 5.2 獨立文檔結構

```
1. 概述（說明為什麼需要這個文檔）
2. 詳細設計（完整的設計內容）
3. 實作範例（代碼示例）
4. 注意事項
5. 參考（引用 SPEC.md）
```

---

## 6. 範例：正確的文檔組織

### ✅ 正確範例

**SPEC.md**：
```markdown
### 5.10 /block（封鎖功能）

**功能說明**：封鎖當前對話對象...
**流程**：1. ... 2. ...
**資料庫表**：`user_blocks`（見 3.4.1 節）
```

**TRANSLATION_STRATEGY.md**（獨立文檔）：
```markdown
## 1. 概述

設計多層級翻譯策略...

## 2. 翻譯供應商

詳細的翻譯流程請參考：SPEC.md 第 5.5 節（對話消息轉發）。
```

### ❌ 錯誤範例

**創建 USER_BLOCKING.md**：
- ❌ 內容簡單（< 200 行）
- ❌ 可以合併到 SPEC.md 5.10 節
- ❌ 與 SPEC.md 內容重複

---

## 7. 文檔審查清單

在創建新文檔前，檢查：

- [ ] 內容是否已在 SPEC.md 中？
- [ ] 內容是否簡單（< 200 行）？
- [ ] 是否可以合併到現有文檔？
- [ ] 是否有重複內容？
- [ ] 是否真的需要獨立文檔？

**如果以上任一為是，則不創建新文檔，而是更新現有文檔。**

---

**最後更新**：2025-01-15

