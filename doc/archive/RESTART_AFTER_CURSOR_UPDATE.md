# Cursor 更新后执行指南

**创建时间**: 2025-01-23  
**状态**: ✅ 准备就绪  
**模式**: 🤖 **全自动模式**（无需人工干预）

---

## 📋 重启前检查清单

### ✅ 已完成
- [x] 自动化脚本已创建（`scripts/auto-replace-i18n.ts`）
- [x] 备份脚本已创建（`scripts/create-backup-point.sh`）
- [x] 超时、重试、进度记录功能已添加
- [x] 所有更改已提交到 Git
- [x] 当前分支：`i18n-clean-extraction`（或 `main`）

### 📁 关键文件位置
- `scripts/auto-replace-i18n.ts` - 主自动化脚本
- `scripts/ast-replace-i18n.ts` - AST 替换工具（如果存在）
- `scripts/create-backup-point.sh` - 备份脚本
- `i18n_keys_mapping_fixed.json` 或 `i18n_keys_mapping.json` - 映射文件
- `package.json` - 包含 `pnpm i18n:auto-replace` 命令

---

## 🚀 重启后执行步骤

### Step 1: 确认环境（1 分钟）

```bash
# 1. 确认当前分支
git branch --show-current

# 2. 确认脚本存在
ls -la scripts/auto-replace-i18n.ts

# 3. 确认映射文件存在
ls -lh i18n_keys_mapping*.json

# 4. 确认 npm 脚本
grep "i18n:auto-replace" package.json
```

### Step 2: 执行自动化替换

```bash
pnpm i18n:auto-replace
```

### Step 3: 脚本执行流程

**🤖 全自动模式**：脚本会自动执行所有步骤，无需人工干预：

1. **自动备份**（约 1 分钟）
   - 创建备份分支
   - 推送到 GitHub
   - 保持当前分支
   - **失败时自动跳过并继续**

2. **检查必要文件**（约 10 秒）
   - 检查映射文件
   - 检查提取结果文件
   - **文件缺失时自动退出**

3. **执行替换**（约 2-30 分钟，取决于文件数量）
   - 使用 AST 替换工具
   - 自动添加 i18n import
   - 替换硬编码为 `i18n.t()`
   - **有超时保护（5 分钟）**
   - **自动重试（最多 3 次）**
   - **失败时自动跳过并继续**

4. **测试验证**（约 5-10 分钟）
   - `pnpm lint` - 代码检查
   - `pnpm typecheck` - 类型检查
   - `pnpm check:i18n` - 硬编码检查
   - **有超时保护**
   - **失败时自动跳过并继续**

5. **创建替换后备份点**（约 1 分钟）

6. **🤖 自动跳过手动测试**（全自动模式）
   - 跳过中文版本测试
   - 跳过中英文切换测试
   - **建议稍后手动测试**

7. **导入英文翻译**（约 1 分钟）
   - 从 CSV 导入英文翻译
   - **自动执行**

---

## 🔒 安全机制

### 超时保护
- ✅ 每个命令最多 5 分钟超时
- ✅ 避免脚本卡住
- ✅ 超时后自动终止

### 自动重试
- ✅ 失败后自动重试最多 3 次
- ✅ 每次重试间隔 2 秒

### 进度记录
- ✅ 自动保存到 `.i18n-replace-progress.json`
- ✅ 支持断点续传
- ✅ 脚本中断后重新运行会自动继续

### 跳过功能
- ✅ 可以输入 `skip` 跳过失败的步骤
- ✅ 可以跳过已完成的步骤
- ✅ 继续执行后续步骤

---

## 💡 如果遇到问题

### 问题 1: 脚本卡住
**解决方案**：
- 脚本有 5 分钟超时保护
- 如果超时，会提示并询问是否继续
- 可以输入 `skip` 跳过该步骤

### 问题 2: 某个步骤失败
**解决方案**：
- 输入 `skip` 跳过失败的步骤
- 脚本会继续执行后续步骤
- 可以手动修复后重新运行（会自动继续）

### 问题 3: 脚本中断
**解决方案**：
- 重新运行 `pnpm i18n:auto-replace`
- 脚本会自动检测进度文件
- 询问是否继续上次的进度
- 输入 `y` 继续，`n` 重新开始

### 问题 4: 需要回滚
**解决方案**：
```bash
# 查看备份分支
git branch | grep backup

# 回滚到备份点
git checkout backup-before-replacement-*
```

---

## 📋 执行前确认

- [ ] 当前分支正确（`i18n-clean-extraction` 或 `main`）
- [ ] 映射文件存在
- [ ] 工作区干净（没有未提交的更改）
- [ ] 可以随时回滚

---

## 🎯 执行命令

```bash
pnpm i18n:auto-replace
```

---

**准备好后，直接运行上面的命令即可！** 🚀

