# ğŸ§ª æ¸¬è©¦æ¨¡å¼é©—æ”¶æŒ‡å—

**ç›®çš„**: åœ¨æ²’æœ‰çœŸå¯¦å»£å‘Šæä¾›å•†çš„æƒ…æ³ä¸‹ï¼Œæ¸¬è©¦å»£å‘Šç³»çµ±çš„å®Œæ•´æµç¨‹

**å„ªå‹¢**:
- âœ… ä¸éœ€è¦ç­‰å¾… GigaPub å¯©æ ¸
- âœ… ä¸æ¶ˆè€—çœŸå¯¦å»£å‘Šé ç®—
- âœ… å¯ä»¥ç„¡é™æ¬¡æ¸¬è©¦
- âœ… å®Œæ•´æ¨¡æ“¬çœŸå¯¦æµç¨‹

---

## ğŸš€ **å¿«é€Ÿé–‹å§‹**

### **Step 1: åŸ·è¡Œæ¸¬è©¦æ¨¡å¼ Migrations**

```bash
# 1. æœ¬åœ°æ¸¬è©¦
cd /Users/yichen/Downloads/cursor/XunNi

# 2. åŸ·è¡Œ Migrationsï¼ˆå¦‚æœé‚„æ²’åŸ·è¡Œï¼‰
wrangler d1 migrations apply DB --local

# 3. åˆå§‹åŒ–æ¸¬è©¦æ¨¡å¼å»£å‘Šæä¾›å•†
wrangler d1 execute DB --local --file=./scripts/init-ad-providers-test.sql

# 4. é©—è­‰é…ç½®
wrangler d1 execute DB --local --command "SELECT * FROM ad_providers WHERE provider_name = 'gigapub_test';"
```

**é æœŸè¼¸å‡ºï¼š**
```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ provider_name  â”‚ display_name         â”‚ is_enabled â”‚ priority â”‚ weight â”‚ config                          â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ gigapub_test   â”‚ GigaPub (æ¸¬è©¦æ¨¡å¼)    â”‚ 1          â”‚ 100      â”‚ 100    â”‚ {"test_mode":1,"api_key":"...} â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **Step 2: å•Ÿå‹•æœ¬åœ°é–‹ç™¼æœå‹™å™¨**

```bash
# å•Ÿå‹• Cloudflare Workers æœ¬åœ°é–‹ç™¼æœå‹™å™¨
pnpm dev

# é æœŸè¼¸å‡ºï¼š
# â›…ï¸ wrangler 3.x.x
# ------------------
# â” Starting local server...
# [wrangler:inf] Ready on http://localhost:8787
```

**ä¿æŒé€™å€‹çµ‚ç«¯çª—å£æ‰“é–‹ï¼**

---

### **Step 3: è¨­ç½®æ¸¬è©¦ç”¨æˆ¶**

**æ‰“é–‹æ–°çš„çµ‚ç«¯çª—å£ï¼š**

```bash
# 1. å‰µå»ºæ¸¬è©¦ç”¨æˆ¶ï¼ˆå¦‚æœé‚„æ²’æœ‰ï¼‰
wrangler d1 execute DB --local --command "
INSERT INTO users (
  telegram_id, 
  nickname, 
  gender, 
  birthday, 
  language_pref, 
  onboarding_completed
) VALUES (
  '999999999',
  'æ¸¬è©¦ç”¨æˆ¶',
  'male',
  '2000-01-01',
  'zh-TW',
  1
) ON CONFLICT(telegram_id) DO NOTHING;
"

# 2. è¨­ç½®ç‚ºç®¡ç†å“¡ï¼ˆå¯é¸ï¼Œç”¨æ–¼æŸ¥çœ‹å ±è¡¨ï¼‰
wrangler d1 execute DB --local --command "
UPDATE users 
SET is_super_admin = 1 
WHERE telegram_id = '999999999';
"

# 3. é©—è­‰ç”¨æˆ¶
wrangler d1 execute DB --local --command "
SELECT telegram_id, nickname, is_super_admin 
FROM users 
WHERE telegram_id = '999999999';
"
```

---

## âœ… **é©—æ”¶æ¸¬è©¦æ¸…å–®**

### **æ¸¬è©¦ A: ç¬¬ä¸‰æ–¹å»£å‘Š - åŸºæœ¬æµç¨‹ â­â­â­â­â­**

#### **A1. æ¨¡æ“¬ç”¨æˆ¶è§€çœ‹å»£å‘Š**

**æ­¥é©Ÿ 1: ç”Ÿæˆæ¸¬è©¦ Token**

```bash
# åœ¨ç€è¦½å™¨ä¸­æ‰“é–‹ï¼ˆéœ€è¦å…ˆå•Ÿå‹• pnpm devï¼‰
# é€™æœƒæ¨¡æ“¬ç”¨æˆ¶é»æ“Šã€Œè§€çœ‹å»£å‘Šã€æŒ‰éˆ•

# æ–¹å¼ 1: ç›´æ¥è¨ªå•æ¸¬è©¦é é¢
open "http://localhost:8787/ad-test.html?user=999999999&token=test_token_123&provider=gigapub_test"

# æ–¹å¼ 2: ä½¿ç”¨ curl æ¸¬è©¦ API
curl -X POST "http://localhost:8787/api/ad/complete?user=999999999&token=test_token_123&provider=gigapub_test"
```

**é æœŸçµæœï¼š**
```json
{
  "success": true,
  "message": "å»£å‘Šçå‹µå·²ç™¼æ”¾"
}
```

---

#### **A2. é©—è­‰é¡åº¦å¢åŠ **

```bash
# æª¢æŸ¥ç”¨æˆ¶é¡åº¦
wrangler d1 execute DB --local --command "
SELECT telegram_id, daily_quota, permanent_quota 
FROM users 
WHERE telegram_id = '999999999';
"
```

**é æœŸçµæœï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ telegram_id  â”‚ daily_quota  â”‚ permanent_quota  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 999999999    â”‚ 1            â”‚ 0                â”‚  â† daily_quota å¢åŠ äº† 1
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **A3. é©—è­‰å»£å‘Šè¨˜éŒ„**

```bash
# æª¢æŸ¥å»£å‘Šçå‹µè¨˜éŒ„
wrangler d1 execute DB --local --command "
SELECT 
  user_id, 
  ad_provider_name, 
  reward_amount, 
  reward_status,
  created_at
FROM ad_rewards 
WHERE user_id = '999999999'
ORDER BY created_at DESC 
LIMIT 5;
"
```

**é æœŸçµæœï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_id   â”‚ ad_provider_name  â”‚ reward_amount â”‚ reward_status â”‚ created_at          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 999999999 â”‚ gigapub_test      â”‚ 1             â”‚ completed     â”‚ 2025-01-18 10:30:00 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… é©—æ”¶æ¨™æº–ï¼š**
- [ ] æ¸¬è©¦é é¢æ­£å¸¸é¡¯ç¤º
- [ ] 15 ç§’å€’è¨ˆæ™‚æ­£å¸¸é‹ä½œ
- [ ] é€²åº¦æ¢å‹•ç•«æµæš¢
- [ ] é»æ“Šã€Œå®Œæˆè§€çœ‹ã€å¾Œæ”¶åˆ°æˆåŠŸè¨Šæ¯
- [ ] ç”¨æˆ¶é¡åº¦å¢åŠ  +1
- [ ] ad_rewards è¡¨æœ‰æ–°è¨˜éŒ„
- [ ] reward_status = 'completed'

---

### **æ¸¬è©¦ B: æ¯æ—¥é™åˆ¶æ¸¬è©¦ â­â­â­â­**

#### **B1. é€£çºŒè§€çœ‹ 20 æ¬¡**

```bash
# ä½¿ç”¨å¾ªç’°æ¸¬è©¦æ¯æ—¥é™åˆ¶
for i in {1..20}; do
  echo "ç¬¬ $i æ¬¡è§€çœ‹..."
  curl -s -X POST "http://localhost:8787/api/ad/complete?user=999999999&token=test_token_$i&provider=gigapub_test" | jq
  sleep 1
done
```

**é æœŸçµæœï¼š**
- å‰ 20 æ¬¡éƒ½è¿”å› `{"success": true}`
- ç¬¬ 21 æ¬¡è¿”å› `{"success": false, "message": "ä»Šæ—¥å»£å‘Šå·²é”ä¸Šé™"}`

---

#### **B2. é©—è­‰çµ±è¨ˆæ•¸æ“š**

```bash
# æª¢æŸ¥ä»Šæ—¥å»£å‘Šçµ±è¨ˆ
wrangler d1 execute DB --local --command "
SELECT 
  user_id,
  COUNT(*) as total_ads,
  SUM(CASE WHEN reward_status = 'completed' THEN 1 ELSE 0 END) as completed_ads,
  SUM(CASE WHEN reward_status = 'completed' THEN reward_amount ELSE 0 END) as total_quota
FROM ad_rewards 
WHERE user_id = '999999999'
  AND DATE(created_at) = DATE('now')
GROUP BY user_id;
"
```

**é æœŸçµæœï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_id   â”‚ total_ads â”‚ completed_ads â”‚ total_quota â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 999999999 â”‚ 20        â”‚ 20            â”‚ 20          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… é©—æ”¶æ¨™æº–ï¼š**
- [ ] å¯ä»¥è§€çœ‹ 20 æ¬¡å»£å‘Š
- [ ] ç¬¬ 21 æ¬¡è¢«æ­£ç¢ºé˜»æ­¢
- [ ] çµ±è¨ˆæ•¸æ“šæº–ç¢ºï¼ˆ20/20ï¼‰
- [ ] ç¸½é¡åº¦å¢åŠ  20

---

### **æ¸¬è©¦ C: å®˜æ–¹å»£å‘Šæ¸¬è©¦ â­â­â­â­â­**

#### **C1. å‰µå»ºæ¸¬è©¦å®˜æ–¹å»£å‘Š**

```bash
# å‰µå»ºæ¸¬è©¦å®˜æ–¹å»£å‘Š
wrangler d1 execute DB --local --command "
INSERT INTO official_ads (
  ad_type,
  title,
  content,
  reward_quota,
  is_enabled
) VALUES (
  'text',
  'ğŸ‰ æ¸¬è©¦æ­¡è¿å»£å‘Š',
  'æ„Ÿè¬æ‚¨æ¸¬è©¦ XunNi å»£å‘Šç³»çµ±ï¼é»æ“Šé ˜å– +2 å€‹æ°¸ä¹…é¡åº¦ä½œç‚ºæ¸¬è©¦çå‹µï¼',
  2,
  1
);
"

# ç²å–å»£å‘Š ID
wrangler d1 execute DB --local --command "
SELECT id, title, reward_quota 
FROM official_ads 
WHERE title LIKE '%æ¸¬è©¦%';
"
```

---

#### **C2. æ¨¡æ“¬é ˜å–å®˜æ–¹å»£å‘Š**

```bash
# å‡è¨­å»£å‘Š ID æ˜¯ 1
AD_ID=1

# 1. è¨˜éŒ„å»£å‘Šè§€çœ‹
wrangler d1 execute DB --local --command "
INSERT INTO official_ad_views (
  user_id,
  official_ad_id,
  is_claimed
) VALUES (
  '999999999',
  $AD_ID,
  0
);
"

# 2. æ¨¡æ“¬é ˜å–çå‹µ
wrangler d1 execute DB --local --command "
UPDATE official_ad_views 
SET is_claimed = 1, 
    claimed_at = CURRENT_TIMESTAMP
WHERE user_id = '999999999' 
  AND official_ad_id = $AD_ID;
"

# 3. å¢åŠ æ°¸ä¹…é¡åº¦
wrangler d1 execute DB --local --command "
UPDATE users 
SET permanent_quota = COALESCE(permanent_quota, 0) + 2
WHERE telegram_id = '999999999';
"
```

---

#### **C3. é©—è­‰æ°¸ä¹…é¡åº¦**

```bash
# æª¢æŸ¥æ°¸ä¹…é¡åº¦
wrangler d1 execute DB --local --command "
SELECT 
  telegram_id, 
  daily_quota, 
  permanent_quota 
FROM users 
WHERE telegram_id = '999999999';
"
```

**é æœŸçµæœï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ telegram_id  â”‚ daily_quota  â”‚ permanent_quota  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 999999999    â”‚ 20           â”‚ 2                â”‚  â† permanent_quota å¢åŠ äº† 2
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… é©—æ”¶æ¨™æº–ï¼š**
- [ ] å®˜æ–¹å»£å‘Šå‰µå»ºæˆåŠŸ
- [ ] å¯ä»¥è¨˜éŒ„è§€çœ‹
- [ ] å¯ä»¥é ˜å–çå‹µ
- [ ] æ°¸ä¹…é¡åº¦æ­£ç¢ºå¢åŠ 
- [ ] ä¸æœƒé‡è¤‡é ˜å–

---

### **æ¸¬è©¦ D: éŒ¯èª¤è™•ç†æ¸¬è©¦ â­â­â­**

#### **D1. ç„¡æ•ˆ Token æ¸¬è©¦**

```bash
# ä½¿ç”¨ç„¡æ•ˆ Token
curl -X POST "http://localhost:8787/api/ad/complete?user=999999999&token=invalid_token&provider=gigapub_test"
```

**é æœŸçµæœï¼š**
```json
{
  "success": false,
  "message": "ç„¡æ•ˆçš„å»£å‘Šå®Œæˆè«‹æ±‚æˆ– Token å·²éæœŸ"
}
```

---

#### **D2. ä¸å­˜åœ¨çš„ç”¨æˆ¶æ¸¬è©¦**

```bash
# ä½¿ç”¨ä¸å­˜åœ¨çš„ç”¨æˆ¶ ID
curl -X POST "http://localhost:8787/api/ad/complete?user=000000000&token=test_token&provider=gigapub_test"
```

**é æœŸçµæœï¼š**
```json
{
  "success": false,
  "message": "ç”¨æˆ¶æœªæ‰¾åˆ°"
}
```

---

#### **D3. è¶…éæ¯æ—¥é™åˆ¶æ¸¬è©¦**

```bash
# åœ¨å·²ç¶“è§€çœ‹ 20 æ¬¡å¾Œå†æ¬¡å˜—è©¦
curl -X POST "http://localhost:8787/api/ad/complete?user=999999999&token=test_token_21&provider=gigapub_test"
```

**é æœŸçµæœï¼š**
```json
{
  "success": false,
  "message": "æ‚¨ä»Šå¤©å·²é”åˆ°è§€çœ‹å»£å‘Šçš„ä¸Šé™"
}
```

**âœ… é©—æ”¶æ¨™æº–ï¼š**
- [ ] ç„¡æ•ˆ Token è¢«æ­£ç¢ºæ‹’çµ•
- [ ] ä¸å­˜åœ¨çš„ç”¨æˆ¶è¢«æ­£ç¢ºè™•ç†
- [ ] è¶…éé™åˆ¶è¢«æ­£ç¢ºé˜»æ­¢
- [ ] éŒ¯èª¤è¨Šæ¯æ¸…æ™°æ˜ç¢º

---

## ğŸ“Š **å®Œæ•´é©—æ”¶å ±å‘Š**

### **é©—æ”¶çµæœçµ±è¨ˆ**

```bash
# ç”Ÿæˆé©—æ”¶å ±å‘Š
wrangler d1 execute DB --local --command "
SELECT 
  'ç¬¬ä¸‰æ–¹å»£å‘Š' as test_category,
  COUNT(*) as total_tests,
  SUM(CASE WHEN reward_status = 'completed' THEN 1 ELSE 0 END) as passed,
  SUM(CASE WHEN reward_status = 'failed' THEN 1 ELSE 0 END) as failed
FROM ad_rewards
WHERE user_id = '999999999'

UNION ALL

SELECT 
  'å®˜æ–¹å»£å‘Š' as test_category,
  COUNT(*) as total_tests,
  SUM(CASE WHEN is_claimed = 1 THEN 1 ELSE 0 END) as passed,
  SUM(CASE WHEN is_claimed = 0 THEN 1 ELSE 0 END) as failed
FROM official_ad_views
WHERE user_id = '999999999';
"
```

**é æœŸè¼¸å‡ºï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ test_category â”‚ total_tests â”‚ passed â”‚ failed â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¬¬ä¸‰æ–¹å»£å‘Š     â”‚ 20          â”‚ 20     â”‚ 0      â”‚
â”‚ å®˜æ–¹å»£å‘Š       â”‚ 1           â”‚ 1      â”‚ 0      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ **é©—æ”¶ç¸½çµ**

### **å¿…é ˆé€šéçš„æ¸¬è©¦ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰ï¼š**

| æ¸¬è©¦é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|---------|------|------|
| A1. åŸºæœ¬å»£å‘Šæµç¨‹ | â¬œ å¾…æ¸¬è©¦ | è§€çœ‹å»£å‘Šä¸¦ç²å¾—çå‹µ |
| A2. é¡åº¦å¢åŠ é©—è­‰ | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªé¡åº¦æ­£ç¢ºå¢åŠ  |
| A3. å»£å‘Šè¨˜éŒ„é©—è­‰ | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªæ•¸æ“šåº«è¨˜éŒ„æ­£ç¢º |
| B1. æ¯æ—¥é™åˆ¶ï¼ˆ20æ¬¡ï¼‰ | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªå¯ä»¥è§€çœ‹ 20 æ¬¡ |
| B2. è¶…éé™åˆ¶é˜»æ­¢ | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªç¬¬ 21 æ¬¡è¢«é˜»æ­¢ |
| C1. å®˜æ–¹å»£å‘Šå‰µå»º | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªå¯ä»¥å‰µå»ºå»£å‘Š |
| C2. å®˜æ–¹å»£å‘Šé ˜å– | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªå¯ä»¥é ˜å–çå‹µ |
| C3. æ°¸ä¹…é¡åº¦å¢åŠ  | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªæ°¸ä¹…é¡åº¦æ­£ç¢º |

### **å»ºè­°é€šéçš„æ¸¬è©¦ï¼ˆéŒ¯èª¤è™•ç†ï¼‰ï¼š**

| æ¸¬è©¦é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|---------|------|------|
| D1. ç„¡æ•ˆ Token | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªéŒ¯èª¤è™•ç†æ­£ç¢º |
| D2. ä¸å­˜åœ¨ç”¨æˆ¶ | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªéŒ¯èª¤è™•ç†æ­£ç¢º |
| D3. è¶…éé™åˆ¶ | â¬œ å¾…æ¸¬è©¦ | ç¢ºèªéŒ¯èª¤è™•ç†æ­£ç¢º |

---

## ğŸš€ **é–‹å§‹æ¸¬è©¦**

**åŸ·è¡Œä»¥ä¸‹å‘½ä»¤é–‹å§‹æ¸¬è©¦ï¼š**

```bash
# 1. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨ï¼ˆä¿æŒé‹è¡Œï¼‰
pnpm dev

# 2. åœ¨æ–°çµ‚ç«¯åŸ·è¡Œæ¸¬è©¦
cd /Users/yichen/Downloads/cursor/XunNi

# 3. åŸ·è¡Œ Migrations
wrangler d1 migrations apply DB --local

# 4. åˆå§‹åŒ–æ¸¬è©¦æ•¸æ“š
wrangler d1 execute DB --local --file=./scripts/init-ad-providers-test.sql

# 5. æ‰“é–‹æ¸¬è©¦é é¢
open "http://localhost:8787/ad-test.html?user=999999999&token=test_token_123&provider=gigapub_test"
```

---

## ğŸ“ **æ¸¬è©¦å®Œæˆå¾Œ**

**æ¸…ç†æ¸¬è©¦æ•¸æ“šï¼ˆå¯é¸ï¼‰ï¼š**

```bash
# åˆªé™¤æ¸¬è©¦ç”¨æˆ¶çš„å»£å‘Šè¨˜éŒ„
wrangler d1 execute DB --local --command "
DELETE FROM ad_rewards WHERE user_id = '999999999';
DELETE FROM official_ad_views WHERE user_id = '999999999';
DELETE FROM users WHERE telegram_id = '999999999';
"
```

---

**æº–å‚™å¥½é–‹å§‹æ¸¬è©¦äº†å—ï¼Ÿ** ğŸ‰

**åŸ·è¡Œä¸Šè¿°å‘½ä»¤ï¼Œç„¶å¾Œå‘Šè¨´æˆ‘æ¸¬è©¦çµæœï¼** ğŸš€

