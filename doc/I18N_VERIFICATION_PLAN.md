# i18n å…¨é¢æ£€éªŒè®¡åˆ’

## æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†å…¨é¢çš„ i18n æ£€éªŒæµç¨‹ï¼ŒåŒ…æ‹¬æœºå™¨æ£€æŸ¥å’Œ AI æ£€æŸ¥ï¼Œç¡®ä¿æ‰€æœ‰ä»£ç ä¸ `i18n_for_translation.csv` å®Œç¾å¯¹åº”ï¼Œæ— ç¡¬ç¼–ç ä¸­æ–‡ã€‚

## æ£€éªŒç›®æ ‡

1. **ä»£ç å®Œæ•´æ€§**ï¼šæ‰€æœ‰ `*.ts` æ–‡ä»¶ä¸­çš„ i18n keys éƒ½åœ¨ CSV ä¸­å­˜åœ¨
2. **æ— ç¡¬ç¼–ç **ï¼šæ‰€æœ‰ç”¨æˆ·å¯è§çš„ä¸­æ–‡å­—ç¬¦ä¸²éƒ½ä½¿ç”¨ i18n
3. **æ•°æ®åº“ä¸€è‡´æ€§**ï¼šæ•°æ®åº“ä¸­çš„ç¡¬ç¼–ç å·²è¿ç§»åˆ° i18n keys
4. **ç±»å‹å®‰å…¨**ï¼šæ‰€æœ‰ i18n keys åœ¨ TypeScript ç±»å‹ä¸­å®šä¹‰

## æ£€éªŒèŒƒå›´

### 1. ä»£ç æ–‡ä»¶æ£€æŸ¥

**ç›®æ ‡æ–‡ä»¶**ï¼š
- `src/telegram/handlers/*.ts` - æ‰€æœ‰ Telegram å¤„ç†å™¨
- `src/services/*.ts` - æ‰€æœ‰æœåŠ¡å±‚æ–‡ä»¶
- `src/utils/*.ts` - æ‰€æœ‰å·¥å…·å‡½æ•°
- `src/domain/*.ts` - æ‰€æœ‰é¢†åŸŸé€»è¾‘æ–‡ä»¶
- `src/router.ts` - è·¯ç”±æ–‡ä»¶
- `src/worker.ts` - Worker å…¥å£æ–‡ä»¶
- `src/api/*.ts` - API ç«¯ç‚¹æ–‡ä»¶

**æ£€æŸ¥é¡¹**ï¼š
- [ ] æ‰€æœ‰ `i18n.t()` è°ƒç”¨çš„ key åœ¨ CSV ä¸­å­˜åœ¨
- [ ] æ‰€æœ‰ç”¨æˆ·å¯è§å­—ç¬¦ä¸²éƒ½ä½¿ç”¨ i18n
- [ ] æ— ç¡¬ç¼–ç ä¸­æ–‡å­—ç¬¦ä¸²ï¼ˆæŠ€æœ¯æ ‡è¯†ç¬¦é™¤å¤–ï¼‰
- [ ] æ‰€æœ‰ `createI18n()` éƒ½ä½¿ç”¨ `user.language_pref`

### 2. è·¯ç”±æ£€æŸ¥

**ç›®æ ‡æ–‡ä»¶**ï¼š
- `src/router.ts` - ä¸»è·¯ç”±æ–‡ä»¶
- `src/worker.ts` - Worker å…¥å£å’Œ HTTP è·¯ç”±

**æ£€æŸ¥é¡¹**ï¼š
- [ ] æ‰€æœ‰è·¯ç”±å›è°ƒå¤„ç†éƒ½è·å–ç”¨æˆ·è¯­è¨€åå¥½
- [ ] æ‰€æœ‰ `createI18n()` è°ƒç”¨éƒ½ä½¿ç”¨ `user.language_pref || 'zh-TW'`
- [ ] æ‰€æœ‰ `sendMessage`ã€`answerCallbackQuery` ç­‰è°ƒç”¨éƒ½ä½¿ç”¨ i18n
- [ ] æ‰€æœ‰é”™è¯¯æ¶ˆæ¯éƒ½ä½¿ç”¨ i18n
- [ ] æ‰€æœ‰æŒ‰é’®æ–‡æœ¬éƒ½ä½¿ç”¨ i18n
- [ ] è·¯ç”±ä¸­çš„ç¡¬ç¼–ç ä¸­æ–‡å·²æ›¿æ¢ï¼ˆå¦‚ `lang_back`ã€`lang_page_` ç­‰å›è°ƒï¼‰
- [ ] Webhook å¤„ç†ä¸­çš„æ¶ˆæ¯éƒ½ä½¿ç”¨ i18nï¼ˆå¦‚éœ€è¦ï¼‰

**ç‰¹æ®Šæ£€æŸ¥**ï¼š
- [ ] `routeUpdate` å‡½æ•°ä¸­çš„æ‰€æœ‰æ¶ˆæ¯å¤„ç†éƒ½ä½¿ç”¨ i18n
- [ ] Callback query è·¯ç”±ï¼ˆå¦‚ `lang_back`ã€`lang_page_`ï¼‰éƒ½æ­£ç¡®è·å–ç”¨æˆ·è¯­è¨€
- [ ] å‘½ä»¤è·¯ç”±ï¼ˆå¦‚ `/start`ã€`/throw`ï¼‰éƒ½æ­£ç¡®ä¼ é€’è¯­è¨€åå¥½

### 3. æ•°æ®åº“æ£€æŸ¥

**ç›®æ ‡è¡¨**ï¼š
- `tasks` è¡¨çš„ `name` å’Œ `description` å­—æ®µ
- å…¶ä»–å¯èƒ½åŒ…å«ç¡¬ç¼–ç ä¸­æ–‡çš„è¡¨ï¼ˆå¦‚ `users`ã€`bottles` ç­‰ï¼‰

**æ£€æŸ¥é¡¹**ï¼š
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬å·²åˆ›å»º
- [ ] è¿ç§»è„šæœ¬å°†ä¸­æ–‡æ›¿æ¢ä¸º i18n keysï¼ˆæ ¼å¼ï¼š`tasks.name.xxx`ï¼‰
- [ ] ä»£ç ä¸­è¯»å–æ•°æ®åº“æ—¶ä½¿ç”¨ `i18n.t()` ç¿»è¯‘
- [ ] å‘åå…¼å®¹ï¼šæ”¯æŒæ—§æ•°æ®ï¼ˆç›´æ¥ä½¿ç”¨ï¼‰å’Œæ–°æ•°æ®ï¼ˆi18n keyï¼‰
- [ ] æ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢éƒ½æ­£ç¡®å¤„ç† i18n keys
- [ ] æ•°æ®åº“å†™å…¥æ—¶ä½¿ç”¨ i18n keysï¼ˆå¦‚é€‚ç”¨ï¼‰

**SQL æ£€æŸ¥**ï¼š
- [ ] æ£€æŸ¥æ‰€æœ‰è¿ç§»è„šæœ¬ä¸­çš„ç¡¬ç¼–ç ä¸­æ–‡
- [ ] æ£€æŸ¥æ‰€æœ‰ SQL æŸ¥è¯¢ä¸­çš„ç¡¬ç¼–ç ä¸­æ–‡
- [ ] éªŒè¯è¿ç§»è„šæœ¬å·²æ‰§è¡Œï¼ˆæµ‹è¯•/ç”Ÿäº§ç¯å¢ƒï¼‰

### 4. ç½‘ç»œ/API æ£€æŸ¥

**ç›®æ ‡æ–‡ä»¶**ï¼š
- `src/services/*.ts` - æ‰€æœ‰æœåŠ¡å±‚æ–‡ä»¶ï¼ˆAPI è°ƒç”¨ï¼‰
- `src/api/*.ts` - API ç«¯ç‚¹æ–‡ä»¶
- `src/worker.ts` - HTTP è·¯ç”±å¤„ç†

**æ£€æŸ¥é¡¹**ï¼š
- [ ] æ‰€æœ‰å¤–éƒ¨ API è°ƒç”¨çš„é”™è¯¯æ¶ˆæ¯éƒ½ä½¿ç”¨ i18n
- [ ] æ‰€æœ‰ HTTP å“åº”ä¸­çš„ç”¨æˆ·å¯è§æ¶ˆæ¯éƒ½ä½¿ç”¨ i18n
- [ ] Telegram API è°ƒç”¨ä¸­çš„æ¶ˆæ¯éƒ½ä½¿ç”¨ i18n
- [ ] ç¿»è¯‘æœåŠ¡ï¼ˆGoogleã€OpenAIã€Geminiï¼‰çš„é”™è¯¯å¤„ç†éƒ½ä½¿ç”¨ i18n
- [ ] Webhook å›è°ƒä¸­çš„æ¶ˆæ¯éƒ½ä½¿ç”¨ i18n
- [ ] API ç«¯ç‚¹çš„å“åº”æ¶ˆæ¯éƒ½ä½¿ç”¨ i18nï¼ˆå¦‚éœ€è¦ï¼‰

**ç½‘ç»œè¯·æ±‚æ£€æŸ¥**ï¼š
- [ ] `fetch` è°ƒç”¨çš„é”™è¯¯å¤„ç†éƒ½ä½¿ç”¨ i18n
- [ ] API å“åº”è§£æé”™è¯¯éƒ½ä½¿ç”¨ i18n
- [ ] è¶…æ—¶é”™è¯¯éƒ½ä½¿ç”¨ i18n
- [ ] ç½‘ç»œé”™è¯¯éƒ½ä½¿ç”¨ i18n

**å¤–éƒ¨æœåŠ¡æ£€æŸ¥**ï¼š
- [ ] Telegram Bot API è°ƒç”¨éƒ½ä½¿ç”¨ i18n
- [ ] Google Translate API é”™è¯¯éƒ½ä½¿ç”¨ i18n
- [ ] OpenAI API é”™è¯¯éƒ½ä½¿ç”¨ i18n
- [ ] Gemini API é”™è¯¯éƒ½ä½¿ç”¨ i18n
- [ ] å…¶ä»–ç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯éƒ½ä½¿ç”¨ i18n

### 5. CSV å®Œæ•´æ€§æ£€æŸ¥

**æ£€æŸ¥é¡¹**ï¼š
- [ ] CSV åŒ…å«æ‰€æœ‰ä»£ç ä¸­ä½¿ç”¨çš„ i18n keys
- [ ] CSV åŒ…å«æ‰€æœ‰æ•°æ®åº“è¿ç§»ç”Ÿæˆçš„ keys
- [ ] CSV æ ¼å¼æ­£ç¡®ï¼ˆkey,zh-TW,zh-CN,en,...ï¼‰
- [ ] æ‰€æœ‰å¿…éœ€çš„è¯­è¨€åˆ—éƒ½å­˜åœ¨ï¼ˆ34 ç§è¯­è¨€ï¼‰

## æœºå™¨æ£€æŸ¥æ–¹æ³•

### 1. ç¡¬ç¼–ç æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰ *.ts æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç ä¸­æ–‡
pnpm check:i18n

# æ£€æŸ¥ç‰¹å®šæ–‡ä»¶
pnpm check:i18n | grep "filename.ts"
```

**æ£€æŸ¥è§„åˆ™**ï¼š
- æ’é™¤æŠ€æœ¯æ ‡è¯†ç¬¦ï¼ˆcallback_data, regex ç­‰ï¼‰
- æ’é™¤æ³¨é‡Šä¸­çš„ä¸­æ–‡
- æ’é™¤ console.log/error ä¸­çš„ä¸­æ–‡
- æ’é™¤ç±»å‹å®šä¹‰ä¸­çš„ä¸­æ–‡

### 2. i18n Key å­˜åœ¨æ€§æ£€æŸ¥

```bash
# æå–æ‰€æœ‰ä»£ç ä¸­ä½¿ç”¨çš„ i18n keys
grep -roh "i18n\.t('[^']*')" src --include="*.ts" | \
  sed "s/i18n\.t('//;s/')$//" | sort -u > /tmp/code_keys.txt

# æå– CSV ä¸­çš„æ‰€æœ‰ keys
cut -d',' -f1 i18n_for_translation.csv | tail -n +2 | sort > /tmp/csv_keys.txt

# æ‰¾å‡ºä»£ç ä¸­ä½¿ç”¨ä½† CSV ä¸­ä¸å­˜åœ¨çš„ keys
comm -23 /tmp/code_keys.txt /tmp/csv_keys.txt

# æ‰¾å‡º CSV ä¸­å­˜åœ¨ä½†ä»£ç ä¸­æœªä½¿ç”¨çš„ keysï¼ˆå¯é€‰ï¼‰
comm -13 /tmp/code_keys.txt /tmp/csv_keys.txt
```

### 3. ç±»å‹æ£€æŸ¥

```bash
# TypeScript ç±»å‹æ£€æŸ¥
pnpm typecheck

# æ£€æŸ¥ i18n types æ˜¯å¦å®Œæ•´
grep -r "i18n\.t(" src --include="*.ts" | \
  grep -o "i18n\.t('[^']*')" | \
  sed "s/i18n\.t('//;s/')$//" | \
  sort -u | \
  while read key; do
    if ! grep -q "$key" src/i18n/types.ts; then
      echo "Missing in types.ts: $key"
    fi
  done
```

### 4. è·¯ç”±æ£€æŸ¥

```bash
# æ£€æŸ¥è·¯ç”±æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç ä¸­æ–‡
pnpm check:i18n | grep "router.ts"

# æ£€æŸ¥è·¯ç”±ä¸­çš„ createI18n è°ƒç”¨
grep -r "createI18n" src/router.ts

# æ£€æŸ¥è·¯ç”±ä¸­çš„ sendMessage è°ƒç”¨æ˜¯å¦ä½¿ç”¨ i18n
grep -A 2 "sendMessage\|answerCallbackQuery" src/router.ts | grep -v "i18n.t"

# æ£€æŸ¥ callback query è·¯ç”±æ˜¯å¦æ­£ç¡®è·å–ç”¨æˆ·è¯­è¨€
grep -B 5 -A 10 "lang_back\|lang_page_" src/router.ts
```

### 5. æ•°æ®åº“è¿ç§»æ£€æŸ¥

```bash
# æ£€æŸ¥è¿ç§»è„šæœ¬æ˜¯å¦å­˜åœ¨
ls -la src/db/migrations/*tasks*.sql

# æ£€æŸ¥è¿ç§»è„šæœ¬ä¸­çš„ i18n keys æ ¼å¼
grep -E "tasks\.(name|description)\." src/db/migrations/*.sql

# æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦æ­£ç¡®å¤„ç†æ•°æ®åº“ i18n keys
grep -r "task\.name\|task\.description" src/telegram/handlers --include="*.ts"

# æ£€æŸ¥æ‰€æœ‰ SQL æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç ä¸­æ–‡
grep -r "[\u4e00-\u9fa5]" src/db/migrations/*.sql

# æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç 
grep -r "[\u4e00-\u9fa5]" src/db/queries --include="*.ts"
```

### 6. ç½‘ç»œ/API æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰ fetch è°ƒç”¨
grep -r "fetch(" src --include="*.ts" | grep -v "node_modules"

# æ£€æŸ¥ API æœåŠ¡æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç 
pnpm check:i18n | grep -E "(services|api)/"

# æ£€æŸ¥å¤–éƒ¨ API è°ƒç”¨çš„é”™è¯¯å¤„ç†
grep -A 5 "fetch\|axios\|http" src/services --include="*.ts" | grep -E "[\u4e00-\u9fa5]"

# æ£€æŸ¥ Telegram API è°ƒç”¨
grep -r "telegram\.(sendMessage|answerCallbackQuery)" src --include="*.ts" | grep -v "i18n.t"

# æ£€æŸ¥ç¿»è¯‘æœåŠ¡çš„é”™è¯¯å¤„ç†
grep -A 3 "translateWith\|Gemini\|Google\|OpenAI" src/services --include="*.ts" | grep -E "[\u4e00-\u9fa5]"
```

## AI æ£€æŸ¥æ–¹æ³•

### 1. è¯­ä¹‰æ£€æŸ¥

**æ£€æŸ¥é¡¹**ï¼š
- i18n key çš„å‘½åæ˜¯å¦ç¬¦åˆè¯­ä¹‰ï¼ˆå¦‚ `errors.userNotFound` è€Œä¸æ˜¯ `error1`ï¼‰
- ç›¸åŒå«ä¹‰çš„å­—ç¬¦ä¸²æ˜¯å¦ä½¿ç”¨ç›¸åŒçš„ key
- åŠ¨æ€å†…å®¹æ˜¯å¦æ­£ç¡®ä½¿ç”¨å‚æ•°ï¼ˆå¦‚ `i18n.t('welcome', { name })`ï¼‰

### 2. ä¸Šä¸‹æ–‡æ£€æŸ¥

**æ£€æŸ¥é¡¹**ï¼š
- é”™è¯¯æ¶ˆæ¯æ˜¯å¦åœ¨æ­£ç¡®çš„å‘½åç©ºé—´ï¼ˆ`errors.*`ï¼‰
- æˆåŠŸæ¶ˆæ¯æ˜¯å¦åœ¨æ­£ç¡®çš„å‘½åç©ºé—´ï¼ˆ`success.*`ï¼‰
- æŒ‰é’®æ–‡æœ¬æ˜¯å¦åœ¨æ­£ç¡®çš„å‘½åç©ºé—´ï¼ˆ`buttons.*`ï¼‰
- ç”¨æˆ·æç¤ºæ˜¯å¦åœ¨æ­£ç¡®çš„å‘½åç©ºé—´ï¼ˆ`common.*`, `onboarding.*` ç­‰ï¼‰

### 3. å®Œæ•´æ€§æ£€æŸ¥

**æ£€æŸ¥é¡¹**ï¼š
- æ‰€æœ‰ç”¨æˆ·å¯è§çš„å­—ç¬¦ä¸²éƒ½å·²æå–
- æ‰€æœ‰åŠ¨æ€å†…å®¹éƒ½æ­£ç¡®ä½¿ç”¨å‚æ•°
- æ‰€æœ‰é”™è¯¯å¤„ç†éƒ½ä½¿ç”¨ i18n
- æ‰€æœ‰æŒ‰é’®æ–‡æœ¬éƒ½ä½¿ç”¨ i18n

### 4. è·¯ç”±æ£€æŸ¥ï¼ˆAIï¼‰

**æ£€æŸ¥é¡¹**ï¼š
- è·¯ç”±ä¸­çš„æ‰€æœ‰å›è°ƒå¤„ç†æ˜¯å¦éƒ½è·å–äº†ç”¨æˆ·è¯­è¨€åå¥½
- è·¯ç”±ä¸­çš„é”™è¯¯å¤„ç†æ˜¯å¦éƒ½ä½¿ç”¨ i18n
- è·¯ç”±ä¸­çš„æ¶ˆæ¯å‘é€æ˜¯å¦éƒ½ä½¿ç”¨ i18n
- Callback query è·¯ç”±æ˜¯å¦æ­£ç¡®ä¼ é€’è¯­è¨€åå¥½

### 5. æ•°æ®åº“æ£€æŸ¥ï¼ˆAIï¼‰

**æ£€æŸ¥é¡¹**ï¼š
- æ•°æ®åº“è¯»å–æ—¶æ˜¯å¦æ­£ç¡®å¤„ç† i18n keys
- æ•°æ®åº“å†™å…¥æ—¶æ˜¯å¦ä½¿ç”¨ i18n keysï¼ˆå¦‚é€‚ç”¨ï¼‰
- è¿ç§»è„šæœ¬æ˜¯å¦å®Œæ•´ï¼ˆæ‰€æœ‰ä»»åŠ¡éƒ½å·²è¿ç§»ï¼‰
- å‘åå…¼å®¹å¤„ç†æ˜¯å¦æ­£ç¡®

### 6. ç½‘ç»œ/API æ£€æŸ¥ï¼ˆAIï¼‰

**æ£€æŸ¥é¡¹**ï¼š
- å¤–éƒ¨ API è°ƒç”¨çš„é”™è¯¯å¤„ç†æ˜¯å¦éƒ½ä½¿ç”¨ i18n
- ç½‘ç»œè¯·æ±‚çš„è¶…æ—¶å’Œé”™è¯¯æ˜¯å¦éƒ½ä½¿ç”¨ i18n
- API å“åº”è§£æé”™è¯¯æ˜¯å¦éƒ½ä½¿ç”¨ i18n
- ç¬¬ä¸‰æ–¹æœåŠ¡çš„é”™è¯¯æ¶ˆæ¯æ˜¯å¦éƒ½ä½¿ç”¨ i18n

## æ£€æŸ¥è„šæœ¬

### è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬

åˆ›å»º `scripts/verify-i18n-completeness.ts`ï¼š

```typescript
/**
 * i18n å®Œæ•´æ€§éªŒè¯è„šæœ¬
 * 
 * æ£€æŸ¥ï¼š
 * 1. æ‰€æœ‰ä»£ç ä¸­ä½¿ç”¨çš„ i18n keys éƒ½åœ¨ CSV ä¸­å­˜åœ¨
 * 2. æ‰€æœ‰ç¡¬ç¼–ç ä¸­æ–‡éƒ½å·²æ›¿æ¢
 * 3. æ•°æ®åº“è¿ç§»å·²å®Œæˆ
 */

import { readFileSync, readdirSync, statSync } from 'fs';
import { join } from 'path';

// 1. æå–ä»£ç ä¸­ä½¿ç”¨çš„æ‰€æœ‰ i18n keys
function extractI18nKeysFromCode(): Set<string> {
  const keys = new Set<string>();
  // ... å®ç°
  return keys;
}

// 2. æå– CSV ä¸­çš„æ‰€æœ‰ keys
function extractKeysFromCSV(): Set<string> {
  const keys = new Set<string>();
  // ... å®ç°
  return keys;
}

// 3. æ£€æŸ¥ç¡¬ç¼–ç ä¸­æ–‡
function checkHardcodedChinese(): string[] {
  const issues: string[] = [];
  // ... å®ç°
  return issues;
}

// 4. æ£€æŸ¥æ•°æ®åº“è¿ç§»
function checkDatabaseMigration(): boolean {
  // ... å®ç°
  return true;
}

// ä¸»å‡½æ•°
async function main() {
  console.log('ğŸ” å¼€å§‹ i18n å®Œæ•´æ€§æ£€æŸ¥...\n');
  
  // æ£€æŸ¥ 1: i18n keys å¯¹åº”å…³ç³»
  const codeKeys = extractI18nKeysFromCode();
  const csvKeys = extractKeysFromCSV();
  const missingInCSV = [...codeKeys].filter(k => !csvKeys.has(k));
  const unusedInCSV = [...csvKeys].filter(k => !codeKeys.has(k));
  
  console.log(`ğŸ“Š ç»Ÿè®¡:`);
  console.log(`  - ä»£ç ä¸­ä½¿ç”¨: ${codeKeys.size} keys`);
  console.log(`  - CSV ä¸­å­˜åœ¨: ${csvKeys.size} keys`);
  console.log(`  - ä»£ç ä¸­ä½¿ç”¨ä½† CSV ä¸­ç¼ºå¤±: ${missingInCSV.length} keys`);
  console.log(`  - CSV ä¸­å­˜åœ¨ä½†ä»£ç ä¸­æœªä½¿ç”¨: ${unusedInCSV.length} keys`);
  
  if (missingInCSV.length > 0) {
    console.log(`\nâŒ ç¼ºå¤±çš„ keys:`);
    missingInCSV.forEach(k => console.log(`  - ${k}`));
  }
  
  // æ£€æŸ¥ 2: ç¡¬ç¼–ç ä¸­æ–‡
  const hardcodedIssues = checkHardcodedChinese();
  if (hardcodedIssues.length > 0) {
    console.log(`\nâŒ å‘ç°ç¡¬ç¼–ç ä¸­æ–‡:`);
    hardcodedIssues.forEach(issue => console.log(`  - ${issue}`));
  }
  
  // æ£€æŸ¥ 3: æ•°æ®åº“è¿ç§»
  const migrationOk = checkDatabaseMigration();
  if (!migrationOk) {
    console.log(`\nâŒ æ•°æ®åº“è¿ç§»æœªå®Œæˆ`);
  }
  
  // æ€»ç»“
  const allOk = missingInCSV.length === 0 && 
                hardcodedIssues.length === 0 && 
                migrationOk;
  
  if (allOk) {
    console.log(`\nâœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼`);
    process.exit(0);
  } else {
    console.log(`\nâŒ æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·ä¿®å¤ä¸Šè¿°é—®é¢˜`);
    process.exit(1);
  }
}

main();
```

## æ£€æŸ¥æ¸…å•

### ä»£ç æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰ `src/telegram/handlers/*.ts` æ–‡ä»¶å·²æ£€æŸ¥
- [ ] æ‰€æœ‰ `src/services/*.ts` æ–‡ä»¶å·²æ£€æŸ¥
- [ ] æ‰€æœ‰ `src/utils/*.ts` æ–‡ä»¶å·²æ£€æŸ¥
- [ ] æ‰€æœ‰ `src/domain/*.ts` æ–‡ä»¶å·²æ£€æŸ¥
- [ ] `src/router.ts` å·²æ£€æŸ¥
- [ ] `src/worker.ts` å·²æ£€æŸ¥
- [ ] æ‰€æœ‰ `src/api/*.ts` æ–‡ä»¶å·²æ£€æŸ¥
- [ ] æ‰€æœ‰ i18n keys åœ¨ CSV ä¸­å­˜åœ¨
- [ ] æ— ç¡¬ç¼–ç ä¸­æ–‡ï¼ˆæŠ€æœ¯æ ‡è¯†ç¬¦é™¤å¤–ï¼‰
- [ ] æ‰€æœ‰ `createI18n()` ä½¿ç”¨ `user.language_pref`

### è·¯ç”±æ£€æŸ¥æ¸…å•

- [ ] `src/router.ts` ä¸­çš„æ‰€æœ‰æ¶ˆæ¯å¤„ç†éƒ½ä½¿ç”¨ i18n
- [ ] æ‰€æœ‰ callback query è·¯ç”±éƒ½æ­£ç¡®è·å–ç”¨æˆ·è¯­è¨€åå¥½
- [ ] æ‰€æœ‰å‘½ä»¤è·¯ç”±éƒ½æ­£ç¡®ä¼ é€’è¯­è¨€åå¥½
- [ ] Webhook å¤„ç†ä¸­çš„æ¶ˆæ¯éƒ½ä½¿ç”¨ i18nï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] è·¯ç”±ä¸­çš„é”™è¯¯å¤„ç†éƒ½ä½¿ç”¨ i18n
- [ ] è·¯ç”±ä¸­çš„æŒ‰é’®æ–‡æœ¬éƒ½ä½¿ç”¨ i18n

### æ•°æ®åº“æ£€æŸ¥æ¸…å•

- [ ] `tasks` è¡¨è¿ç§»è„šæœ¬å·²åˆ›å»º
- [ ] è¿ç§»è„šæœ¬å°†ä¸­æ–‡æ›¿æ¢ä¸º i18n keys
- [ ] ä»£ç ä¸­è¯»å– `tasks` æ—¶ä½¿ç”¨ `i18n.t()` ç¿»è¯‘
- [ ] å‘åå…¼å®¹å¤„ç†å·²å®ç°
- [ ] è¿ç§»è„šæœ¬å·²åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œ
- [ ] è¿ç§»è„šæœ¬å·²åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] æ‰€æœ‰ SQL æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç ä¸­æ–‡å·²æ£€æŸ¥
- [ ] æ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç å·²æ£€æŸ¥
- [ ] æ•°æ®åº“å†™å…¥æ—¶ä½¿ç”¨ i18n keysï¼ˆå¦‚é€‚ç”¨ï¼‰

### ç½‘ç»œ/API æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰å¤–éƒ¨ API è°ƒç”¨çš„é”™è¯¯æ¶ˆæ¯éƒ½ä½¿ç”¨ i18n
- [ ] æ‰€æœ‰ HTTP å“åº”ä¸­çš„ç”¨æˆ·å¯è§æ¶ˆæ¯éƒ½ä½¿ç”¨ i18n
- [ ] Telegram API è°ƒç”¨ä¸­çš„æ¶ˆæ¯éƒ½ä½¿ç”¨ i18n
- [ ] ç¿»è¯‘æœåŠ¡çš„é”™è¯¯å¤„ç†éƒ½ä½¿ç”¨ i18n
- [ ] Webhook å›è°ƒä¸­çš„æ¶ˆæ¯éƒ½ä½¿ç”¨ i18n
- [ ] API ç«¯ç‚¹çš„å“åº”æ¶ˆæ¯éƒ½ä½¿ç”¨ i18nï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ‰€æœ‰ `fetch` è°ƒç”¨çš„é”™è¯¯å¤„ç†éƒ½ä½¿ç”¨ i18n
- [ ] ç½‘ç»œè¶…æ—¶å’Œé”™è¯¯éƒ½ä½¿ç”¨ i18n

### CSV æ£€æŸ¥æ¸…å•

- [ ] CSV åŒ…å«æ‰€æœ‰ä»£ç ä¸­ä½¿ç”¨çš„ keys
- [ ] CSV åŒ…å«æ‰€æœ‰æ•°æ®åº“è¿ç§»ç”Ÿæˆçš„ keys
- [ ] CSV æ ¼å¼æ­£ç¡®
- [ ] æ‰€æœ‰ 34 ç§è¯­è¨€åˆ—éƒ½å­˜åœ¨
- [ ] ä¸­æ–‡ï¼ˆzh-TWï¼‰åˆ—å®Œæ•´
- [ ] è‹±æ–‡ï¼ˆenï¼‰åˆ—å®Œæ•´ï¼ˆè‡³å°‘ 90%+ï¼‰

## ä¿®å¤æµç¨‹

### å‘ç°ç¼ºå¤± key æ—¶

1. **ç¡®å®š key çš„å‘½åç©ºé—´**ï¼ˆå¦‚ `errors.*`, `success.*`, `buttons.*`ï¼‰
2. **æ·»åŠ åˆ° `src/i18n/locales/zh-TW.ts`**
3. **æ·»åŠ åˆ° `i18n_for_translation.csv`**
4. **æ›´æ–° TypeScript ç±»å‹**ï¼ˆå¦‚éœ€è¦ï¼‰
5. **é‡æ–°è¿è¡Œæ£€æŸ¥**

### å‘ç°ç¡¬ç¼–ç æ—¶

1. **ç¡®å®šå­—ç¬¦ä¸²çš„ç”¨é€”**ï¼ˆé”™è¯¯æ¶ˆæ¯ã€æŒ‰é’®æ–‡æœ¬ã€ç”¨æˆ·æç¤ºç­‰ï¼‰
2. **åˆ›å»ºæˆ–ä½¿ç”¨ç°æœ‰çš„ i18n key**
3. **æ›¿æ¢ç¡¬ç¼–ç ä¸º `i18n.t(key)`**
4. **ç¡®ä¿ `createI18n()` ä½¿ç”¨æ­£ç¡®çš„è¯­è¨€åå¥½**
5. **é‡æ–°è¿è¡Œæ£€æŸ¥**

### æ•°æ®åº“è¿ç§»æ—¶

1. **åˆ›å»ºè¿ç§»è„šæœ¬**ï¼ˆ`src/db/migrations/XXXX_migrate_tasks_to_i18n.sql`ï¼‰
2. **æ›´æ–°ä»£ç **ä»¥æ”¯æŒ i18n keys å’Œæ—§æ•°æ®
3. **æµ‹è¯•è¿ç§»è„šæœ¬**
4. **æ‰§è¡Œè¿ç§»**ï¼ˆå…ˆåœ¨æµ‹è¯•ç¯å¢ƒï¼‰
5. **éªŒè¯æ•°æ®**æ­£ç¡®æ€§

### è·¯ç”±ä¿®å¤æ—¶

1. **è¯†åˆ«è·¯ç”±ä¸­çš„ç¡¬ç¼–ç **ï¼ˆæ¶ˆæ¯ã€æŒ‰é’®ã€é”™è¯¯å¤„ç†ï¼‰
2. **ç¡®ä¿è·å–ç”¨æˆ·è¯­è¨€åå¥½**ï¼ˆ`findUserByTelegramId` + `user.language_pref`ï¼‰
3. **åˆ›å»ºæˆ–ä½¿ç”¨ç°æœ‰çš„ i18n key**
4. **æ›¿æ¢ç¡¬ç¼–ç ä¸º `i18n.t(key)`**
5. **éªŒè¯æ‰€æœ‰è·¯ç”±è·¯å¾„**éƒ½æ­£ç¡®ä½¿ç”¨ i18n

### ç½‘ç»œ/API ä¿®å¤æ—¶

1. **è¯†åˆ« API è°ƒç”¨ä¸­çš„ç¡¬ç¼–ç **ï¼ˆé”™è¯¯æ¶ˆæ¯ã€å“åº”æ¶ˆæ¯ï¼‰
2. **ç¡®å®šé”™è¯¯ç±»å‹**ï¼ˆç½‘ç»œé”™è¯¯ã€API é”™è¯¯ã€è¶…æ—¶ç­‰ï¼‰
3. **åˆ›å»ºæˆ–ä½¿ç”¨ç°æœ‰çš„ i18n key**
4. **æ›¿æ¢ç¡¬ç¼–ç ä¸º `i18n.t(key)`**
5. **ç¡®ä¿é”™è¯¯å¤„ç†**éƒ½ä½¿ç”¨ i18n

## æŒç»­ç»´æŠ¤

### å¼€å‘æ–°åŠŸèƒ½æ—¶

1. **ç›´æ¥ä½¿ç”¨ i18n**ï¼Œä¸è¦å…ˆå†™ä¸­æ–‡å†æ›¿æ¢
2. **ç«‹å³æ·»åŠ  key åˆ° CSV**
3. **è¿è¡Œæ£€æŸ¥è„šæœ¬**ç¡®è®¤æ— é—®é¢˜

### ä»£ç å®¡æŸ¥æ—¶

1. **æ£€æŸ¥æ˜¯å¦æœ‰ç¡¬ç¼–ç ä¸­æ–‡**
2. **æ£€æŸ¥ i18n keys æ˜¯å¦åœ¨ CSV ä¸­**
3. **æ£€æŸ¥å‘½åç©ºé—´æ˜¯å¦æ­£ç¡®**

## å·¥å…·å’Œå‘½ä»¤

```bash
# ç¡¬ç¼–ç æ£€æŸ¥
pnpm check:i18n

# ç±»å‹æ£€æŸ¥
pnpm typecheck

# Lint æ£€æŸ¥
pnpm lint

# å®Œæ•´éªŒè¯ï¼ˆå¾…å®ç°ï¼‰
pnpm verify:i18n

# ç”ŸæˆéªŒè¯æŠ¥å‘Š
pnpm verify:i18n:report
```

## æ£€æŸ¥ç»“æœï¼ˆ2025-01-15ï¼‰

### ç»Ÿè®¡æ•°æ®

- **ä»£ç ä¸­ä½¿ç”¨çš„ keys**: 606 ä¸ª
- **CSV ä¸­å­˜åœ¨çš„ keys**: 2003 ä¸ª
- **ä»£ç ä¸­ä½¿ç”¨ä½† CSV ä¸­ç¼ºå¤±**: 262 ä¸ª
- **ç¡¬ç¼–ç ä¸­æ–‡é—®é¢˜**: 95 ä¸ªæ–‡ä»¶ä¸­æœ‰ç¡¬ç¼–ç 

### ä¸»è¦é—®é¢˜

#### 1. ç¼ºå¤±çš„ i18n keysï¼ˆéƒ¨åˆ†åˆ—è¡¨ï¼‰

**Admin ç›¸å…³**ï¼š
- `admin.banUsageError`
- `admin.banUserNotFound`
- `admin.cannotBanAdmin`
- `admin.error`
- `admin.listFooter`
- `admin.listNotRegistered`
- `admin.listRoleAdmin`
- `admin.listRoleSuperAdmin`
- `admin.listTitle`
- `admin.onlyAdmin`
- `admin.onlySuperAdmin`
- `admin.unbanNotBanned`
- `admin.unbanUsageError`
- `admin.unbanUserNotFound`

**Bottle/Catch ç›¸å…³**ï¼š
- `bottle.bottle13`
- `bottle.throw.aiModerationFailed`
- `buttons.cancel`
- `catch.anonymousUser`
- `catch.back`
- `catch.banned`
- `catch.block`
- `catch.bottle`
- `catch.bottle2`
- `catch.bottle4`
- `catch.bottle5`
- `catch.conversation2`
- `catch.conversation3`
- `catch.conversationError`
- `catch.message4`
- `catch.message5`

**å®Œæ•´åˆ—è¡¨**: å…± 262 ä¸ªç¼ºå¤±çš„ keys

#### 2. ç¡¬ç¼–ç ä¸­æ–‡

- **95 ä¸ªæ–‡ä»¶**ä¸­ä»æœ‰ç¡¬ç¼–ç ä¸­æ–‡
- ä¸»è¦åˆ†å¸ƒåœ¨ï¼š
  - `src/telegram/handlers/*.ts`
  - `src/services/*.ts`
  - `src/utils/*.ts`

#### 3. æ•°æ®åº“è¿ç§»çŠ¶æ€

âœ… **å·²å®Œæˆ**ï¼š
- è¿ç§»è„šæœ¬å·²åˆ›å»ºï¼š`src/db/migrations/0050_update_tasks_to_i18n_keys.sql`
- è¿ç§»è„šæœ¬åŒ…å« 8 ä¸ªä»»åŠ¡çš„ i18n keys
- ä»£ç ä¸­å·²å®ç°å‘åå…¼å®¹å¤„ç†ï¼ˆ`tasks.ts` å’Œ `menu.ts`ï¼‰

âœ… **CSV ä¸­åŒ…å«**ï¼š
- æ‰€æœ‰ `tasks.name.*` keysï¼ˆ8 ä¸ªï¼‰
- æ‰€æœ‰ `tasks.description.*` keysï¼ˆ8 ä¸ªï¼‰

### ä¿®å¤å»ºè®®

#### ä¼˜å…ˆçº§ 1ï¼šæ·»åŠ ç¼ºå¤±çš„ keys

1. **æå–æ‰€æœ‰ç¼ºå¤±çš„ keys**ï¼š
   ```bash
   comm -23 /tmp/code_keys.txt /tmp/csv_keys.txt > missing_keys.txt
   ```

2. **æ·»åŠ åˆ° `src/i18n/locales/zh-TW.ts`**

3. **æ·»åŠ åˆ° `i18n_for_translation.csv`**

#### ä¼˜å…ˆçº§ 2ï¼šä¿®å¤ç¡¬ç¼–ç 

1. **è¿è¡Œç¡¬ç¼–ç æ£€æŸ¥**ï¼š
   ```bash
   pnpm check:i18n
   ```

2. **é€ä¸ªæ–‡ä»¶ä¿®å¤**ï¼š
   - è¯†åˆ«ç¡¬ç¼–ç å­—ç¬¦ä¸²
   - åˆ›å»ºæˆ–ä½¿ç”¨ç°æœ‰çš„ i18n key
   - æ›¿æ¢ä¸º `i18n.t(key)`

#### ä¼˜å…ˆçº§ 3ï¼šéªŒè¯æ•°æ®åº“è¿ç§»

1. **ç¡®è®¤è¿ç§»è„šæœ¬å·²æ‰§è¡Œ**ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰
2. **éªŒè¯æ•°æ®æ­£ç¡®æ€§**ï¼š
   ```sql
   SELECT id, name, description FROM tasks;
   ```
   åº”è¯¥çœ‹åˆ° `tasks.name.*` å’Œ `tasks.description.*` æ ¼å¼

## ä¸‹ä¸€æ­¥

1. âœ… **å®ç°è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬** (`scripts/verify-i18n-completeness.ts`)
2. â³ **æ‰§è¡Œå…¨é¢æ£€æŸ¥**ï¼Œç”Ÿæˆé—®é¢˜æŠ¥å‘Š
3. â³ **ä¿®å¤æ‰€æœ‰å‘ç°çš„é—®é¢˜**ï¼ˆ262 ä¸ªç¼ºå¤± keys + 95 ä¸ªç¡¬ç¼–ç æ–‡ä»¶ï¼‰
4. âœ… **éªŒè¯æ•°æ®åº“è¿ç§»**å·²å®Œæˆ
5. â³ **æ›´æ–°æ–‡æ¡£**è®°å½•æ£€æŸ¥ç»“æœ

