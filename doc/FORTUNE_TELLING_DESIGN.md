# ğŸ”® AI ç®—å‘½åŠŸèƒ½è¨­è¨ˆ (AI Fortune Telling)

> **âš ï¸ é–‹ç™¼è¦ç¯„èˆ‡å¼•ç”¨**
> æœ¬è¨­è¨ˆå¿…é ˆåš´æ ¼éµå®ˆä»¥ä¸‹æ–‡æª”è¦ç¯„ï¼š
> *   `@doc/UI_GUIDELINE.md`: UI äº¤äº’é«”é©—ã€æŒ‰éˆ•ä½ˆå±€ã€è¿”å›é‚è¼¯ã€‚
> *   `@doc/DEVELOPMENT_STANDARDS.md`: ä»£ç¢¼é¢¨æ ¼ã€éŒ¯èª¤è™•ç†ã€i18n è¦ç¯„ã€‚
> *   `@doc/ECONOMICS_AND_PRICING.md`: ç®—å‘½ç“¶æ¶ˆè€—èˆ‡ç¶“æ¿Ÿæ¨¡å‹ã€‚

## 1. æ ¸å¿ƒé‚è¼¯èˆ‡æ¶æ§‹

æœ¬ç³»çµ±æ¡ç”¨ **ã€Œé‚è¼¯å±¤ (Logic)ã€ + ã€Œæ–‡å­¸å±¤ (Literature)ã€** çš„é›™å±¤æ¶æ§‹ï¼Œç¢ºä¿ç®—å‘½çš„æº–ç¢ºæ€§èˆ‡å¤šèªè¨€é©é…æ€§ã€‚

### 1.1 å·®ç•°åŒ–å„ªå‹¢ï¼šå¤šç¶­åº¦æ•¸æ“šèåˆ (Why us?)
ä¸€èˆ¬çš„ GPT ç®—å‘½åªçœ‹æ˜Ÿåº§ã€‚æˆ‘å€‘çš„å„ªå‹¢åœ¨æ–¼æ•´åˆäº†ç”¨æˆ¶çš„ **å…¨æ–¹ä½æ•¸æ“š**ï¼š
*   **è¥¿æ–¹å æ˜Ÿ**: å¤ªé™½/æœˆäº®/ä¸Šå‡æ˜Ÿåº§ (éœ€å‡ºç”Ÿæ™‚é–“)ã€‚
*   **æ±æ–¹å…«å­—**: å¤©å¹²åœ°æ”¯ã€äº”è¡Œç¼ºè£œã€‚
*   **å¿ƒç†æ¸¬è©•**: MBTI äººæ ¼é¡å‹ (å·²åœ¨ `users` è¡¨ä¸­)ã€‚
*   **ç”Ÿç†ç‰¹å¾µ**: è¡€å‹ (éœ€æ”¶é›†)ã€æ€§åˆ¥ã€‚

**çµè«–**ï¼šæˆ‘å€‘é¤µçµ¦ AI çš„ Prompt åŒ…å«äº†ã€ŒMBTI + æ˜Ÿç›¤ + å…«å­— + è¡€å‹ã€çš„äº¤å‰åˆ†æï¼Œé€™æ˜¯ç”¨æˆ¶è‡ªå·±å»å• ChatGPT å¾ˆé›£åšåˆ°çš„ï¼ˆå› ç‚ºä»–å€‘é€šå¸¸ä¸æœƒåŒæ™‚æä¾›é€™éº¼å¤šç¶­åº¦çš„æ•¸æ“šï¼Œä¹Ÿä¸æ‡‚å¦‚ä½•æ•´åˆï¼‰ã€‚

### 1.3 æ•¸æ“šæºèˆ‡é‹ç®— (Data Source & Calculation)

**Q: æ˜¯å¦éœ€è¦ç¶­è­·é¾å¤§çš„å‘½ç†è³‡æ–™åº«ï¼ˆæµå¹´ã€æ˜Ÿæ›†è¡¨ï¼‰ï¼Ÿ**
**A: ä¸éœ€è¦ã€‚**

æˆ‘å€‘æ¡ç”¨ **"On-Demand Calculation" (å³æ™‚é‹ç®—)** æ¨¡å¼ï¼š

1.  **æ˜Ÿæ›†æ•¸æ“š (Ephemeris)**:
    *   ä½¿ç”¨ `astronomy-engine` èˆ‡ `lunar-javascript`ã€‚
    *   **å„ªå‹¢**ï¼šè¼•é‡ç´šã€ç„¡éœ€ç¶­è­·è³‡æ–™åº«ï¼Œé©åˆ Worker ç’°å¢ƒã€‚

2.  **ç´«å¾®/å…«å­—æ’ç›¤**:
    *   ä½¿ç”¨ `lunar-javascript` ç­‰æˆç†Ÿé–‹æºåº« (æ”¯æ´ 100% ç²¾æº–çš„ç´«å¾®æ–—æ•¸èˆ‡å…«å­—æ’ç›¤)ã€‚

3.  **çŸ¥è­˜åº« (Knowledge Base)**:
    *   ä¾è³´ **LLM (Gemini 1.5 Pro / 3.0)** çš„å…§å»ºçŸ¥è­˜é€²è¡Œè§£è®€ã€‚
    *   **å¤šèªè¨€æ”¯æ´**: AI è² è²¬å°‡å‘½ç†è¡“èªè½‰è­¯ç‚ºç”¨æˆ¶è¨­å®šçš„èªè¨€ (34ç¨®èªè¨€)ã€‚

**çµè«–**ï¼šæˆ‘å€‘åªå­˜ã€Œç”¨æˆ¶çš„å‡ºç”Ÿæ•¸æ“šã€å’Œã€Œç®—å‘½æ­·å²çµæœã€ã€‚

---

## 2. ç”¨æˆ¶é«”é©— (UX) èˆ‡å…¥å£è¨­è¨ˆ

ç‚ºé¿å…ä¸»èœå–®æ“æ“ ï¼Œæˆ‘å€‘æ¡ç”¨ **ã€Œå–®ä¸€å…¥å£ï¼Œåˆ†å±¤å¼•å°ã€** ç­–ç•¥ã€‚

### 2.1 èœå–®çµæ§‹
*   **ä¸»èœå–® (Level 1)**: åªæœ‰ä¸€å€‹æŒ‰éˆ• `ğŸ”® AI ç®—å‘½`ã€‚
    *   **é€²å…¥æ¢ä»¶ (Mandatory)**: ç”¨æˆ¶å¿…é ˆå·²æœ‰ **MBTI** æ•¸æ“šã€‚è‹¥ç„¡ï¼Œé»æ“Šå¾Œå¼·åˆ¶é€²å…¥ MBTI è£œå…¨æµç¨‹ï¼Œä¸¦æç¤ºã€Œéœ€ MBTI æ‰èƒ½æä¾›æº–ç¢ºç®—å‘½ã€ã€‚
    *   > **é‹ç‡Ÿç­–ç•¥è¨»è¨˜**: é›–ç„¶æ¨™æº–è¨­è¨ˆåœ¨ Level 2 ç½®é ‚ï¼Œä½†åœ¨ã€Œæƒ…äººç¯€ã€ç­‰ç‰¹å®šæ´»å‹•æœŸé–“ï¼Œå¯æš«æ™‚å°‡ `ğŸ§¬ å±¬æ€§è¨ºæ–·` æå‡è‡³ Level 1 ä¸»é¸å–®ï¼Œä»¥é”æˆã€æš´åŠ›æ¨å»£ã€æ•ˆæœã€‚

*   **äºŒç´šèœå–® (ç®—å‘½å¤§å»³ Level 2)**:
    *   **ğŸ”¥ ç½®é ‚æ¨è–¦ (Featured - æš´åŠ›æ¨å»£ä½)**:
        1.  `ğŸ§¬ å±¬æ€§è¨ºæ–· (é‚€è«‹å¥½å‹)` - **å…¨å¯¬æŒ‰éˆ•ï¼Œæ ¸å¿ƒè£‚è®Šå…¥å£**ã€‚
    *   **åŸºç¤æœå‹™ (Basic)**:
        2.  `ğŸ“… ä»Šæ—¥é‹å‹¢` (1 ç“¶)
        3.  `ğŸ—“ï¸ æœ¬é€±é‹å‹¢` (1 ç“¶/é€±)
        4.  `ğŸŒŸ åäººåŒç›¤` (1 ç“¶/æ¬¡)
    *   **é€²éšæœå‹™ (Advanced - æ·±åº¦è©³è§£)**:
        5.  `ğŸ”® ç´«å¾®æ–—æ•¸` (1 ç“¶)
        6.  `ğŸŒ  è¥¿æ´‹å æ˜Ÿ` (1 ç“¶)
        7.  `ğŸƒ å¡”ç¾…å åœ` (1 ç“¶)
        8.  `ğŸ“œ å…«å­—æ¨å‘½` (1 ç“¶)
    *   **ç®¡ç†èˆ‡ç´€éŒ„**:
        9.  `âš™ï¸ ç®¡ç†æª”æ¡ˆ` (é¡¯ç¤ºæˆ‘çš„ ID / é…å°é–‹é—œ)
        10. `ğŸ“œ æˆ‘çš„å ±å‘Š`

### 2.3 è¨Šæ¯ç­–ç•¥ (Message Strategy) & äº¤äº’å„ªåŒ–

**Telegram UX åŸå‰‡**: ç©©å®šã€æ¸…æ™°ã€ä¸éºå¤±ã€‚

1.  **å®‰å…¨ç™¼é€æ©Ÿåˆ¶ (Robust Sending)**:
    *   **ç´”æ–‡å­—å„ªå…ˆ (Plain Text First)**: **âš ï¸ éŸ¿æ‡‰ç”¨æˆ¶è¦æ±‚ï¼Œæ”¾æ£„ Markdown**ã€‚æ‰€æœ‰è¨Šæ¯å°‡æ¡ç”¨ **ã€Œç´”æ–‡å­— + å®˜æ–¹ Emojiã€** é€²è¡Œæ’ç‰ˆã€‚
        *   ä¸ä½¿ç”¨ `*bold*` æˆ– `_italic_`ï¼Œé¿å… `Can't parse entities` éŒ¯èª¤ã€‚
        *   ä½¿ç”¨ Emoji (å¦‚ ğŸ“Œ, ğŸ’¡, ğŸ”®) ä¾†å€åˆ†æ®µè½èˆ‡æ¨™é¡Œï¼Œç¢ºä¿ 100% çš„ç™¼é€æˆåŠŸç‡èˆ‡è·¨å¹³å°ä¸€è‡´æ€§ã€‚
    *   **è‡ªå‹•åˆ†æ®µ**: é•·æ–‡è¶…é 4000 å­—è‡ªå‹•åˆ‡åˆ†ï¼Œé¿å… Telegram API é™åˆ¶ã€‚
    *   **æŒ‰éˆ•é™„è‘—**: åŠŸèƒ½æŒ‰éˆ•ç›´æ¥é™„è‘—åœ¨è¨Šæ¯ä¸‹æ–¹ï¼Œä¸å¦å¤–ç™¼é€ Stickers å¹²æ“¾è¦–ç·šã€‚

2.  **Inline äº¤äº’ (Clean UI)**:
    *   **Wizard æµç¨‹**: ç›¡é‡ä½¿ç”¨ `editMessageText` æ›´æ–°ç•¶å‰è¨Šæ¯ï¼Œè€Œä¸æ˜¯ç™¼é€æ–°è¨Šæ¯ã€‚
    *   **é˜²è¿·å¤±**: æ¯å€‹æ­¥é©Ÿå¿…é ˆå¸¶æœ‰ `[ğŸ”™ ä¸Šä¸€æ­¥]` å’Œ `[âŒ å–æ¶ˆ]` æŒ‰éˆ•ã€‚

3.  **çµæ§‹åŒ–è¼¸å‡º (è©³ç´°å ±å‘Š)**:
    *   **Header**: Emoji æ¨™é¡Œ + æ‘˜è¦ã€‚
    *   **Body**: è©³ç´°å…§å®¹ (åˆ†æ®µç™¼é€ï¼Œå¦‚æœå¤ªé•·)ã€‚
    *   **Footer**: å°èˆªæŒ‰éˆ•ã€‚

### 2.4 æ­·å²è¨˜éŒ„èˆ‡æ•¸æ“šå®Œæ•´æ€§é©—è­‰ (Data Integrity & Re-generation)

**æ ¸å¿ƒæ©Ÿåˆ¶**: ç¢ºä¿å ±å‘Šæº–ç¢ºæ€§ï¼Œé¿å…ã€ŒèˆŠå ±å‘Šé…æ–°æ•¸æ“šã€çš„éŒ¯èª¤ã€‚

1.  **å¿«ç…§æ¯”å° (Snapshot Comparison)**:
    *   ç”Ÿæˆå ±å‘Šæ™‚ï¼Œå°‡ç•¶ä¸‹çš„ `profile_data` (ç”Ÿæ—¥ã€æ™‚é–“ã€MBTIã€è¡€å‹) **å®Œæ•´åºåˆ—åŒ– (JSON)** ä¸¦å­˜å„²åœ¨ `fortune_history` çš„ `profile_snapshot` æ¬„ä½ä¸­ã€‚
    *   ç•¶ç”¨æˆ¶é»æ“Šã€ŒæŸ¥çœ‹æ­·å²å ±å‘Šã€æ™‚ï¼Œç³»çµ±æœƒ**è‡ªå‹•æ¯”å°**ï¼š
        *   `Current Profile` vs `Historical Snapshot`
    *   **è‹¥æ•¸æ“šä¸€è‡´**: ç›´æ¥é¡¯ç¤ºç·©å­˜å ±å‘Š (å…è²»)ã€‚
    *   **è‹¥æ•¸æ“šä¸ç¬¦** (ç”¨æˆ¶ä¿®æ”¹éæª”æ¡ˆ): 
        *   æç¤º: `âš ï¸ æª¢æ¸¬åˆ°æ‚¨çš„å‘½ç›¤è³‡æ–™ (ç”Ÿæ—¥/MBTI/è¡€å‹) å·²è®Šæ›´ï¼ŒèˆŠå ±å‘Šå·²å¤±æ•ˆã€‚`
        *   æŒ‰éˆ•: `[ğŸ”„ é‡æ–°ç”Ÿæˆå ±å‘Š (æ¶ˆè€— 1 ç“¶)]`

2.  **è³‡æ–™ä¿å­˜ç­–ç•¥**:
    *   **æ¯æ—¥é‹å‹¢**: ä¿ç•™ 30 å¤©ã€‚
    *   **é€²éšå ±å‘Š (ç´«å¾®/å…«å­—/å æ˜Ÿ/æ„›æƒ…/åäººç­‰)**: **ä¿ç•™ 3 å¹´ (3 Years)**ã€‚
        *   **æ•¸æ“šä¿å­˜è²æ˜**: æœ¬å¹³å°æ‰€æœ‰å ±å‘Šï¼ˆå«ä»˜è²»é …ç›®ï¼‰æœ€é•·ä¿ç•™æœŸé™ç‚º **3å¹´**ã€‚
    *   **éæœŸè™•ç†**: è¶…é 3 å¹´çš„æ­·å²è¨˜éŒ„å°‡è¢«ç³»çµ±è‡ªå‹•æ¸…ç†ã€‚

## 8. æˆ‘çš„å ±å‘Šèˆ‡æ­·å²è¨˜éŒ„ (My Reports & History)

ç‚ºç¢ºä¿ç”¨æˆ¶èƒ½æ–¹ä¾¿æŸ¥é–±é«˜åƒ¹å€¼å ±å‘Šï¼ˆæœ‰æ•ˆæœŸ 3 å¹´ï¼‰ï¼Œæˆ‘å€‘æ¡ç”¨ã€Œåˆ†é¡åˆ†é ã€çš„ç€è¦½æ¨¡å¼ã€‚

*   **å…¥å£**: `ğŸ”® AI ç®—å‘½` -> `ğŸ“œ æˆ‘çš„å ±å‘Š`
*   **åˆ—è¡¨ä»‹é¢è¨­è¨ˆ**:
    *   **Tab åˆ†é¡ (å›  Telegram é™åˆ¶ï¼Œä½¿ç”¨é ‚éƒ¨åˆ‡æ›æŒ‰éˆ•)**:
        *   `[ğŸ“‚ å…¨éƒ¨]` `[ğŸ§¬ åˆç›¤]` `[ğŸ”® å‘½ç†]` `[ğŸ—“ï¸ é‹å‹¢]`
    *   **åˆ—è¡¨é …ç›® (Format)**:
        *   æ¯é é¡¯ç¤º 5-8 ç­†è¨˜éŒ„ã€‚
        *   æ ¼å¼ï¼š`[Icon] æ¨™é¡Œ - æ—¥æœŸ`
        *   ç¯„ä¾‹ï¼š
            *   `ğŸ§¬ èˆ‡ UserB çš„é›™äººåˆç›¤ - 2025/11/30`
            *   `ğŸ”® ç´«å¾®æ–—æ•¸è©³æ‰¹ - 2025/11/28`
            *   `ğŸ—“ï¸ æœ¬é€±é‹å‹¢ (11/24-11/30)`
    *   **æ“ä½œ**: é»æ“Šé …ç›®å¾Œé€²å…¥ã€Œå ±å‘Šè©³æƒ…è¦–åœ–ã€ã€‚
    *   **åˆ†é æ§åˆ¶**: `[â¬…ï¸ ä¸Šä¸€é ] [ç¬¬ 1/5 é ] [ä¸‹ä¸€é  â¡ï¸]`

*   **å ±å‘Šè©³æƒ…è¦–åœ– (Detail View)**:
    *   é¡¯ç¤ºå®Œæ•´å ±å‘Šå…§å®¹ã€‚
    *   **é ‚éƒ¨ç‹€æ…‹æ¬„**:
        *   é¡¯ç¤º `ğŸ“… ç”Ÿæˆæ—¥æœŸ: YYYY-MM-DD`
        *   é¡¯ç¤º `â³ æœ‰æ•ˆæœŸè‡³: YYYY-MM-DD` (é‡å°åˆç›¤èˆ‡ä»˜è²»å ±å‘Š)
        *   è‹¥è³‡æ–™éæœŸæˆ–å·²è®Šæ›´: é¡¯ç¤º `âš ï¸ è³‡æ–™å·²æ›´æ–°ï¼Œå ±å‘Šå¯èƒ½å¤±æº–` + `[ğŸ”„ é‡æ–°ç”Ÿæˆ (1ç“¶)]` æŒ‰éˆ•ã€‚
    *   **åº•éƒ¨æŒ‰éˆ•**: `[ğŸ”™ è¿”å›åˆ—è¡¨]` `[ğŸ—‘ï¸ åˆªé™¤è¨˜éŒ„]`

---

## 3. ç®—å‘½ç“¶ (Fortune Bottle) ç¶“æ¿Ÿæ¨¡å‹

### 3.1 ç²å–æ©Ÿåˆ¶
*   **æ¯é€±å…è²»é…é¡ (Weekly Reset)**:
    *   ä¸€èˆ¬ç”¨æˆ¶: æ¯é€± **1 ç“¶** (ä¸å¯ç´¯ç©)ã€‚
    *   **VIP ç”¨æˆ¶**: æ¯å¤© **1 ç“¶** (ä¸å¯ç´¯ç©ï¼Œæ¯æ—¥ 00:00 é‡ç½®)ã€‚
*   **é¡å¤–ç²å– (å¯ç´¯ç©)**:
    *   **æ´»èºçå‹µ**: æ¯ä¸Ÿå‡º 10 å€‹æ¼‚æµç“¶ -> **+1 ç“¶**ã€‚
    *   **è£‚è®Šçå‹µ**: é‚€è«‹çš„æœ‹å‹(B)å†é‚€è«‹æœ‹å‹(C)æ™‚ -> **A ç²å¾— +1 ç“¶**ã€‚
    *   **ä»˜è²»å……å€¼**:
        *   å°åŒ…: 100 Stars / 10 ç“¶ã€‚
        *   å¤§åŒ…: 385 Stars / 50 ç“¶ **(å„ªæƒ  Special Offer)**ã€‚

### 3.2 ç”¢å“ç­–ç•¥è½‰å‹ (Product Pivot)
ç‚ºäº†å»ºç«‹é•·æœŸçš„ç”¨æˆ¶ä¿¡ä»»èˆ‡ç•™å­˜ï¼Œæˆ‘å€‘æ”¾æ£„äº†è¤‡é›œçš„ã€Œæ¨¡å¡ŠåŒ–æ”¶è²»ã€ï¼Œæ”¹ç‚º **ã€Œé€±æœŸæ€§è¨‚é–±åˆ¶ã€** é«”é©—ã€‚

*   **ä»Šæ—¥é‹å‹¢ (Daily)**: 1 ç“¶/æ¬¡ (**VIP æœƒå“¡ 0 ç“¶/æ¬¡**ï¼Œä¸æ¶ˆè€—æ¯æ—¥é…é¡)ã€‚
*   **æœ¬é€±é‹å‹¢ (Weekly)**: 1 ç“¶/é€± (é–å®šé€±ä¸€ï¼Œé€±é–“å›çœ‹å…è²»)ã€‚
*   **åäººåŒç›¤**: 1 ç“¶/æ¬¡ (æ¯æ¬¡æŸ¥æ‰¾æ–°å°è±¡)ã€‚
*   **é€²éšå‘½ç†æœå‹™ (Advanced)**: 1 ç“¶/æ¬¡ (ä¸€æ¬¡æ€§ç”Ÿæˆï¼Œä¿å­˜3å¹´ï¼Œè³‡æ–™è®Šæ›´éœ€é‡ç®—)ã€‚

---

## 6. é€²éšå‘½ç†æœå‹™æ“´å…… (Advanced Fortune Services)

**è¨­è¨ˆç›®æ¨™**: æä¾›æ¥µé«˜ä¿¡æ¯é‡ã€å°ˆæ¥­åº¦é«˜çš„å‘½ç†å ±å‘Šï¼Œå……åˆ†åˆ©ç”¨ AI çš„å¤šèªè¨€èƒ½åŠ› (34 Languages)ã€‚
**é©ç”¨å°è±¡**: æ‰€æœ‰ç”¨æˆ¶ (ä¸€èˆ¬æœƒå“¡ & VIP) çš†å¯ä½¿ç”¨ã€‚æ¯æ¬¡æ¶ˆè€— **1 ç®—å‘½ç“¶**ã€‚

### 6.1 ç´«å¾®æ–—æ•¸ (Zi Wei Dou Shu)
*   **è¼¸å…¥**: å‡ºç”Ÿå¹´/æœˆ/æ—¥/æ™‚ (å¿…é ˆç²¾ç¢º)ã€‚
*   **é‹ç®—æ ¸å¿ƒ**: **ä¾è³´ `lunar-javascript` åº«** é€²è¡Œç²¾ç¢ºæ’ç›¤ï¼ˆAI ä¸è² è²¬æ’ç›¤ï¼Œåªè² è²¬è§£è®€ï¼Œé¿å…å¹»è¦ºï¼‰ã€‚
*   **AI ä»»å‹™**: è§£è®€å‘½ç›¤æ ¼å±€ (å¦‚ã€Œæ®ºç ´ç‹¼ã€ã€ã€Œæ©ŸæœˆåŒæ¢ã€) åŠå„å®®ä½å«ç¾©ã€‚
*   **é‡é»**: å¿…é ˆç²¾ç¢ºè§£é‡‹ 14 ä¸»æ˜Ÿåœ¨ç”¨æˆ¶å‘½ç›¤ä¸­çš„å…·é«”å½±éŸ¿ï¼Œè€Œéé€šç”¨è§£é‡‹ã€‚

### 6.2 è¥¿æ´‹å æ˜Ÿ (Astrology - Natal Chart)
*   **è¼¸å…¥**: å‡ºç”Ÿæ™‚é–“ + å‡ºç”ŸåŸå¸‚ (ç¶“ç·¯åº¦)ã€‚
*   **é‹ç®—æ ¸å¿ƒ**: **ä¾è³´ `astronomy-engine` åº«** è¨ˆç®— 10 å¤§è¡Œæ˜Ÿè½å…¥çš„æ˜Ÿåº§ (Signs) èˆ‡å®®ä½ (Houses)ï¼Œä»¥åŠç›¸ä½ (Aspects)ã€‚
*   **AI ä»»å‹™**: é€²è¡Œã€Œå…¨ç›¤è§£è®€ã€ï¼ŒåŒ…å«ä¸Šå‡æ˜Ÿåº§ (äººæ ¼é¢å…·)ã€æœˆäº®æ˜Ÿåº§ (å…§åœ¨æƒ…æ„Ÿ)ã€ç›¸ä½è¡çªèˆ‡èª¿å’Œã€‚

### 6.3 å¡”ç¾…å åœ (Tarot Reading)
*   **æ©Ÿåˆ¶**: 
    1.  ç”¨æˆ¶å¿ƒä¸­é»˜å¿µå•é¡Œ (æˆ–é¸æ“‡ã€Œä¸€èˆ¬é‹å‹¢ã€)ã€‚
    2.  é»æ“ŠæŠ½ç‰Œ (ç³»çµ±éš¨æ©Ÿæ•¸ç”Ÿæˆ)ã€‚
    3.  ç‰Œé™£: **è–ä¸‰è§’ (3å¼µ)** æˆ– **å‡±çˆ¾ç‰¹åå­— (10å¼µ)** (è¦–è¤‡é›œåº¦è€Œå®šï¼Œå»ºè­°å…ˆåš 3 å¼µ)ã€‚
*   **AI ä»»å‹™**: çµåˆç‰Œé¢å«ç¾© (æ­£/é€†ä½) èˆ‡ç”¨æˆ¶èƒŒæ™¯é€²è¡Œç›´è¦ºå¼è§£è®€ã€‚
*   **UI å‘ˆç¾**: ç”±æ–¼ Bot é™åˆ¶ï¼Œä½¿ç”¨ **Emoji + æ–‡å­—** å‘ˆç¾ç‰Œé¢ (å¦‚ `ğŸƒ æ„šè€… (æ­£ä½)` )ï¼Œä¸ä¾è³´åœ–ç‰‡ä»¥ç¢ºä¿åŠ è¼‰é€Ÿåº¦èˆ‡ç©©å®šæ€§ã€‚

### 6.4 å…«å­—æ¨å‘½ (BaZi / Four Pillars)
*   **è¼¸å…¥**: å‡ºç”Ÿå¹´/æœˆ/æ—¥/æ™‚ã€‚
*   **é‹ç®—æ ¸å¿ƒ**: **ä¾è³´ `lunar-javascript` åº«** è¨ˆç®—å››æŸ±å¹²æ”¯èˆ‡åç¥ï¼ˆç¢ºä¿è¾²æ›†è½‰æ›ç²¾ç¢ºï¼‰ã€‚
*   **AI ä»»å‹™**: åˆ†æã€Œæ—¥ä¸»å¼·å¼±ã€ã€ã€Œå–œç”¨ç¥ã€ã€ã€Œäº”è¡Œç¼ºå¤±ã€ï¼Œä¸¦æä¾›æ”¹é‹å»ºè­° (é¡è‰²ã€æ–¹ä½)ã€‚

### 6.5 å±¬æ€§è¨ºæ–· (Attribute Diagnosis) - éš±ç§å„ªå…ˆèˆ‡è£‚è®Šæ©Ÿåˆ¶ (Privacy First & Viral)

**æ ¸å¿ƒç†å¿µ**: ç¢ºä¿é›™æ–¹çŸ¥æƒ…åŒæ„ (Consent)ï¼Œé¿å…é¨·æ“¾ï¼ŒåŒæ™‚åˆ©ç”¨é…å°è«‹æ±‚ä½œç‚ºè£‚è®Šå‚³æ’­ã€‚é€™ä¸åƒ…é™æ–¼æ„›æƒ…ï¼Œé©ç”¨æ–¼**æœ‹å‹ã€åŒäº‹ã€å®¶äºº**ä¹‹é–“çš„é»˜å¥‘èˆ‡æ€§æ ¼å…±é³´åˆ†æã€‚

#### A. æ¨¡å¼é¸æ“‡ (Mode Selection)
ç”¨æˆ¶é»æ“Š `ğŸ§¬ å±¬æ€§è¨ºæ–·` å¾Œï¼Œå½ˆå‡ºé¸æ“‡èœå–®ï¼š
1.  `[ğŸ§šâ€â™€ï¸ éš±è—å±¬æ€§ (å€‹äººæ½›èƒ½)]` -> é€²å…¥ **å–®äººæ¨¡å¼** (åˆ†æè‡ªæˆ‘æ½›åœ¨ç‰¹è³ªã€é©åˆçš„å¤¥ä¼´é¡å‹ã€éš±è—å¤©è³¦)ã€‚
2.  `[ğŸ§© é›™äººåˆç›¤ (é»˜å¥‘åˆ†æ)]` -> é€²å…¥ **é›™äººåˆç›¤æ¨¡å¼**ã€‚

#### B. é›™äººåˆç›¤æµç¨‹ (Mode 2: Attribute Match Flow)

**Step 1: é¸æ“‡é—œä¿‚é¡å‹ (Select Relationship Type)**
åœ¨è¼¸å…¥å°æ–¹ ID å‰ï¼Œå…ˆé¸æ“‡è¦åˆ†æçš„é—œä¿‚é¡å‹ï¼ˆé€™æœƒå½±éŸ¿ AI çš„åˆ†æç¶­åº¦èˆ‡èªæ°£ï¼‰ã€‚

**1. ğŸ’˜ æ„›æƒ… (Love)**
*   åˆ†æé‡é»ï¼šæˆ€æ„›å¥‘åˆåº¦ã€é•·æœŸç›¸è™•æ¨¡å¼ã€æ¿€æƒ…èˆ‡æ‰¿è«¾ã€‚
*   ç‰¹åˆ¥é—œæ³¨ï¼šå¹´é½¡å·®è·ï¼ˆå§å¼Ÿæˆ€/å…„å¦¹æˆ€ï¼‰å°é—œä¿‚çš„å½±éŸ¿ã€‚

**2. ğŸ‘ª è¦ªæƒ… (Family) - æ·±åº¦ç´°åˆ†**
è¦ªæƒ…é—œä¿‚æ˜¯ä¸å¯é¸æ“‡çš„ç·£åˆ†ï¼Œé‡é»åœ¨æ–¼**ã€Œå¦‚ä½•ç›¸è™•ã€**èˆ‡**ã€Œäº’ç›¸ç†è§£ã€**ï¼Œè€Œéã€Œé©ä¸é©åˆã€ã€‚
*   **ç³»çµ±æª¢æ¸¬ç”¨æˆ¶æ€§åˆ¥å¾Œï¼Œé¡¯ç¤ºç´°åˆ†é¸é …**ï¼š
    *   **ç”·æ€§ç”¨æˆ¶é¡¯ç¤º**ï¼š`å¦»å­`ã€`å­å¥³`ã€`çˆ¶æ¯`ã€`å­«è¼©`ã€`ç¥–çˆ¶æ¯`
    *   **å¥³æ€§ç”¨æˆ¶é¡¯ç¤º**ï¼š`ä¸ˆå¤«`ã€`å­å¥³`ã€`çˆ¶æ¯`ã€`å­«è¼©`ã€`ç¥–çˆ¶æ¯`
*   **åˆ†æé‡é»**ï¼š
    *   æ¥ç´å®¶äººçš„æ€§æ ¼ç‰¹è³ªï¼ˆå¦‚ï¼šçˆ¶è¦ªçš„å¨åš´ vs å¥³å…’çš„å›é€†ï¼‰ã€‚
    *   æä¾›å…·é«”çš„æºé€šå»ºè­°ï¼ˆå¦‚ï¼šå¦‚ä½•èˆ‡å›ºåŸ·çš„é•·è¼©æºé€šï¼‰ã€‚
    *   **é•·å¹¼è¼©åˆ†**ï¼šAI å¿…é ˆè­˜åˆ¥ä¸¦å°Šé‡é•·å¹¼å€«ç†ã€‚

**3. ğŸ¤ å‹æƒ… (Friendship)**
*   åˆ†æé‡é»ï¼šèˆˆè¶£å…±é³´ã€æ€§æ ¼äº’è£œã€ç¾©æ°£èˆ‡æ”¯æŒã€‚

**4. ğŸ’¼ å·¥ä½œ (Work)**
*   åˆ†æé‡é»ï¼šè·å ´å”ä½œæ•ˆç‡ã€æ±ºç­–é¢¨æ ¼è¡çªã€ä¸Šä¸‹ç´šæˆ–å¹³ç´šçš„ç›¸è™•ä¹‹é“ã€‚

**Step 2: è¼¸å…¥èˆ‡é¡åº¦æª¢æŸ¥ (Pre-check)**
1.  **é¡åº¦æª¢æŸ¥ (Quota Check)**:
    *   ç³»çµ±å…ˆæª¢æŸ¥**è«‹æ±‚æ–¹ (User A)** æ˜¯å¦æ“æœ‰è‡³å°‘ **1 å€‹ç®—å‘½ç“¶** (æˆ– VIP/å…è²»é¡åº¦)ã€‚
    *   **è‹¥ä¸è¶³**: ç›´æ¥å½ˆå‡ºã€Œç²å–ç®—å‘½ç“¶ã€å¼•å°ï¼Œ**ç¦æ­¢** ç™¼èµ·è«‹æ±‚ã€‚
2.  æç¤º: ã€Œâš ï¸ è«‹ç¢ºèªå°æ–¹æ˜¯ä½ èªè­˜çš„[é—œä¿‚é¡å‹]å°è±¡ï¼Œä¸”å¿…é ˆå–å¾—å°æ–¹çš„åŒæ„ã€‚ã€
3.  ç”¨æˆ¶ A è¼¸å…¥ç”¨æˆ¶ B çš„ Telegram ID / Usernameã€‚
4.  ç³»çµ±æª¢æŸ¥ç”¨æˆ¶ B æ˜¯å¦å­˜åœ¨åŠè³‡æ–™æ˜¯å¦å®Œæ•´ã€‚

**Step 3: ç™¼é€åŒæ„è«‹æ±‚ (Consent Request)**
1.  **Bot ä¸»å‹•ç§è¨Šç”¨æˆ¶ B**:
    *   **å®‰å¿ƒè²æ˜ (Reassurance)**: å¿…é ˆæ˜ç¢ºå‘ŠçŸ¥ Bï¼ŒA ç„¡æ³•çœ‹åˆ°éš±ç§æ•¸æ“šã€‚
    *   è¨Šæ¯ç¯„ä¾‹:
        > ã€ŒğŸ‘‹ ä½ çš„å¥½å‹ **[A æš±ç¨±] [æ€§åˆ¥]** å¸Œæœ›å’Œä½ åš **[é—œä¿‚é¡å‹]** çš„å±¬æ€§é…å°åˆ†æï¼Œæ˜¯å¦åŒæ„ï¼Ÿ
        >
        > ğŸ”’ **éš±ç§æ‰¿è«¾**: è«‹æ”¾å¿ƒï¼Œä½ çš„çœŸå¯¦å¹´é½¡ã€å‡ºç”Ÿæ—¥æœŸã€æ™‚é–“ã€åœ°é» **çµ•å°ä¸æœƒ** æ´©éœ²çµ¦å°æ–¹ã€‚å°æ–¹åªèƒ½çœ‹åˆ° AI ç”Ÿæˆçš„ã€é…å°å»ºè­°å ±å‘Šã€ã€‚ã€
    *   æŒ‰éˆ•: `[âœ… åŒæ„]`  `[âŒ æ‹’çµ•]`

**Step 4: å°æ–¹å›æ‡‰è™•ç† & å ±å‘Šç”Ÿæˆ**
*   **æƒ…å¢ƒ 1: ç”¨æˆ¶ B åŒæ„**
    1.  å»ºç«‹é…å°è¨˜éŒ„ï¼Œæ‰£é™¤ç”¨æˆ¶ A 1 ç®—å‘½ç“¶ã€‚
    2.  **ç”Ÿæˆåˆç›¤å ±å‘Š (AI Synthesis)**:
        *   **ç¶œåˆæ•¸æ“šå¼•æ“**: æ•´åˆ **æ˜Ÿç›¤ (ç›¸ä½åˆ†æ)** + **å…«å­— (äº”è¡Œç”Ÿå‰‹)** + **MBTI (èªçŸ¥åŠŸèƒ½)** + **è¡€å‹**ã€‚
        *   **å¥‘åˆåº¦è©•æ˜Ÿ (Compatibility Rating) è¨­è¨ˆé‚è¼¯**:
            *   **æ©Ÿåˆ¶**: ä¸¦ééš¨æ©Ÿç”Ÿæˆï¼Œè€Œæ˜¯ç”± AI åŸºæ–¼ä¸Šè¿°æ•¸æ“šçš„åŠ æ¬Šè¨ˆç®—ã€‚
            *   **æ¬Šé‡åƒè€ƒ**:
                *   æ˜Ÿåº§ç›¸ä½ (Trine/Sextile åŠ åˆ†, Square/Opposition æç¤ºæŒ‘æˆ°) - 40%
                *   MBTI èªçŸ¥åŠŸèƒ½äº’è£œæ€§ - 30%
                *   å…«å­—æ—¥ä¸»ç”Ÿå‰‹ - 20%
                *   è¡€å‹æ€§æ ¼é©é… - 10%
            *   **è¦ªæƒ…ç‰¹åˆ¥èª¿æ•´**: å°æ–¼è¦ªæƒ…ï¼Œè©•æ˜Ÿä»£è¡¨**ã€Œäº’å‹•é †æš¢åº¦ (Harmony Index)ã€**è€Œéã€Œæ˜¯å¦é©é…ã€ã€‚å³ä¾¿æ˜¯ä½åˆ†ï¼Œä¹Ÿä»£è¡¨ã€Œéœ€è¦æ›´å¤šæ™ºæ…§èˆ‡åŒ…å®¹ä¾†ç¶“ç‡Ÿã€ï¼Œè€Œéã€Œé—œä¿‚ä¸å¥½ã€ã€‚
        *   **æ­£å‘çµèª (Positive Conclusion)**:
            *   å¼·åˆ¶ AI åœ¨çµå°¾æ˜‡è¯ï¼šã€Œäººèˆ‡äººçš„ç›¸é‡æ˜¯å¹¾åå„„åˆ†ä¹‹ä¸€çš„å¥‡è¹Ÿã€ã€‚
            *   ç„¡è«–è©•åˆ†é«˜ä½ï¼Œéƒ½å¼·èª¿ç·£åˆ†çš„çè²´èˆ‡ç¶“ç‡Ÿçš„é‡è¦æ€§ã€‚
    3.  ç™¼é€å ±å‘Šã€‚

*   **æƒ…å¢ƒ 2: ç”¨æˆ¶ B æ‹’çµ•**
    1.  é€šçŸ¥ç”¨æˆ¶ A: ã€ŒâŒ å°æ–¹å·²å©‰æ‹’æœ¬æ¬¡é…å°è«‹æ±‚ã€‚ã€
    2.  è§¸ç™¼ **åé¨·æ“¾å†·å»æ©Ÿåˆ¶ (Anti-Harassment Cooldown)**ã€‚
    3.  **ä¸æ‰£è²»**ã€‚

#### C. åé¨·æ“¾èˆ‡é»‘åå–®æ©Ÿåˆ¶ (Anti-Harassment & Blacklist)
ç‚ºé˜²æ­¢é¨·æ“¾ä¸¦æ•´åˆã€Œæ¼‚æµç“¶ã€çš„å±è”½éœ€æ±‚ï¼Œç³»çµ±å¯¦æ–½ã€Œæ¼¸é€²å¼å†·å»ã€èˆ‡ã€Œè‡ªå‹•é»‘åå–®ã€æ©Ÿåˆ¶ã€‚

1.  **æ¼¸é€²å¼å†·å» (Progressive Cooldown)**:
    *   **ç¬¬ 1 æ¬¡è¢«æ‹’çµ•**: 24 å°æ™‚å…§ä¸å¯å°è©²ç”¨æˆ¶ç™¼èµ·è«‹æ±‚ã€‚
    *   **ç¬¬ 2 æ¬¡è¢«æ‹’çµ•**: 72 å°æ™‚å…§ä¸å¯å°è©²ç”¨æˆ¶ç™¼èµ·è«‹æ±‚ã€‚
    *   **ç¬¬ 3 æ¬¡è¢«æ‹’çµ•**: **ç›´æ¥åŠ å…¥é»‘åå–® (Auto-Block)**ã€‚

2.  **çµ±ä¸€é»‘åå–®ç³»çµ± (Unified Blacklist System)**:
    *   **è§¸ç™¼æ¢ä»¶**:
        *   é€£çºŒ 3 æ¬¡æ‹’çµ•é…å°è«‹æ±‚ã€‚
        *   ç”¨æˆ¶æ‰‹å‹•åœ¨è¨­ç½®ä¸­å°é–æŸäºº (å°šæœªå¯¦ä½œæ‰‹å‹•å…¥å£ï¼Œç›®å‰ç”±æ‹’çµ•è§¸ç™¼)ã€‚
    *   **å°é–æ•ˆæœ**:
        *   âŒ **å±¬æ€§è¨ºæ–·**: ç„¡æ³•å†ç™¼èµ·é…å°è«‹æ±‚ã€‚
        *   âŒ **æ¼‚æµç“¶**: é›™æ–¹å°‡**æ°¸é ä¸æœƒ**æ’ˆåˆ°å°æ–¹çš„ç“¶å­ï¼ˆé›™å‘å±è”½ï¼‰ã€‚
    *   **è§£é–æ©Ÿåˆ¶**:
        *   è¢«å°é–è€…ç„¡æ³•è‡ªè¡Œè§£é–ã€‚
        *   ç™¼èµ·å°é–è€…å¯åœ¨ `âš™ï¸ è¨­å®š` -> `ğŸ›¡ï¸ éš±ç§èˆ‡é»‘åå–®` ä¸­æŸ¥çœ‹ä¸¦è§£é™¤å°é–ã€‚

#### D. æœ‰æ•ˆæœŸèˆ‡è¨ˆè²» (Validity & Pricing)
*   **Consent æœ‰æ•ˆæœŸ**: 30 å¤©ã€‚
*   **è³‡æ–™è®Šæ›´é‡ç®— (On-Demand Re-calculation)**:
    *   è‹¥ä»»ä¸€æ–¹ (A æˆ– B) ä¿®æ”¹äº†å‘½ç›¤è³‡æ–™ï¼ŒèˆŠå ±å‘Šæ¨™è¨˜ç‚ºã€Œå¤±æ•ˆ (Outdated)ã€ã€‚
    *   **è¨ˆè²»è§¸ç™¼é»**: **åªæœ‰ç•¶ç”¨æˆ¶ä¸»å‹•é»æ“Š** `[ğŸ”„ è³‡æ–™å·²è®Šæ›´ï¼Œé‡æ–°ç”Ÿæˆå ±å‘Š]` æŒ‰éˆ•æ™‚ï¼Œæ‰æœƒæ‰£é™¤ 1 ç®—å‘½ç“¶ã€‚
    *   *è¨»: ç³»çµ±ä¸æœƒè‡ªå‹•æ‰£è²»ï¼Œå¿…é ˆç”±ç”¨æˆ¶æˆæ¬Šã€‚*

---

## 7. éš±ç§èˆ‡é»‘åå–®ç®¡ç† (Privacy & Blocklist Management)

**æ–°åŠŸèƒ½**: ç‚ºäº†è®“ç”¨æˆ¶ç®¡ç†è¢«è‡ªå‹•æˆ–æ‰‹å‹•å°é–çš„å°è±¡ã€‚

*   **å…¥å£**: `âš™ï¸ è¨­å®š` -> `ğŸ›¡ï¸ éš±ç§èˆ‡é»‘åå–®`ã€‚
*   **UI è¨­è¨ˆ (éµå¾ª UI Guideline ç°¡æ½”èˆ‡åé¥‹åŸå‰‡)**:
    
    **1. ä¸»ç•Œé¢ (Main Interface)**:
    *   **æ¨™é¡Œ**: `ğŸ›¡ï¸ éš±ç§èˆ‡é»‘åå–®ç®¡ç†`
    *   **èªªæ˜**:
        > åœ¨æ­¤ç®¡ç†æ‚¨å°é–çš„ç”¨æˆ¶ã€‚è¢«å°é–çš„å°è±¡å°‡ç„¡æ³•ï¼š
        > 1. å‘æ‚¨ç™¼é€é…å°è«‹æ±‚
        > 2. æ’¿åˆ°æ‚¨çš„æ¼‚æµç“¶ (é›™å‘å±è”½)
    *   **åˆ—è¡¨å‘ˆç¾**:
        *   **ç©ºç‹€æ…‹ (Empty)**: é¡¯ç¤ºã€Œç›®å‰æ²’æœ‰å°é–ä»»ä½•ç”¨æˆ¶ âœ…ã€ã€‚
        *   **éç©ºç‹€æ…‹**: ä»¥ Inline Buttons åˆ—å‡ºè¢«å°é–è€…ï¼Œæ ¼å¼ç‚º `[ğŸ”“ è§£é–: æš±ç¨±/ID]`ã€‚
        *   **åˆ†é æ©Ÿåˆ¶**: è‹¥è¶…é 10 äººï¼Œåº•éƒ¨é¡¯ç¤º `[â¬…ï¸ ä¸Šä¸€é ]` `[ä¸‹ä¸€é  â¡ï¸]`ã€‚
    *   **åŠŸèƒ½æŒ‰éˆ•**:
        *   `[â• æ‰‹å‹•å°é– (è¼¸å…¥ ID)]` (åº•éƒ¨å›ºå®š)
        *   `[ğŸ”™ è¿”å›è¨­å®š]`

    **2. æ“ä½œäº¤äº’ (Interaction)**:
    *   **è§£é™¤å°é–**:
        *   é»æ“Š `[ğŸ”“ è§£é–: UserA]` -> å½ˆå‡º Alert `âœ… å·²è§£é™¤å° UserA çš„å°é–` -> åˆ—è¡¨è‡ªå‹•åˆ·æ–°ã€‚
    *   **æ‰‹å‹•å°é–**:
        *   é»æ“Š `[â• æ‰‹å‹•å°é–]` -> é€²å…¥ Wizard æ¨¡å¼ã€‚
        *   æç¤º: ã€Œè«‹è¼¸å…¥æ‚¨æƒ³å°é–çš„ç”¨æˆ¶ Telegram ID (æˆ–æ˜¯è½‰ç™¼ä»–çš„ä¸€æ¢è¨Šæ¯çµ¦æˆ‘)ï¼šã€
        *   è¼¸å…¥å¾Œåé¥‹:
            *   æˆåŠŸ: `âœ… å·²æˆåŠŸå°é– [UserB]` -> è¿”å›åˆ—è¡¨ã€‚
            *   å¤±æ•— (ç„¡æ•ˆID): `âš ï¸ æ‰¾ä¸åˆ°è©²ç”¨æˆ¶ï¼Œè«‹æª¢æŸ¥ ID æ˜¯å¦æ­£ç¢ºã€‚` -> é¡¯ç¤ºé‡è©¦æŒ‰éˆ•ã€‚

---

## 12. æ•¸æ“šåº«è®Šæ›´éœ€æ±‚ (Database Schema Requirements)

**âš ï¸ é–‹ç™¼å‰å¿…è®€ï¼šç‚ºæ”¯æ´ä¸Šè¿°åŠŸèƒ½ï¼Œå¿…é ˆåŸ·è¡Œä»¥ä¸‹ Migration**

1.  **`users` è¡¨**:
    *   (ç¾æœ‰) `allow_matching`: æ”¹ç‚ºé è¨­é–‹å•Ÿã€‚
2.  **`user_blocklist` è¡¨ (æ–°å¢)**:
    *   ç”¨æ–¼çµ±ä¸€ç®¡ç†é»‘åå–®ï¼ˆé…å°èˆ‡æ¼‚æµç“¶ï¼‰ã€‚
    *   Fields:
        *   `user_id`: TEXT (Initiator)
        *   `blocked_user_id`: TEXT (Target)
        *   `reason`: TEXT (e.g., 'match_rejected', 'manual')
        *   `created_at`: TIMESTAMP
        *   Primary Key: `(user_id, blocked_user_id)`
3.  **`match_requests` è¡¨ (æ–°å¢)**:
    *   ç”¨æ–¼è¿½è¹¤è«‹æ±‚ç‹€æ…‹èˆ‡å†·å»æ™‚é–“ã€‚
    *   Fields:
        *   `id`: UUID
        *   `requester_id`: User A Telegram ID
        *   `target_id`: User B Telegram ID
        *   `status`: `pending`, `accepted`, `rejected`, `expired`
        *   `relationship_type`: TEXT (love, family, friend, work)
        *   `family_role`: TEXT
        *   `rejection_count`: INT (é€£çºŒæ‹’çµ•æ¬¡æ•¸)
        *   `last_rejected_at`: TIMESTAMP
        *   `created_at`: TIMESTAMP
        *   `expires_at`: TIMESTAMP
4.  **`fortune_history` è¡¨**:
    *   æ–°å¢ `profile_snapshot` (TEXT/JSON)
    *   æ–°å¢ `target_user_id` (TEXT)
    *   æ›´æ–° `type` Enum

---

## 13. é–‹ç™¼å®‰å…¨èˆ‡ i18n è¦ç¯„ (Safety & i18n Standards)

**âš ï¸ é–‹ç™¼éç¨‹ä¸­å¿…é ˆåš´æ ¼éµå®ˆä»¥ä¸‹åŸå‰‡ï¼Œé˜²æ­¢å›æ­¸éŒ¯èª¤ (Regression) èˆ‡ i18n ç½é›£ã€‚**

### 13.1 åŠŸèƒ½å®‰å…¨ (Feature Safety)
*   **é›¶ç ´å£åŸå‰‡**: æ–°å¢åŠŸèƒ½ï¼ˆå¦‚å±¬æ€§è¨ºæ–·ï¼‰**çµ•å°ä¸å¯å½±éŸ¿** ç¾æœ‰çš„ `Daily Fortune`ã€`Onboarding` æˆ– `Profile Management` æµç¨‹ã€‚
*   **ä»£ç¢¼éš”é›¢**: æ–°é‚è¼¯æ‡‰ç›¡é‡å°è£åœ¨ç¨ç«‹çš„å‡½æ•¸æˆ– Service æ–¹æ³•ä¸­ï¼Œé¿å…ä¿®æ”¹ç¾æœ‰çš„æ ¸å¿ƒ Helperã€‚

### 13.2 i18n å¯¦ä½œè¦ç¯„ (Internationalization)
*   **å„ªå…ˆè¤‡ç”¨ (Reuse First)**: ç·¨å¯« UI æ™‚ï¼Œå…ˆæœç´¢ `src/i18n/locales/zh-TW.ts`ã€‚
*   **ç¦æ­¢ç¡¬ç·¨ç¢¼**: çµ•å°ç¦æ­¢åœ¨ `.ts` æª”æ¡ˆä¸­ç›´æ¥å¯«æ­»ä¸­æ–‡ã€‚
*   **åƒæ•¸æ ¼å¼**: `{variable}` åªèƒ½åŒ…å«å­—æ¯æ•¸å­—ã€‚é¿å…ä½¿ç”¨åµŒå¥—èªæ³• `{user.name}`ï¼Œæ‡‰æ‰å¹³åŒ–ç‚º `{name}`ã€‚

### 13.4 è¿‘æœŸé—œéµä¿®å¾©èˆ‡æ•™è¨“ (Recent Critical Fixes & Lessons)
**è¨˜éŒ„æ—¥æœŸ: 2025-11-30**

1.  **Session Timeout å´©æ½° (`RangeError: Invalid time value`)**:
    *   **åŸå› **: æ–°å¢çš„ `SessionType` (å¦‚ `fortune_input`) æœªæ·»åŠ åˆ° `SESSION_TIMEOUT` å¸¸æ•¸ä¸­ï¼Œå°è‡´éæœŸæ™‚é–“è¨ˆç®—çµæœç‚º `NaN`ã€‚
    *   **é é˜²**: ä¿®æ”¹ `SessionType` å®šç¾©æ™‚ï¼Œ**å¿…é ˆåŒæ­¥** æ›´æ–° `SESSION_TIMEOUT`ã€‚

2.  **è®Šæ•¸ä½œç”¨åŸŸéŒ¯èª¤ (`ReferenceError: user is not defined`)**:
    *   **åŸå› **: åœ¨ `handleFortuneInput` ä¸­èª¿ç”¨ `createI18n` æ™‚ä½¿ç”¨äº†æœªåœ¨æ­¤ä½œç”¨åŸŸå®šç¾©çš„ `user` è®Šæ•¸ã€‚
    *   **é é˜²**: ä½¿ç”¨ä»»ä½•è®Šæ•¸å‰ï¼Œç¢ºä¿å·²åœ¨ç•¶å‰ Block ä¸­ç²å–æˆ–å®šç¾©ã€‚

3.  **i18n èª¤ç”¨èˆ‡ç¼ºå¤±**:
    *   **å•é¡Œ**: `common.cancel` è¢«éŒ¯èª¤è¦†å¯«ç‚ºéŒ¯èª¤æç¤ºèªï¼›`[fortune.love.invite_btn]` ç¼ºå¤±ã€‚
    *   **é é˜²**: ä½¿ç”¨ `scripts/check-i18n-integrity.ts` é€²è¡Œé éƒ¨ç½²æª¢æŸ¥ï¼›ä¿®æ”¹é€šç”¨ Key æ™‚éœ€æ ¼å¤–å°å¿ƒã€‚

4.  **æŒ‰éˆ•åŠŸèƒ½ç•°å¸¸**:
    *   **å•é¡Œ**: ã€Œé‚€è«‹å¥½å‹ã€æŒ‰éˆ•æ‡‰ä½¿ç”¨ URL Scheme (`https://t.me/share/url`) è€Œéåƒ…åƒ…æ˜¯æ–‡å­—æç¤ºã€‚

5.  **é‡æ§‹æé†’ (Refactoring Checklist)**:
    *   [ ] å¾¹åº•ç§»é™¤èˆŠçš„ `fortune_love.ts` ä¸­ç›´æ¥ç”Ÿæˆå ±å‘Šçš„é‚è¼¯ï¼Œæ”¹ç‚ºç™¼é€è«‹æ±‚ã€‚
    *   [ ] ç¢ºä¿ `allow_matching` æ¬„ä½çš„èªç¾©è®Šæ›´è¢«æ­£ç¢ºç†è§£ï¼ˆèˆŠä»£ç¢¼å¯èƒ½å°‡å…¶è¦–ç‚ºã€Œå¯ç›´æ¥é…å°ã€ï¼‰ã€‚
    *   [ ] ç¢ºä¿ `quota` æª¢æŸ¥é‚è¼¯åœ¨æµç¨‹æœ€å‰ç«¯ï¼ˆè¼¸å…¥ ID å‰ï¼‰å°±åŸ·è¡Œã€‚

---

## 14. Cursor + AI é–‹ç™¼å¯¦è¸å®ˆå‰‡ (AI Implementation Guidelines)

ç‚ºäº†ç¢ºä¿åœ¨æ¥ä¸‹ä¾†çš„é–‹ç™¼é€±æœŸä¸­ï¼Œé¿å…é‡è¤‡éå»çš„éŒ¯èª¤ï¼ˆi18n å›æ­¸ã€è³‡æ–™åº«ä¸åŒæ­¥ã€é‚è¼¯æ­»è§’ï¼‰ï¼Œå¿…é ˆåš´æ ¼éµå®ˆä»¥ä¸‹é–‹ç™¼å®ˆå‰‡ã€‚

### 14.1 é›¶å®¹å¿çš„ i18n æµç¨‹ (Zero Tolerance i18n Flow)
**åŸå‰‡**: ä»»ä½•è¢«é¡¯ç¤ºåœ¨ UI ä¸Šçš„æ–‡å­—ï¼Œéƒ½å¿…é ˆæ˜¯è®Šé‡ã€‚
1.  **Strict Syntax**: åœ¨ `zh-TW.ts` æˆ–ä»»ä½•èªè¨€æ–‡ä»¶ä¸­ï¼Œ**çµ•å°ç¦æ­¢**ä½¿ç”¨ JS æ¨¡æ¿å­—é¢é‡èªæ³•ï¼ˆåå¼•è™Ÿ `` ` `` æˆ– `${var}`ï¼‰ã€‚å¿…é ˆå§‹çµ‚ä½¿ç”¨ `{var}` æ ¼å¼ã€‚
2.  **Pre-Commit Check**: æ¯æ¬¡ä¿®æ”¹ç¿»è­¯æ–‡ä»¶å¾Œï¼Œ**å¿…é ˆ**æ‰‹å‹•åŸ·è¡Œ `pnpm tsx scripts/check-i18n-integrity.ts`ã€‚å¦‚æœå ±éŒ¯ï¼Œ**ä¸å…è¨±**æäº¤ä»£ç¢¼ã€‚
3.  **Atomic Translation**: ä¸è¦è©¦åœ–åœ¨ä¸€æ¬¡ç·¨è¼¯ä¸­ç¿»è­¯æ‰€æœ‰èªè¨€ã€‚å…ˆç¢ºä¿ `zh-TW` å®Œç¾ç„¡ç¼ºï¼Œç„¶å¾Œä¾è³´å¾ŒçºŒçš„æ‰¹é‡ç¿»è­¯è…³æœ¬ã€‚

### 14.2 è³‡æ–™åº«è®Šæ›´å„ªå…ˆ (Database Migration First)
**åŸå‰‡**: æ‡‰ç”¨å±¤ä»£ç¢¼æ°¸é ä¸æ‡‰ã€ŒçŒœæ¸¬ã€è³‡æ–™åº«çµæ§‹ã€‚
1.  **Schema First**: å¦‚æœåŠŸèƒ½éœ€è¦æ–°æ¬„ä½ï¼ˆå¦‚ `match_requests`ï¼‰ï¼Œ**ç¬¬ä¸€æ­¥**æ°¸é æ˜¯ç·¨å¯« Migration SQLã€‚
2.  **Verify & Apply**: ç·¨å¯«å®Œ Migration å¾Œï¼Œç«‹å³åœ¨ Staging ç’°å¢ƒåŸ·è¡Œ `wrangler d1 migrations apply`ï¼Œä¸¦ä½¿ç”¨ `d1 execute` é©—è­‰è¡¨çµæ§‹å·²ç”Ÿæ•ˆã€‚
3.  **Code Second**: åªæœ‰åœ¨è³‡æ–™åº«ç¢ºèªæ›´æ–°å¾Œï¼Œæ‰é–‹å§‹ç·¨å¯« TypeScript é‚è¼¯ã€‚

### 14.3 é˜²ç¦¦æ€§ç·¨ç¨‹èˆ‡æ—¥èªŒ (Defensive Coding & Logging)
**åŸå‰‡**: æ°¸é å‡è¨­ã€Œç”¨æˆ¶ä¸å­˜åœ¨ã€ã€ã€Œé¡åº¦ä¸è¶³ã€æˆ–ã€Œè¼¸å…¥ç„¡æ•ˆã€ã€‚
1.  **Early Exit**: åœ¨å‡½æ•¸é–‹é ­é€²è¡Œæ‰€æœ‰å¿…è¦æª¢æŸ¥ï¼ˆUser auth, Quota check, Input validationï¼‰ã€‚å¦‚æœä¸é€šéï¼Œç«‹å³ `return` ä¸¦çµ¦å‡ºæ˜ç¢ºæç¤ºã€‚
2.  **Granular Logging**: åœ¨é—œéµæµç¨‹ï¼ˆå¦‚ï¼šç™¼èµ·é…å°è«‹æ±‚ã€æ¥æ”¶å›èª¿ï¼‰çš„æ¯å€‹åˆ†æ”¯é»æ·»åŠ  `console.log` æˆ– `console.error`ã€‚é€™èƒ½è§£æ±ºã€Œé»æ“Šç„¡åæ‡‰ã€çš„éš±å½¢ Bugã€‚
3.  **Type Safety**: æ“´å…… `FortuneType` æˆ– `SessionType` æ™‚ï¼Œå¿…é ˆåŒæ­¥æ›´æ–°æ‰€æœ‰ç›¸é—œçš„ Switch Case å’Œ Type Definitionï¼ˆå¦‚ `SESSION_TIMEOUT`ï¼‰ï¼Œä¸è¦éºæ¼ä»»ä½•ä¸€å€‹ã€‚

### 14.4 æç¤ºè©å„ªåŒ– (Prompt Optimization for Gemini)
**åŸå‰‡**: å° AI èªªæ¸…æ¥šã€Œè¦ä»€éº¼ã€å’Œã€Œä¸è¦ä»€éº¼ã€ã€‚
1.  **Format Enforcing**: åœ¨ Prompt System Role ä¸­ï¼Œæ˜ç¢ºåŠ ä¸Š `[IMPORTANT: OUTPUT MUST BE PLAIN TEXT WITH EMOJIS. NO MARKDOWN.]`ã€‚
2.  **Privacy Guard**: åœ¨ Prompt ä¸­å¼·åˆ¶åŠ å…¥ `[SECURITY RULE: DO NOT REVEAL TARGET'S BIRTH DATA]`ã€‚

---

**æœ€å¾Œæ›´æ–°**: 2025-11-30
**ç¶­è­·è€…**: å°ˆæ¡ˆåœ˜éšŠ
