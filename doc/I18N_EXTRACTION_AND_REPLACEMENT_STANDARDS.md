# i18n æå–ä¸æ›¿æ¢è§„èŒƒ

> **é‡è¦**: æœ¬æ–‡æ¡£å®šä¹‰äº† i18n æå–å’Œæ›¿æ¢çš„æ ‡å‡†æµç¨‹å’Œè§„åˆ™ã€‚**æ¯æ¬¡è¿›è¡Œ i18n ç›¸å…³å·¥ä½œå‰ï¼Œå¿…é¡»å…ˆé˜…è¯»æœ¬æ–‡æ¡£ã€‚**

**æœ€åæ›´æ–°**: 2025-01-23  
**çŠ¶æ€**: âœ… å·²ç”Ÿæ•ˆ

---

## ğŸ“‹ ç›®å½•

1. [æå–è§„èŒƒ](#æå–è§„èŒƒ)
2. [æ›¿æ¢è§„èŒƒ](#æ›¿æ¢è§„èŒƒ)
3. [çŠ¶æ€è·Ÿè¸ªè§„èŒƒ](#çŠ¶æ€è·Ÿè¸ªè§„èŒƒ)
4. [æ–‡ä»¶ç»“æ„è§„èŒƒ](#æ–‡ä»¶ç»“æ„è§„èŒƒ)
5. [è´¨é‡ä¿è¯è§„èŒƒ](#è´¨é‡ä¿è¯è§„èŒƒ)

---

## 1. æå–è§„èŒƒ

### 1.1 æå–å‰å¿…é¡»æ£€æŸ¥

**âš ï¸ æ¯æ¬¡æå–å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œä»¥ä¸‹æ£€æŸ¥**ï¼š

```bash
# 1. æ£€æŸ¥æ›¿æ¢çŠ¶æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh i18n_replacement_status.json

# 2. å¦‚æœå­˜åœ¨ï¼Œè¯»å–å¹¶æ˜¾ç¤ºå½“å‰çŠ¶æ€
cat i18n_replacement_status.json | jq '.totalReplaced, .totalPending'

# 3. æ£€æŸ¥æ˜¯å¦æœ‰å¸¦çŠ¶æ€çš„æå–ç»“æœ
ls -lh i18n_complete_final_with_status.json
```

**è§„åˆ™**ï¼š
- âœ… **å¿…é¡»è¯»å–** `i18n_replacement_status.json`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- âœ… **å¿…é¡»è·³è¿‡** `status: "replaced"` çš„å†…å®¹
- âœ… **å¿…é¡»è·³è¿‡** å·²åœ¨ `replaced` åˆ—è¡¨ä¸­çš„å†…å®¹
- âŒ **ç¦æ­¢** é‡å¤æå–å·²æ›¿æ¢çš„å†…å®¹

### 1.2 æ‰«æèŒƒå›´

**å®Œæ•´æ‰«æç›®å½•**ï¼ˆå¿…é¡»å…¨éƒ¨æ‰«æï¼‰ï¼š

```typescript
const SCAN_DIRS = [
  'src/telegram/handlers',  // æ‰€æœ‰ handlers
  'src/domain',             // ä¸šåŠ¡é€»è¾‘å±‚
  'src/services',           // æœåŠ¡å±‚
  'src/db',                 // æ•°æ®åº“ç›¸å…³ï¼ˆåŒ…æ‹¬ SQL æ–‡ä»¶ï¼‰
  'src/utils',              // å·¥å…·å‡½æ•°
  'src/config',             // é…ç½®æ–‡ä»¶
];
```

**æ‰«ææ–‡ä»¶ç±»å‹**ï¼š
- âœ… `.ts` æ–‡ä»¶ï¼ˆTypeScript æºä»£ç ï¼‰
- âœ… `.sql` æ–‡ä»¶ï¼ˆæ•°æ®åº“è¿ç§»å’Œç§å­æ•°æ®ï¼‰
- âŒ è·³è¿‡ `.test.ts` æ–‡ä»¶ï¼ˆæµ‹è¯•æ–‡ä»¶ï¼‰
- âŒ è·³è¿‡ `node_modules/`
- âŒ è·³è¿‡æ³¨é‡Šï¼ˆ`//`, `/* */`ï¼‰

### 1.3 æå–è§„åˆ™

#### æå–ç²’åº¦åŸåˆ™

**âœ… å¿…é¡»éµå®ˆ**ï¼š

1. **å®Œæ•´å¥å­/æ®µè½**ï¼š
   - âœ… ä¿æŒè¯­ä¹‰å®Œæ•´æ€§
   - âœ… 500 å­—ä»¥å†…çš„æ®µè½éƒ½ä¿æŒå®Œæ•´
   - âœ… ä¸è¦æ‹†åˆ†è¿‡ç»†

2. **æŒ‰é’®æ–‡å­—**ï¼š
   - âœ… å¯ä»¥å•ç‹¬æå–ï¼ˆå¦‚ "ä¸Ÿç“¶å­"ã€"è¨­å®š"ï¼‰
   - âœ… ä¿æŒç®€çŸ­

3. **é”™è¯¯æ¶ˆæ¯**ï¼š
   - âœ… å®Œæ•´æå–ï¼ˆå¦‚ "âš ï¸ ç”¨æˆ¶ä¸å­˜åœ¨ï¼Œè«‹å…ˆä½¿ç”¨ /start è¨»å†Šã€‚"ï¼‰
   - âŒ ä¸è¦æ‹†åˆ†

4. **æ¨¡æ¿å­—ç¬¦ä¸²**ï¼š
   - âœ… åŒ…å«å˜é‡æ’å€¼çš„å®Œæ•´æ¨¡æ¿ï¼ˆå¦‚ `"ğŸ“Š ä»Šæ—¥å·²ç™¼é€ï¼š${usedToday}/${dailyLimit} å‰‡"`ï¼‰
   - âœ… ä¿æŒä¸ºä¸€ä¸ª key

#### è·³è¿‡è§„åˆ™

**âŒ ä»¥ä¸‹å†…å®¹å¿…é¡»è·³è¿‡**ï¼š

1. **æ³¨é‡Š**ï¼š
   ```typescript
   // âŒ è·³è¿‡ï¼šè¿™æ˜¯æ³¨é‡Š
   /* âŒ è·³è¿‡ï¼šè¿™ä¹Ÿæ˜¯æ³¨é‡Š */
   ```

2. **console.log**ï¼š
   ```typescript
   console.log('âŒ è·³è¿‡ï¼šè¿™æ˜¯æ—¥å¿—');
   ```

3. **å·²ä½¿ç”¨ i18n.t()**ï¼š
   ```typescript
   i18n.t('errors.userNotFound')  // âŒ è·³è¿‡ï¼šå·²ç»ä½¿ç”¨ i18n
   ```

4. **æŠ€æœ¯æ ‡è¯†ç¬¦**ï¼š
   ```typescript
   callback_data: 'lang_zh-TW'  // âŒ è·³è¿‡ï¼šæŠ€æœ¯æ ‡è¯†ç¬¦
   ```

5. **æ­£åˆ™è¡¨è¾¾å¼**ï¼š
   ```typescript
   /[\u4e00-\u9fa5]/  // âŒ è·³è¿‡ï¼šæ­£åˆ™è¡¨è¾¾å¼
   ```

6. **Emoji ä½œä¸ºçŠ¶æ€**ï¼š
   ```typescript
   status: 'âœ…'  // âŒ è·³è¿‡ï¼šEmoji ä½œä¸ºçŠ¶æ€æŒ‡ç¤º
   ```

### 1.4 å»é‡æœºåˆ¶

**å¿…é¡»å®ç°**ï¼š

```typescript
function addExtracted(item: ExtractedContent) {
  // 1. æ£€æŸ¥æ›¿æ¢çŠ¶æ€ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
  if (replacementStatus) {
    const isReplaced = replacementStatus.replaced.some(r => 
      r.file === item.file && r.line === item.line
    );
    if (isReplaced) {
      console.log(`â­ï¸  è·³è¿‡å·²æ›¿æ¢: ${item.file}:${item.line}`);
      return; // è·³è¿‡å·²æ›¿æ¢çš„å†…å®¹
    }
  }
  
  // 2. æ£€æŸ¥æ–‡æœ¬å»é‡
  const exists = extracted.some(e => e.text === item.text);
  if (!exists) {
    extracted.push(item);
  }
}
```

### 1.5 è¾“å‡ºæ–‡ä»¶

**å¿…é¡»ç”Ÿæˆ**ï¼š

1. **`i18n_complete_final.json`** - æå–çš„åŸå§‹æ•°æ®
2. **`i18n_keys_mapping.json`** - Key æ˜ å°„è¡¨
3. **`i18n_scanned_files.txt`** - æ‰«æçš„æ–‡ä»¶åˆ—è¡¨
4. **`I18N_EXTRACTION_REPORT.md`** - æ‰«ææŠ¥å‘Š

**å¯é€‰ç”Ÿæˆ**ï¼ˆå¦‚æœå­˜åœ¨æ›¿æ¢çŠ¶æ€ï¼‰ï¼š
- `i18n_complete_final_with_status.json` - å¸¦çŠ¶æ€çš„æå–ç»“æœ

---

## 2. æ›¿æ¢è§„èŒƒ

### 2.1 æ›¿æ¢å‰å¿…é¡»æ£€æŸ¥

**âš ï¸ æ¯æ¬¡æ›¿æ¢å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œä»¥ä¸‹æ£€æŸ¥**ï¼š

```bash
# 1. æ£€æŸ¥æå–ç»“æœæ˜¯å¦å­˜åœ¨
ls -lh i18n_complete_final.json
ls -lh i18n_keys_mapping.json

# 2. æ£€æŸ¥æ›¿æ¢çŠ¶æ€æ–‡ä»¶
ls -lh i18n_replacement_status.json

# 3. ç¡®è®¤å½“å‰ Git çŠ¶æ€
git status
git log -1 --oneline
```

**è§„åˆ™**ï¼š
- âœ… **å¿…é¡»å¤‡ä»½** å½“å‰ä»£ç ï¼ˆGit commitï¼‰
- âœ… **å¿…é¡»è¯»å–** key æ˜ å°„è¡¨
- âœ… **å¿…é¡»æ›´æ–°** æ›¿æ¢çŠ¶æ€æ–‡ä»¶
- âŒ **ç¦æ­¢** ç›´æ¥ä¿®æ”¹ä»£ç ï¼ˆå¿…é¡»å…ˆå¤‡ä»½ï¼‰

### 2.2 æ›¿æ¢è§„åˆ™

#### æ›¿æ¢æ–¹å¼

**ä½¿ç”¨ AST è§£ææ›¿æ¢**ï¼ˆæ¨èï¼‰ï¼š

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ AST è§£æ
import * as ts from 'typescript';

function replaceWithAST(sourceFile: ts.SourceFile, mapping: Map<string, string>) {
  // ä½¿ç”¨ TypeScript AST ç²¾ç¡®æ›¿æ¢
  // ...
}
```

**ç¦æ­¢ä½¿ç”¨ç®€å•å­—ç¬¦ä¸²æ›¿æ¢**ï¼š

```typescript
// âŒ é”™è¯¯ï¼šç®€å•å­—ç¬¦ä¸²æ›¿æ¢ï¼ˆå®¹æ˜“å‡ºé”™ï¼‰
content.replace('âŒ ç„¡æ•ˆçš„èªè¨€ä»£ç¢¼', "i18n.t('errors.invalidLanguageCode')");
```

#### æ›¿æ¢æ ¼å¼

**æ ‡å‡†æ ¼å¼**ï¼š

```typescript
// æ›¿æ¢å‰
await telegram.sendMessage(chatId, 'âŒ ç„¡æ•ˆçš„èªè¨€ä»£ç¢¼');

// æ›¿æ¢å
const { createI18n } = await import('~/i18n');
const i18n = createI18n(user.language_pref || 'zh-TW');
await telegram.sendMessage(chatId, i18n.t('errors.invalidLanguageCode'));
```

**å¿…é¡»æ·»åŠ  i18n åˆå§‹åŒ–**ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼š

```typescript
// å¦‚æœæ–‡ä»¶æ²¡æœ‰ i18n importï¼Œå¿…é¡»æ·»åŠ 
import { createI18n } from '~/i18n';

// åœ¨å‡½æ•°ä¸­åˆå§‹åŒ–ï¼ˆä½¿ç”¨ç”¨æˆ·çš„ language_prefï¼‰
const i18n = createI18n(user.language_pref || 'zh-TW');
```

### 2.3 æ›¿æ¢åå¿…é¡»æ›´æ–°çŠ¶æ€

**æ›¿æ¢åå¿…é¡»æ‰§è¡Œ**ï¼š

```typescript
// 1. æ›´æ–°æ›¿æ¢çŠ¶æ€æ–‡ä»¶
function updateReplacementStatus(file: string, line: number, key: string, original: string) {
  const status = loadReplacementStatus();
  
  status.replaced.push({
    file,
    line,
    original,
    key,
    replacedAt: new Date().toISOString(),
  });
  
  // ä» pending ä¸­ç§»é™¤
  status.pending = status.pending.filter(
    p => !(p.file === file && p.line === line)
  );
  
  status.totalReplaced++;
  status.totalPending--;
  
  saveReplacementStatus(status);
}
```

### 2.4 æ›¿æ¢åå¿…é¡»æµ‹è¯•

**æ¯ä¸ªæ–‡ä»¶æ›¿æ¢åå¿…é¡»**ï¼š

```bash
# 1. Lint æ£€æŸ¥
pnpm lint

# 2. ç±»å‹æ£€æŸ¥
pnpm type-check

# 3. å•å…ƒæµ‹è¯•ï¼ˆå¦‚æœæœ‰ï¼‰
pnpm test

# 4. Smoke Testï¼ˆå…³é”®åŠŸèƒ½ï¼‰
pnpm smoke-test
```

---

## 3. çŠ¶æ€è·Ÿè¸ªè§„èŒƒ

### 3.1 çŠ¶æ€æ–‡ä»¶ç»“æ„

**æ›¿æ¢çŠ¶æ€æ–‡ä»¶**ï¼š`i18n_replacement_status.json`

```json
{
  "createdAt": "2025-01-23T...",
  "totalExtracted": 1945,
  "totalReplaced": 20,
  "totalPending": 1925,
  "replaced": [
    {
      "file": "src/telegram/handlers/language_selection.ts",
      "line": 83,
      "original": "âŒ ç„¡æ•ˆçš„èªè¨€ä»£ç¢¼",
      "key": "errors.invalidLanguageCode",
      "replacedAt": "2025-01-23T..."
    }
  ],
  "pending": [
    {
      "file": "src/telegram/handlers/menu.ts",
      "line": 45,
      "original": "ğŸ“Š çµ±è¨ˆæ•¸æ“š",
      "key": "menu.stats",
      "extractedAt": "2025-11-22T..."
    }
  ]
}
```

### 3.2 çŠ¶æ€å­—æ®µ

**æå–ç»“æœä¸­çš„ status å­—æ®µ**ï¼š

- `extracted` - å·²æå–ä½†æœªæ›¿æ¢
- `replaced` - å·²æ›¿æ¢
- `pending` - å¾…å¤„ç†

### 3.3 çŠ¶æ€æ›´æ–°è§„åˆ™

**å¿…é¡»éµå®ˆ**ï¼š

1. **æå–æ—¶**ï¼š
   - âœ… è¯»å–æ›¿æ¢çŠ¶æ€æ–‡ä»¶
   - âœ… è·³è¿‡ `status: "replaced"` çš„å†…å®¹
   - âœ… æ–°æå–çš„å†…å®¹æ ‡è®°ä¸º `status: "extracted"`

2. **æ›¿æ¢æ—¶**ï¼š
   - âœ… æ›´æ–°æ›¿æ¢çŠ¶æ€æ–‡ä»¶
   - âœ… ä» `pending` ç§»åˆ° `replaced`
   - âœ… æ›´æ–°æå–ç»“æœä¸­çš„ `status` å­—æ®µ

3. **éªŒè¯æ—¶**ï¼š
   - âœ… æ£€æŸ¥çŠ¶æ€æ–‡ä»¶æ˜¯å¦æœ€æ–°
   - âœ… éªŒè¯æ›¿æ¢è¿›åº¦

---

## 4. æ–‡ä»¶ç»“æ„è§„èŒƒ

### 4.1 æå–ç›¸å…³æ–‡ä»¶

**å¿…é¡»å­˜åœ¨çš„æ–‡ä»¶**ï¼š

```
i18n_complete_final.json              # æå–ç»“æœï¼ˆä¸»æ–‡ä»¶ï¼‰
i18n_keys_mapping.json                # Key æ˜ å°„è¡¨
i18n_complete_final_with_status.json  # å¸¦çŠ¶æ€çš„æå–ç»“æœï¼ˆå¦‚æœå­˜åœ¨ï¼‰
i18n_replacement_status.json          # æ›¿æ¢çŠ¶æ€æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
i18n_scanned_files.txt                # æ‰«æçš„æ–‡ä»¶åˆ—è¡¨
I18N_EXTRACTION_REPORT.md             # æå–æŠ¥å‘Š
```

### 4.2 è„šæœ¬æ–‡ä»¶

**å¿…é¡»å­˜åœ¨çš„è„šæœ¬**ï¼š

```
scripts/extract-100-percent-coverage.ts    # æå–è„šæœ¬
scripts/add-status-to-extraction.ts       # çŠ¶æ€åˆ†æè„šæœ¬
scripts/apply-i18n-replacements-final.ts  # æ›¿æ¢è„šæœ¬
```

---

## 5. è´¨é‡ä¿è¯è§„èŒƒ

### 5.1 æå–è´¨é‡

**å¿…é¡»éªŒè¯**ï¼š

1. âœ… **è¦†ç›–ç‡**: 100%ï¼ˆæ‰€æœ‰ç¡¬ç¼–ç éƒ½å·²è¯†åˆ«ï¼ŒåŒ…æ‹¬æ•°æ®åº“ï¼‰
2. âœ… **å»é‡**: æ²¡æœ‰é‡å¤æå–
3. âœ… **å®Œæ•´æ€§**: å®Œæ•´å¥å­/æ®µè½ï¼Œä¸æ‹†åˆ†è¿‡ç»†
4. âœ… **è·³è¿‡è§„åˆ™**: æ­£ç¡®è·³è¿‡æ³¨é‡Šã€æ—¥å¿—ç­‰
5. âœ… **æ•°æ®åº“å†…å®¹**: SQL æ–‡ä»¶ä¸­çš„ä¸­æ–‡å·²æå–

### 5.2 æ•°æ®åº“ç¡¬ç¼–ç å¤„ç†

**æå–çŠ¶æ€**ï¼ˆâœ… å·²å®Œæˆï¼‰ï¼š
- âœ… SQL æ–‡ä»¶å·²æ‰«æï¼š8 ä¸ªæ–‡ä»¶åŒ…å«ä¸­æ–‡
- âœ… ä¸­æ–‡å†…å®¹å·²æå–ï¼šæ‰€æœ‰æ•°æ®åº“ä¸­çš„ä¸­æ–‡ç¡¬ç¼–ç éƒ½å·²æå–
- âœ… å·²ç”Ÿæˆ i18n keys

**æ›¿æ¢çŠ¶æ€**ï¼ˆâŒ æœªå¼€å§‹ï¼‰ï¼š
- âŒ æ•°æ®åº“æœªæ›´æ–°ï¼šæ•°æ®åº“ä¸­çš„æ•°æ®ä»ç„¶æ˜¯ä¸­æ–‡
- âŒ æœªç”Ÿæˆè¿ç§»è„šæœ¬ï¼šéœ€è¦ç”Ÿæˆè¿ç§»è„šæœ¬
- âŒ ä»£ç æœªæ›´æ–°ï¼šè¯»å–æ•°æ®åº“æ•°æ®çš„ä»£ç è¿˜æ²¡æœ‰ä½¿ç”¨ `i18n.t()`

**å¤„ç†æ­¥éª¤**ï¼š
1. ç”Ÿæˆæ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆå°†ä¸­æ–‡æ›¿æ¢ä¸º i18n keysï¼‰
2. æ›´æ–°ä»£ç è¯»å–é€»è¾‘ï¼ˆä½¿ç”¨ `i18n.t()`ï¼‰
3. æ‰§è¡Œè¿ç§»å¹¶æµ‹è¯•

### 5.2 æ›¿æ¢è´¨é‡

**å¿…é¡»éªŒè¯**ï¼š

1. âœ… **å‡†ç¡®æ€§**: ä½¿ç”¨ AST è§£æï¼Œ100% å‡†ç¡®
2. âœ… **ç±»å‹å®‰å…¨**: è‡ªåŠ¨æ›´æ–° TypeScript ç±»å‹
3. âœ… **æµ‹è¯•é€šè¿‡**: Lintã€ç±»å‹æ£€æŸ¥ã€å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
4. âœ… **çŠ¶æ€æ›´æ–°**: æ›¿æ¢çŠ¶æ€æ–‡ä»¶å·²æ›´æ–°

### 5.3 éªŒæ”¶æ ‡å‡†

**æ›¿æ¢å®Œæˆåå¿…é¡»**ï¼š

1. âœ… **Lint æ£€æŸ¥**: `pnpm lint` é€šè¿‡
2. âœ… **ç±»å‹æ£€æŸ¥**: `pnpm type-check` é€šè¿‡
3. âœ… **å•å…ƒæµ‹è¯•**: `pnpm test` é€šè¿‡
4. âœ… **Smoke Test**: å…³é”®åŠŸèƒ½æµ‹è¯•é€šè¿‡
5. âœ… **çŠ¶æ€æ–‡ä»¶**: æ›¿æ¢çŠ¶æ€æ–‡ä»¶å·²æ›´æ–°
6. âœ… **Git æäº¤**: ä»£ç å·²æäº¤åˆ° Git

---

## 6. å·¥ä½œæµç¨‹

### 6.1 æå–æµç¨‹

```mermaid
graph TD
    A[å¼€å§‹æå–] --> B[æ£€æŸ¥æ›¿æ¢çŠ¶æ€æ–‡ä»¶]
    B --> C[æ‰«ææ‰€æœ‰æ–‡ä»¶]
    C --> D[æå–ç¡¬ç¼–ç ]
    D --> E[å»é‡æ£€æŸ¥]
    E --> F[è·³è¿‡å·²æ›¿æ¢å†…å®¹]
    F --> G[ç”Ÿæˆæå–ç»“æœ]
    G --> H[ç”Ÿæˆ Key æ˜ å°„]
    H --> I[ç”ŸæˆæŠ¥å‘Š]
    I --> J[å®Œæˆ]
```

### 6.2 æ›¿æ¢æµç¨‹

```mermaid
graph TD
    A[å¼€å§‹æ›¿æ¢] --> B[å¤‡ä»½ä»£ç ]
    B --> C[è¯»å– Key æ˜ å°„]
    C --> D[è¯»å–æ›¿æ¢çŠ¶æ€]
    D --> E[AST è§£ææ›¿æ¢]
    E --> F[æ›´æ–°çŠ¶æ€æ–‡ä»¶]
    F --> G[Lint æ£€æŸ¥]
    G --> H[ç±»å‹æ£€æŸ¥]
    H --> I[æµ‹è¯•]
    I --> J[Git æäº¤]
    J --> K[å®Œæˆ]
```

---

## 7. å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•é¿å…é‡å¤æå–ï¼Ÿ

**A**: 
1. è¯»å– `i18n_replacement_status.json`
2. è·³è¿‡ `status: "replaced"` çš„å†…å®¹
3. ä½¿ç”¨æ–‡æœ¬å»é‡æœºåˆ¶

### Q2: å¦‚ä½•çŸ¥é“æ›¿æ¢è¿›åº¦ï¼Ÿ

**A**: 
1. æŸ¥çœ‹ `i18n_replacement_status.json` ä¸­çš„ `totalReplaced` å’Œ `totalPending`
2. æŸ¥çœ‹ `i18n_complete_final_with_status.json` ä¸­çš„ `statusDistribution`

### Q3: æå–è„šæœ¬å¦‚ä½•çŸ¥é“å“ªäº›å·²æ›¿æ¢ï¼Ÿ

**A**: 
1. è¯»å– `i18n_replacement_status.json`
2. æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦æœ‰ `i18n.t()` è°ƒç”¨
3. å¯¹æ¯”æå–ç»“æœå’Œæ›¿æ¢çŠ¶æ€

---

## 8. å¼€å‘æ–°åŠŸèƒ½æ—¶çš„ i18n è§„èŒƒï¼ˆâš ï¸ é¢„é˜²ç¡¬ç¼–ç ï¼‰

### 8.1 å¼€å‘å‰å‡†å¤‡

**å¿…é¡»é˜…è¯»**ï¼š
- [ ] `@doc/I18N_GUIDE.md` - i18n ä½¿ç”¨æŒ‡å—
- [ ] `@doc/I18N_EXTRACTION_AND_REPLACEMENT_STANDARDS.md` - æœ¬æ–‡æ¡£

**å¿…é¡»ç†è§£**ï¼š
- âœ… æ‰€æœ‰ç”¨æˆ·å¯è§æ–‡å­—éƒ½å¿…é¡»ä½¿ç”¨ `i18n.t()`
- âœ… ç¦æ­¢ç¡¬ç¼–ç ä¸­æ–‡å­—ç¬¦ä¸²
- âœ… æ–°å¢æ–‡å­—æ—¶ç«‹å³æ·»åŠ åˆ° locale æ–‡ä»¶

### 8.2 ç¼–å†™ä»£ç æ—¶çš„è¦æ±‚

**âœ… æ­£ç¡®åšæ³•**ï¼š

```typescript
// 1. å¯¼å…¥ i18n
import { createI18n } from '~/i18n';

// 2. åˆå§‹åŒ– i18nï¼ˆä½¿ç”¨ç”¨æˆ·çš„ language_prefï¼‰
const i18n = createI18n(user.language_pref || 'zh-TW');

// 3. ä½¿ç”¨ i18n.t() æ˜¾ç¤ºæ–‡å­—
await telegram.sendMessage(chatId, i18n.t('errors.userNotFound'));
await telegram.sendMessageWithButtons(
  chatId,
  i18n.t('menu.welcome'),
  [[{ text: i18n.t('buttons.throwBottle'), callback_data: 'menu_throw' }]]
);
```

**âŒ ç¦æ­¢çš„åšæ³•**ï¼š

```typescript
// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç ä¸­æ–‡
await telegram.sendMessage(chatId, 'âŒ ç”¨æˆ¶ä¸å­˜åœ¨');

// âŒ é”™è¯¯ï¼šå…ˆå†™ä¸­æ–‡ï¼Œè¯´ã€Œä¹‹åå†æå–ã€
await telegram.sendMessage(chatId, 'æ­¡è¿ä½¿ç”¨ XunNiï¼');  // TODO: æå–åˆ° i18n

// âŒ é”™è¯¯ï¼šæŒ‰é’®æ–‡å­—ç¡¬ç¼–ç 
[{ text: 'ğŸŒŠ ä¸Ÿå‡ºæ¼‚æµç“¶', callback_data: 'menu_throw' }]
```

### 8.3 æ–°å¢æ–‡å­—çš„å¤„ç†æµç¨‹

**å½“éœ€è¦æ–°å¢ç”¨æˆ·å¯è§æ–‡å­—æ—¶**ï¼š

1. **å…ˆæ·»åŠ åˆ° locale æ–‡ä»¶**ï¼š
   ```typescript
   // src/i18n/locales/zh-TW.ts
   export const translations: Translations = {
     // ... ç°æœ‰å†…å®¹
     newFeature: {
       welcome: 'æ­¡è¿ä½¿ç”¨æ–°åŠŸèƒ½ï¼',
       description: 'é€™æ˜¯æ–°åŠŸèƒ½çš„èªªæ˜...',
     },
   };
   ```

2. **æ·»åŠ åˆ° types.ts**ï¼š
   ```typescript
   // src/i18n/types.ts
   export interface Translations {
     // ... ç°æœ‰å†…å®¹
     newFeature: {
       welcome: string;
       description: string;
     };
   }
   ```

3. **åœ¨ä»£ç ä¸­ä½¿ç”¨**ï¼š
   ```typescript
   await telegram.sendMessage(chatId, i18n.t('newFeature.welcome'));
   ```

### 8.4 æäº¤å‰æ£€æŸ¥

**å¿…é¡»æ‰§è¡Œ**ï¼š

```bash
# 1. æ£€æŸ¥ç¡¬ç¼–ç 
pnpm check:i18n

# åº”è¯¥æ˜¾ç¤ºï¼šâœ… æ²¡æœ‰å‘ç°ç¡¬ç¼–ç çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼

# 2. Lint æ£€æŸ¥
pnpm lint

# 3. ç±»å‹æ£€æŸ¥
pnpm typecheck

# 4. æµ‹è¯•
pnpm test
```

**å¦‚æœ `pnpm check:i18n` å‘ç°ç¡¬ç¼–ç **ï¼š
1. ç«‹å³ä¿®å¤ï¼ˆæ›¿æ¢ä¸º `i18n.t()`ï¼‰
2. æ·»åŠ åˆ° locale æ–‡ä»¶
3. é‡æ–°è¿è¡Œæ£€æŸ¥

### 8.5 ä»£ç å®¡æŸ¥æ¸…å•

**åœ¨æäº¤ä»£ç å‰ï¼Œè‡ªæˆ‘å®¡æŸ¥**ï¼š

- [ ] æ‰€æœ‰ç”¨æˆ·å¯è§æ–‡å­—éƒ½ä½¿ç”¨ `i18n.t()`
- [ ] å·²æ·»åŠ  `import { createI18n } from '~/i18n'`
- [ ] å·²åˆå§‹åŒ– `const i18n = createI18n(user.language_pref || 'zh-TW')`
- [ ] æ‰€æœ‰ `sendMessage`ã€`editMessageText` ç­‰éƒ½ä½¿ç”¨ `i18n.t()`
- [ ] æ‰€æœ‰æŒ‰é’®æ–‡å­—éƒ½ä½¿ç”¨ `i18n.t()`
- [ ] æ‰€æœ‰é”™è¯¯æ¶ˆæ¯éƒ½ä½¿ç”¨ `i18n.t()`
- [ ] è¿è¡Œ `pnpm check:i18n` é€šè¿‡ï¼ˆ0 ä¸ªç¡¬ç¼–ç ï¼‰
- [ ] æ–°å¢çš„æ–‡å­—å·²æ·»åŠ åˆ° `zh-TW.ts` å’Œ `types.ts`

---

## 9. æ£€æŸ¥æ¸…å•

### æå–å‰æ£€æŸ¥æ¸…å•

- [ ] æ£€æŸ¥æ›¿æ¢çŠ¶æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- [ ] ç¡®è®¤æ‰«æç›®å½•å®Œæ•´
- [ ] ç¡®è®¤æå–è§„åˆ™å·²ç†è§£
- [ ] ç¡®è®¤è¾“å‡ºæ–‡ä»¶è·¯å¾„

### æ›¿æ¢å‰æ£€æŸ¥æ¸…å•

- [ ] ä»£ç å·²å¤‡ä»½ï¼ˆGit commitï¼‰
- [ ] æå–ç»“æœæ–‡ä»¶å­˜åœ¨
- [ ] Key æ˜ å°„æ–‡ä»¶å­˜åœ¨
- [ ] æ›¿æ¢çŠ¶æ€æ–‡ä»¶å­˜åœ¨

### æ›¿æ¢åæ£€æŸ¥æ¸…å•

- [ ] æ›¿æ¢çŠ¶æ€æ–‡ä»¶å·²æ›´æ–°
- [ ] Lint æ£€æŸ¥é€šè¿‡
- [ ] ç±»å‹æ£€æŸ¥é€šè¿‡
- [ ] æµ‹è¯•é€šè¿‡
- [ ] Git å·²æäº¤

### å¼€å‘æ–°åŠŸèƒ½æ£€æŸ¥æ¸…å•ï¼ˆâš ï¸ é¢„é˜²ç¡¬ç¼–ç ï¼‰

- [ ] å·²é˜…è¯» `@doc/I18N_GUIDE.md`
- [ ] å·²é˜…è¯» `@doc/I18N_EXTRACTION_AND_REPLACEMENT_STANDARDS.md`
- [ ] æ‰€æœ‰ç”¨æˆ·å¯è§æ–‡å­—éƒ½ä½¿ç”¨ `i18n.t()`
- [ ] å·²æ·»åŠ  `import { createI18n } from '~/i18n'`
- [ ] å·²åˆå§‹åŒ– i18n å®ä¾‹
- [ ] æ–°å¢æ–‡å­—å·²æ·»åŠ åˆ° `zh-TW.ts` å’Œ `types.ts`
- [ ] è¿è¡Œ `pnpm check:i18n` é€šè¿‡ï¼ˆ0 ä¸ªç¡¬ç¼–ç ï¼‰
- [ ] è¿è¡Œ `pnpm lint` é€šè¿‡
- [ ] è¿è¡Œ `pnpm test` é€šè¿‡

---

**é‡è¦**: æœ¬æ–‡æ¡£æ˜¯ i18n æå–å’Œæ›¿æ¢çš„**å”¯ä¸€æ ‡å‡†**ã€‚æ‰€æœ‰ç›¸å…³å·¥ä½œå¿…é¡»éµå¾ªæœ¬æ–‡æ¡£ã€‚

**å¼€å‘æ–°åŠŸèƒ½æ—¶**: **å¿…é¡»éµå®ˆç¬¬ 8 èŠ‚çš„è§„èŒƒ**ï¼Œé¿å…äº§ç”Ÿæ–°çš„ç¡¬ç¼–ç ã€‚

**æœ€åæ›´æ–°**: 2025-01-23

