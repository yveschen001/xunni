#!/usr/bin/env node
/**
 * Generate Legal Documents TypeScript File
 * 
 * This script reads HTML files from public/ and generates a TypeScript file
 * with the content embedded as strings.
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const publicDir = path.join(__dirname, '..', 'public');
const outputFile = path.join(__dirname, '..', 'src', 'legal', 'documents.ts');

// Read HTML files
const privacyHtml = fs.readFileSync(path.join(publicDir, 'privacy.html'), 'utf-8');
const termsHtml = fs.readFileSync(path.join(publicDir, 'terms.html'), 'utf-8');
const communityHtml = fs.readFileSync(path.join(publicDir, 'community.html'), 'utf-8');

// Escape backticks and ${} in HTML content
function escapeTemplate(str) {
  return str.replace(/`/g, '\\`').replace(/\${/g, '\\${');
}

// Generate TypeScript file
const content = `/**
 * Legal Documents Content
 * 
 * This file contains the HTML content of legal documents.
 * Auto-generated from public/*.html files.
 * 
 * DO NOT EDIT THIS FILE MANUALLY!
 * Run: node scripts/generate-legal-docs.js
 */

export const LEGAL_DOCUMENTS = {
  privacy: \`${escapeTemplate(privacyHtml)}\`,
  
  terms: \`${escapeTemplate(termsHtml)}\`,
  
  community: \`${escapeTemplate(communityHtml)}\`,
} as const;

/**
 * Get legal document HTML content
 */
export function getLegalDocument(type: 'privacy' | 'terms' | 'community'): string {
  return LEGAL_DOCUMENTS[type];
}

/**
 * Serve legal document as HTTP response
 */
export function serveLegalDocument(type: 'privacy' | 'terms' | 'community'): Response {
  const content = getLegalDocument(type);
  
  return new Response(content, {
    status: 200,
    headers: {
      'Content-Type': 'text/html; charset=utf-8',
      'Cache-Control': 'public, max-age=3600', // Cache for 1 hour
      'X-Content-Type-Options': 'nosniff',
    },
  });
}
`;

// Ensure directory exists
const legalDir = path.join(__dirname, '..', 'src', 'legal');
if (!fs.existsSync(legalDir)) {
  fs.mkdirSync(legalDir, { recursive: true });
}

// Write file
fs.writeFileSync(outputFile, content, 'utf-8');

console.log('âœ… Generated:', outputFile);
console.log('ðŸ“Š File sizes:');
console.log(`   - privacy.html: ${(privacyHtml.length / 1024).toFixed(2)} KB`);
console.log(`   - terms.html: ${(termsHtml.length / 1024).toFixed(2)} KB`);
console.log(`   - community.html: ${(communityHtml.length / 1024).toFixed(2)} KB`);
console.log(`   - Total: ${((privacyHtml.length + termsHtml.length + communityHtml.length) / 1024).toFixed(2)} KB`);

