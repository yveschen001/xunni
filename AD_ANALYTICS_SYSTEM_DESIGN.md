# å»£å‘Šç³»çµ±æ•¸æ“šè¿½è¹¤èˆ‡åˆ†æè¨­è¨ˆ

## ğŸ“‹ **ç›®éŒ„**

1. [æ¥­å‹™ç›®æ¨™](#æ¥­å‹™ç›®æ¨™)
2. [æ ¸å¿ƒè¿½è¹¤æŒ‡æ¨™](#æ ¸å¿ƒè¿½è¹¤æŒ‡æ¨™)
3. [æ•¸æ“šåº«è¨­è¨ˆ](#æ•¸æ“šåº«è¨­è¨ˆ)
4. [è¿½è¹¤é»è¨­è¨ˆ](#è¿½è¹¤é»è¨­è¨ˆ)
5. [åˆ†æå ±è¡¨](#åˆ†æå ±è¡¨)
6. [é‹ç‡Ÿæ±ºç­–æŒ‡æ¨™](#é‹ç‡Ÿæ±ºç­–æŒ‡æ¨™)
7. [å¯¦ç¾æ–¹æ¡ˆ](#å¯¦ç¾æ–¹æ¡ˆ)

---

## ğŸ¯ **æ¥­å‹™ç›®æ¨™**

### **æ ¸å¿ƒå•é¡Œ**

ä½œç‚ºé‹ç‡Ÿè€…ï¼Œæˆ‘å€‘éœ€è¦å›ç­”ä»¥ä¸‹å•é¡Œï¼š

1. **å»£å‘Šæ•ˆæœ**
   - å“ªå€‹å»£å‘Šå•†æ•ˆæœæœ€å¥½ï¼Ÿ
   - ç”¨æˆ¶æ›´å–œæ­¡çœ‹å“ªç¨®å»£å‘Šï¼Ÿ
   - å»£å‘Šå®Œæˆç‡å¦‚ä½•ï¼Ÿ

2. **ç”¨æˆ¶è¡Œç‚º**
   - ç”¨æˆ¶å¾å“ªè£¡ä¾†ï¼Ÿï¼ˆé‚€è«‹ vs è‡ªç„¶å¢é•·ï¼‰
   - ç”¨æˆ¶æ´»èºåº¦å¦‚ä½•ï¼Ÿ
   - ä»€éº¼æ™‚å€™ç”¨æˆ¶æœ€æ´»èºï¼Ÿ

3. **è½‰åŒ–æ¼æ–—**
   - æœ‰å¤šå°‘ç”¨æˆ¶çœ‹äº†å»£å‘Šï¼Ÿ
   - æœ‰å¤šå°‘ç”¨æˆ¶å®Œæˆäº†å»£å‘Šï¼Ÿ
   - æœ‰å¤šå°‘ç”¨æˆ¶æœ€çµ‚å‡ç´š VIPï¼Ÿ

4. **æ”¶ç›Šåˆ†æ**
   - å»£å‘Šæ”¶å…¥ vs VIP æ”¶å…¥
   - å“ªäº›ç”¨æˆ¶æ›´å¯èƒ½ä»˜è²»ï¼Ÿ
   - ROI å¦‚ä½•ï¼Ÿ

---

## ğŸ“Š **æ ¸å¿ƒè¿½è¹¤æŒ‡æ¨™**

### **1. ç”¨æˆ¶ç”Ÿå‘½é€±æœŸæŒ‡æ¨™**

#### **è¨»å†Šéšæ®µ**
```
ç”¨æˆ¶ä¾†æºè¿½è¹¤ï¼š
â”œâ”€ é‚€è«‹è¨»å†Šï¼ˆè¨˜éŒ„é‚€è«‹è€… IDï¼‰
â”œâ”€ è‡ªç„¶è¨»å†Šï¼ˆæœç´¢ã€ç¾¤çµ„ç­‰ï¼‰
â”œâ”€ å»£å‘Šå¼•æµï¼ˆå¦‚æœæœ‰å¤–éƒ¨å»£å‘Šï¼‰
â””â”€ å…¶ä»–æ¸ é“

é—œéµæ•¸æ“šï¼š
- è¨»å†Šæ™‚é–“
- è¨»å†Šä¾†æº
- é‚€è«‹è€… IDï¼ˆå¦‚æœæœ‰ï¼‰
- è¨»å†Šæ™‚çš„èªè¨€è¨­ç½®
- è¨»å†Šæ™‚çš„åœ°ç†ä½ç½®ï¼ˆå¾ Telegram ç²å–ï¼‰
```

#### **æ–°æ‰‹éšæ®µï¼ˆ0-7 å¤©ï¼‰**
```
è¡Œç‚ºè¿½è¹¤ï¼š
â”œâ”€ é¦–æ¬¡ä¸Ÿç“¶å­æ™‚é–“ï¼ˆå¾è¨»å†Šåˆ°é¦–æ¬¡ä¸Ÿç“¶å­çš„æ™‚é•·ï¼‰
â”œâ”€ é¦–æ¬¡æ’¿ç“¶å­æ™‚é–“
â”œâ”€ é¦–æ¬¡å°è©±æ™‚é–“
â”œâ”€ é¦–æ¬¡çœ‹å»£å‘Šæ™‚é–“
â”œâ”€ é¦–æ¬¡é‚€è«‹æœ‹å‹æ™‚é–“
â””â”€ é¦–æ¬¡å‡ç´š VIP æ™‚é–“

é—œéµæŒ‡æ¨™ï¼š
- æ–°æ‰‹ç•™å­˜ç‡ï¼ˆD1, D3, D7ï¼‰
- æ–°æ‰‹æ´»èºåº¦ï¼ˆæ¯æ—¥ä¸Ÿç“¶å­æ¬¡æ•¸ï¼‰
- æ–°æ‰‹è½‰åŒ–ç‡ï¼ˆçœ‹å»£å‘Š â†’ VIPï¼‰
```

#### **æ´»èºéšæ®µï¼ˆ7-30 å¤©ï¼‰**
```
è¡Œç‚ºè¿½è¹¤ï¼š
â”œâ”€ æ¯æ—¥æ´»èºæ™‚é–“
â”œâ”€ æ¯æ—¥ä¸Ÿç“¶å­æ¬¡æ•¸
â”œâ”€ æ¯æ—¥å°è©±æ¬¡æ•¸
â”œâ”€ æ¯æ—¥çœ‹å»£å‘Šæ¬¡æ•¸
â”œâ”€ é‚€è«‹æœ‹å‹æ•¸é‡
â””â”€ VIP è½‰åŒ–æƒ…æ³

é—œéµæŒ‡æ¨™ï¼š
- æ—¥æ´»èºç”¨æˆ¶ï¼ˆDAUï¼‰
- é€±æ´»èºç”¨æˆ¶ï¼ˆWAUï¼‰
- æœˆæ´»èºç”¨æˆ¶ï¼ˆMAUï¼‰
- ç”¨æˆ¶ç²˜æ€§ï¼ˆDAU/MAUï¼‰
```

#### **å¿ èª éšæ®µï¼ˆ30+ å¤©ï¼‰**
```
è¡Œç‚ºè¿½è¹¤ï¼š
â”œâ”€ VIP çºŒè²»æƒ…æ³
â”œâ”€ é•·æœŸæ´»èºåº¦
â”œâ”€ é‚€è«‹è²¢ç»åº¦
â””â”€ ç¤¾å€åƒèˆ‡åº¦

é—œéµæŒ‡æ¨™ï¼š
- é•·æœŸç•™å­˜ç‡
- VIP çºŒè²»ç‡
- ç”¨æˆ¶ LTVï¼ˆç”Ÿå‘½é€±æœŸåƒ¹å€¼ï¼‰
```

---

### **2. å»£å‘Šç³»çµ±æŒ‡æ¨™**

#### **ç¬¬ä¸‰æ–¹è¦–é »å»£å‘Š**
```
è¿½è¹¤é»ï¼š
â”œâ”€ å»£å‘Šå±•ç¤ºï¼ˆad_impressionï¼‰
â”‚   â”œâ”€ ç”¨æˆ¶é»æ“Šã€Œçœ‹å»£å‘Šã€æŒ‰éˆ•
â”‚   â”œâ”€ å»£å‘Šæä¾›å•†ï¼ˆGigaPub/Google/Unityï¼‰
â”‚   â”œâ”€ ç•¶å‰å·²çœ‹å»£å‘Šæ•¸
â”‚   â””â”€ å‰©é¤˜å»£å‘Šæ•¸
â”‚
â”œâ”€ å»£å‘Šé–‹å§‹æ’­æ”¾ï¼ˆad_startï¼‰
â”‚   â”œâ”€ å»£å‘Š ID
â”‚   â”œâ”€ å»£å‘Šæä¾›å•†
â”‚   â””â”€ é–‹å§‹æ™‚é–“
â”‚
â”œâ”€ å»£å‘Šæ’­æ”¾ä¸­ï¼ˆad_progressï¼‰
â”‚   â”œâ”€ æ’­æ”¾é€²åº¦ï¼ˆ25%, 50%, 75%ï¼‰
â”‚   â””â”€ æ’­æ”¾æ™‚é•·
â”‚
â”œâ”€ å»£å‘Šå®Œæˆï¼ˆad_completeï¼‰
â”‚   â”œâ”€ å®Œæˆæ™‚é–“
â”‚   â”œâ”€ ç¸½æ’­æ”¾æ™‚é•·
â”‚   â”œâ”€ çå‹µç™¼æ”¾ç‹€æ…‹
â”‚   â””â”€ ç”¨æˆ¶ç•¶å‰ç¸½é¡åº¦
â”‚
â””â”€ å»£å‘ŠéŒ¯èª¤ï¼ˆad_errorï¼‰
    â”œâ”€ éŒ¯èª¤é¡å‹ï¼ˆåŠ è¼‰å¤±æ•—/æ’­æ”¾ä¸­æ–·/ç¶²çµ¡éŒ¯èª¤ï¼‰
    â”œâ”€ éŒ¯èª¤è¨Šæ¯
    â”œâ”€ å»£å‘Šæä¾›å•†
    â””â”€ ç”¨æˆ¶ç¶²çµ¡ç‹€æ³

é—œéµæŒ‡æ¨™ï¼š
- å»£å‘Šå±•ç¤ºæ¬¡æ•¸ï¼ˆImpressionsï¼‰
- å»£å‘Šé–‹å§‹ç‡ï¼ˆStart Rate = Starts / Impressionsï¼‰
- å»£å‘Šå®Œæˆç‡ï¼ˆCompletion Rate = Completions / Startsï¼‰
- å»£å‘ŠéŒ¯èª¤ç‡ï¼ˆError Rate = Errors / Impressionsï¼‰
- å¹³å‡æ’­æ”¾æ™‚é•·
- ä¸åŒæä¾›å•†çš„è¡¨ç¾å°æ¯”
```

#### **å®˜æ–¹æ–‡å­—å»£å‘Š**
```
è¿½è¹¤é»ï¼š
â”œâ”€ å»£å‘Šå±•ç¤ºï¼ˆofficial_ad_impressionï¼‰
â”‚   â”œâ”€ å»£å‘Š ID
â”‚   â”œâ”€ å»£å‘Šé¡å‹ï¼ˆtext/link/group/channelï¼‰
â”‚   â”œâ”€ å±•ç¤ºä½ç½®ï¼ˆé¡åº¦ç”¨å®Œæç¤º/ä¸»å‹•æŸ¥çœ‹ï¼‰
â”‚   â””â”€ å±•ç¤ºæ™‚é–“
â”‚
â”œâ”€ å»£å‘Šé»æ“Šï¼ˆofficial_ad_clickï¼‰
â”‚   â”œâ”€ å»£å‘Š ID
â”‚   â”œâ”€ é»æ“Šæ™‚é–“
â”‚   â””â”€ ç”¨æˆ¶ç•¶å‰ç‹€æ…‹ï¼ˆé¡åº¦ã€VIP ç‹€æ…‹ï¼‰
â”‚
â”œâ”€ å»£å‘Šå®Œæˆï¼ˆofficial_ad_completeï¼‰
â”‚   â”œâ”€ å®Œæˆé¡å‹ï¼ˆé»æ“Šé ˜å–/åŠ å…¥ç¾¤çµ„/è¨‚é–±é »é“ï¼‰
â”‚   â”œâ”€ æ˜¯å¦éœ€è¦èªè­‰
â”‚   â”œâ”€ èªè­‰çµæœ
â”‚   â””â”€ çå‹µç™¼æ”¾ç‹€æ…‹
â”‚
â””â”€ å»£å‘Šè½‰åŒ–ï¼ˆofficial_ad_conversionï¼‰
    â”œâ”€ è½‰åŒ–é¡å‹ï¼ˆåŠ å…¥ç¾¤çµ„/è¨‚é–±é »é“/è¨ªå•éˆæ¥ï¼‰
    â”œâ”€ è½‰åŒ–æ™‚é–“
    â””â”€ å¾ŒçºŒè¡Œç‚ºï¼ˆæ˜¯å¦ç¹¼çºŒæ´»èºï¼‰

é—œéµæŒ‡æ¨™ï¼š
- å®˜æ–¹å»£å‘Šå±•ç¤ºæ¬¡æ•¸
- å®˜æ–¹å»£å‘Šé»æ“Šç‡ï¼ˆCTR = Clicks / Impressionsï¼‰
- å®˜æ–¹å»£å‘Šå®Œæˆç‡ï¼ˆCompletion Rateï¼‰
- ä¸åŒå»£å‘Šé¡å‹çš„è¡¨ç¾å°æ¯”
- ç¾¤çµ„/é »é“åŠ å…¥ç‡
```

---

### **3. VIP è½‰åŒ–æ¼æ–—**

#### **å®Œæ•´è½‰åŒ–è·¯å¾‘**
```
éšæ®µ 1: èªçŸ¥éšæ®µ
â”œâ”€ ç”¨æˆ¶çœ‹åˆ° VIP æç¤ºï¼ˆvip_awarenessï¼‰
â”‚   â”œâ”€ è§¸ç™¼å ´æ™¯ï¼ˆé¡åº¦ç”¨å®Œ/ä¸»å‹•æŸ¥çœ‹/å»£å‘Šå¾Œï¼‰
â”‚   â”œâ”€ æç¤ºé¡å‹ï¼ˆå½ˆçª—/æŒ‰éˆ•/å‘½ä»¤ï¼‰
â”‚   â””â”€ ç”¨æˆ¶ç•¶å‰ç‹€æ…‹
â”‚
éšæ®µ 2: èˆˆè¶£éšæ®µ
â”œâ”€ ç”¨æˆ¶é»æ“ŠæŸ¥çœ‹ VIPï¼ˆvip_interestï¼‰
â”‚   â”œâ”€ é»æ“Šä¾†æºï¼ˆé¡åº¦æç¤º/Profile/Helpï¼‰
â”‚   â”œâ”€ æŸ¥çœ‹æ™‚é–“
â”‚   â””â”€ åœç•™æ™‚é•·
â”‚
éšæ®µ 3: è€ƒæ…®éšæ®µ
â”œâ”€ ç”¨æˆ¶æŸ¥çœ‹ VIP è©³æƒ…ï¼ˆvip_considerationï¼‰
â”‚   â”œâ”€ æŸ¥çœ‹æ¬¡æ•¸
â”‚   â”œâ”€ æŸ¥çœ‹é–“éš”
â”‚   â””â”€ å°æ¯”è¡Œç‚ºï¼ˆæ˜¯å¦å…ˆçœ‹å»£å‘Š/é‚€è«‹æœ‹å‹ï¼‰
â”‚
éšæ®µ 4: è³¼è²·éšæ®µ
â”œâ”€ ç”¨æˆ¶é»æ“Šè³¼è²· VIPï¼ˆvip_purchase_intentï¼‰
â”‚   â”œâ”€ é¸æ“‡çš„å¥—é¤ï¼ˆæœˆ/å­£/å¹´ï¼‰
â”‚   â”œâ”€ æ”¯ä»˜æ–¹å¼é¸æ“‡
â”‚   â””â”€ æ˜¯å¦å®Œæˆæ”¯ä»˜
â”‚
éšæ®µ 5: è½‰åŒ–å®Œæˆ
â””â”€ VIP è³¼è²·æˆåŠŸï¼ˆvip_purchase_successï¼‰
    â”œâ”€ è³¼è²·å¥—é¤
    â”œâ”€ æ”¯ä»˜é‡‘é¡
    â”œâ”€ æ”¯ä»˜æ–¹å¼
    â”œâ”€ å¾è¨»å†Šåˆ°è³¼è²·çš„æ™‚é•·
    â””â”€ è³¼è²·å‰çš„è¡Œç‚ºè·¯å¾‘

é—œéµæŒ‡æ¨™ï¼š
- å„éšæ®µè½‰åŒ–ç‡
- å¹³å‡è½‰åŒ–æ™‚é•·ï¼ˆå¾è¨»å†Šåˆ°è³¼è²·ï¼‰
- æµå¤±é»åˆ†æï¼ˆåœ¨å“ªå€‹éšæ®µæµå¤±æœ€å¤šï¼‰
- ä¸åŒä¾†æºç”¨æˆ¶çš„è½‰åŒ–ç‡å°æ¯”
```

#### **VIP ç”¨æˆ¶è¡Œç‚º**
```
è¿½è¹¤é»ï¼š
â”œâ”€ VIP ä½¿ç”¨æƒ…æ³ï¼ˆvip_usageï¼‰
â”‚   â”œâ”€ æ¯æ—¥ä¸Ÿç“¶å­æ¬¡æ•¸ï¼ˆvs å…è²»ç”¨æˆ¶ï¼‰
â”‚   â”œâ”€ æ¯æ—¥å°è©±æ¬¡æ•¸
â”‚   â””â”€ æ´»èºæ™‚é–“åˆ†å¸ƒ
â”‚
â”œâ”€ VIP çºŒè²»è¡Œç‚ºï¼ˆvip_renewalï¼‰
â”‚   â”œâ”€ çºŒè²»æ™‚é–“ï¼ˆåˆ°æœŸå‰/åˆ°æœŸå¾Œï¼‰
â”‚   â”œâ”€ çºŒè²»å¥—é¤ï¼ˆå‡ç´š/é™ç´š/ç¶­æŒï¼‰
â”‚   â””â”€ çºŒè²»ç‡
â”‚
â””â”€ VIP æµå¤±ï¼ˆvip_churnï¼‰
    â”œâ”€ æµå¤±æ™‚é–“ï¼ˆåˆ°æœŸå¾Œå¤šä¹…ï¼‰
    â”œâ”€ æµå¤±åŸå› ï¼ˆå¦‚æœæœ‰åé¥‹ï¼‰
    â””â”€ æµå¤±å‰çš„æ´»èºåº¦è®ŠåŒ–

é—œéµæŒ‡æ¨™ï¼š
- VIP æ´»èºåº¦ vs å…è²»ç”¨æˆ¶
- VIP çºŒè²»ç‡
- VIP æµå¤±ç‡
- VIP LTVï¼ˆç”Ÿå‘½é€±æœŸåƒ¹å€¼ï¼‰
```

---

### **4. é‚€è«‹ç³»çµ±æŒ‡æ¨™**

#### **é‚€è«‹è¡Œç‚ºè¿½è¹¤**
```
è¿½è¹¤é»ï¼š
â”œâ”€ é‚€è«‹ç™¼èµ·ï¼ˆinvite_initiatedï¼‰
â”‚   â”œâ”€ é‚€è«‹è€… ID
â”‚   â”œâ”€ é‚€è«‹æ–¹å¼ï¼ˆåˆ†äº«éˆæ¥/ç›´æ¥é‚€è«‹ï¼‰
â”‚   â”œâ”€ é‚€è«‹æ™‚æ©Ÿï¼ˆé¡åº¦ç”¨å®Œ/ä¸»å‹•åˆ†äº«ï¼‰
â”‚   â””â”€ é‚€è«‹è€…ç•¶å‰ç‹€æ…‹ï¼ˆVIP/å…è²»ï¼‰
â”‚
â”œâ”€ é‚€è«‹æˆåŠŸï¼ˆinvite_acceptedï¼‰
â”‚   â”œâ”€ è¢«é‚€è«‹è€… ID
â”‚   â”œâ”€ è¨»å†Šæ™‚é–“
â”‚   â”œâ”€ é‚€è«‹éˆæ¥é»æ“Šåˆ°è¨»å†Šçš„æ™‚é•·
â”‚   â””â”€ è¢«é‚€è«‹è€…ä¾†æºåœ°å€
â”‚
â”œâ”€ é‚€è«‹æ¿€æ´»ï¼ˆinvite_activatedï¼‰
â”‚   â”œâ”€ è¢«é‚€è«‹è€…é¦–æ¬¡ä¸Ÿç“¶å­
â”‚   â”œâ”€ é‚€è«‹è€…ç²å¾—çå‹µ
â”‚   â””â”€ æ¿€æ´»æ™‚é•·ï¼ˆå¾è¨»å†Šåˆ°æ¿€æ´»ï¼‰
â”‚
â””â”€ é‚€è«‹è²¢ç»ï¼ˆinvite_contributionï¼‰
    â”œâ”€ è¢«é‚€è«‹è€…æ´»èºåº¦
    â”œâ”€ è¢«é‚€è«‹è€…æ˜¯å¦å‡ç´š VIP
    â””â”€ é‚€è«‹è€…çš„ç¸½è²¢ç»åƒ¹å€¼

é—œéµæŒ‡æ¨™ï¼š
- é‚€è«‹è½‰åŒ–ç‡ï¼ˆæ¥å—/ç™¼èµ·ï¼‰
- é‚€è«‹æ¿€æ´»ç‡ï¼ˆæ¿€æ´»/æ¥å—ï¼‰
- å¹³å‡é‚€è«‹æ•¸ï¼ˆæ¯å€‹ç”¨æˆ¶ï¼‰
- é‚€è«‹è³ªé‡ï¼ˆè¢«é‚€è«‹è€…çš„æ´»èºåº¦ï¼‰
- ç—…æ¯’ä¿‚æ•¸ï¼ˆK-factorï¼‰
```

---

### **5. å…§å®¹äº’å‹•æŒ‡æ¨™**

#### **æ¼‚æµç“¶äº’å‹•**
```
è¿½è¹¤é»ï¼š
â”œâ”€ ä¸Ÿç“¶å­è¡Œç‚ºï¼ˆbottle_throwï¼‰
â”‚   â”œâ”€ ä¸Ÿç“¶å­æ™‚é–“
â”‚   â”œâ”€ å…§å®¹é¡å‹ï¼ˆæ–‡å­—/åœ–ç‰‡/èªéŸ³ï¼‰
â”‚   â”œâ”€ å…§å®¹é•·åº¦
â”‚   â”œâ”€ ç”¨æˆ¶ç•¶å‰é¡åº¦
â”‚   â””â”€ æ˜¯å¦ä½¿ç”¨å»£å‘Šé¡åº¦
â”‚
â”œâ”€ æ’¿ç“¶å­è¡Œç‚ºï¼ˆbottle_catchï¼‰
â”‚   â”œâ”€ æ’¿ç“¶å­æ™‚é–“
â”‚   â”œâ”€ ç“¶å­å¹´é½¡ï¼ˆä¸Ÿå‡ºåˆ°æ’¿èµ·çš„æ™‚é•·ï¼‰
â”‚   â”œâ”€ æ˜¯å¦å›è¦†
â”‚   â””â”€ å›è¦†æ™‚é•·
â”‚
â”œâ”€ å°è©±äº’å‹•ï¼ˆconversationï¼‰
â”‚   â”œâ”€ å°è©±è¼ªæ¬¡
â”‚   â”œâ”€ å°è©±æ™‚é•·
â”‚   â”œâ”€ è¨Šæ¯é¡å‹åˆ†å¸ƒ
â”‚   â””â”€ å°è©±çµæŸåŸå› ï¼ˆè‡ªç„¶çµæŸ/è¢«èˆ‰å ±/ä¸»å‹•çµæŸï¼‰
â”‚
â””â”€ èˆ‰å ±è¡Œç‚ºï¼ˆreportï¼‰
    â”œâ”€ èˆ‰å ±é¡å‹
    â”œâ”€ èˆ‰å ±æ™‚æ©Ÿï¼ˆå°è©±ä¸­/å°è©±å¾Œï¼‰
    â”œâ”€ èˆ‰å ±è™•ç†çµæœ
    â””â”€ èˆ‰å ±è€…æ­·å²è¡Œç‚º

é—œéµæŒ‡æ¨™ï¼š
- æ¯æ—¥ä¸Ÿç“¶å­ç¸½æ•¸
- æ¯æ—¥æ’¿ç“¶å­ç¸½æ•¸
- ç“¶å­åŒ¹é…ç‡ï¼ˆæ’¿èµ·/ä¸Ÿå‡ºï¼‰
- å¹³å‡å°è©±è¼ªæ¬¡
- å¹³å‡å°è©±æ™‚é•·
- èˆ‰å ±ç‡
```

---

## ğŸ—„ï¸ **æ•¸æ“šåº«è¨­è¨ˆ**

### **1. åˆ†æäº‹ä»¶è¡¨ï¼ˆanalytics_eventsï¼‰**

```sql
-- Migration: 0028_create_analytics_events.sql
-- æ ¸å¿ƒåˆ†æäº‹ä»¶è¡¨ï¼Œè¨˜éŒ„æ‰€æœ‰ç”¨æˆ¶è¡Œç‚º

CREATE TABLE IF NOT EXISTS analytics_events (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  
  -- äº‹ä»¶åŸºæœ¬ä¿¡æ¯
  event_type TEXT NOT NULL,  -- äº‹ä»¶é¡å‹ï¼ˆè¦‹ä¸‹æ–¹æšèˆ‰ï¼‰
  event_category TEXT NOT NULL,  -- äº‹ä»¶åˆ†é¡ï¼ˆuser/ad/vip/invite/contentï¼‰
  
  -- ç”¨æˆ¶ä¿¡æ¯
  user_id TEXT NOT NULL,  -- Telegram ID
  user_type TEXT,  -- 'free' | 'vip'
  user_age_days INTEGER,  -- ç”¨æˆ¶è¨»å†Šå¤©æ•¸
  
  -- äº‹ä»¶è©³æƒ…
  event_data TEXT,  -- JSON æ ¼å¼çš„äº‹ä»¶è©³ç´°æ•¸æ“š
  
  -- å»£å‘Šç›¸é—œï¼ˆå¦‚æœæ˜¯å»£å‘Šäº‹ä»¶ï¼‰
  ad_provider TEXT,  -- å»£å‘Šæä¾›å•†
  ad_id INTEGER,  -- å»£å‘Š ID
  ad_type TEXT,  -- 'third_party' | 'official'
  
  -- æœƒè©±ä¿¡æ¯
  session_id TEXT,  -- æœƒè©± IDï¼ˆç”¨æ–¼è¿½è¹¤ç”¨æˆ¶è·¯å¾‘ï¼‰
  
  -- è¨­å‚™å’Œç’°å¢ƒ
  user_language TEXT,  -- ç”¨æˆ¶èªè¨€
  user_timezone TEXT,  -- ç”¨æˆ¶æ™‚å€
  
  -- æ™‚é–“æˆ³
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  event_date TEXT,  -- YYYY-MM-DDï¼ˆç”¨æ–¼å¿«é€ŸæŸ¥è©¢ï¼‰
  event_hour INTEGER  -- 0-23ï¼ˆç”¨æ–¼æ™‚æ®µåˆ†æï¼‰
);

-- ç´¢å¼•
CREATE INDEX idx_analytics_events_type ON analytics_events(event_type);
CREATE INDEX idx_analytics_events_category ON analytics_events(event_category);
CREATE INDEX idx_analytics_events_user ON analytics_events(user_id);
CREATE INDEX idx_analytics_events_date ON analytics_events(event_date);
CREATE INDEX idx_analytics_events_hour ON analytics_events(event_hour);
CREATE INDEX idx_analytics_events_session ON analytics_events(session_id);
CREATE INDEX idx_analytics_events_ad_provider ON analytics_events(ad_provider);
```

#### **äº‹ä»¶é¡å‹æšèˆ‰**

```typescript
// ç”¨æˆ¶ç”Ÿå‘½é€±æœŸäº‹ä»¶
export enum UserLifecycleEvent {
  USER_REGISTERED = 'user_registered',
  USER_FIRST_THROW = 'user_first_throw',
  USER_FIRST_CATCH = 'user_first_catch',
  USER_FIRST_CONVERSATION = 'user_first_conversation',
  USER_FIRST_AD = 'user_first_ad',
  USER_FIRST_INVITE = 'user_first_invite',
  USER_BECAME_ACTIVE = 'user_became_active',  // é€£çºŒ 3 å¤©æ´»èº
  USER_BECAME_INACTIVE = 'user_became_inactive',  // 7 å¤©æœªæ´»èº
  USER_RETURNED = 'user_returned',  // æµå¤±å¾Œå›æ­¸
}

// å»£å‘Šäº‹ä»¶
export enum AdEvent {
  AD_IMPRESSION = 'ad_impression',  // å»£å‘Šå±•ç¤º
  AD_CLICK = 'ad_click',  // å»£å‘Šé»æ“Š
  AD_START = 'ad_start',  // å»£å‘Šé–‹å§‹æ’­æ”¾
  AD_PROGRESS_25 = 'ad_progress_25',  // æ’­æ”¾ 25%
  AD_PROGRESS_50 = 'ad_progress_50',  // æ’­æ”¾ 50%
  AD_PROGRESS_75 = 'ad_progress_75',  // æ’­æ”¾ 75%
  AD_COMPLETE = 'ad_complete',  // å»£å‘Šå®Œæˆ
  AD_ERROR = 'ad_error',  // å»£å‘ŠéŒ¯èª¤
  AD_SKIP = 'ad_skip',  // å»£å‘Šè·³éï¼ˆå¦‚æœå…è¨±ï¼‰
  
  // å®˜æ–¹å»£å‘Š
  OFFICIAL_AD_IMPRESSION = 'official_ad_impression',
  OFFICIAL_AD_CLICK = 'official_ad_click',
  OFFICIAL_AD_COMPLETE = 'official_ad_complete',
  OFFICIAL_AD_VERIFY = 'official_ad_verify',  // ç¾¤çµ„/é »é“èªè­‰
}

// VIP äº‹ä»¶
export enum VIPEvent {
  VIP_AWARENESS = 'vip_awareness',  // çœ‹åˆ° VIP æç¤º
  VIP_INTEREST = 'vip_interest',  // é»æ“ŠæŸ¥çœ‹ VIP
  VIP_CONSIDERATION = 'vip_consideration',  // æŸ¥çœ‹ VIP è©³æƒ…
  VIP_PURCHASE_INTENT = 'vip_purchase_intent',  // é»æ“Šè³¼è²·
  VIP_PURCHASE_SUCCESS = 'vip_purchase_success',  // è³¼è²·æˆåŠŸ
  VIP_PURCHASE_FAILED = 'vip_purchase_failed',  // è³¼è²·å¤±æ•—
  VIP_RENEWAL = 'vip_renewal',  // VIP çºŒè²»
  VIP_EXPIRED = 'vip_expired',  // VIP éæœŸ
  VIP_CANCELLED = 'vip_cancelled',  // VIP å–æ¶ˆ
}

// é‚€è«‹äº‹ä»¶
export enum InviteEvent {
  INVITE_INITIATED = 'invite_initiated',  // ç™¼èµ·é‚€è«‹
  INVITE_LINK_CLICKED = 'invite_link_clicked',  // é‚€è«‹éˆæ¥è¢«é»æ“Š
  INVITE_ACCEPTED = 'invite_accepted',  // é‚€è«‹è¢«æ¥å—ï¼ˆè¨»å†Šï¼‰
  INVITE_ACTIVATED = 'invite_activated',  // é‚€è«‹è¢«æ¿€æ´»ï¼ˆé¦–æ¬¡ä¸Ÿç“¶å­ï¼‰
  INVITE_REWARD_GRANTED = 'invite_reward_granted',  // é‚€è«‹çå‹µç™¼æ”¾
}

// å…§å®¹äº’å‹•äº‹ä»¶
export enum ContentEvent {
  BOTTLE_THROW = 'bottle_throw',  // ä¸Ÿç“¶å­
  BOTTLE_CATCH = 'bottle_catch',  // æ’¿ç“¶å­
  CONVERSATION_START = 'conversation_start',  // é–‹å§‹å°è©±
  CONVERSATION_MESSAGE = 'conversation_message',  // ç™¼é€è¨Šæ¯
  CONVERSATION_END = 'conversation_end',  // çµæŸå°è©±
  REPORT_SUBMITTED = 'report_submitted',  // æäº¤èˆ‰å ±
  USER_BANNED = 'user_banned',  // ç”¨æˆ¶è¢«å°ç¦
}
```

---

### **2. ç”¨æˆ¶æœƒè©±è¡¨ï¼ˆuser_sessionsï¼‰**

```sql
-- Migration: 0029_create_user_sessions.sql
-- è¿½è¹¤ç”¨æˆ¶æœƒè©±ï¼Œç”¨æ–¼åˆ†æç”¨æˆ¶è·¯å¾‘

CREATE TABLE IF NOT EXISTS user_sessions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  session_id TEXT NOT NULL UNIQUE,
  user_id TEXT NOT NULL,
  
  -- æœƒè©±ä¿¡æ¯
  session_start TEXT DEFAULT CURRENT_TIMESTAMP,
  session_end TEXT,
  session_duration_seconds INTEGER,
  
  -- æœƒè©±çµ±è¨ˆ
  events_count INTEGER DEFAULT 0,
  bottles_thrown INTEGER DEFAULT 0,
  bottles_caught INTEGER DEFAULT 0,
  ads_watched INTEGER DEFAULT 0,
  conversations_started INTEGER DEFAULT 0,
  
  -- æœƒè©±çµæœ
  vip_converted INTEGER DEFAULT 0,  -- æ˜¯å¦åœ¨æ­¤æœƒè©±ä¸­è½‰åŒ–ç‚º VIP
  invite_sent INTEGER DEFAULT 0,  -- æ˜¯å¦ç™¼é€é‚€è«‹
  
  -- è¨­å‚™ä¿¡æ¯
  user_language TEXT,
  user_timezone TEXT,
  
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_user_sessions_user ON user_sessions(user_id);
CREATE INDEX idx_user_sessions_start ON user_sessions(session_start);
CREATE INDEX idx_user_sessions_vip_converted ON user_sessions(vip_converted);
```

---

### **3. æ¯æ—¥ç”¨æˆ¶æ‘˜è¦è¡¨ï¼ˆdaily_user_summaryï¼‰**

```sql
-- Migration: 0030_create_daily_user_summary.sql
-- æ¯æ—¥ç”¨æˆ¶è¡Œç‚ºæ‘˜è¦ï¼Œç”¨æ–¼å¿«é€ŸæŸ¥è©¢å’Œåˆ†æ

CREATE TABLE IF NOT EXISTS daily_user_summary (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT NOT NULL,
  summary_date TEXT NOT NULL,  -- YYYY-MM-DD
  
  -- åŸºæœ¬ä¿¡æ¯
  user_type TEXT,  -- 'free' | 'vip'
  user_age_days INTEGER,  -- ç”¨æˆ¶è¨»å†Šå¤©æ•¸
  
  -- æ´»èºåº¦
  is_active INTEGER DEFAULT 0,  -- ç•¶å¤©æ˜¯å¦æ´»èº
  session_count INTEGER DEFAULT 0,  -- æœƒè©±æ¬¡æ•¸
  total_duration_seconds INTEGER DEFAULT 0,  -- ç¸½ä½¿ç”¨æ™‚é•·
  
  -- å…§å®¹äº’å‹•
  bottles_thrown INTEGER DEFAULT 0,
  bottles_caught INTEGER DEFAULT 0,
  conversations_started INTEGER DEFAULT 0,
  messages_sent INTEGER DEFAULT 0,
  
  -- å»£å‘Šäº’å‹•
  ads_viewed INTEGER DEFAULT 0,
  ads_completed INTEGER DEFAULT 0,
  official_ads_clicked INTEGER DEFAULT 0,
  
  -- é‚€è«‹è¡Œç‚º
  invites_sent INTEGER DEFAULT 0,
  invites_accepted INTEGER DEFAULT 0,
  
  -- VIP ç›¸é—œ
  vip_page_views INTEGER DEFAULT 0,
  vip_converted INTEGER DEFAULT 0,
  
  -- é¡åº¦ä½¿ç”¨
  quota_used INTEGER DEFAULT 0,
  quota_from_ads INTEGER DEFAULT 0,
  quota_from_invites INTEGER DEFAULT 0,
  
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  
  UNIQUE(user_id, summary_date)
);

CREATE INDEX idx_daily_user_summary_user ON daily_user_summary(user_id);
CREATE INDEX idx_daily_user_summary_date ON daily_user_summary(summary_date);
CREATE INDEX idx_daily_user_summary_active ON daily_user_summary(is_active);
CREATE INDEX idx_daily_user_summary_type ON daily_user_summary(user_type);
```

---

### **4. æ¼æ–—åˆ†æè¡¨ï¼ˆfunnel_eventsï¼‰**

```sql
-- Migration: 0031_create_funnel_events.sql
-- å°ˆé–€ç”¨æ–¼æ¼æ–—åˆ†æçš„è¡¨

CREATE TABLE IF NOT EXISTS funnel_events (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT NOT NULL,
  funnel_type TEXT NOT NULL,  -- 'vip_conversion' | 'ad_completion' | 'invite_flow'
  funnel_step TEXT NOT NULL,  -- æ¼æ–—æ­¥é©Ÿ
  step_order INTEGER NOT NULL,  -- æ­¥é©Ÿé †åº
  
  -- æ­¥é©Ÿè©³æƒ…
  step_data TEXT,  -- JSON æ ¼å¼
  
  -- æ™‚é–“ä¿¡æ¯
  step_timestamp TEXT DEFAULT CURRENT_TIMESTAMP,
  time_from_previous_step_seconds INTEGER,  -- è·é›¢ä¸Šä¸€æ­¥çš„æ™‚é–“
  time_from_funnel_start_seconds INTEGER,  -- è·é›¢æ¼æ–—é–‹å§‹çš„æ™‚é–“
  
  -- çµæœ
  completed INTEGER DEFAULT 0,  -- æ˜¯å¦å®Œæˆæ•´å€‹æ¼æ–—
  dropped_off INTEGER DEFAULT 0,  -- æ˜¯å¦åœ¨æ­¤æ­¥é©Ÿæµå¤±
  
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_funnel_events_user ON funnel_events(user_id);
CREATE INDEX idx_funnel_events_type ON funnel_events(funnel_type);
CREATE INDEX idx_funnel_events_step ON funnel_events(funnel_step);
CREATE INDEX idx_funnel_events_completed ON funnel_events(completed);
```

---

### **5. æ›´æ–°ç¾æœ‰çš„ daily_stats è¡¨**

```sql
-- Migration: 0032_update_daily_stats_analytics.sql
-- æ·»åŠ æ›´å¤šåˆ†æç¶­åº¦åˆ°æ¯æ—¥çµ±è¨ˆè¡¨

ALTER TABLE daily_stats ADD COLUMN total_sessions INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN avg_session_duration_seconds INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN dau INTEGER DEFAULT 0;  -- Daily Active Users
ALTER TABLE daily_stats ADD COLUMN wau INTEGER DEFAULT 0;  -- Weekly Active Users
ALTER TABLE daily_stats ADD COLUMN mau INTEGER DEFAULT 0;  -- Monthly Active Users

-- å»£å‘Šæ•¸æ“šï¼ˆå·²æœ‰ï¼Œç¢ºä¿å®Œæ•´ï¼‰
ALTER TABLE daily_stats ADD COLUMN total_ad_impressions INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN total_ad_clicks INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN total_ad_starts INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN total_ad_completions INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN total_ad_errors INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN ad_ctr REAL DEFAULT 0.0;  -- Click-Through Rate
ALTER TABLE daily_stats ADD COLUMN ad_completion_rate REAL DEFAULT 0.0;

-- å®˜æ–¹å»£å‘Šæ•¸æ“š
ALTER TABLE daily_stats ADD COLUMN official_ad_impressions INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN official_ad_clicks INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN official_ad_completions INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN official_ad_ctr REAL DEFAULT 0.0;

-- VIP è½‰åŒ–æ•¸æ“š
ALTER TABLE daily_stats ADD COLUMN vip_page_views INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN vip_purchase_intents INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN vip_conversions INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN vip_conversion_rate REAL DEFAULT 0.0;
ALTER TABLE daily_stats ADD COLUMN vip_revenue REAL DEFAULT 0.0;

-- é‚€è«‹æ•¸æ“šï¼ˆå·²æœ‰ï¼Œç¢ºä¿å®Œæ•´ï¼‰
ALTER TABLE daily_stats ADD COLUMN invites_sent INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN invites_accepted INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN invites_activated INTEGER DEFAULT 0;
ALTER TABLE daily_stats ADD COLUMN invite_conversion_rate REAL DEFAULT 0.0;

-- å…§å®¹äº’å‹•æ•¸æ“šï¼ˆå·²æœ‰ï¼Œç¢ºä¿å®Œæ•´ï¼‰
ALTER TABLE daily_stats ADD COLUMN avg_bottles_per_user REAL DEFAULT 0.0;
ALTER TABLE daily_stats ADD COLUMN avg_conversations_per_user REAL DEFAULT 0.0;
ALTER TABLE daily_stats ADD COLUMN avg_messages_per_conversation REAL DEFAULT 0.0;

-- ç•™å­˜æ•¸æ“š
ALTER TABLE daily_stats ADD COLUMN d1_retention_rate REAL DEFAULT 0.0;  -- æ¬¡æ—¥ç•™å­˜
ALTER TABLE daily_stats ADD COLUMN d7_retention_rate REAL DEFAULT 0.0;  -- 7æ—¥ç•™å­˜
ALTER TABLE daily_stats ADD COLUMN d30_retention_rate REAL DEFAULT 0.0;  -- 30æ—¥ç•™å­˜
```

---

## ğŸ“ **è¿½è¹¤é»è¨­è¨ˆ**

### **1. ç”¨æˆ¶è¨»å†Šè¿½è¹¤**

#### **ä½ç½®ï¼š`src/telegram/handlers/start.ts`**

```typescript
/**
 * Track user registration
 */
async function trackUserRegistration(
  analytics: AnalyticsService,
  user: User,
  invitedBy?: string
) {
  await analytics.trackEvent({
    event_type: UserLifecycleEvent.USER_REGISTERED,
    event_category: 'user',
    user_id: user.telegram_id,
    user_type: 'free',
    user_age_days: 0,
    event_data: JSON.stringify({
      nickname: user.nickname,
      gender: user.gender,
      language: user.language_code,
      invited_by: invitedBy || null,
      registration_source: invitedBy ? 'invite' : 'organic',
    }),
  });
}
```

---

### **2. å»£å‘Šè¿½è¹¤ï¼ˆç¬¬ä¸‰æ–¹è¦–é »å»£å‘Šï¼‰**

#### **ä½ç½®ï¼š`src/telegram/handlers/ad_reward.ts`**

```typescript
/**
 * Track ad impression (ç”¨æˆ¶é»æ“Šã€Œçœ‹å»£å‘Šã€æŒ‰éˆ•)
 */
async function trackAdImpression(
  analytics: AnalyticsService,
  userId: string,
  provider: AdProvider,
  remainingAds: number
) {
  await analytics.trackEvent({
    event_type: AdEvent.AD_IMPRESSION,
    event_category: 'ad',
    user_id: userId,
    ad_provider: provider.provider_name,
    ad_type: 'third_party',
    event_data: JSON.stringify({
      provider_display_name: provider.provider_display_name,
      remaining_ads: remainingAds,
      total_daily_limit: 20,
    }),
  });
}

/**
 * Track ad start (å»£å‘Šé–‹å§‹æ’­æ”¾)
 */
async function trackAdStart(
  analytics: AnalyticsService,
  userId: string,
  provider: string
) {
  await analytics.trackEvent({
    event_type: AdEvent.AD_START,
    event_category: 'ad',
    user_id: userId,
    ad_provider: provider,
    ad_type: 'third_party',
    event_data: JSON.stringify({
      start_time: new Date().toISOString(),
    }),
  });
}

/**
 * Track ad completion (å»£å‘Šå®Œæˆ)
 */
async function trackAdCompletion(
  analytics: AnalyticsService,
  userId: string,
  provider: string,
  rewardGranted: boolean,
  totalAdsWatched: number
) {
  await analytics.trackEvent({
    event_type: AdEvent.AD_COMPLETE,
    event_category: 'ad',
    user_id: userId,
    ad_provider: provider,
    ad_type: 'third_party',
    event_data: JSON.stringify({
      reward_granted: rewardGranted,
      quota_earned: rewardGranted ? 1 : 0,
      total_ads_watched_today: totalAdsWatched,
      completion_time: new Date().toISOString(),
    }),
  });
}

/**
 * Track ad error (å»£å‘ŠéŒ¯èª¤)
 */
async function trackAdError(
  analytics: AnalyticsService,
  userId: string,
  provider: string,
  error: Error
) {
  await analytics.trackEvent({
    event_type: AdEvent.AD_ERROR,
    event_category: 'ad',
    user_id: userId,
    ad_provider: provider,
    ad_type: 'third_party',
    event_data: JSON.stringify({
      error_type: error.name,
      error_message: error.message,
      error_stack: error.stack?.substring(0, 500),  // åªè¨˜éŒ„å‰ 500 å­—ç¬¦
    }),
  });
}
```

---

### **3. å®˜æ–¹å»£å‘Šè¿½è¹¤**

#### **ä½ç½®ï¼š`src/telegram/handlers/ad_reward.ts`**

```typescript
/**
 * Track official ad impression
 */
async function trackOfficialAdImpression(
  analytics: AnalyticsService,
  userId: string,
  ad: OfficialAd,
  displayContext: string
) {
  await analytics.trackEvent({
    event_type: AdEvent.OFFICIAL_AD_IMPRESSION,
    event_category: 'ad',
    user_id: userId,
    ad_id: ad.id,
    ad_type: 'official',
    event_data: JSON.stringify({
      ad_title: ad.title,
      ad_type: ad.ad_type,
      reward_quota: ad.reward_quota,
      display_context: displayContext,  // 'quota_exhausted' | 'manual_view'
    }),
  });
}

/**
 * Track official ad click
 */
async function trackOfficialAdClick(
  analytics: AnalyticsService,
  userId: string,
  ad: OfficialAd
) {
  await analytics.trackEvent({
    event_type: AdEvent.OFFICIAL_AD_CLICK,
    event_category: 'ad',
    user_id: userId,
    ad_id: ad.id,
    ad_type: 'official',
    event_data: JSON.stringify({
      ad_title: ad.title,
      ad_type: ad.ad_type,
      has_url: !!ad.url,
      requires_verification: ad.requires_verification,
    }),
  });
}

/**
 * Track official ad completion
 */
async function trackOfficialAdCompletion(
  analytics: AnalyticsService,
  userId: string,
  ad: OfficialAd,
  verified: boolean
) {
  await analytics.trackEvent({
    event_type: AdEvent.OFFICIAL_AD_COMPLETE,
    event_category: 'ad',
    user_id: userId,
    ad_id: ad.id,
    ad_type: 'official',
    event_data: JSON.stringify({
      ad_title: ad.title,
      ad_type: ad.ad_type,
      reward_granted: true,
      reward_amount: ad.reward_quota,
      verified: verified,
    }),
  });
}
```

---

### **4. VIP è½‰åŒ–æ¼æ–—è¿½è¹¤**

#### **ä½ç½®ï¼š`src/telegram/handlers/vip.ts` å’Œ `src/telegram/handlers/throw.ts`**

```typescript
/**
 * Track VIP awareness (ç”¨æˆ¶çœ‹åˆ° VIP æç¤º)
 */
async function trackVIPAwareness(
  analytics: AnalyticsService,
  userId: string,
  context: string
) {
  await analytics.trackEvent({
    event_type: VIPEvent.VIP_AWARENESS,
    event_category: 'vip',
    user_id: userId,
    event_data: JSON.stringify({
      context: context,  // 'quota_exhausted' | 'profile' | 'help'
      timestamp: new Date().toISOString(),
    }),
  });
  
  // åŒæ™‚è¨˜éŒ„åˆ°æ¼æ–—è¡¨
  await analytics.trackFunnelStep({
    user_id: userId,
    funnel_type: 'vip_conversion',
    funnel_step: 'awareness',
    step_order: 1,
    step_data: JSON.stringify({ context }),
  });
}

/**
 * Track VIP interest (ç”¨æˆ¶é»æ“ŠæŸ¥çœ‹ VIP)
 */
async function trackVIPInterest(
  analytics: AnalyticsService,
  userId: string,
  source: string
) {
  await analytics.trackEvent({
    event_type: VIPEvent.VIP_INTEREST,
    event_category: 'vip',
    user_id: userId,
    event_data: JSON.stringify({
      source: source,  // 'button' | 'command' | 'link'
    }),
  });
  
  await analytics.trackFunnelStep({
    user_id: userId,
    funnel_type: 'vip_conversion',
    funnel_step: 'interest',
    step_order: 2,
    step_data: JSON.stringify({ source }),
  });
}

/**
 * Track VIP consideration (ç”¨æˆ¶æŸ¥çœ‹ VIP è©³æƒ…)
 */
async function trackVIPConsideration(
  analytics: AnalyticsService,
  userId: string,
  viewCount: number
) {
  await analytics.trackEvent({
    event_type: VIPEvent.VIP_CONSIDERATION,
    event_category: 'vip',
    user_id: userId,
    event_data: JSON.stringify({
      view_count: viewCount,
      timestamp: new Date().toISOString(),
    }),
  });
  
  await analytics.trackFunnelStep({
    user_id: userId,
    funnel_type: 'vip_conversion',
    funnel_step: 'consideration',
    step_order: 3,
    step_data: JSON.stringify({ view_count: viewCount }),
  });
}

/**
 * Track VIP purchase intent (ç”¨æˆ¶é»æ“Šè³¼è²·)
 */
async function trackVIPPurchaseIntent(
  analytics: AnalyticsService,
  userId: string,
  plan: string
) {
  await analytics.trackEvent({
    event_type: VIPEvent.VIP_PURCHASE_INTENT,
    event_category: 'vip',
    user_id: userId,
    event_data: JSON.stringify({
      plan: plan,  // 'monthly' | 'quarterly' | 'yearly'
      timestamp: new Date().toISOString(),
    }),
  });
  
  await analytics.trackFunnelStep({
    user_id: userId,
    funnel_type: 'vip_conversion',
    funnel_step: 'purchase_intent',
    step_order: 4,
    step_data: JSON.stringify({ plan }),
  });
}

/**
 * Track VIP purchase success (è³¼è²·æˆåŠŸ)
 */
async function trackVIPPurchaseSuccess(
  analytics: AnalyticsService,
  userId: string,
  plan: string,
  amount: number,
  userAgeDays: number
) {
  await analytics.trackEvent({
    event_type: VIPEvent.VIP_PURCHASE_SUCCESS,
    event_category: 'vip',
    user_id: userId,
    event_data: JSON.stringify({
      plan: plan,
      amount: amount,
      user_age_days: userAgeDays,
      timestamp: new Date().toISOString(),
    }),
  });
  
  await analytics.trackFunnelStep({
    user_id: userId,
    funnel_type: 'vip_conversion',
    funnel_step: 'purchase_success',
    step_order: 5,
    step_data: JSON.stringify({ plan, amount }),
    completed: true,
  });
}
```

---

### **5. é‚€è«‹ç³»çµ±è¿½è¹¤**

#### **ä½ç½®ï¼š`src/telegram/handlers/profile.ts` å’Œ `src/telegram/handlers/start.ts`**

```typescript
/**
 * Track invite initiated (ç™¼èµ·é‚€è«‹)
 */
async function trackInviteInitiated(
  analytics: AnalyticsService,
  userId: string,
  isVIP: boolean
) {
  await analytics.trackEvent({
    event_type: InviteEvent.INVITE_INITIATED,
    event_category: 'invite',
    user_id: userId,
    user_type: isVIP ? 'vip' : 'free',
    event_data: JSON.stringify({
      inviter_is_vip: isVIP,
      timestamp: new Date().toISOString(),
    }),
  });
}

/**
 * Track invite link clicked (é‚€è«‹éˆæ¥è¢«é»æ“Š)
 */
async function trackInviteLinkClicked(
  analytics: AnalyticsService,
  inviterId: string,
  inviteCode: string
) {
  await analytics.trackEvent({
    event_type: InviteEvent.INVITE_LINK_CLICKED,
    event_category: 'invite',
    user_id: inviterId,  // è¨˜éŒ„åœ¨é‚€è«‹è€…èº«ä¸Š
    event_data: JSON.stringify({
      invite_code: inviteCode,
      timestamp: new Date().toISOString(),
    }),
  });
}

/**
 * Track invite accepted (é‚€è«‹è¢«æ¥å— - è¨»å†Š)
 */
async function trackInviteAccepted(
  analytics: AnalyticsService,
  inviterId: string,
  inviteeId: string
) {
  // è¨˜éŒ„åœ¨é‚€è«‹è€…èº«ä¸Š
  await analytics.trackEvent({
    event_type: InviteEvent.INVITE_ACCEPTED,
    event_category: 'invite',
    user_id: inviterId,
    event_data: JSON.stringify({
      invitee_id: inviteeId,
      timestamp: new Date().toISOString(),
    }),
  });
  
  // åŒæ™‚è¨˜éŒ„åœ¨è¢«é‚€è«‹è€…èº«ä¸Šï¼ˆç”¨æ–¼åˆ†æä¾†æºï¼‰
  await analytics.trackEvent({
    event_type: UserLifecycleEvent.USER_REGISTERED,
    event_category: 'user',
    user_id: inviteeId,
    event_data: JSON.stringify({
      registration_source: 'invite',
      invited_by: inviterId,
    }),
  });
}

/**
 * Track invite activated (é‚€è«‹è¢«æ¿€æ´» - é¦–æ¬¡ä¸Ÿç“¶å­)
 */
async function trackInviteActivated(
  analytics: AnalyticsService,
  inviterId: string,
  inviteeId: string,
  timeSinceRegistration: number
) {
  await analytics.trackEvent({
    event_type: InviteEvent.INVITE_ACTIVATED,
    event_category: 'invite',
    user_id: inviterId,
    event_data: JSON.stringify({
      invitee_id: inviteeId,
      time_since_registration_seconds: timeSinceRegistration,
      timestamp: new Date().toISOString(),
    }),
  });
}
```

---

### **6. å…§å®¹äº’å‹•è¿½è¹¤**

#### **ä½ç½®ï¼š`src/telegram/handlers/throw.ts` å’Œ `src/telegram/handlers/catch.ts`**

```typescript
/**
 * Track bottle throw (ä¸Ÿç“¶å­)
 */
async function trackBottleThrow(
  analytics: AnalyticsService,
  userId: string,
  contentType: string,
  quotaSource: string
) {
  await analytics.trackEvent({
    event_type: ContentEvent.BOTTLE_THROW,
    event_category: 'content',
    user_id: userId,
    event_data: JSON.stringify({
      content_type: contentType,  // 'text' | 'photo' | 'voice'
      quota_source: quotaSource,  // 'base' | 'invite' | 'ad'
      timestamp: new Date().toISOString(),
    }),
  });
}

/**
 * Track bottle catch (æ’¿ç“¶å­)
 */
async function trackBottleCatch(
  analytics: AnalyticsService,
  userId: string,
  bottleAge: number,
  replied: boolean
) {
  await analytics.trackEvent({
    event_type: ContentEvent.BOTTLE_CATCH,
    event_category: 'content',
    user_id: userId,
    event_data: JSON.stringify({
      bottle_age_seconds: bottleAge,
      replied: replied,
      timestamp: new Date().toISOString(),
    }),
  });
}

/**
 * Track conversation start (é–‹å§‹å°è©±)
 */
async function trackConversationStart(
  analytics: AnalyticsService,
  userId: string,
  partnerId: string
) {
  await analytics.trackEvent({
    event_type: ContentEvent.CONVERSATION_START,
    event_category: 'content',
    user_id: userId,
    event_data: JSON.stringify({
      partner_id: partnerId,
      timestamp: new Date().toISOString(),
    }),
  });
}

/**
 * Track conversation end (çµæŸå°è©±)
 */
async function trackConversationEnd(
  analytics: AnalyticsService,
  userId: string,
  conversationDuration: number,
  messageCount: number,
  endReason: string
) {
  await analytics.trackEvent({
    event_type: ContentEvent.CONVERSATION_END,
    event_category: 'content',
    user_id: userId,
    event_data: JSON.stringify({
      duration_seconds: conversationDuration,
      message_count: messageCount,
      end_reason: endReason,  // 'natural' | 'reported' | 'manual'
      timestamp: new Date().toISOString(),
    }),
  });
}
```

---

## ğŸ“Š **åˆ†æå ±è¡¨**

### **1. æ¯æ—¥é‹ç‡Ÿå ±è¡¨**

#### **æ–‡ä»¶ï¼š`src/services/analytics_reports.ts`**

```typescript
/**
 * Generate daily operations report
 */
export async function generateDailyReport(
  db: DatabaseClient,
  date: string
): Promise<DailyReport> {
  // 1. ç”¨æˆ¶æ•¸æ“š
  const userMetrics = await getUserMetrics(db, date);
  
  // 2. å»£å‘Šæ•¸æ“š
  const adMetrics = await getAdMetrics(db, date);
  
  // 3. VIP è½‰åŒ–æ•¸æ“š
  const vipMetrics = await getVIPMetrics(db, date);
  
  // 4. é‚€è«‹æ•¸æ“š
  const inviteMetrics = await getInviteMetrics(db, date);
  
  // 5. å…§å®¹äº’å‹•æ•¸æ“š
  const contentMetrics = await getContentMetrics(db, date);
  
  return {
    date,
    user_metrics: userMetrics,
    ad_metrics: adMetrics,
    vip_metrics: vipMetrics,
    invite_metrics: inviteMetrics,
    content_metrics: contentMetrics,
  };
}

/**
 * Format daily report for Telegram
 */
export function formatDailyReport(report: DailyReport): string {
  return `
ğŸ“Š **æ¯æ—¥é‹ç‡Ÿå ±è¡¨**
ğŸ“… æ—¥æœŸï¼š${report.date}

**ğŸ‘¥ ç”¨æˆ¶æ•¸æ“š**
â€¢ æ–°å¢ç”¨æˆ¶ï¼š${report.user_metrics.new_users} äºº
â€¢ æ´»èºç”¨æˆ¶ï¼ˆDAUï¼‰ï¼š${report.user_metrics.dau} äºº
â€¢ ç•™å­˜ç‡ï¼ˆD1ï¼‰ï¼š${report.user_metrics.d1_retention}%
â€¢ å¹³å‡ä½¿ç”¨æ™‚é•·ï¼š${report.user_metrics.avg_session_duration} åˆ†é˜

**ğŸ“º å»£å‘Šæ•¸æ“š**
â€¢ ç¬¬ä¸‰æ–¹å»£å‘Šï¼š
  - å±•ç¤ºï¼š${report.ad_metrics.third_party.impressions} æ¬¡
  - å®Œæˆï¼š${report.ad_metrics.third_party.completions} æ¬¡
  - å®Œæˆç‡ï¼š${report.ad_metrics.third_party.completion_rate}%
  - çå‹µç™¼æ”¾ï¼š${report.ad_metrics.third_party.rewards_granted} å€‹é¡åº¦

â€¢ å®˜æ–¹å»£å‘Šï¼š
  - å±•ç¤ºï¼š${report.ad_metrics.official.impressions} æ¬¡
  - é»æ“Šï¼š${report.ad_metrics.official.clicks} æ¬¡
  - CTRï¼š${report.ad_metrics.official.ctr}%
  - çå‹µç™¼æ”¾ï¼š${report.ad_metrics.official.rewards_granted} å€‹é¡åº¦

**ğŸ’ VIP æ•¸æ“š**
â€¢ VIP é é¢è¨ªå•ï¼š${report.vip_metrics.page_views} æ¬¡
â€¢ è³¼è²·æ„å‘ï¼š${report.vip_metrics.purchase_intents} æ¬¡
â€¢ æˆåŠŸè½‰åŒ–ï¼š${report.vip_metrics.conversions} æ¬¡
â€¢ è½‰åŒ–ç‡ï¼š${report.vip_metrics.conversion_rate}%
â€¢ æ”¶å…¥ï¼š$${report.vip_metrics.revenue}

**ğŸ“² é‚€è«‹æ•¸æ“š**
â€¢ ç™¼èµ·é‚€è«‹ï¼š${report.invite_metrics.initiated} æ¬¡
â€¢ æ¥å—é‚€è«‹ï¼š${report.invite_metrics.accepted} æ¬¡
â€¢ æ¿€æ´»é‚€è«‹ï¼š${report.invite_metrics.activated} æ¬¡
â€¢ è½‰åŒ–ç‡ï¼š${report.invite_metrics.conversion_rate}%

**ğŸ’¬ å…§å®¹äº’å‹•**
â€¢ ä¸Ÿç“¶å­ï¼š${report.content_metrics.bottles_thrown} å€‹
â€¢ æ’¿ç“¶å­ï¼š${report.content_metrics.bottles_caught} å€‹
â€¢ æ–°å°è©±ï¼š${report.content_metrics.conversations_started} å€‹
â€¢ å¹³å‡å°è©±è¼ªæ¬¡ï¼š${report.content_metrics.avg_conversation_rounds}

ğŸ’¡ è©³ç´°æ•¸æ“šï¼š/analytics
  `;
}
```

---

### **2. å»£å‘Šæ•ˆæœåˆ†æå ±è¡¨**

```typescript
/**
 * Generate ad performance report
 */
export async function generateAdPerformanceReport(
  db: DatabaseClient,
  startDate: string,
  endDate: string
): Promise<AdPerformanceReport> {
  // 1. ç¬¬ä¸‰æ–¹å»£å‘Šè¡¨ç¾
  const thirdPartyPerformance = await getThirdPartyAdPerformance(db, startDate, endDate);
  
  // 2. å®˜æ–¹å»£å‘Šè¡¨ç¾
  const officialAdPerformance = await getOfficialAdPerformance(db, startDate, endDate);
  
  // 3. ä¸åŒæä¾›å•†å°æ¯”
  const providerComparison = await getProviderComparison(db, startDate, endDate);
  
  // 4. æ™‚æ®µåˆ†æ
  const hourlyAnalysis = await getHourlyAdPerformance(db, startDate, endDate);
  
  return {
    period: { start: startDate, end: endDate },
    third_party: thirdPartyPerformance,
    official: officialAdPerformance,
    provider_comparison: providerComparison,
    hourly_analysis: hourlyAnalysis,
  };
}
```

---

### **3. VIP è½‰åŒ–æ¼æ–—å ±è¡¨**

```typescript
/**
 * Generate VIP conversion funnel report
 */
export async function generateVIPFunnelReport(
  db: DatabaseClient,
  startDate: string,
  endDate: string
): Promise<VIPFunnelReport> {
  const funnelSteps = [
    'awareness',      // çœ‹åˆ° VIP æç¤º
    'interest',       // é»æ“ŠæŸ¥çœ‹ VIP
    'consideration',  // æŸ¥çœ‹ VIP è©³æƒ…
    'purchase_intent',// é»æ“Šè³¼è²·
    'purchase_success'// è³¼è²·æˆåŠŸ
  ];
  
  const funnelData = [];
  
  for (let i = 0; i < funnelSteps.length; i++) {
    const step = funnelSteps[i];
    const count = await getFunnelStepCount(db, 'vip_conversion', step, startDate, endDate);
    const dropOffRate = i > 0 ? await getDropOffRate(db, funnelSteps[i - 1], step, startDate, endDate) : 0;
    
    funnelData.push({
      step: step,
      step_order: i + 1,
      user_count: count,
      drop_off_rate: dropOffRate,
      conversion_rate: count / funnelData[0]?.user_count || 0,
    });
  }
  
  return {
    period: { start: startDate, end: endDate },
    funnel_steps: funnelData,
    overall_conversion_rate: funnelData[funnelData.length - 1].conversion_rate,
    avg_time_to_convert: await getAvgTimeToConvert(db, startDate, endDate),
  };
}
```

---

### **4. ç”¨æˆ¶ç¾¤çµ„åˆ†æå ±è¡¨**

```typescript
/**
 * Generate user cohort analysis report
 */
export async function generateCohortReport(
  db: DatabaseClient,
  cohortDate: string
): Promise<CohortReport> {
  // ç²å–è©²æ—¥è¨»å†Šçš„ç”¨æˆ¶
  const cohortUsers = await getUsersRegisteredOn(db, cohortDate);
  
  // è¨ˆç®—å„å¤©çš„ç•™å­˜ç‡
  const retentionData = [];
  for (let day = 1; day <= 30; day++) {
    const activeUsers = await getActiveUsersOnDay(db, cohortUsers, cohortDate, day);
    retentionData.push({
      day: day,
      active_users: activeUsers,
      retention_rate: (activeUsers / cohortUsers.length) * 100,
    });
  }
  
  // è¨ˆç®— VIP è½‰åŒ–æƒ…æ³
  const vipConversions = await getVIPConversionsForCohort(db, cohortUsers);
  
  return {
    cohort_date: cohortDate,
    cohort_size: cohortUsers.length,
    retention_data: retentionData,
    vip_conversions: vipConversions,
  };
}
```

---

## ğŸ¯ **é‹ç‡Ÿæ±ºç­–æŒ‡æ¨™**

### **1. æ ¸å¿ƒ KPI Dashboard**

```typescript
/**
 * Core KPIs for business decisions
 */
export interface CoreKPIs {
  // ç”¨æˆ¶å¢é•·
  dau: number;              // æ—¥æ´»èºç”¨æˆ¶
  wau: number;              // é€±æ´»èºç”¨æˆ¶
  mau: number;              // æœˆæ´»èºç”¨æˆ¶
  new_users_today: number;  // ä»Šæ—¥æ–°å¢
  d1_retention: number;     // æ¬¡æ—¥ç•™å­˜ç‡
  d7_retention: number;     // 7æ—¥ç•™å­˜ç‡
  
  // å»£å‘Šæ•ˆæœ
  ad_impressions: number;   // å»£å‘Šå±•ç¤º
  ad_completion_rate: number; // å»£å‘Šå®Œæˆç‡
  ad_revenue_estimate: number; // é ä¼°å»£å‘Šæ”¶å…¥
  
  // VIP è½‰åŒ–
  vip_conversion_rate: number; // VIP è½‰åŒ–ç‡
  vip_revenue_today: number;   // ä»Šæ—¥ VIP æ”¶å…¥
  vip_mrr: number;             // æœˆåº¦ç¶“å¸¸æ€§æ”¶å…¥
  
  // é‚€è«‹æ•ˆæœ
  invite_k_factor: number;     // ç—…æ¯’ä¿‚æ•¸
  invite_conversion_rate: number; // é‚€è«‹è½‰åŒ–ç‡
  
  // å…§å®¹äº’å‹•
  bottles_per_user: number;    // äººå‡ä¸Ÿç“¶å­æ•¸
  conversation_rate: number;   // å°è©±ç‡
  
  // å¥åº·åº¦æŒ‡æ¨™
  report_rate: number;         // èˆ‰å ±ç‡
  ban_rate: number;            // å°ç¦ç‡
  churn_rate: number;          // æµå¤±ç‡
}
```

---

### **2. é—œéµæ±ºç­–å•é¡Œ & å°æ‡‰æŒ‡æ¨™**

#### **å•é¡Œ 1ï¼šå»£å‘Šç³»çµ±æ˜¯å¦æœ‰æ•ˆï¼Ÿ**

**é—œéµæŒ‡æ¨™ï¼š**
- å»£å‘Šå®Œæˆç‡ > 80%ï¼ˆå¥åº·ï¼‰
- å»£å‘Šçå‹µä½¿ç”¨ç‡ > 60%ï¼ˆç”¨æˆ¶çœŸçš„éœ€è¦é¡åº¦ï¼‰
- å»£å‘Šå¾Œ VIP è½‰åŒ–ç‡ vs æœªçœ‹å»£å‘Šç”¨æˆ¶çš„ VIP è½‰åŒ–ç‡

**æ±ºç­–é‚è¼¯ï¼š**
```typescript
if (ad_completion_rate > 80 && ad_reward_usage_rate > 60) {
  // å»£å‘Šç³»çµ±æœ‰æ•ˆï¼Œå¯ä»¥è€ƒæ…®ï¼š
  // 1. å¢åŠ å»£å‘Šæä¾›å•†
  // 2. æé«˜æ¯æ—¥å»£å‘Šä¸Šé™
  // 3. å„ªåŒ–å»£å‘Šçå‹µé¡åº¦
} else if (ad_completion_rate < 50) {
  // å»£å‘Šé«”é©—ä¸ä½³ï¼Œéœ€è¦ï¼š
  // 1. æª¢æŸ¥å»£å‘Šæä¾›å•†è³ªé‡
  // 2. å„ªåŒ–å»£å‘ŠåŠ è¼‰é€Ÿåº¦
  // 3. è€ƒæ…®æ›´æ›å»£å‘Šå•†
}
```

---

#### **å•é¡Œ 2ï¼šæ‡‰è©²å„ªåŒ–å…è²»ç”¨æˆ¶é«”é©—é‚„æ˜¯æ¨å»£ VIPï¼Ÿ**

**é—œéµæŒ‡æ¨™ï¼š**
- å…è²»ç”¨æˆ¶æ´»èºåº¦ï¼ˆDAU ä¸­å…è²»ç”¨æˆ¶ä½”æ¯”ï¼‰
- VIP è½‰åŒ–ç‡
- VIP æ”¶å…¥ vs å»£å‘Šæ”¶å…¥

**æ±ºç­–é‚è¼¯ï¼š**
```typescript
const free_user_ratio = free_dau / total_dau;
const vip_conversion_rate = vip_conversions / total_users;
const revenue_ratio = vip_revenue / (vip_revenue + ad_revenue);

if (free_user_ratio > 0.9 && vip_conversion_rate < 0.05) {
  // å¤§éƒ¨åˆ†ç”¨æˆ¶æ˜¯å…è²»ç”¨æˆ¶ï¼ŒVIP è½‰åŒ–ä½
  // ç­–ç•¥ï¼šå„ªåŒ–å…è²»ç”¨æˆ¶é«”é©—ï¼Œå¢åŠ å»£å‘Šæ”¶å…¥
  // 1. æé«˜å»£å‘Šè³ªé‡
  // 2. å¢åŠ å®˜æ–¹å»£å‘Šï¼ˆæ°¸ä¹…é¡åº¦ï¼‰
  // 3. å„ªåŒ–é‚€è«‹æ©Ÿåˆ¶
} else if (revenue_ratio > 0.7 && vip_conversion_rate > 0.1) {
  // VIP æ˜¯ä¸»è¦æ”¶å…¥ä¾†æº
  // ç­–ç•¥ï¼šå°ˆæ³¨ VIP ç”¨æˆ¶é«”é©—
  // 1. å¢åŠ  VIP å°ˆå±¬åŠŸèƒ½
  // 2. å„ªåŒ– VIP çºŒè²»æµç¨‹
  // 3. VIP ç”¨æˆ¶ç¤¾ç¾¤å»ºè¨­
}
```

---

#### **å•é¡Œ 3ï¼šé‚€è«‹ç³»çµ±æ˜¯å¦å¥åº·ï¼Ÿ**

**é—œéµæŒ‡æ¨™ï¼š**
- K-factorï¼ˆç—…æ¯’ä¿‚æ•¸ï¼‰> 1ï¼ˆè‡ªç„¶å¢é•·ï¼‰
- é‚€è«‹æ¿€æ´»ç‡ > 50%
- è¢«é‚€è«‹ç”¨æˆ¶çš„ç•™å­˜ç‡ vs è‡ªç„¶ç”¨æˆ¶

**æ±ºç­–é‚è¼¯ï¼š**
```typescript
const k_factor = (invites_sent / active_users) * (invites_accepted / invites_sent);
const invite_activation_rate = invites_activated / invites_accepted;

if (k_factor > 1 && invite_activation_rate > 0.5) {
  // é‚€è«‹ç³»çµ±éå¸¸å¥åº·
  // ç­–ç•¥ï¼šåŠ å¤§é‚€è«‹çå‹µ
  // 1. å¢åŠ é‚€è«‹è€…çå‹µ
  // 2. çµ¦è¢«é‚€è«‹è€…é¦–æ¬¡çå‹µ
  // 3. æ¨å‡ºé‚€è«‹æ’è¡Œæ¦œ
} else if (k_factor < 0.5) {
  // é‚€è«‹ç³»çµ±éœ€è¦å„ªåŒ–
  // ç­–ç•¥ï¼šé™ä½é‚€è«‹é–€æª»
  // 1. ç°¡åŒ–é‚€è«‹æµç¨‹
  // 2. å¢åŠ é‚€è«‹å…¥å£
  // 3. å„ªåŒ–é‚€è«‹æ–‡æ¡ˆ
}
```

---

#### **å•é¡Œ 4ï¼šç”¨æˆ¶åœ¨å“ªå€‹éšæ®µæµå¤±æœ€å¤šï¼Ÿ**

**é—œéµæŒ‡æ¨™ï¼š**
- æ–°æ‰‹æµå¤±ç‡ï¼ˆD1, D3, D7ï¼‰
- VIP è½‰åŒ–æ¼æ–—å„éšæ®µæµå¤±ç‡
- ç”¨æˆ¶æœ€å¾Œä¸€æ¬¡æ´»èºæ™‚é–“åˆ†å¸ƒ

**æ±ºç­–é‚è¼¯ï¼š**
```typescript
const d1_retention = 0.45;  // 45% æ¬¡æ—¥ç•™å­˜
const d7_retention = 0.25;  // 25% 7æ—¥ç•™å­˜

if (d1_retention < 0.4) {
  // æ–°æ‰‹æµå¤±åš´é‡
  // ç­–ç•¥ï¼šå„ªåŒ–æ–°æ‰‹é«”é©—
  // 1. æ–°æ‰‹å¼•å°å„ªåŒ–
  // 2. é¦–æ¬¡é«”é©—çå‹µ
  // 3. é™ä½é¦–æ¬¡ä½¿ç”¨é–€æª»
} else if (d7_retention / d1_retention < 0.5) {
  // D1-D7 æµå¤±åš´é‡
  // ç­–ç•¥ï¼šå¢åŠ ç”¨æˆ¶ç²˜æ€§
  // 1. æ¯æ—¥ç°½åˆ°çå‹µ
  // 2. é€£çºŒä½¿ç”¨çå‹µ
  // 3. æ¨é€é€šçŸ¥å„ªåŒ–
}
```

---

## ğŸ› ï¸ **å¯¦ç¾æ–¹æ¡ˆ**

### **Phase 1: æ•¸æ“šåº« & Domainï¼ˆ2-3 å¤©ï¼‰**

**ä»»å‹™æ¸…å–®ï¼š**
- [ ] å‰µå»º Migration `0028_create_analytics_events.sql`
- [ ] å‰µå»º Migration `0029_create_user_sessions.sql`
- [ ] å‰µå»º Migration `0030_create_daily_user_summary.sql`
- [ ] å‰µå»º Migration `0031_create_funnel_events.sql`
- [ ] å‰µå»º Migration `0032_update_daily_stats_analytics.sql`
- [ ] åŸ·è¡Œæ‰€æœ‰ Migrations
- [ ] å‰µå»º `src/domain/analytics.ts`
- [ ] å‰µå»º `src/domain/analytics_events.ts`ï¼ˆäº‹ä»¶é¡å‹å®šç¾©ï¼‰
- [ ] ç·¨å¯«å–®å…ƒæ¸¬è©¦

---

### **Phase 2: Analytics Serviceï¼ˆ2-3 å¤©ï¼‰**

**ä»»å‹™æ¸…å–®ï¼š**
- [ ] å‰µå»º `src/services/analytics.ts`
- [ ] å¯¦ç¾ `trackEvent()` æ–¹æ³•
- [ ] å¯¦ç¾ `trackFunnelStep()` æ–¹æ³•
- [ ] å¯¦ç¾ `startSession()` å’Œ `endSession()` æ–¹æ³•
- [ ] å‰µå»º `src/db/queries/analytics.ts`
- [ ] å¯¦ç¾å„ç¨®æŸ¥è©¢æ–¹æ³•
- [ ] ç·¨å¯«æ¸¬è©¦

---

### **Phase 3: é›†æˆè¿½è¹¤é»ï¼ˆ3-4 å¤©ï¼‰**

**ä»»å‹™æ¸…å–®ï¼š**
- [ ] é›†æˆç”¨æˆ¶è¨»å†Šè¿½è¹¤ï¼ˆ`start.ts`ï¼‰
- [ ] é›†æˆå»£å‘Šè¿½è¹¤ï¼ˆ`ad_reward.ts`ï¼‰
- [ ] é›†æˆ VIP è¿½è¹¤ï¼ˆ`vip.ts`, `throw.ts`ï¼‰
- [ ] é›†æˆé‚€è«‹è¿½è¹¤ï¼ˆ`profile.ts`, `start.ts`ï¼‰
- [ ] é›†æˆå…§å®¹è¿½è¹¤ï¼ˆ`throw.ts`, `catch.ts`, `conversation.ts`ï¼‰
- [ ] æ¸¬è©¦æ‰€æœ‰è¿½è¹¤é»

---

### **Phase 4: å ±è¡¨ç³»çµ±ï¼ˆ2-3 å¤©ï¼‰**

**ä»»å‹™æ¸…å–®ï¼š**
- [ ] å‰µå»º `src/services/analytics_reports.ts`
- [ ] å¯¦ç¾æ¯æ—¥é‹ç‡Ÿå ±è¡¨
- [ ] å¯¦ç¾å»£å‘Šæ•ˆæœå ±è¡¨
- [ ] å¯¦ç¾ VIP è½‰åŒ–æ¼æ–—å ±è¡¨
- [ ] å¯¦ç¾ç”¨æˆ¶ç¾¤çµ„åˆ†æå ±è¡¨
- [ ] å‰µå»º `src/telegram/handlers/admin_analytics.ts`
- [ ] å¯¦ç¾ `/analytics` å‘½ä»¤
- [ ] å¯¦ç¾ `/ad_performance` å‘½ä»¤
- [ ] å¯¦ç¾ `/vip_funnel` å‘½ä»¤
- [ ] å¯¦ç¾ `/cohort_analysis` å‘½ä»¤

---

### **Phase 5: è‡ªå‹•åŒ–å ±è¡¨ï¼ˆ1-2 å¤©ï¼‰**

**ä»»å‹™æ¸…å–®ï¼š**
- [ ] å‰µå»º `src/cron/daily_report.ts`
- [ ] å¯¦ç¾æ¯æ—¥è‡ªå‹•å ±è¡¨ç”Ÿæˆ
- [ ] å¯¦ç¾è‡ªå‹•æ¨é€çµ¦è¶…ç´šç®¡ç†å“¡
- [ ] é…ç½® Cloudflare Cron Triggers
- [ ] æ¸¬è©¦è‡ªå‹•åŒ–æµç¨‹

---

### **Phase 6: Dashboard & å¯è¦–åŒ–ï¼ˆå¯é¸ï¼Œ2-3 å¤©ï¼‰**

**ä»»å‹™æ¸…å–®ï¼š**
- [ ] å‰µå»º `public/analytics-dashboard.html`
- [ ] å¯¦ç¾æ•¸æ“šå¯è¦–åŒ–ï¼ˆChart.jsï¼‰
- [ ] å¯¦ç¾å¯¦æ™‚æ•¸æ“šæ›´æ–°
- [ ] æ·»åŠ ç¯©é¸å’Œæ™‚é–“ç¯„åœé¸æ“‡
- [ ] éƒ¨ç½²åˆ° Cloudflare Pages

---

## ğŸ“ˆ **é æœŸæ•ˆæœ**

### **1. æ•¸æ“šé©…å‹•æ±ºç­–**
- âœ… æ¯å¤©è‡ªå‹•æ”¶åˆ°é‹ç‡Ÿå ±è¡¨
- âœ… å¯¦æ™‚äº†è§£å»£å‘Šæ•ˆæœ
- âœ… æ¸…æ¥šçŸ¥é“ VIP è½‰åŒ–æƒ…æ³
- âœ… æŒæ¡ç”¨æˆ¶è¡Œç‚ºæ¨¡å¼

### **2. å¿«é€Ÿå•é¡Œç™¼ç¾**
- âœ… å»£å‘Šå®Œæˆç‡ä¸‹é™ â†’ ç«‹å³åˆ‡æ›å»£å‘Šå•†
- âœ… æ–°æ‰‹ç•™å­˜ç‡ä½ â†’ å„ªåŒ–æ–°æ‰‹å¼•å°
- âœ… VIP è½‰åŒ–ç‡ä½ â†’ èª¿æ•´å®šåƒ¹æˆ–åŠŸèƒ½

### **3. ç²¾æº–é‹ç‡Ÿå„ªåŒ–**
- âœ… çŸ¥é“å“ªå€‹æ™‚æ®µç”¨æˆ¶æœ€æ´»èº â†’ å„ªåŒ–æ¨é€æ™‚é–“
- âœ… çŸ¥é“å“ªç¨®å»£å‘Šæ•ˆæœæœ€å¥½ â†’ èª¿æ•´å»£å‘Šç­–ç•¥
- âœ… çŸ¥é“ç”¨æˆ¶å¾å“ªè£¡ä¾† â†’ å„ªåŒ–æ¨å»£æ¸ é“

### **4. æ”¶ç›Šæœ€å¤§åŒ–**
- âœ… å¹³è¡¡å»£å‘Šæ”¶å…¥å’Œ VIP æ”¶å…¥
- âœ… å„ªåŒ– VIP å®šåƒ¹ç­–ç•¥
- âœ… æé«˜ç”¨æˆ¶ LTV

---

## ğŸ¯ **ç¸½çµ**

### **æ ¸å¿ƒè¿½è¹¤é»ï¼ˆå¿…é ˆå¯¦ç¾ï¼‰**

1. âœ… **ç”¨æˆ¶è¨»å†Š** - è¿½è¹¤ä¾†æºå’Œè½‰åŒ–
2. âœ… **å»£å‘Šäº’å‹•** - å®Œæ•´çš„å»£å‘Šæ¼æ–—
3. âœ… **VIP è½‰åŒ–** - 5 æ­¥è½‰åŒ–æ¼æ–—
4. âœ… **é‚€è«‹è¡Œç‚º** - ç—…æ¯’å¢é•·è¿½è¹¤
5. âœ… **å…§å®¹äº’å‹•** - ç”¨æˆ¶æ´»èºåº¦

### **æ ¸å¿ƒå ±è¡¨ï¼ˆå¿…é ˆå¯¦ç¾ï¼‰**

1. âœ… **æ¯æ—¥é‹ç‡Ÿå ±è¡¨** - è‡ªå‹•æ¨é€
2. âœ… **å»£å‘Šæ•ˆæœå ±è¡¨** - å„ªåŒ–å»£å‘Šç­–ç•¥
3. âœ… **VIP è½‰åŒ–å ±è¡¨** - æé«˜è½‰åŒ–ç‡
4. âœ… **ç”¨æˆ¶ç•™å­˜å ±è¡¨** - é™ä½æµå¤±

### **æŠ€è¡“æ–¹æ¡ˆ**

- âœ… **Cloudflare Analytics + D1** - ç„¡éœ€é¡å¤–ä¾è³´
- âœ… **å®Œæ•´çš„äº‹ä»¶è¿½è¹¤** - è¨˜éŒ„æ‰€æœ‰é—œéµè¡Œç‚º
- âœ… **è‡ªå‹•åŒ–å ±è¡¨** - æ¯æ—¥æ¨é€ï¼Œç„¡éœ€æ‰‹å‹•æŸ¥è©¢
- âœ… **å¯¦æ™‚æŸ¥è©¢** - SQL æŸ¥è©¢ä»»ä½•æ•¸æ“š

---

**ç¸½é–‹ç™¼æ™‚é–“ï¼šç´„ 10-15 å¤©**

**å„ªå…ˆç´šï¼š**
1. Phase 1-3ï¼ˆæ ¸å¿ƒè¿½è¹¤ï¼‰- å¿…é ˆ
2. Phase 4ï¼ˆå ±è¡¨ç³»çµ±ï¼‰- å¿…é ˆ
3. Phase 5ï¼ˆè‡ªå‹•åŒ–ï¼‰- å¼·çƒˆæ¨è–¦
4. Phase 6ï¼ˆDashboardï¼‰- å¯é¸

---

**æº–å‚™å¥½é–‹å§‹å¯¦ç¾äº†å—ï¼Ÿ** ğŸš€

**æœ€å¾Œæ›´æ–°**: 2025-01-18  
**ç‰ˆæœ¬**: 1.0  
**ä½œè€…**: XunNi Team

