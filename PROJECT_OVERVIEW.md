# XunNi å°ˆæ¡ˆæ¦‚è¦½ï¼ˆAI å¿…è®€ï¼‰

> **é€™æ˜¯ AI ä»£ç†åœ¨é–‹å§‹ä»»ä½•å·¥ä½œå‰å¿…é ˆé–±è®€çš„ä¸»è¦æ–‡æª”ã€‚**

## å°ˆæ¡ˆå®šç¾©

**XunNi** æ˜¯ä¸€å€‹é‹è¡Œåœ¨ Cloudflare Workers ä¸Šçš„ Telegram Botï¼Œæä¾› MBTI + æ˜Ÿåº§å¿ƒç†æ¸¬é©—æ¼‚æµç“¶åŒ¿åäº¤å‹åŠŸèƒ½ã€‚

- **é¡å‹**: Telegram Botï¼ˆåŒ¿åèŠå¤©ï¼‰
- **é‹è¡Œç’°å¢ƒ**: Cloudflare Workers + D1ï¼ˆSQLiteï¼‰
- **èªè¨€**: TypeScript (ESM)
- **è³‡æ–™åº«**: Cloudflare D1
- **å¿«å–**: Cloudflare KVï¼ˆå¯é¸ï¼‰

## æ ¸å¿ƒæ¥­å‹™é‚è¼¯

1. **ä½¿ç”¨è€…è¨»å†Š**: å®Œæˆæš±ç¨±ã€MBTI æ¸¬é©—ã€åè©é¨™æ¸¬é©—å¾Œå¯ä¸Ÿç“¶/æ’¿ç“¶
2. **æ¼‚æµç“¶åŒ¹é…**: ä¾ MBTIã€å¹´é½¡ã€æ€§åˆ¥ç­‰æ¢ä»¶åŒ¿åé…å°
3. **åŒ¿åèŠå¤©**: é€éä¸­è½‰ Bot è½‰ç™¼è¨Šæ¯ï¼Œä¸æš´éœ²çœŸå¯¦ ID
4. **VIP è¨‚é–±**: é€é Telegram Stars ä»˜è²»ï¼Œäº«æœ‰æ›´å¤šåŠŸèƒ½å’Œç¿»è­¯æœå‹™
5. **å®‰å…¨é¢¨æ§**: åè©é¨™æ¸¬é©— + AI å¯©æ ¸ + èˆ‰å ±æ©Ÿåˆ¶

## å°ˆæ¡ˆçµæ§‹ï¼ˆä¾†æºæ–‡ä»¶ä½ç½®ï¼‰

```
XunNi/
â”œâ”€â”€ src/                          # æºä»£ç¢¼ç›®éŒ„
â”‚   â”œâ”€â”€ worker.ts                 # Worker å…¥å£é»ï¼ˆ@src/worker.tsï¼‰
â”‚   â”œâ”€â”€ router.ts                 # HTTP è·¯ç”±è™•ç†å™¨ï¼ˆ@src/router.tsï¼‰
â”‚   â”œâ”€â”€ config/                   # é…ç½®æ¨¡çµ„ï¼ˆ@src/config/ï¼‰
â”‚   â”‚   â”œâ”€â”€ env.ts                # ç’°å¢ƒè®Šæ•¸é©—è­‰ï¼ˆ@src/config/env.tsï¼‰
â”‚   â”‚   â””â”€â”€ constants.ts          # å¸¸é‡å®šç¾©ï¼ˆ@src/config/constants.tsï¼‰
â”‚   â”œâ”€â”€ db/                       # è³‡æ–™åº«å±¤ï¼ˆ@src/db/ï¼‰
â”‚   â”‚   â”œâ”€â”€ schema.sql            # è³‡æ–™åº« Schemaï¼ˆ@src/db/schema.sqlï¼‰
â”‚   â”‚   â”œâ”€â”€ migrations/           # é·ç§»è…³æœ¬ï¼ˆ@src/db/migrations/ï¼‰
â”‚   â”‚   â””â”€â”€ client.ts             # D1 å®¢æˆ¶ç«¯å°è£ï¼ˆ@src/db/client.tsï¼‰
â”‚   â”œâ”€â”€ domain/                   # æ¥­å‹™é‚è¼¯å±¤ï¼ˆç´”å‡½æ•¸ï¼Œç„¡å‰¯ä½œç”¨ï¼‰ï¼ˆ@src/domain/ï¼‰
â”‚   â”‚   â”œâ”€â”€ usage.ts              # ä½¿ç”¨æ¬¡æ•¸é™åˆ¶ï¼ˆ@src/domain/usage.tsï¼‰
â”‚   â”‚   â”œâ”€â”€ risk.ts               # é¢¨éšªåˆ†æ•¸èˆ‡å°ç¦ï¼ˆ@src/domain/risk.tsï¼‰
â”‚   â”‚   â”œâ”€â”€ matching.ts           # æ¼‚æµç“¶åŒ¹é…ï¼ˆ@src/domain/matching.tsï¼‰
â”‚   â”‚   â”œâ”€â”€ eligibility.ts        # è³‡æ ¼æŸ¥è©¢ï¼ˆ@src/domain/eligibility.tsï¼‰
â”‚   â”‚   â””â”€â”€ public_stats.ts       # å…¬é–‹çµ±è¨ˆï¼ˆ@src/domain/public_stats.tsï¼‰
â”‚   â”œâ”€â”€ telegram/                 # Telegram ç›¸é—œï¼ˆ@src/telegram/ï¼‰
â”‚   â”‚   â”œâ”€â”€ handlers/             # æŒ‡ä»¤è™•ç†å™¨ï¼ˆ@src/telegram/handlers/ï¼‰
â”‚   â”‚   â””â”€â”€ types.ts              # Telegram API å‹åˆ¥ï¼ˆ@src/telegram/types.tsï¼‰
â”‚   â”œâ”€â”€ services/                 # å¤–éƒ¨æœå‹™æ•´åˆï¼ˆ@src/services/ï¼‰
â”‚   â”‚   â””â”€â”€ openai.ts             # OpenAI APIï¼ˆ@src/services/openai.tsï¼‰
â”‚   â”œâ”€â”€ utils/                    # é€šç”¨å·¥å…·ï¼ˆ@src/utils/ï¼‰
â”‚   â”‚   â”œâ”€â”€ url-whitelist.ts      # URL ç™½åå–®ï¼ˆ@src/utils/url-whitelist.tsï¼‰
â”‚   â”‚   â””â”€â”€ emoji.ts              # Emoji è™•ç†ï¼ˆ@src/utils/emoji.tsï¼‰
â”‚   â””â”€â”€ i18n/                     # åœ‹éš›åŒ–ï¼ˆ@src/i18n/ï¼‰
â”‚       â”œâ”€â”€ index.ts              # i18n åˆå§‹åŒ–ï¼ˆ@src/i18n/index.tsï¼‰
â”‚       â”œâ”€â”€ keys.ts               # ç¿»è­¯éµå€¼ï¼ˆ@src/i18n/keys.tsï¼‰
â”‚       â””â”€â”€ locales/              # èªè¨€åŒ…ï¼ˆ@src/i18n/locales/ï¼‰
â”œâ”€â”€ tests/                        # æ¸¬è©¦ç›®éŒ„ï¼ˆ@tests/ï¼‰
â”œâ”€â”€ scripts/                      # è…³æœ¬ç›®éŒ„ï¼ˆ@scripts/ï¼‰
â”œâ”€â”€ doc/                          # æ–‡æª”ç›®éŒ„ï¼ˆ@doc/ï¼‰
â”‚   â”œâ”€â”€ SPEC.md                   # å°ˆæ¡ˆè¦æ ¼æ›¸ï¼ˆ@doc/SPEC.mdï¼‰
â”‚   â”œâ”€â”€ DEVELOPMENT_STANDARDS.md  # é–‹ç™¼è¦ç¯„ï¼ˆ@doc/DEVELOPMENT_STANDARDS.mdï¼‰
â”‚   â”œâ”€â”€ MODULE_DESIGN.md          # æ¨¡çµ„åŒ–è¨­è¨ˆï¼ˆ@doc/MODULE_DESIGN.mdï¼‰
â”‚   â””â”€â”€ ...                       # å…¶ä»–æ–‡æª”è¦‹ @doc/README.md
â”œâ”€â”€ wrangler.toml                 # Cloudflare é…ç½®ï¼ˆ@wrangler.tomlï¼‰
â”œâ”€â”€ package.json                  # ä¾è³´é…ç½®ï¼ˆ@package.jsonï¼‰
â””â”€â”€ tsconfig.json                 # TypeScript é…ç½®ï¼ˆ@tsconfig.jsonï¼‰
```

## æŠ€è¡“æ£§

- **Runtime**: Cloudflare Workers
- **Database**: Cloudflare D1 (SQLite ç›¸å®¹)
- **Cache**: Cloudflare KVï¼ˆå¯é¸ï¼‰
- **Language**: TypeScript (ESM)
- **Testing**: Vitest
- **Payment**: Telegram Stars

## é‡è¦æ–‡æª”ä½ç½®

åœ¨ç·¨è¼¯ä»»ä½•ä»£ç¢¼å‰ï¼Œå¿…é ˆå…ˆé–±è®€ï¼š

1. **å°ˆæ¡ˆè¦æ ¼æ›¸**: `@doc/SPEC.md` - å®Œæ•´çš„æ¥­å‹™é‚è¼¯å’Œè³‡æ–™åº«è¨­è¨ˆ
2. **é–‹ç™¼è¦ç¯„**: `@doc/DEVELOPMENT_STANDARDS.md` - ä»£ç¢¼é¢¨æ ¼å’Œå‘½åè¦ç¯„
3. **æ¨¡çµ„è¨­è¨ˆ**: `@doc/MODULE_DESIGN.md` - æ¶æ§‹åŸå‰‡å’Œåˆ†å±¤è¨­è¨ˆ
4. **ç’°å¢ƒé…ç½®**: `@doc/ENV_CONFIG.md` - ç’°å¢ƒè®Šæ•¸é…ç½®

å®Œæ•´æ–‡æª”ç´¢å¼•è¦‹ï¼š`@doc/README.md`

## é–‹ç™¼æµç¨‹

1. **é–±è®€æ–‡æª”**: å…ˆé–±è®€ `@doc/SPEC.md` å’Œç›¸é—œè¨­è¨ˆæ–‡æª”
2. **éµå¾ªè¦ç¯„**: åš´æ ¼éµå®ˆ `@doc/DEVELOPMENT_STANDARDS.md` ä¸­çš„è¦ç¯„
3. **ç·¨å¯«æ¸¬è©¦**: Domain å±¤å¿…é ˆå…ˆå¯«æ¸¬è©¦ï¼ˆç›®æ¨™ 90%+ è¦†è“‹ç‡ï¼‰
4. **åŸ·è¡Œæ¸¬è©¦**: `pnpm test` ç¢ºä¿æ‰€æœ‰æ¸¬è©¦é€šé
5. **åŸ·è¡Œ Lint**: `pnpm lint` æª¢æŸ¥ä»£ç¢¼é¢¨æ ¼
6. **å‚™ä»½**: ä½¿ç”¨ `pnpm backup` å’Œ `pnpm backup:push`

## å‘½ä»¤é€ŸæŸ¥

```bash
# æœ¬åœ°é–‹ç™¼
pnpm dev

# åŸ·è¡Œæ¸¬è©¦
pnpm test

# åŸ·è¡Œ Lint
pnpm lint

# æœ¬åœ°å‚™ä»½
pnpm backup

# æ¨é€åˆ° GitHub
pnpm backup:push

# éƒ¨ç½²åˆ° Staging
pnpm deploy:staging

# éƒ¨ç½²åˆ° Production
pnpm deploy:production
```

## é—œéµè¦å‰‡ï¼ˆå¿…é ˆéµå®ˆï¼‰

### è¨Šæ¯æ ¼å¼
- **æ‰€æœ‰ Telegram è¨Šæ¯ä½¿ç”¨ç´”æ–‡å­— + å®˜æ–¹ Emoji**
- **ä¸ä½¿ç”¨ HTML æˆ– Markdown æ ¼å¼**

### ä¸å¯ä¿®æ”¹çš„æ¬„ä½
- **æ€§åˆ¥ï¼ˆgenderï¼‰**: è¨­å®šå¾Œæ°¸é ä¸èƒ½ä¿®æ”¹ï¼ˆéœ€äºŒæ¬¡ç¢ºèªï¼‰
- **ç”Ÿæ—¥ï¼ˆbirthdayï¼‰**: è¨­å®šå¾Œæ°¸é ä¸èƒ½ä¿®æ”¹ï¼ˆéœ€äºŒæ¬¡ç¢ºèªï¼‰

### å¹´é½¡é™åˆ¶
- æœªæ»¿ 18 æ­²ä¸å…è¨±è¨»å†Š
- å¿…é ˆè¼¸å…¥çœŸå¯¦ç”Ÿæ—¥é©—è­‰

### è³‡æ–™åº«è¦ç¯„
- æ‰€æœ‰è¡¨ä½¿ç”¨å°å¯« + ä¸‹åŠƒç·šå‘½å
- æ‰€æœ‰æ¬„ä½ä½¿ç”¨å°å¯« + ä¸‹åŠƒç·šå‘½å
- å¿…é ˆé€šéé·ç§»è…³æœ¬ç®¡ç†è³‡æ–™åº«è®Šæ›´

### åœ‹éš›åŒ–
- æ‰€æœ‰ä½¿ç”¨è€…å¯è¦‹æ–‡å­—å¿…é ˆä½¿ç”¨ i18n ç³»çµ±
- ä½¿ç”¨ `I18N_KEYS` å¸¸æ•¸ï¼Œä¸ä½¿ç”¨å­—ä¸²å­—é¢é‡
- åƒè€ƒ `@doc/I18N_GUIDE.md`

### æ¸¬è©¦è¦†è“‹ç‡ç›®æ¨™
- Domain å±¤ï¼š90%+
- Utilsï¼š80%+
- Handlersï¼š60%+

## å—ä¿è­·çš„æ–‡ä»¶/ç›®éŒ„

**âš ï¸ ä¿®æ”¹å‰å¿…é ˆè¬¹æ…ï¼Œå»ºè­°å…ˆèˆ‡ç¶­è­·è€…ç¢ºèªï¼š**

- `@wrangler.toml` - Cloudflare é…ç½®ï¼ˆéƒ¨ç½²ç›¸é—œï¼‰
- `@src/db/schema.sql` - è³‡æ–™åº« Schemaï¼ˆéœ€é€šéé·ç§»è…³æœ¬ï¼‰
- `@src/db/migrations/` - é·ç§»è…³æœ¬ç›®éŒ„ï¼ˆè®Šæ›´éœ€å¯©æ ¸ï¼‰
- `@scripts/backup-*.ts` - å‚™ä»½è…³æœ¬ï¼ˆå‚™ä»½ç­–ç•¥ç›¸é—œï¼‰
- `@doc/SPEC.md` - æ ¸å¿ƒè¦æ ¼æ›¸ï¼ˆé‡å¤§è®Šæ›´éœ€å¯©æ ¸ï¼‰

**ğŸ”’ çµ•å°ç¦æ­¢ä¿®æ”¹ï¼š**

- `.dev.vars` - åŒ…å«æ•æ„Ÿè³‡è¨Šï¼ˆåœ¨ `.gitignore` ä¸­ï¼‰
- `node_modules/` - ä¾è³´åŒ…
- `package-lock.json` / `pnpm-lock.yaml` - é–å®šæ–‡ä»¶ï¼ˆé™¤éæ›´æ–°ä¾è³´ï¼‰

## æ•…éšœæ’é™¤

### å•é¡Œï¼šä¸çŸ¥é“å¾å“ªè£¡é–‹å§‹
**è§£æ±ºæ–¹æ¡ˆ**: å…ˆé–±è®€ `@doc/SPEC.md` ç¬¬ 15 ç¯€ã€Œå»ºè­°çš„ Cursor é–‹ç™¼é †åºã€

### å•é¡Œï¼šä¸ç¢ºå®šå‘½åè¦ç¯„
**è§£æ±ºæ–¹æ¡ˆ**: æŸ¥çœ‹ `@doc/DEVELOPMENT_STANDARDS.md` ç¬¬ 2.2 ç¯€

### å•é¡Œï¼šä¸çŸ¥é“å¦‚ä½•æ¸¬è©¦
**è§£æ±ºæ–¹æ¡ˆ**: åƒè€ƒ `@doc/TESTING.md` å’Œç¾æœ‰æ¸¬è©¦æ–‡ä»¶ `@tests/domain/`

### å•é¡Œï¼šä¸ç¢ºå®šæ¶æ§‹è¨­è¨ˆ
**è§£æ±ºæ–¹æ¡ˆ**: é–±è®€ `@doc/MODULE_DESIGN.md` äº†è§£åˆ†å±¤è¨­è¨ˆåŸå‰‡

---

**æœ€å¾Œæ›´æ–°**: 2025-01-15  
**ç¶­è­·è€…**: å°ˆæ¡ˆåœ˜éšŠ

