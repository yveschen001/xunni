# 手动测试指南

## 🎯 测试目标

验证 Bot 在真实 Telegram 环境中的实际表现，而不仅仅是自动化测试。

---

## 🔧 准备工作

### 1. 重置你的账号

在 Telegram Bot 中发送：
```
/dev_reset
```

或使用命令：
```bash
# 查看你的 Telegram ID
# 在 Bot 中发送 /dev_info

# 然后重置（替换 YOUR_TELEGRAM_ID）
npx wrangler d1 execute xunni-db-staging --remote --command "
DELETE FROM users WHERE telegram_id = 'YOUR_TELEGRAM_ID';
"
```

### 2. 启动日志监控

```bash
cd /Users/yichen/Downloads/cursor/XunNi
npx wrangler tail --env staging --format pretty
```

保持这个终端窗口打开，你可以实时看到 Bot 的所有请求和响应。

---

## 📝 详细测试步骤

### 第一部分：注册流程（10 分钟）

#### 1. 触发欢迎消息
- [ ] 在 Bot 中发送任意消息（例如："你好"）
- [ ] **预期**：收到欢迎消息和语言选择按钮
- [ ] **检查**：是否显示 20 种语言选项？
- [ ] **检查**：按钮是否正常显示？

#### 2. 选择语言
- [ ] 点击"繁體中文"按钮
- [ ] **预期**：收到"请输入你的昵称"消息
- [ ] **检查**：消息是否为繁体中文？
- [ ] **检查**：提示是否清晰？

#### 3. 输入昵称
- [ ] 输入昵称（例如："测试用户"）
- [ ] **预期**：收到性别选择按钮
- [ ] **检查**：是否有"男"、"女"两个按钮？

#### 4. 选择性别
- [ ] 点击"男"按钮
- [ ] **预期**：收到性别确认消息
- [ ] **检查**：是否显示"你选择了：男"？
- [ ] **检查**：是否有"确认"和"重新选择"按钮？

#### 5. 确认性别
- [ ] 点击"✅ 确认"按钮
- [ ] **预期**：收到生日输入提示
- [ ] **检查**：是否说明格式为 YYYY-MM-DD？
- [ ] **检查**：是否提到年龄限制（18+）？

#### 6. 输入生日
- [ ] 输入生日（例如："2000-01-01"）
- [ ] **预期**：收到生日确认消息
- [ ] **检查**：是否显示年龄和星座？
- [ ] **检查**：是否有"确认"和"重新输入"按钮？

#### 7. 测试年龄限制
- [ ] 点击"重新输入"
- [ ] 输入未满 18 岁的生日（例如："2010-01-01"）
- [ ] **预期**：收到"未满 18 岁不能注册"的提示
- [ ] **检查**：是否被阻止继续？

#### 8. 重新输入正确生日
- [ ] 输入正确生日（例如："2000-01-01"）
- [ ] 点击"✅ 确认"
- [ ] **预期**：收到 MBTI 选择消息
- [ ] **检查**：是否有三个选项？
  - "✍️ 我已经知道我的 MBTI"
  - "📝 进行快速测验"
  - "⏭️ 稍后再说"

#### 9. 测试 MBTI - 手动输入
- [ ] 点击"✍️ 我已经知道我的 MBTI"
- [ ] **预期**：收到 16 种 MBTI 类型按钮
- [ ] **检查**：是否显示所有 16 种类型？
- [ ] 点击"返回"按钮
- [ ] **预期**：回到 MBTI 选择界面

#### 10. 测试 MBTI - 快速测验
- [ ] 点击"📝 进行快速测验"
- [ ] **预期**：收到第一个测验问题
- [ ] **检查**：是否有 A/B 两个选项？
- [ ] 依次回答所有问题（约 8-10 题）
- [ ] **预期**：收到测验结果和 MBTI 类型
- [ ] **检查**：是否显示详细的性格描述？

#### 11. 反诈骗确认
- [ ] **预期**：收到反诈骗安全确认消息
- [ ] **检查**：是否列出 3 个安全提示？
- [ ] **检查**：是否有"确认"和"了解更多"按钮？
- [ ] 点击"📚 我想了解更多安全知识"
- [ ] **预期**：收到详细的安全提示
- [ ] 点击"✅ 是的，我了解并会注意安全"

#### 12. 服务条款同意
- [ ] **预期**：收到服务条款消息
- [ ] **检查**：是否有"同意"按钮？
- [ ] 点击"✅ 同意服务条款"
- [ ] **预期**：收到注册完成消息
- [ ] **检查**：是否显示欢迎消息和可用命令？

---

### 第二部分：核心功能测试（20 分钟）

#### 13. 测试帮助命令
- [ ] 发送 `/help`
- [ ] **预期**：收到命令列表
- [ ] **检查**：是否列出所有可用命令？
- [ ] **检查**：是否有命令说明？

#### 14. 测试个人资料
- [ ] 发送 `/profile`
- [ ] **预期**：收到个人资料摘要
- [ ] **检查**：是否显示昵称、性别、年龄、星座、MBTI？
- [ ] **检查**：是否显示 VIP 状态和配额？

#### 15. 测试资料卡
- [ ] 发送 `/profile_card`
- [ ] **预期**：收到详细的资料卡
- [ ] **检查**：是否显示完整信息？
- [ ] **检查**：格式是否美观？

#### 16. 测试丢漂流瓶
- [ ] 发送 `/throw`
- [ ] **预期**：收到"请输入漂流瓶内容"提示
- [ ] 输入内容（例如："Hello, World! 你好世界！"）
- [ ] **预期**：收到目标性别选择按钮
- [ ] **检查**：是否有"男"、"女"、"任意"三个选项？
- [ ] 点击"任意"
- [ ] **预期**：收到"漂流瓶已丢出"确认
- [ ] **检查**：是否显示剩余配额？

#### 17. 测试配额限制
- [ ] 连续发送 `/throw` 并丢出 3 个漂流瓶
- [ ] **预期**：第 4 次时收到"今日配额已用完"提示
- [ ] **检查**：是否提示升级 VIP？

#### 18. 测试 VIP 功能
- [ ] 发送 `/vip`
- [ ] **预期**：收到 VIP 介绍和购买按钮
- [ ] **检查**：是否列出 VIP 权益？
- [ ] **检查**：是否显示价格（Telegram Stars）？
- [ ] 点击"购买 VIP"按钮
- [ ] **预期**：收到支付界面
- [ ] **注意**：不要实际支付，只测试流程

#### 19. 测试统计数据
- [ ] 发送 `/stats`
- [ ] **预期**：收到统计数据
- [ ] **检查**：是否显示今日/总计的漂流瓶和对话数？
- [ ] **检查**：数据是否正确？

---

### 第三部分：多账号测试（20 分钟）

#### 20. 创建第二个测试账号
- [ ] 使用另一个 Telegram 账号（或让朋友帮忙）
- [ ] 发送 `/dev_skip` 快速完成注册
- [ ] **预期**：自动完成注册，跳过所有步骤

#### 21. 测试捡漂流瓶
- [ ] 在第二个账号中发送 `/catch`
- [ ] **预期**：收到第一个账号丢出的漂流瓶
- [ ] **检查**：是否显示瓶子内容？
- [ ] **检查**：是否显示对方的 MBTI 和星座？
- [ ] **检查**：是否有"回复"按钮？

#### 22. 测试匿名聊天
- [ ] 在第二个账号中直接回复消息（例如："你好！收到你的漂流瓶了！"）
- [ ] **预期**：第一个账号收到匿名消息
- [ ] **检查**：第一个账号是否收到通知？
- [ ] **检查**：是否显示"来自匿名对话的消息"？

#### 23. 测试翻译功能
- [ ] 在第一个账号中回复（例如："Hello! Nice to meet you!"）
- [ ] **预期**：第二个账号收到翻译后的消息
- [ ] **检查**：是否自动翻译成繁体中文？
- [ ] **检查**：翻译质量如何？
- [ ] **检查**：是否显示翻译提示？

#### 24. 测试对话列表
- [ ] 在第一个账号中发送 `/chats`
- [ ] **预期**：收到活跃对话列表
- [ ] **检查**：是否显示与第二个账号的对话？
- [ ] **检查**：是否显示最后消息时间？

#### 25. 测试封锁功能
- [ ] 在第一个账号中发送 `/block`
- [ ] **预期**：收到"已封锁对方"确认
- [ ] 在第二个账号中尝试发送消息
- [ ] **预期**：第一个账号不应该收到消息
- [ ] **检查**：封锁是否生效？

#### 26. 测试举报功能
- [ ] 使用 `/dev_reset` 重置第一个账号
- [ ] 重新建立对话
- [ ] 在第一个账号中发送 `/report`
- [ ] **预期**：收到举报确认
- [ ] **检查**：是否记录举报？

---

### 第四部分：边缘情况测试（10 分钟）

#### 27. 测试 URL 白名单
- [ ] 在对话中发送包含外部链接的消息（例如："https://google.com"）
- [ ] **预期**：收到"不允许发送外部链接"提示
- [ ] **检查**：消息是否被拦截？

#### 28. 测试 Telegram 链接
- [ ] 发送 Telegram 链接（例如："https://t.me/username"）
- [ ] **预期**：消息正常发送
- [ ] **检查**：白名单是否正常工作？

#### 29. 测试中断恢复
- [ ] 使用 `/dev_reset` 重置账号
- [ ] 开始注册，完成到性别选择
- [ ] 关闭 Telegram
- [ ] 重新打开，发送 `/start`
- [ ] **预期**：从性别选择步骤继续
- [ ] **检查**：中断恢复是否正常？

#### 30. 测试无效输入
- [ ] 在注册过程中发送无效输入
  - 生日格式错误："2000/01/01"
  - 昵称过长：超过 50 字符
  - 随机文本
- [ ] **预期**：收到友好的错误提示
- [ ] **检查**：是否有清晰的指导？

---

### 第五部分：开发工具测试（5 分钟）

#### 31. 测试 /dev_info
- [ ] 发送 `/dev_info`
- [ ] **预期**：收到详细的用户信息
- [ ] **检查**：是否显示所有字段？
- [ ] **检查**：是否显示统计数据？

#### 32. 测试 /dev_reset
- [ ] 发送 `/dev_reset`
- [ ] **预期**：收到"数据已重置"确认
- [ ] 发送任意消息
- [ ] **预期**：重新触发注册流程
- [ ] **检查**：重置是否完全？

#### 33. 测试 /dev_skip
- [ ] 发送 `/dev_skip`
- [ ] **预期**：自动完成注册
- [ ] 发送 `/profile`
- [ ] **检查**：是否有默认数据？
- [ ] **检查**：是否可以立即使用核心功能？

---

## 📊 测试记录表

### 注册流程（13 项）
- [ ] 1. 触发欢迎消息
- [ ] 2. 选择语言
- [ ] 3. 输入昵称
- [ ] 4. 选择性别
- [ ] 5. 确认性别
- [ ] 6. 输入生日
- [ ] 7. 测试年龄限制
- [ ] 8. 重新输入正确生日
- [ ] 9. 测试 MBTI - 手动输入
- [ ] 10. 测试 MBTI - 快速测验
- [ ] 11. 反诈骗确认
- [ ] 12. 服务条款同意
- [ ] 13. 注册完成

### 核心功能（7 项）
- [ ] 14. 测试帮助命令
- [ ] 15. 测试个人资料
- [ ] 16. 测试资料卡
- [ ] 17. 测试丢漂流瓶
- [ ] 18. 测试配额限制
- [ ] 19. 测试 VIP 功能
- [ ] 20. 测试统计数据

### 多账号测试（7 项）
- [ ] 21. 创建第二个测试账号
- [ ] 22. 测试捡漂流瓶
- [ ] 23. 测试匿名聊天
- [ ] 24. 测试翻译功能
- [ ] 25. 测试对话列表
- [ ] 26. 测试封锁功能
- [ ] 27. 测试举报功能

### 边缘情况（4 项）
- [ ] 28. 测试 URL 白名单
- [ ] 29. 测试 Telegram 链接
- [ ] 30. 测试中断恢复
- [ ] 31. 测试无效输入

### 开发工具（3 项）
- [ ] 32. 测试 /dev_info
- [ ] 33. 测试 /dev_reset
- [ ] 34. 测试 /dev_skip

---

## 🐛 问题记录模板

发现问题时，请记录：

```markdown
### 问题 #X：[简短描述]

**步骤**：
1. 
2. 
3. 

**预期结果**：


**实际结果**：


**截图**：
[如果有的话]

**严重程度**：
- [ ] 高（阻塞功能）
- [ ] 中（影响体验）
- [ ] 低（小问题）

**日志**：
[从 wrangler tail 复制相关日志]
```

---

## 📈 测试完成后

### 1. 统计结果
- 总测试项：34 项
- 通过：__ 项
- 失败：__ 项
- 跳过：__ 项
- 成功率：__%

### 2. 主要发现
- 优点：
- 缺点：
- 建议：

### 3. 下一步
- [ ] 修复发现的问题
- [ ] 优化用户体验
- [ ] 准备 Production 部署
- [ ] 继续开发 Phase 3

---

**测试时间**: ____  
**测试人**: ____  
**环境**: Staging  
**Bot**: @你的Bot用户名

