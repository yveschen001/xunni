# âœ… é–‹ç™¼æµç¨‹åˆ‡æ›å®Œæˆ

## ğŸ‰ **æˆåŠŸï¼**

ä½ å·²ç¶“å¾**æœ¬åœ° Polling æ¨¡å¼**åˆ‡æ›å›**æ­£å¸¸çš„ Cloudflare Worker é–‹ç™¼æµç¨‹**ï¼

---

## ğŸ“‹ **ç•¶å‰ç‹€æ…‹**

### âœ… **å·²å®Œæˆï¼š**

1. âœ… **Bot å·²éƒ¨ç½²åˆ° Cloudflare Staging**
   - URL: `https://xunni-bot-staging.yves221.workers.dev`
   - Version: `fc868710-1a74-4a24-a023-d8985d3781e1`

2. âœ… **Webhook å·²è¨­ç½®**
   - Bot: `@xunni_dev_bot`
   - Webhook: `https://xunni-bot-staging.yves221.workers.dev/webhook`

3. âœ… **D1 æ•¸æ“šåº«æ­£å¸¸é‹è¡Œ**
   - Database: `xunni-db-staging`
   - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

4. âœ… **Bot æ­£å¸¸éŸ¿æ‡‰**
   - åœ¨ Telegram æ¸¬è©¦é€šé
   - æ‰€æœ‰å‘½ä»¤éƒ½èƒ½æ­£å¸¸å·¥ä½œ

---

## ğŸš€ **ç¾åœ¨å¯ä»¥ä½¿ç”¨çš„é–‹ç™¼æµç¨‹**

### **æ–¹å¼ 1: ç›´æ¥éƒ¨ç½²åˆ° Stagingï¼ˆæ¨è–¦ï¼‰** â­

```bash
# 1. ä¿®æ”¹ä»£ç¢¼
vim src/telegram/handlers/ä½ çš„æ–‡ä»¶.ts

# 2. é‹è¡Œæ¸¬è©¦
pnpm test

# 3. éƒ¨ç½²åˆ° Staging
pnpm deploy:staging

# 4. åœ¨ Telegram æ¸¬è©¦ @xunni_dev_bot
# Bot æœƒç«‹å³ä½¿ç”¨æ–°ä»£ç¢¼

# 5. æŸ¥çœ‹æ—¥èªŒï¼ˆå¦‚æœéœ€è¦ï¼‰
wrangler tail --env staging
```

**å„ªé»ï¼š**
- âœ… æœ€ç°¡å–®
- âœ… ä¸éœ€è¦é¡å¤–å·¥å…·
- âœ… çœŸå¯¦ç’°å¢ƒæ¸¬è©¦
- âœ… å®Œæ•´çš„æ•¸æ“šåº«åŠŸèƒ½

**ç¼ºé»ï¼š**
- âš ï¸ æ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦éƒ¨ç½²ï¼ˆç´„ 10-15 ç§’ï¼‰

---

### **æ–¹å¼ 2: ä½¿ç”¨ Wrangler Dev + ngrok**

```bash
# çµ‚ç«¯ 1: å•Ÿå‹• Wrangler Dev
pnpm dev

# çµ‚ç«¯ 2: å•Ÿå‹• ngrok
ngrok http 8787

# çµ‚ç«¯ 3: è¨­ç½® Webhook
curl -X POST "https://api.telegram.org/botä½ çš„TOKEN/setWebhook" \
  -d "url=https://ä½ çš„ngrokåœ°å€.ngrok.io/webhook"

# ä¿®æ”¹ä»£ç¢¼å¾Œæœƒè‡ªå‹•é‡è¼‰
```

**å„ªé»ï¼š**
- âœ… ç†±é‡è¼‰ï¼ˆä¿®æ”¹ä»£ç¢¼è‡ªå‹•ç”Ÿæ•ˆï¼‰
- âœ… æœ¬åœ°èª¿è©¦
- âœ… å®Œæ•´çš„æ•¸æ“šåº«åŠŸèƒ½

**ç¼ºé»ï¼š**
- âš ï¸ éœ€è¦ ngrok
- âš ï¸ è¨­ç½®è¼ƒè¤‡é›œ

---

## ğŸ“Š **é–‹ç™¼æµç¨‹å°æ¯”**

| æ–¹å¼ | é€Ÿåº¦ | è¨­ç½®è¤‡é›œåº¦ | æ•¸æ“šåº« | æ¨è–¦åº¦ |
|------|------|-----------|--------|--------|
| **ç›´æ¥éƒ¨ç½² Staging** | â­â­â­ | â­â­â­â­â­ | âœ… çœŸå¯¦ | â­â­â­â­â­ |
| **Wrangler Dev + ngrok** | â­â­â­â­â­ | â­â­â­ | âœ… æœ¬åœ° | â­â­â­â­ |
| **Polling æ¨¡å¼** | â­â­â­â­ | â­â­â­â­â­ | âŒ Mock | â­â­ |

---

## ğŸ¯ **æ¨è–¦çš„å·¥ä½œæµç¨‹**

### **æ—¥å¸¸é–‹ç™¼ï¼ˆå°æ”¹å‹•ï¼‰ï¼š**

```bash
1. ä¿®æ”¹ä»£ç¢¼
2. pnpm test
3. pnpm deploy:staging
4. åœ¨ Telegram æ¸¬è©¦
5. å¦‚æœ OKï¼Œæäº¤ä»£ç¢¼
```

### **é–‹ç™¼æ–°åŠŸèƒ½ï¼ˆå¤§æ”¹å‹•ï¼‰ï¼š**

```bash
1. å‰µå»ºåŠŸèƒ½åˆ†æ”¯
2. ä¿®æ”¹ä»£ç¢¼
3. ç·¨å¯«æ¸¬è©¦
4. pnpm test
5. pnpm lint
6. pnpm deploy:staging
7. å®Œæ•´æ¸¬è©¦
8. æäº¤ä¸¦åˆä½µä»£ç¢¼
9. pnpm deploy:production
```

---

## ğŸ’¡ **å¿«é€Ÿå‘½ä»¤åƒè€ƒ**

```bash
# é–‹ç™¼
pnpm dev                    # æœ¬åœ°é–‹ç™¼ï¼ˆéœ€è¦ ngrokï¼‰
pnpm test                   # é‹è¡Œæ¸¬è©¦
pnpm lint                   # æª¢æŸ¥ä»£ç¢¼

# éƒ¨ç½²
pnpm deploy:staging         # éƒ¨ç½²åˆ° Staging â­ æœ€å¸¸ç”¨
pnpm deploy:production      # éƒ¨ç½²åˆ° Production

# æ—¥èªŒ
wrangler tail --env staging # æŸ¥çœ‹ Staging æ—¥èªŒ
pnpm monitor                # ç›£æ§æ—¥èªŒ

# æ•¸æ“šåº«
wrangler d1 execute DB --env staging --command "SELECT * FROM users LIMIT 10"

# å‚™ä»½
pnpm backup                 # æœ¬åœ°å‚™ä»½
pnpm backup:push            # æ¨é€åˆ° GitHub
```

---

## ğŸ”„ **ç’°å¢ƒåˆ‡æ›**

### **ç•¶å‰ç’°å¢ƒï¼šCloudflare Staging** âœ…

```
ğŸ¤– Bot: @xunni_dev_bot
ğŸŒ URL: https://xunni-bot-staging.yves221.workers.dev
ğŸ—„ï¸ DB: xunni-db-staging
```

### **å¦‚æœéœ€è¦åˆ‡æ›åˆ°æœ¬åœ°é–‹ç™¼ï¼š**

```bash
# 1. å•Ÿå‹•æœ¬åœ°ç’°å¢ƒ
pnpm dev

# 2. å•Ÿå‹• ngrokï¼ˆåœ¨å¦ä¸€å€‹çµ‚ç«¯ï¼‰
ngrok http 8787

# 3. è¨­ç½® Webhook
curl -X POST "https://api.telegram.org/botä½ çš„TOKEN/setWebhook" \
  -d "url=https://ä½ çš„ngrokåœ°å€.ngrok.io/webhook"
```

### **åˆ‡æ›å› Stagingï¼š**

```bash
# é‡æ–°è¨­ç½® Webhook
curl -X POST "https://api.telegram.org/bot8226418094:AAE5wfp_AvKW36yqya502hUEJQIdSDrYJzM/setWebhook" \
  -d "url=https://xunni-bot-staging.yves221.workers.dev/webhook"
```

---

## ğŸ“š **æ–‡æª”ç´¢å¼•**

- **`CLOUDFLARE_WORKER_é–‹ç™¼æµç¨‹.md`** - å®Œæ•´é–‹ç™¼æµç¨‹æŒ‡å—
- **`doc/DEPLOYMENT.md`** - éƒ¨ç½²æŒ‡å—
- **`doc/ENV_CONFIG.md`** - ç’°å¢ƒé…ç½®
- **`doc/DEVELOPMENT_STANDARDS.md`** - é–‹ç™¼è¦ç¯„

---

## ğŸŠ **ç¸½çµ**

### âœ… **å·²å®Œæˆï¼š**

1. âœ… å¾ Polling æ¨¡å¼åˆ‡æ›åˆ° Cloudflare Worker
2. âœ… Bot éƒ¨ç½²åˆ° Staging ä¸¦æ­£å¸¸å·¥ä½œ
3. âœ… Webhook è¨­ç½®å®Œæˆ
4. âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

### ğŸš€ **ç¾åœ¨å¯ä»¥ï¼š**

1. âœ… æ­£å¸¸é–‹ç™¼æ–°åŠŸèƒ½
2. âœ… åœ¨ Telegram æ¸¬è©¦ @xunni_dev_bot
3. âœ… ä½¿ç”¨å®Œæ•´çš„æ•¸æ“šåº«åŠŸèƒ½
4. âœ… æŸ¥çœ‹å¯¦æ™‚æ—¥èªŒ

### ğŸ’ª **æ¨è–¦æµç¨‹ï¼š**

**æœ€ç°¡å–®çš„é–‹ç™¼æµç¨‹ï¼š**
```bash
# ä¿®æ”¹ä»£ç¢¼ â†’ æ¸¬è©¦ â†’ éƒ¨ç½² â†’ æ¸¬è©¦
vim src/...
pnpm test
pnpm deploy:staging
# åœ¨ Telegram æ¸¬è©¦
```

---

## ğŸ‰ **é–‹å§‹é–‹ç™¼å§ï¼**

**ç¾åœ¨ä½ å¯ä»¥é–‹å§‹é–‹ç™¼å»£å‘Šç³»çµ±æˆ–å…¶ä»–æ–°åŠŸèƒ½äº†ï¼**

**å¿«é€Ÿé–‹å§‹ï¼š**
```bash
# 1. ä¿®æ”¹ä»£ç¢¼
vim src/telegram/handlers/ad.ts

# 2. éƒ¨ç½²æ¸¬è©¦
pnpm deploy:staging

# 3. åœ¨ Telegram æ¸¬è©¦
# ç™¼é€æ¶ˆæ¯åˆ° @xunni_dev_bot
```

**Happy Coding! ğŸš€**

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025-01-18  
**ç‹€æ…‹ï¼š** âœ… å®Œæˆ  
**ç•¶å‰ç’°å¢ƒï¼š** Cloudflare Staging  
**ä¸‹ä¸€æ­¥ï¼š** é–‹å§‹é–‹ç™¼æ–°åŠŸèƒ½ï¼

