# 緊急測試指南

**Version ID：** a79555de-ef39-4b9a-817b-cc76670d3762  
**Bot：** @xunni_dev_bot

---

## ⚠️ 重要：必須重新開始測試

**原因：** 您當前的對話使用的是舊的標識符格式（`#A`），需要重新創建對話才能使用新格式（`#0117ABCD`）

---

## 🧪 完整測試步驟

### 步驟 1：清空所有數據
```
發送：/dev_reset
```

**預期：**
```
✅ **開發模式：數據已重置**

你的所有數據已被刪除。

💡 現在可以重新開始測試註冊流程。
```

---

### 步驟 2：快速設置（跳過註冊）
```
發送：/dev_skip
```

**預期：**
```
✅ **開發模式：跳過註冊**

已自動完成註冊流程。

💡 現在可以直接測試核心功能：
• /throw - 丟漂流瓶
• /catch - 撿漂流瓶
• /stats - 查看統計
```

---

### 步驟 3：丟瓶子
```
發送：/throw
```

**預期：**
```
🍾 **丟漂流瓶**

🎯 尋找對象：女生（默認）
💡 可在 /edit_profile 中修改匹配偏好

📝 **請輸入你的漂流瓶內容**

✅ **規則**：
• 最短 12 個字符
• 最多 500 個字符
• 只允許 Telegram 連結 (t.me)
• 不要包含個人聯絡方式

💬 **範例**：
「你好！我是一個喜歡音樂和電影的人，希望認識志同道合的朋友～」
```

---

### 步驟 4：輸入瓶子內容
```
輸入：我是一個喜歡音樂和電影的人，希望認識志同道合的朋友～
```

**預期：**
```
🎉 漂流瓶已丟出！

瓶子 ID：#[數字]
今日已丟：1/3

💡 你的瓶子將在 24 小時內等待有緣人撿起～

想要撿別人的瓶子嗎？使用 /catch
```

---

### 步驟 5：用另一個帳號撿瓶子
```
切換到另一個測試帳號
發送：/dev_reset
發送：/dev_skip
發送：/catch
```

**預期：**
```
🍾 你撿到了一個漂流瓶！

📝 暱稱：OKOk******（10 字符）
🧠 MBTI：ENTP
⭐ 星座：Virgo
🗣️ 語言：zh-TW

━━━━━━━━━━━━━━━━
我是一個喜歡音樂和電影的人，希望認識志同道合的朋友～

━━━━━━━━━━━━━━━━

💬 直接按 /reply 回覆訊息聊天
📊 今日已撿：1/3
```

**⚠️ 關鍵檢查點：**
- ✅ 暱稱應該顯示 `OKOk******`（10 字符）
- ✅ 不應該顯示 `OKOk****`（8 字符）

---

### 步驟 6：發送對話訊息
```
直接輸入：你好啊
```

**預期（對方收到）：**
```
💬 來自匿名對話的訊息（來自 #0117ABCD）：
來自：測試用戶****（10 字符）
MBTI：ENTP
星座：Virgo

你好啊

⚠️ 長按對方訊息，在子菜單中選擇"reply"，系統才會送出匿名聊天。

🔒 需要封鎖或舉報請直接在此對話中使用 /block 或 /report
🏠 返回主選單：/menu
```

**⚠️ 關鍵檢查點：**
- ✅ 標識符應該顯示 `#0117ABCD` 格式（MMDD + 4 位字母）
- ✅ 不應該顯示 `#A`
- ✅ 暱稱應該顯示 `測試用戶****`（10 字符）

---

### 步驟 7：測試短訊息
```
發送：好的
```

**預期：**
- ✅ 應該成功發送
- ❌ 不應該提示「瓶子內容太短」

---

## 📋 驗收清單

### 1. 標識符格式
- [ ] 對話訊息頭部顯示 `#0117ABCD` 格式？
- [ ] 不是 `#A` 格式？

### 2. 暱稱遮蓋
- [ ] 撿瓶子時暱稱顯示 `OKOk******`（10 字符）？
- [ ] 對話訊息中暱稱顯示 `測試用戶****`（10 字符）？
- [ ] 不是 `OKOk****`（8 字符）？

### 3. 對話訊息驗證
- [ ] 短訊息（例如「好的」）能成功發送？
- [ ] 不會提示「瓶子內容太短」？

---

## 🐛 如果還是有問題

### 問題 1：標識符還是 `#A`
**原因：** 沒有執行 `/dev_reset`，還在使用舊的對話

**解決：**
```
1. 發送：/dev_reset
2. 重新執行步驟 2-6
```

---

### 問題 2：暱稱還是 8 字符
**原因：** 代碼沒有部署成功

**檢查：** Version ID 是否為 `a79555de-ef39-4b9a-817b-cc76670d3762`？

---

### 問題 3：短訊息還是提示「瓶子內容太短」
**原因：** 可能有 throw_bottle session 殘留

**解決：**
```
1. 發送：/menu
2. 再發送短訊息
```

或者：
```
1. 發送：/dev_reset
2. 重新開始測試
```

---

## 🚀 當前部署狀態

**Version ID：** a79555de-ef39-4b9a-817b-cc76670d3762  
**Bot：** @xunni_dev_bot  
**狀態：** ✅ 已部署並運行

**修復內容：**
1. ✅ 標識符格式改為 `#MMDDHHHH`
2. ✅ 暱稱遮蓋統一為 10 字符
3. ✅ 對話訊息沒有最少字數限制

---

**請按照步驟重新測試！** 🙏

