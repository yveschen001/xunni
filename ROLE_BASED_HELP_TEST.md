# 角色權限測試指南

**最後更新：** 2025-11-17

---

## 📋 測試目標

驗證不同角色的用戶看到不同的 `/help` 命令列表。

---

## 👥 角色定義

### 1. 🙋 **普通用戶（Regular User）**
- **定義**: 任何註冊用戶
- **Telegram ID**: 非管理員 ID

### 2. 👮 **普通管理員（Regular Admin）**
- **定義**: 通過 `ADMIN_USER_IDS` 配置的管理員
- **Telegram ID**: 在 `ADMIN_USER_IDS` 中配置的 ID

### 3. 🔱 **超級管理員（Super Admin/God）**
- **定義**: 最高權限管理員
- **Telegram ID**: `396943893`（硬編碼）

---

## 🧪 測試用例

### 測試 1：普通用戶看到的命令

**測試步驟：**
1. 使用非管理員帳號登入 @xunni_dev_bot
2. 發送 `/help`

**預期結果：**
```
📖 **XunNi 指令列表**

🎮 **核心功能**
/start - 開始使用 / 繼續註冊
/menu - 主選單
/throw - 丟出漂流瓶
/catch - 撿起漂流瓶
/profile - 查看個人資料
/profile_card - 查看資料卡片
/edit_profile - 編輯個人資料
/mbti - MBTI 管理
/stats - 我的統計數據
/chats - 我的對話列表
/vip - VIP 訂閱

🛡️ **安全功能**
/block - 封鎖使用者
/report - 舉報不當內容
/appeal - 申訴封禁
/appeal_status - 查詢申訴狀態

📖 **幫助**
/rules - 查看遊戲規則
/help - 顯示此列表
/settings - 推送設定

━━━━━━━━━━━━━━━━
💡 提示：直接發送訊息即可在對話中聊天
```

**驗證點：**
- ✅ 只顯示基本用戶命令
- ❌ 不顯示管理員功能
- ❌ 不顯示超級管理員功能

---

### 測試 2：普通管理員看到的命令

**前置條件：**
1. 在 `wrangler.toml` 中添加測試管理員 ID：
   ```toml
   ADMIN_USER_IDS = "TEST_ADMIN_ID"
   ```
2. 重新部署：`pnpm deploy:staging`

**測試步驟：**
1. 使用測試管理員帳號登入 @xunni_dev_bot
2. 發送 `/help`

**預期結果：**
```
📖 **XunNi 指令列表**

🎮 **核心功能**
[... 基本用戶命令 ...]

🛡️ **安全功能**
[... 基本安全命令 ...]

📖 **幫助**
[... 基本幫助命令 ...]

👮 **管理員功能**
/admin_appeals - 查看待審核申訴
/admin_bans - 查看封禁記錄
/admin_bans <user_id> - 查看用戶封禁歷史
/admin_approve <id> [備註] - 批准申訴
/admin_reject <id> [備註] - 拒絕申訴

━━━━━━━━━━━━━━━━
💡 提示：直接發送訊息即可在對話中聊天
```

**驗證點：**
- ✅ 顯示基本用戶命令
- ✅ 顯示管理員功能（申訴、封禁管理）
- ❌ 不顯示超級管理員功能

---

### 測試 3：超級管理員看到的命令

**測試步驟：**
1. 使用超級管理員帳號（`396943893`）登入 @xunni_dev_bot
2. 發送 `/help`

**預期結果：**
```
📖 **XunNi 指令列表**

🎮 **核心功能**
[... 基本用戶命令 ...]

🛡️ **安全功能**
[... 基本安全命令 ...]

📖 **幫助**
[... 基本幫助命令 ...]

👮 **管理員功能**
/admin_appeals - 查看待審核申訴
/admin_bans - 查看封禁記錄
/admin_bans <user_id> - 查看用戶封禁歷史
/admin_approve <id> [備註] - 批准申訴
/admin_reject <id> [備註] - 拒絕申訴

🔱 **超級管理員功能**
/broadcast - 群發訊息
/dev_info - 系統信息
/dev_reset - 重置帳號（測試用）
💡 配置管理：修改 wrangler.toml

━━━━━━━━━━━━━━━━
💡 提示：直接發送訊息即可在對話中聊天
```

**驗證點：**
- ✅ 顯示基本用戶命令
- ✅ 顯示管理員功能
- ✅ 顯示超級管理員功能

---

## 🔍 權限矩陣

| 命令分類 | 普通用戶 | 普通管理員 | 超級管理員 |
|---------|---------|-----------|-----------|
| 核心功能 | ✅ | ✅ | ✅ |
| 安全功能 | ✅ | ✅ | ✅ |
| 幫助 | ✅ | ✅ | ✅ |
| 管理員功能 | ❌ | ✅ | ✅ |
| 超級管理員功能 | ❌ | ❌ | ✅ |

---

## 🎯 命令權限詳細列表

### 基本用戶命令（所有人可用）
```
/start, /menu, /throw, /catch, /profile, /profile_card, 
/edit_profile, /mbti, /stats, /chats, /vip, /block, 
/report, /appeal, /appeal_status, /rules, /help, /settings
```

### 管理員命令（管理員 + 超級管理員）
```
/admin_appeals, /admin_bans, /admin_approve, /admin_reject
```

### 超級管理員命令（僅超級管理員）
```
/broadcast, /dev_info, /dev_reset
配置管理權限（wrangler.toml）
```

---

## ✅ 驗收標準

### 1. 普通用戶
- [ ] 只看到基本命令（17 個命令）
- [ ] 不看到任何管理員命令
- [ ] 命令格式正確，無錯別字

### 2. 普通管理員
- [ ] 看到基本命令（17 個命令）
- [ ] 看到管理員功能（5 個命令）
- [ ] 不看到超級管理員功能
- [ ] 命令格式正確，無錯別字

### 3. 超級管理員
- [ ] 看到基本命令（17 個命令）
- [ ] 看到管理員功能（5 個命令）
- [ ] 看到超級管理員功能（3 個命令 + 配置管理提示）
- [ ] 命令格式正確，無錯別字

---

## 🐛 常見問題

### Q: 普通管理員看不到管理員命令？
A: 檢查：
1. `ADMIN_USER_IDS` 是否正確配置
2. 是否重新部署了 Worker
3. 使用 `/dev_info` 確認你的 Telegram ID

### Q: 超級管理員看不到超級管理員命令？
A: 檢查：
1. 確認你的 Telegram ID 是 `396943893`
2. 檢查代碼中的 `SUPER_ADMIN_ID` 常數
3. 重新部署 Worker

### Q: 如何測試不同角色？
A: 
- **普通用戶**: 使用任何非管理員帳號
- **普通管理員**: 在 `ADMIN_USER_IDS` 中添加測試 ID
- **超級管理員**: 使用 `396943893` 帳號

---

## 📝 測試記錄模板

```
測試日期：____________________
測試環境：[ ] Staging  [ ] Production
測試人員：____________________

測試 1：普通用戶
- 測試帳號：____________________
- 結果：[ ] 通過  [ ] 失敗
- 備註：____________________

測試 2：普通管理員
- 測試帳號：____________________
- 結果：[ ] 通過  [ ] 失敗
- 備註：____________________

測試 3：超級管理員
- 測試帳號：396943893
- 結果：[ ] 通過  [ ] 失敗
- 備註：____________________

總結：____________________
```

---

**維護者：** 開發團隊  
**相關文檔：** `ADMIN_SETUP_GUIDE.md`

