name = "xunni-bot"
main = "src/worker.ts"
compatibility_date = "2025-01-15"
node_compat = true
account_id = "7404fbe7880034e92c7d4a20969e42f5"

# D1 Migrations
[[d1_databases]]
binding = "DB"
database_name = "xunni-db-staging"
database_id = "7b77ad82-ba26-489f-995f-8256b32379df"
migrations_dir = "src/db/migrations"

# KV Cache (Dev)
[[kv_namespaces]]
binding = "CACHE"
id = "8222fd298f254b498b7842d03e5d2a4d" # Staging ID
preview_id = "8222fd298f254b498b7842d03e5d2a4d" # Staging ID

[[kv_namespaces]]
binding = "I18N_DATA"
id = "6e9a063bd4a2463d8a2d76dd7fbef88a" # Staging ID
preview_id = "6e9a063bd4a2463d8a2d76dd7fbef88a" # Staging ID

# Default environment variables (non-sensitive)
[vars]
ENVIRONMENT = "development"
LOG_LEVEL = "debug"
TELEGRAM_WEBHOOK_SECRET = "test-secret"
TELEGRAM_BOT_TOKEN = "mock-token"
BROADCAST_BATCH_SIZE = "25"
BROADCAST_MAX_JOBS = "3"
ENABLE_AI_MODERATION = "true"
ENABLE_TRANSLATION = "true"
ADMIN_LOG_GROUP_ID = "-4917557179"

# Staging environment
[env.staging]
name = "xunni-bot-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
LOG_LEVEL = "info"
BROADCAST_BATCH_SIZE = "25"
BROADCAST_MAX_JOBS = "3"
ENABLE_AI_MODERATION = "true"
ENABLE_TRANSLATION = "true"
ADMIN_LOG_GROUP_ID = "-5073384780"
GEMINI_PROJECT_ID = "gen-lang-client-0526946218"
GEMINI_LOCATION = "us-central1"
GEMINI_MODELS = "gemini-2.0-flash-exp,gemini-2.5-flash-lite"
GEMINI_API_VERSION = "v1beta"
OPENAI_MODEL = "gpt-4o-mini"
# Super Admin Configuration
SUPER_ADMIN_USER_ID = "396943893"
ADMIN_USER_IDS = ""
# Ad System Configuration
PUBLIC_URL = "https://xunni-bot-staging.yves221.workers.dev"
ENABLE_ANALYTICS = "true"
AD_PROVIDER_STRATEGY = "priority"
AD_REWARD_SECRET = "NOGD2InZ/VuIhZPSiajhwdmIc/PKHnijE/VSUKxzspM="
OFFICIAL_CHANNEL_ID = "-1003260293651"
ENABLE_VIP_SUBSCRIPTION = "false"
ENABLE_SMART_MATCHING = "true"
SMART_MATCHING_THRESHOLD = "70"
VIP_PRICE_STARS = "1"
MOONPACKET_API_KEY = "mock-api-key"
MOONPACKET_API_SECRET = "your_secret_here"

# Staging D1 Database
[[env.staging.d1_databases]]
binding = "DB"
database_name = "xunni-db-staging"
database_id = "7b77ad82-ba26-489f-995f-8256b32379df"
migrations_dir = "src/db/migrations"

# Staging KV Namespace
[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "8222fd298f254b498b7842d03e5d2a4d"

# Staging I18N Data
[[env.staging.kv_namespaces]]
binding = "I18N_DATA"
id = "6e9a063bd4a2463d8a2d76dd7fbef88a"

# Staging Cron Triggers
[env.staging.triggers]
crons = [
  "0 0 * * *",    # Daily Cleanup (00:00 UTC)
  "5 0 * * *",    # Daily Stats (00:05 UTC)
  "10 0 * * *",   # Financial Settlement (00:10 UTC)
  "0 9 * * *",    # Super Admin Reports (09:00 UTC)
  "*/5 * * * *",  # Broadcast & Maintenance (Every 5 mins)
  "*/10 * * * *", # Health Check (Every 10 mins)
  "0 * * * *",    # Hourly Tasks (Push, Match, etc.)
  "0 10 * * *",   # VIP Expirations (10:00 UTC)
  "0 3 * * *",    # Avatar Updates (03:00 UTC)
  "0 1 * * *"     # Birthday & Admin Report (01:00 UTC)
]

# Production environment
[env.production]
name = "xunni-bot"

[env.production.vars]
ENVIRONMENT = "production"
LOG_LEVEL = "warn"
ADMIN_LOG_GROUP_ID = "-4917557179"
GEMINI_PROJECT_ID = "gen-lang-client-0526946218"
GEMINI_LOCATION = "us-central1"
GEMINI_MODELS = "gemini-2.0-flash-exp,gemini-2.5-flash-lite"
GEMINI_API_VERSION = "v1beta"
OPENAI_MODEL = "gpt-4o-mini"
SUPER_ADMIN_USER_ID = "396943893"
ADMIN_USER_IDS = ""
PUBLIC_URL = "https://api.xunni.xyz"
ENABLE_ANALYTICS = "true"
AD_PROVIDER_STRATEGY = "priority"
AD_REWARD_SECRET = "NOGD2InZ/VuIhZPSiajhwdmIc/PKHnijE/VSUKxzspM="
OFFICIAL_CHANNEL_ID = "-1003260293651"
ENABLE_VIP_SUBSCRIPTION = "false"
VIP_PRICE_STARS = "385"
ENABLE_SMART_MATCHING = "true"
SMART_MATCHING_THRESHOLD = "70"
# MOONPACKET_API_SECRET = "your_secret_here" # Commented out as likely unused or should be secret

# Production D1 Database
[[env.production.d1_databases]]
binding = "DB"
database_name = "xunni-db-production"
database_id = "8d7fc73c-0eaf-4125-8047-9ef35de6b3c2"
migrations_dir = "src/db/migrations"

# Production KV Namespace
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "0a6b866ecab6428691f462178473f94f"

# Production I18N Data
[[env.production.kv_namespaces]]
binding = "I18N_DATA"
id = "1bbc7e09e9044c18b04aa1b7e7b3ef95"

# Production Custom Domain
[[env.production.routes]]
pattern = "api.xunni.xyz"
custom_domain = true

# Production Cron triggers
[env.production.triggers]
crons = [
  "0 0 * * *",    # Daily Cleanup (00:00 UTC)
  "5 0 * * *",    # Daily Stats (00:05 UTC)
  "10 0 * * *",   # Financial Settlement (00:10 UTC)
  "0 9 * * *",    # Super Admin Reports (09:00 UTC)
  "*/5 * * * *",  # Broadcast & Maintenance (Every 5 mins)
  "*/10 * * * *", # Health Check (Every 10 mins)
  "0 * * * *",    # Hourly Tasks (Push, Match, etc.)
  "0 10 * * *",   # VIP Expirations (10:00 UTC)
  "0 3 * * *",    # Avatar Updates (03:00 UTC)
  "0 1 * * *"     # Birthday & Admin Report (01:00 UTC)
]
