# 待開發功能總結

**更新時間：** 2025-01-16  
**狀態：** 📋 規劃完成，待開發

---

## 📊 總覽

| 功能 | 優先級 | 預計工時 | 文檔 | 狀態 |
|------|--------|----------|------|------|
| 血型功能 | 高 | 4-6 小時 | `doc/BLOOD_TYPE_FEATURE_PLAN.md` | 📋 已規劃 |
| MBTI 36 題測試 | 高 | 6-8 小時 | `doc/MBTI_36_QUESTIONS_PLAN.md` | 📋 已規劃 |
| 聊天記錄對象標識 | 高 | 3-4 小時 | `doc/CHAT_HISTORY_IDENTIFIER_PLAN.md` | 📋 已規劃 |

**總預計工時：** 13-18 小時

---

## 🎯 功能一：血型功能完整開發

### 功能概述
開發完整的血型功能，包括註冊時填寫、編輯、以及 VIP 用戶的血型配對功能。

### 主要功能點
1. **註冊流程中添加血型選擇**
   - 位置：生日確認之後
   - 提示：「填寫血型可用於未來的血型配對功能（VIP 專屬）」
   - 選項：A / B / AB / O / 不確定（可跳過）
   - 二次確認機制

2. **編輯血型功能**
   - 入口：`/profile` → 「✏️ 編輯資料」 → 「🩸 編輯血型」
   - 可隨時修改（不像性別和生日）

3. **VIP 血型配對功能**（VIP 專屬）
   - VIP 用戶丟瓶子時可篩選血型
   - 選項：任何 / A / B / AB / O
   - 顯示預估可配對用戶數量

4. **資料庫支援**
   - 欄位：`users.blood_type`（已存在）
   - 值：'A', 'B', 'AB', 'O', NULL

### 技術要點
- 修改註冊流程：`src/telegram/handlers/start.ts`
- 新增編輯功能：`src/telegram/handlers/edit_profile.ts`
- VIP 配對篩選：`src/telegram/handlers/throw_advanced.ts`
- i18n 翻譯支援

### 開發時程
- Phase 1: 註冊流程（2 小時）
- Phase 2: 編輯功能（1 小時）
- Phase 3: VIP 配對（2 小時）
- Phase 4: i18n 和文檔（1 小時）

**詳細文檔：** `doc/BLOOD_TYPE_FEATURE_PLAN.md`

---

## 🎯 功能二：MBTI 36 題測試

### 功能概述
開發完整的 MBTI 36 題測試，提供更準確的性格測試結果，取代目前的簡化版測試。

### 主要功能點
1. **36 題完整測試**
   - 4 個維度：E/I, S/N, T/F, J/P
   - 每個維度 9 題
   - 每題 2 個選項（A/B）

2. **測試流程**
   - 顯示測試說明（約 5 分鐘完成）
   - 逐題作答，顯示進度
   - 可暫停和恢復測試
   - 計算結果並顯示

3. **結果展示**
   - MBTI 類型（16 種）
   - 各維度得分百分比
   - 詳細性格描述
   - 分享結果功能

4. **測試入口**
   - 註冊流程中（替代現有簡化版）
   - `/mbti` 命令（重新測試）
   - `/profile` → 「✏️ 編輯資料」 → 「🧠 重新測試 MBTI」

### 技術要點
- 題庫設計：36 題中英文翻譯
- Session 管理：保存測試進度
- 計分邏輯：統計各維度得分
- 結果描述：16 種 MBTI 類型詳細說明

### 開發時程
- Phase 1: 題庫準備（2 小時）
- Phase 2: 核心邏輯（2 小時）
- Phase 3: Handler 實現（2 小時）
- Phase 4: 整合和測試（2 小時）

**詳細文檔：** `doc/MBTI_36_QUESTIONS_PLAN.md`

---

## 🎯 功能三：聊天記錄對象標識

### 功能概述
在聊天記錄中為每個對話對象添加唯一的 `#` 標識符，方便用戶識別和查詢同一對象的所有對話記錄。

### 主要功能點
1. **對象標識符**
   - 格式：`#A`, `#B`, `#C`, ..., `#Z`, `#AA`, `#AB`, ...
   - 按對話開始時間順序分配
   - 同一對象使用相同標識符

2. **顯示位置**
   - 聊天記錄列表：顯示所有對話對象
   - 對話詳情：顯示與特定對象的對話
   - 新訊息：顯示來自哪個對象

3. **搜尋功能**
   - `/history` - 顯示所有對話
   - `/history #A` - 顯示與 #A 的對話
   - 顯示對話統計（訊息數、最後訊息時間）

4. **資料庫設計**
   - 新增 `conversation_identifiers` 表
   - 記錄用戶、對象、標識符的映射關係

### 技術要點
- 標識符生成邏輯：A -> Z -> AA -> AZ -> BA...
- 資料庫查詢：`src/db/queries/conversation_identifiers.ts`
- Handler 修改：`src/telegram/handlers/message_forward.ts`
- 新增 Handler：`src/telegram/handlers/history.ts`

### 開發時程
- Phase 1: 資料庫和核心邏輯（1 小時）
- Phase 2: Handler 修改（1 小時）
- Phase 3: UI 優化（1 小時）
- Phase 4: 測試和文檔（1 小時）

**詳細文檔：** `doc/CHAT_HISTORY_IDENTIFIER_PLAN.md`

---

## 📅 建議開發順序

### 第一批（優先）
1. **聊天記錄對象標識**（3-4 小時）
   - 最快完成，立即提升用戶體驗
   - 技術難度較低
   - 獨立功能，不影響其他模組

### 第二批
2. **血型功能**（4-6 小時）
   - 涉及註冊流程，需要謹慎測試
   - VIP 配對功能增加商業價值

### 第三批
3. **MBTI 36 題測試**（6-8 小時）
   - 工時最長，需要準備題庫
   - 可以分階段實現（先題庫，後邏輯）

---

## 🧪 測試策略

### 每個功能開發完成後
1. **單元測試**
   - Domain 層函數測試
   - 覆蓋率目標：90%+

2. **集成測試**
   - 完整流程測試
   - 邊界情況測試

3. **手動測試**
   - Staging 環境測試
   - 多語言測試
   - UI/UX 驗證

4. **Smoke Test 更新**
   - 添加新功能到 Smoke Test
   - 確保不破壞現有功能

---

## 📝 文檔更新計劃

### 每個功能完成後需更新
1. **`doc/SPEC.md`**
   - 更新功能規格
   - 更新資料庫 schema

2. **`doc/ONBOARDING_FLOW.md`**（如果涉及註冊流程）
   - 更新註冊流程圖
   - 更新步驟說明

3. **`CHANGELOG.md`**
   - 記錄新功能
   - 記錄 API 變更

4. **`CURRENT_STATUS.md`**
   - 更新已完成功能
   - 更新待開發功能

---

## ✅ 驗收標準

### 功能完整性
- [ ] 所有計劃功能都已實現
- [ ] 所有測試都通過
- [ ] 文檔已更新

### 代碼質量
- [ ] ESLint 0 錯誤
- [ ] 單元測試覆蓋率達標
- [ ] 無 `console.log` 和 `any` 類型

### 用戶體驗
- [ ] UI 清晰易懂
- [ ] 提示訊息友好
- [ ] 支援所有語言

### 部署
- [ ] Staging 測試通過
- [ ] Smoke Test 通過
- [ ] 部署到 Production

---

## 🔗 相關文檔

- `CURRENT_STATUS.md` - 當前專案狀態
- `doc/BLOOD_TYPE_FEATURE_PLAN.md` - 血型功能詳細計劃
- `doc/MBTI_36_QUESTIONS_PLAN.md` - MBTI 36 題測試詳細計劃
- `doc/CHAT_HISTORY_IDENTIFIER_PLAN.md` - 聊天記錄標識詳細計劃
- `doc/DEVELOPMENT_STANDARDS.md` - 開發規範
- `doc/TESTING.md` - 測試規範

---

## 💡 開發建議

### 開發前
1. 閱讀對應的詳細計劃文檔
2. 確認資料庫 schema 變更
3. 準備 i18n 翻譯內容

### 開發中
4. 遵循 `doc/DEVELOPMENT_STANDARDS.md` 規範
5. 先寫測試，後寫實現（TDD）
6. 頻繁提交，保持小步快跑

### 開發後
7. 執行完整測試套件
8. 更新相關文檔
9. Staging 環境驗證
10. 部署到 Production

---

**建立時間：** 2025-01-16  
**維護者：** 開發團隊  
**下次更新：** 功能開發完成後

