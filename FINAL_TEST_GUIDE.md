# 最終測試指南

**測試版本：** 84745932-f942-4fc2-8a84-aa72ad034f44  
**Bot：** @xunni_dev_bot  
**測試時間：** 2025-01-17

---

## ✅ 本次修復內容

### 1. 修復 `/dev_reset` 和 `/start` 流程
- ✅ SQL 語法錯誤（參數數量不匹配）
- ✅ 移除 Markdown 格式（`**`、`` ` ``）
- ✅ 添加 `invite_code` 欄位到 `/dev_skip`

### 2. 添加每日訊息配額檢查
- ✅ 免費用戶：10 則/天/對象
- ✅ VIP 用戶：100 則/天/對象
- ✅ 配額檢查在發送前執行
- ✅ 超過配額時顯示清晰錯誤訊息

---

## 🧪 完整測試流程

### 測試 1：`/dev_reset` + `/start` 註冊流程

```
1. /dev_reset  （清空數據）
   ✅ 預期：顯示「開發模式：數據已重置」（無 Markdown 格式）

2. /start      （重新註冊）
   ✅ 預期：顯示語言選擇按鈕

3. 選擇語言
   ✅ 預期：進入暱稱設置

4. 完成註冊流程
   ✅ 預期：成功註冊，顯示主選單
```

---

### 測試 2：`/dev_reset` + `/dev_skip` 快速設置

```
1. /dev_reset  （清空數據）
   ✅ 預期：顯示「開發模式：數據已重置」

2. /dev_skip   （快速設置）
   ✅ 預期：顯示「開發模式：跳過註冊」（無 Markdown 格式）
   ✅ 預期：用戶已完成註冊，可以使用核心功能
```

---

### 測試 3：對話標識符格式

```
1. 用戶 A: /dev_reset + /dev_skip
2. 用戶 B: /dev_reset + /dev_skip

3. 用戶 A: /throw
   輸入瓶子內容（12+ 字符）

4. 用戶 B: /catch
   ✅ 預期：撿到瓶子，顯示對方資料卡

5. 用戶 B: 回覆訊息
   ✅ 預期：訊息成功發送

6. 用戶 A: 查看收到的訊息
   ✅ 預期：標識符格式為 #0117ABCD（不是 #A）
   ✅ 預期：暱稱顯示為「測試用戶****」（10 字符）
```

---

### 測試 4：暱稱遮蓋規則

**規則：**
- 少於 4 個字：顯示全部 + 填充 `*` 至 10 字符
- 4 個字以上：顯示前面部分 + 至少 4 個 `*`，總共 10 字符

**測試案例：**

| 原始暱稱 | 預期遮蓋 | 說明 |
|---------|---------|------|
| `OK` | `OK********` | 2 字 + 8 星 = 10 |
| `OKO` | `OKO*******` | 3 字 + 7 星 = 10 |
| `OKOk` | `OKOk******` | 4 字 + 6 星 = 10 |
| `張小明` | `張小明*******` | 3 字 + 7 星 = 10 |
| `張小明的朋友` | `張小明的朋****` | 6 字 + 4 星 = 10 |

---

### 測試 5：對話訊息最少字數

**規則：**
- **第一則瓶子**：最少 12 字符
- **後續對話訊息**：只要非空即可（無最少字數限制）

**測試：**

```
1. 用戶 A: /throw
   輸入「Hi」
   ❌ 預期：顯示「瓶子內容至少需要 12 個字符」

2. 用戶 A: 輸入「Hello, how are you?」（12+ 字符）
   ✅ 預期：瓶子成功丟出

3. 用戶 B: /catch
   ✅ 預期：撿到瓶子

4. 用戶 B: 回覆「Hi」（2 字符）
   ✅ 預期：訊息成功發送（無最少字數限制）
```

---

### 測試 6：每日訊息配額（免費用戶）

**配額：** 10 則/天/對象

**測試：**

```
1. 用戶 A（免費）: /dev_reset + /dev_skip
2. 用戶 B: /dev_reset + /dev_skip

3. 用戶 A: /throw（12+ 字符）
4. 用戶 B: /catch

5. 用戶 A: 發送 10 則訊息
   ✅ 預期：前 10 則都成功發送

6. 用戶 A: 嘗試發送第 11 則訊息
   ❌ 預期：顯示「今日對話訊息配額已用完（10/10）」
   ✅ 預期：提示「升級 VIP 可獲得更多配額（100 則/天）：/vip」
```

---

### 測試 7：每日訊息配額（VIP 用戶）

**配額：** 100 則/天/對象

**測試：**

```
1. 用戶 A（VIP）: /dev_reset + /dev_skip
2. 用戶 B: /dev_reset + /dev_skip

3. 用戶 A: /throw（12+ 字符）
4. 用戶 B: /catch

5. 用戶 A: 發送 100 則訊息
   ✅ 預期：前 100 則都成功發送

6. 用戶 A: 嘗試發送第 101 則訊息
   ❌ 預期：顯示「今日對話訊息配額已用完（100/100）」
   ✅ 預期：顯示「VIP 用戶每日可發送 100 則訊息。」
```

---

### 測試 8：不同對象獨立配額

**測試：**

```
1. 用戶 A（免費）: /dev_reset + /dev_skip
2. 用戶 B: /dev_reset + /dev_skip
3. 用戶 C: /dev_reset + /dev_skip

4. 用戶 A: /throw（12+ 字符）
5. 用戶 B: /catch
6. 用戶 A: 發送 10 則訊息給用戶 B
   ✅ 預期：配額用完

7. 用戶 A: /throw（12+ 字符）
8. 用戶 C: /catch
9. 用戶 A: 發送訊息給用戶 C
   ✅ 預期：可以成功發送（配額獨立計算）
```

---

## 📋 驗收檢查清單

### 基礎功能
- [ ] `/dev_reset` 清空數據成功
- [ ] `/start` 觸發語言選擇
- [ ] `/dev_skip` 快速設置成功
- [ ] 註冊流程完整

### 訊息格式
- [ ] 所有訊息使用純文字（無 Markdown）
- [ ] 標識符格式：`#0117ABCD`（不是 `#A`）
- [ ] 暱稱遮蓋：10 字符（例如 `OKOk******`）

### 對話功能
- [ ] 第一則瓶子：最少 12 字符
- [ ] 後續訊息：無最少字數限制
- [ ] 短訊息（如 "Hi"）可以成功發送

### 每日配額
- [ ] 免費用戶：10 則/天/對象
- [ ] VIP 用戶：100 則/天/對象
- [ ] 超過配額時顯示清晰錯誤訊息
- [ ] 不同對象的配額獨立計算

---

## 🚀 部署資訊

**Version ID：** `84745932-f942-4fc2-8a84-aa72ad034f44`  
**Bot：** @xunni_dev_bot  
**環境：** Staging  
**狀態：** ✅ 已部署並運行

---

## 📝 注意事項

1. **測試前請先 `/dev_reset`** 清空舊數據
2. **標識符格式** 只對新對話生效（舊數據仍是 `#A`）
3. **每日配額** 基於 UTC 時間計算
4. **VIP 狀態** 需要在資料庫中手動設置（或使用 `/dev_skip`）

---

**測試指南創建時間：** 2025-01-17  
**準備完成，可以開始測試！** 🎉

