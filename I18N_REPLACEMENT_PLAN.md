# i18n ç¡¬ç¼–ç æ›¿æ¢è®¡åˆ’

**åˆ›å»ºæ—¶é—´**: 2025-01-23  
**ç›®æ ‡**: å°† 2584 å¤„ç¡¬ç¼–ç ä¸­æ–‡æ›¿æ¢ä¸º `i18n.t(key)`  
**åŸåˆ™**: é«˜äºè¡Œä¸šæ ‡å‡† + Cursor AI æ™ºèƒ½å¢å¼ºï¼Œé›¶é”™è¯¯

---

## ğŸ¯ ç›®æ ‡

### æ›¿æ¢èŒƒå›´
- **ç¡¬ç¼–ç ä½ç½®**: 2584 å¤„
- **æ¶‰åŠæ–‡ä»¶**: 74 ä¸ª
- **æå–å†…å®¹**: 1945 ä¸ªï¼ˆå·²è¦†ç›–æ‰€æœ‰ç¡¬ç¼–ç ï¼‰
- **æœ€ç»ˆ keys**: 1939 ä¸ª

### è´¨é‡ç›®æ ‡
- âœ… **é”™è¯¯ç‡**: < 0.1%
- âœ… **è¦†ç›–ç‡**: 100%
- âœ… **ç±»å‹å®‰å…¨**: 100%
- âœ… **æµ‹è¯•é€šè¿‡**: 100%

---

## ğŸ† ä¸šç•Œæ ‡å‡† vs æˆ‘ä»¬çš„æ–¹æ¡ˆ

### ä¸šç•Œæ ‡å‡†æ–¹æ³•
1. **ç®€å•å­—ç¬¦ä¸²æ›¿æ¢**ï¼ˆsed/æ­£åˆ™ï¼‰
   - ä¼˜ç‚¹ï¼šå¿«é€Ÿ
   - ç¼ºç‚¹ï¼šå®¹æ˜“å‡ºé”™ï¼Œæ— æ³•å¤„ç†å¤æ‚æƒ…å†µ

2. **AST è§£ææ›¿æ¢**
   - ä¼˜ç‚¹ï¼šå‡†ç¡®
   - ç¼ºç‚¹ï¼šéœ€è¦å¤„ç†å¾ˆå¤šè¾¹ç•Œæƒ…å†µ

3. **æ‰‹åŠ¨æ›¿æ¢**
   - ä¼˜ç‚¹ï¼šç²¾ç¡®
   - ç¼ºç‚¹ï¼šè€—æ—¶ï¼Œå®¹æ˜“é—æ¼

### æˆ‘ä»¬çš„æ–¹æ¡ˆï¼šAST + AI å¢å¼º + å¤šå±‚éªŒè¯ â­â­â­â­â­

**è¶…è¶Šä¸šç•Œæ ‡å‡†çš„åœ°æ–¹**ï¼š
1. âœ… **AST ç²¾ç¡®è§£æ**ï¼šä½¿ç”¨ TypeScript ASTï¼Œ100% å‡†ç¡®
2. âœ… **AI æ™ºèƒ½éªŒè¯**ï¼šCursor AI å®¡æ ¸æ¯ä¸ªæ›¿æ¢
3. âœ… **å¤šå±‚å®‰å…¨æ£€æŸ¥**ï¼šæ›¿æ¢å‰ã€ä¸­ã€åä¸‰æ¬¡éªŒè¯
4. âœ… **ç±»å‹å®‰å…¨ä¿è¯**ï¼šè‡ªåŠ¨æ›´æ–° TypeScript ç±»å‹
5. âœ… **å¢é‡æ›¿æ¢**ï¼šæ–‡ä»¶çº§åŸå­æ“ä½œï¼Œå¯å›æ»š
6. âœ… **å®æ—¶æµ‹è¯•**ï¼šæ¯ä¸ªæ–‡ä»¶æ›¿æ¢åç«‹å³æµ‹è¯•

---

## ğŸ“‹ è¯¦ç»†æ‰§è¡Œè®¡åˆ’

### Phase 1: å‡†å¤‡é˜¶æ®µï¼ˆ5 åˆ†é’Ÿï¼‰

#### 1.1 ç¯å¢ƒå‡†å¤‡
```bash
# ç¡®è®¤å½“å‰çŠ¶æ€
git status
git log -1 --oneline

# ç¡®è®¤æå–ç»“æœå­˜åœ¨
ls -lh i18n_keys_mapping_fixed.json
ls -lh i18n_complete_final.json
ls -lh i18n_replacement_status.json  # æ›¿æ¢çŠ¶æ€æ–‡ä»¶
```

#### 1.2 åŠ è½½æ˜ å°„è¡¨å’ŒçŠ¶æ€
- è¯»å– `i18n_keys_mapping_fixed.json` - Key æ˜ å°„è¡¨
- è¯»å– `i18n_replacement_status.json` - æ›¿æ¢çŠ¶æ€ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- å»ºç«‹ï¼šåŸå§‹æ–‡æœ¬ â†’ i18n key çš„æ˜ å°„
- å»ºç«‹ï¼šæ–‡ä»¶è·¯å¾„ â†’ éœ€è¦æ›¿æ¢çš„åˆ—è¡¨
- **è·³è¿‡å·²æ›¿æ¢çš„å†…å®¹**ï¼ˆæ ¹æ®çŠ¶æ€æ–‡ä»¶ï¼‰

#### 1.3 åˆ†æç°æœ‰ i18n ä½¿ç”¨æ¨¡å¼
- æ£€æŸ¥å·²æœ‰ `i18n.t()` çš„ä½¿ç”¨æ–¹å¼
- ç¡®è®¤ `createI18n()` çš„è°ƒç”¨æ¨¡å¼
- ç¡®è®¤å‚æ•°ä¼ é€’æ–¹å¼

#### 1.4 å½“å‰çŠ¶æ€ç¡®è®¤

**æå–çŠ¶æ€**ï¼ˆæ ¹æ® `i18n_replacement_status.json`ï¼‰ï¼š
- `totalExtracted`: 1945 ä¸ªå†…å®¹
- `totalReplaced`: 20 ä¸ªï¼ˆ1.03%ï¼‰
- `totalPending`: 1925 ä¸ªï¼ˆ98.97%ï¼‰

**æ‰«æèŒƒå›´**ï¼š
- âœ… `src/telegram/handlers` - 44 ä¸ªæ–‡ä»¶
- âœ… `src/domain` - ä¸šåŠ¡é€»è¾‘å±‚
- âœ… `src/services` - æœåŠ¡å±‚
- âœ… `src/db` - æ•°æ®åº“ç›¸å…³ï¼ˆåŒ…æ‹¬ SQL æ–‡ä»¶ï¼‰

**é¢„æœŸè¾“å‡º**ï¼š
- æ˜ å°„è¡¨å·²åŠ è½½
- çŠ¶æ€æ–‡ä»¶å·²è¯»å–
- ä½¿ç”¨æ¨¡å¼å·²ç¡®è®¤
- æ›¿æ¢ç­–ç•¥å·²ç¡®å®š

---

### Phase 2: AST è§£æä¸æ›¿æ¢è„šæœ¬ï¼ˆ15 åˆ†é’Ÿï¼‰

#### 2.1 åˆ›å»º AST æ›¿æ¢å·¥å…·

**ä½¿ç”¨ TypeScript Compiler API**ï¼š
```typescript
import * as ts from 'typescript';

// ä¼˜åŠ¿ï¼š
// - 100% å‡†ç¡®è§£æ
// - ç†è§£ä»£ç ç»“æ„
// - ä¿æŒä»£ç æ ¼å¼
// - å¤„ç†å¤æ‚æƒ…å†µï¼ˆæ¨¡æ¿å­—ç¬¦ä¸²ã€å˜é‡æ’å€¼ç­‰ï¼‰
```

#### 2.2 æ›¿æ¢ç­–ç•¥

**ç­–ç•¥ Aï¼šç²¾ç¡®åŒ¹é…æ›¿æ¢**ï¼ˆä¸»è¦æ–¹æ³•ï¼‰
- ä½¿ç”¨ AST æ‰¾åˆ°å­—ç¬¦ä¸²å­—é¢é‡
- ç²¾ç¡®åŒ¹é…æå–çš„æ–‡æœ¬
- æ›¿æ¢ä¸º `i18n.t('key')`

**ç­–ç•¥ Bï¼šæ¨¡æ¿å­—ç¬¦ä¸²å¤„ç†**
- è¯†åˆ«æ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„ä¸­æ–‡
- æå–å˜é‡éƒ¨åˆ†
- æ›¿æ¢ä¸º `i18n.t('key', { param: value })`

**ç­–ç•¥ Cï¼šå­—ç¬¦ä¸²æ‹¼æ¥å¤„ç†**
- è¯†åˆ«å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆ`+` æ“ä½œç¬¦ï¼‰
- åˆå¹¶ä¸ºå®Œæ•´æ–‡æœ¬
- æ›¿æ¢ä¸ºå•ä¸ª `i18n.t()` è°ƒç”¨

#### 2.3 ç‰¹æ®Šæƒ…å†µå¤„ç†

**1. å˜é‡æ’å€¼**
```typescript
// åŸå§‹
`ğŸ‘‹ å—¨ï¼Œ${nickname}ï¼`

// æ›¿æ¢å
i18n.t('profile.greeting', { nickname })
```

**2. æ¡ä»¶è¡¨è¾¾å¼**
```typescript
// åŸå§‹
isVip ? 'VIP æœƒå“¡ ğŸ’' : 'å…è²»æœƒå“¡'

// æ›¿æ¢å
isVip ? i18n.t('common.vipMember') : i18n.t('common.freeMember')
```

**3. å¤šè¡Œå­—ç¬¦ä¸²**
```typescript
// åŸå§‹
'ç¬¬ä¸€è¡Œ\nç¬¬äºŒè¡Œ\nç¬¬ä¸‰è¡Œ'

// æ›¿æ¢å
i18n.t('message.multiline')
```

**4. æŒ‰é’®æ–‡å­—**
```typescript
// åŸå§‹
{ text: 'ğŸŒŠ ä¸Ÿå‡ºæ¼‚æµç“¶', callback_data: 'menu_throw' }

// æ›¿æ¢å
{ text: i18n.t('buttons.throwBottle'), callback_data: 'menu_throw' }
```

---

### Phase 3: AI æ™ºèƒ½éªŒè¯ï¼ˆ10 åˆ†é’Ÿï¼‰

#### 3.1 æ›¿æ¢å‰éªŒè¯

**ä½¿ç”¨ Cursor AI æ£€æŸ¥**ï¼š
- ç¡®è®¤æ›¿æ¢çš„ key å­˜åœ¨
- ç¡®è®¤å‚æ•°åŒ¹é…
- ç¡®è®¤ä¸Šä¸‹æ–‡æ­£ç¡®

**éªŒè¯è„šæœ¬**ï¼š
```typescript
// å¯¹æ¯ä¸ªæ›¿æ¢æ“ä½œï¼š
// 1. æ£€æŸ¥ key æ˜¯å¦åœ¨ i18n_keys_mapping_fixed.json ä¸­
// 2. æ£€æŸ¥å‚æ•°æ˜¯å¦åŒ¹é…ï¼ˆå¦‚æœæœ‰å˜é‡ï¼‰
// 3. ä½¿ç”¨ Cursor AI å®¡æ ¸æ›¿æ¢æ˜¯å¦æ­£ç¡®
```

#### 3.2 æ›¿æ¢ä¸­éªŒè¯

**å®æ—¶æ£€æŸ¥**ï¼š
- æ›¿æ¢åç«‹å³æ£€æŸ¥è¯­æ³•
- æ£€æŸ¥ç±»å‹é”™è¯¯
- æ£€æŸ¥å¯¼å…¥è¯­å¥

#### 3.3 æ›¿æ¢åéªŒè¯

**AI å®¡æ ¸æ¯ä¸ªæ–‡ä»¶**ï¼š
- ä½¿ç”¨ Cursor AI æ£€æŸ¥æ›¿æ¢åçš„ä»£ç 
- ç¡®è®¤é€»è¾‘æœªæ”¹å˜
- ç¡®è®¤æ ¼å¼æ­£ç¡®

---

### Phase 4: å¢é‡æ›¿æ¢ç­–ç•¥ï¼ˆ30 åˆ†é’Ÿï¼‰

#### 4.1 æ–‡ä»¶çº§åŸå­æ“ä½œ

**ç­–ç•¥**ï¼š
1. ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªæ–‡ä»¶
2. æ›¿æ¢åç«‹å³æµ‹è¯•
3. é€šè¿‡åæäº¤ï¼Œå¤±è´¥åˆ™å›æ»š

**æµç¨‹**ï¼š
```bash
for file in files:
  1. git checkout file  # ç¡®ä¿å¹²å‡€çŠ¶æ€
  2. è¿è¡Œ AST æ›¿æ¢
  3. è¿è¡Œ lint æ£€æŸ¥
  4. è¿è¡Œç±»å‹æ£€æŸ¥
  5. è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆå¦‚æœæœ‰ï¼‰
  6. å¦‚æœé€šè¿‡ -> git add file
  7. å¦‚æœå¤±è´¥ -> git checkout fileï¼ˆå›æ»šï¼‰
```

#### 4.2 ä¼˜å…ˆçº§é¡ºåº

**é«˜ä¼˜å…ˆçº§**ï¼ˆç”¨æˆ·æœ€å¸¸çœ‹åˆ°çš„ï¼‰ï¼š
1. `menu.ts` - ä¸»èœå•
2. `catch.ts` - æ¡ç“¶å­
3. `throw.ts` - ä¸¢ç“¶å­
4. `profile.ts` - ä¸ªäººèµ„æ–™
5. `stats.ts` - ç»Ÿè®¡æ•°æ®

**ä¸­ä¼˜å…ˆçº§**ï¼š
6. `onboarding_*.ts` - æ³¨å†Œæµç¨‹
7. `settings.ts` - è®¾ç½®
8. `help.ts` - å¸®åŠ©

**ä½ä¼˜å…ˆçº§**ï¼š
9. `admin_*.ts` - ç®¡ç†å‘˜åŠŸèƒ½
10. å…¶ä»–åŠŸèƒ½

#### 4.3 æ‰¹é‡å¤„ç†

**å°æ‰¹é‡ç­–ç•¥**ï¼š
- æ¯æ¬¡å¤„ç† 5-10 ä¸ªæ–‡ä»¶
- æ¯æ‰¹å®Œæˆåæµ‹è¯•
- é€šè¿‡åç»§ç»­ä¸‹ä¸€æ‰¹

---

### Phase 5: ç±»å‹å®‰å…¨æ›´æ–°ï¼ˆ10 åˆ†é’Ÿï¼‰

#### 5.1 æ›´æ–° types.ts

**è‡ªåŠ¨ç”Ÿæˆç±»å‹å®šä¹‰**ï¼š
```typescript
// ä» i18n_keys_mapping_fixed.json ç”Ÿæˆ
// ç¡®ä¿æ‰€æœ‰ key éƒ½æœ‰ç±»å‹å®šä¹‰
```

#### 5.2 ç±»å‹æ£€æŸ¥

**éªŒè¯**ï¼š
- æ‰€æœ‰ `i18n.t()` è°ƒç”¨çš„ key éƒ½æœ‰ç±»å‹
- TypeScript ç¼–è¯‘æ— é”™è¯¯
- æ—  `any` ç±»å‹

---

### Phase 6: Locale æ–‡ä»¶ç”Ÿæˆï¼ˆ10 åˆ†é’Ÿï¼‰

#### 6.1 ç”Ÿæˆ zh-TW.ts

**ä»æå–ç»“æœç”Ÿæˆ**ï¼š
```typescript
// ä» i18n_complete_final.json ç”Ÿæˆ
// åµŒå¥—å¯¹è±¡ç»“æ„
// åŒ…å«æ‰€æœ‰ 1945 ä¸ªå†…å®¹
```

#### 6.2 éªŒè¯å®Œæ•´æ€§

**æ£€æŸ¥**ï¼š
- æ‰€æœ‰ key éƒ½æœ‰å¯¹åº”çš„ç¿»è¯‘
- æ— ç¼ºå¤±çš„ key
- æ ¼å¼æ­£ç¡®

---

### Phase 7: æµ‹è¯•éªŒè¯ï¼ˆ20 åˆ†é’Ÿï¼‰

#### 7.1 è¯­æ³•æ£€æŸ¥
```bash
pnpm lint
```

#### 7.2 ç±»å‹æ£€æŸ¥
```bash
pnpm type-check
# æˆ–
tsc --noEmit
```

#### 7.3 å•å…ƒæµ‹è¯•
```bash
pnpm test
```

#### 7.4 Smoke Test
```bash
pnpm smoke-test
```

#### 7.5 ç¡¬ç¼–ç æ£€æŸ¥
```bash
npx tsx scripts/verify-no-hardcoded-chinese.ts
# åº”è¯¥æ˜¾ç¤ºï¼š0 ä¸ªé—æ¼
```

---

### Phase 8: AI æœ€ç»ˆå®¡æ ¸ï¼ˆ10 åˆ†é’Ÿï¼‰

#### 8.1 ä»£ç å®¡æŸ¥

**ä½¿ç”¨ Cursor AI å®¡æŸ¥**ï¼š
- éšæœºæŠ½æŸ¥ 10-20 ä¸ªæ–‡ä»¶
- ç¡®è®¤æ›¿æ¢æ­£ç¡®
- ç¡®è®¤æ— é—æ¼
- ç¡®è®¤æ— é”™è¯¯

#### 8.2 é€»è¾‘éªŒè¯

**AI æ£€æŸ¥**ï¼š
- ä¸šåŠ¡é€»è¾‘æœªæ”¹å˜
- å‚æ•°ä¼ é€’æ­£ç¡®
- é”™è¯¯å¤„ç†å®Œæ•´

---

## ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶

### 1. å¤šå±‚å¤‡ä»½
- âœ… Git æäº¤å‰å¤‡ä»½
- âœ… æ¯ä¸ªæ–‡ä»¶æ›¿æ¢å‰å¤‡ä»½
- âœ… æ¯æ‰¹æ›¿æ¢åå¤‡ä»½

### 2. åŸå­æ“ä½œ
- âœ… æ–‡ä»¶çº§åŸå­æ›¿æ¢
- âœ… å¤±è´¥ç«‹å³å›æ»š
- âœ… ä¸ç•™ä¸‹éƒ¨åˆ†æ›¿æ¢çš„æ–‡ä»¶

### 3. å®æ—¶éªŒè¯
- âœ… æ›¿æ¢åç«‹å³ lint
- âœ… æ›¿æ¢åç«‹å³ç±»å‹æ£€æŸ¥
- âœ… æ›¿æ¢åç«‹å³æµ‹è¯•

### 4. AI å¢å¼ºï¼ˆCursor AIï¼‰
- âœ… **æ›¿æ¢å‰ AI åˆ†æ**ï¼šåˆ†æä»£ç ä¸Šä¸‹æ–‡ï¼Œç¡®è®¤æ›¿æ¢ä½ç½®
- âœ… **æ›¿æ¢ä¸­ AI å®æ—¶éªŒè¯**ï¼šæ¯ä¸ªæ›¿æ¢åç«‹å³éªŒè¯
- âœ… **æ›¿æ¢å AI å…¨é¢å®¡æŸ¥**ï¼šå®¡æŸ¥æ•´ä¸ªæ–‡ä»¶
- âœ… **AI æ™ºèƒ½ä¿®å¤**ï¼šè‡ªåŠ¨ä¿®å¤å¸¸è§é”™è¯¯
- âœ… **AI é—æ¼æ£€æµ‹**ï¼šæ‰«ææœªæ›¿æ¢çš„ç¡¬ç¼–ç 

### 5. å›æ»šæœºåˆ¶
- âœ… å•æ–‡ä»¶å›æ»š
- âœ… æ‰¹é‡å›æ»š
- âœ… å®Œæ•´å›æ»šåˆ°å¤‡ä»½åˆ†æ”¯

---

## ğŸ”§ æŠ€æœ¯å®ç°

### AST æ›¿æ¢å·¥å…·æ¶æ„

```typescript
interface Replacement {
  original: string;      // åŸå§‹æ–‡æœ¬
  key: string;           // i18n key
  file: string;          // æ–‡ä»¶è·¯å¾„
  line: number;          // è¡Œå·
  context: string;       // ä¸Šä¸‹æ–‡
  params?: string[];     // å‚æ•°åˆ—è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰
  type: 'string' | 'template' | 'button'; // ç±»å‹
}

class ASTReplacer {
  private mappings: Map<string, Replacement>;
  
  // 1. è§£ææ–‡ä»¶ä¸º AST
  parseFile(filePath: string): ts.SourceFile {
    const content = fs.readFileSync(filePath, 'utf-8');
    return ts.createSourceFile(
      filePath,
      content,
      ts.ScriptTarget.Latest,
      true
    );
  }
  
  // 2. æŸ¥æ‰¾éœ€è¦æ›¿æ¢çš„èŠ‚ç‚¹ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
  findReplacements(
    sourceFile: ts.SourceFile,
    mappings: Replacement[]
  ): Array<{ node: ts.Node; replacement: Replacement }> {
    const results: Array<{ node: ts.Node; replacement: Replacement }> = [];
    
    const visit = (node: ts.Node) => {
      // å­—ç¬¦ä¸²å­—é¢é‡
      if (ts.isStringLiteral(node)) {
        const text = node.text;
        const match = mappings.find(m => m.original === text);
        if (match) {
          results.push({ node, replacement: match });
        }
      }
      
      // æ¨¡æ¿å­—ç¬¦ä¸²
      if (ts.isTemplateExpression(node)) {
        // å¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„ä¸­æ–‡
        // ...
      }
      
      ts.forEachChild(node, visit);
    };
    
    visit(sourceFile);
    return results;
  }
  
  // 3. æ‰§è¡Œæ›¿æ¢ï¼ˆä¿æŒä»£ç æ ¼å¼ï¼‰
  replace(
    sourceFile: ts.SourceFile,
    replacements: Array<{ node: ts.Node; replacement: Replacement }>
  ): string {
    const printer = ts.createPrinter();
    const transformer = (context: ts.TransformationContext) => {
      return (sourceFile: ts.SourceFile) => {
        const visitor = (node: ts.Node): ts.Node => {
          const replacement = replacements.find(r => r.node === node);
          if (replacement) {
            // åˆ›å»º i18n.t() è°ƒç”¨
            return this.createI18nCall(replacement.replacement);
          }
          return ts.visitEachChild(node, visitor, context);
        };
        return ts.visitNode(sourceFile, visitor);
      };
    };
    
    const result = ts.transform(sourceFile, [transformer]);
    return printer.printFile(result.transformed[0]);
  }
  
  // 4. åˆ›å»º i18n.t() è°ƒç”¨èŠ‚ç‚¹
  private createI18nCall(replacement: Replacement): ts.CallExpression {
    // ç”Ÿæˆ i18n.t('key', { params })
    // ...
  }
  
  // 5. éªŒè¯æ›¿æ¢
  async verify(
    filePath: string,
    originalCode: string,
    newCode: string
  ): Promise<{ valid: boolean; errors: string[] }> {
    // è¯­æ³•æ£€æŸ¥
    // ç±»å‹æ£€æŸ¥
    // AI éªŒè¯
  }
}
```

### AI éªŒè¯é›†æˆï¼ˆCursor AIï¼‰

```typescript
/**
 * ä½¿ç”¨ Cursor AI éªŒè¯æ›¿æ¢
 * ä¸éœ€è¦ API Keyï¼Œä½¿ç”¨ Cursor å†…ç½® AI
 */
async function aiVerifyReplacement(
  filePath: string,
  originalLine: string,
  newLine: string,
  context: {
    before: string;  // å‰ 5 è¡Œ
    after: string;   // å 5 è¡Œ
    functionName: string;
  }
): Promise<{
  correct: boolean;
  confidence: number;
  issues?: string[];
  suggestion?: string;
}> {
  // ä½¿ç”¨ Cursor AI åˆ†æï¼š
  // 1. æ›¿æ¢æ˜¯å¦æ­£ç¡®
  // 2. é€»è¾‘æ˜¯å¦æ”¹å˜
  // 3. å‚æ•°æ˜¯å¦åŒ¹é…
  // 4. ç±»å‹æ˜¯å¦å®‰å…¨
  
  // è¿”å›éªŒè¯ç»“æœ
}
```

### æ™ºèƒ½å¯¼å…¥ç®¡ç†

```typescript
class ImportManager {
  // ç¡®ä¿æ–‡ä»¶æœ‰ i18n import
  ensureI18nImport(content: string): string {
    if (!content.includes("import { createI18n }")) {
      // æ‰¾åˆ°æœ€åä¸€ä¸ª import
      // æ·»åŠ  i18n import
    }
  }
  
  // ç¡®ä¿æœ‰ i18n å®ä¾‹
  ensureI18nInstance(
    content: string,
    functionName: string
  ): string {
    // æ£€æŸ¥å‡½æ•°ä¸­æ˜¯å¦æœ‰ i18n å®ä¾‹
    // å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ ï¼šconst i18n = createI18n(user.language_pref || 'zh-TW');
  }
}
```

---

## ğŸ“Š æ‰§è¡Œæ—¶é—´ä¼°ç®—

| é˜¶æ®µ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| Phase 1: å‡†å¤‡ | 5 åˆ†é’Ÿ | åŠ è½½æ˜ å°„è¡¨ã€åˆ†ææ¨¡å¼ |
| Phase 2: AST å·¥å…· | 15 åˆ†é’Ÿ | å¼€å‘æ›¿æ¢è„šæœ¬ |
| Phase 3: AI éªŒè¯ | 10 åˆ†é’Ÿ | é›†æˆ Cursor AI éªŒè¯ |
| Phase 4: å¢é‡æ›¿æ¢ | 30 åˆ†é’Ÿ | æ–‡ä»¶çº§æ›¿æ¢ï¼ˆ74 ä¸ªæ–‡ä»¶ï¼‰ |
| Phase 5: ç±»å‹æ›´æ–° | 10 åˆ†é’Ÿ | æ›´æ–° types.ts |
| Phase 6: Locale ç”Ÿæˆ | 10 åˆ†é’Ÿ | ç”Ÿæˆ zh-TW.ts |
| Phase 7: æµ‹è¯•éªŒè¯ | 20 åˆ†é’Ÿ | å…¨é¢æµ‹è¯• |
| Phase 8: AI å®¡æ ¸ | 10 åˆ†é’Ÿ | Cursor AI æœ€ç»ˆå®¡æŸ¥ |
| **æ€»è®¡** | **2 å°æ—¶** | |

**å¯¹æ¯”ä¸šç•Œæ ‡å‡†**ï¼š
- ä¸šç•Œæ ‡å‡†ï¼š4-6 å°æ—¶ï¼ˆæ‰‹åŠ¨æˆ–ç®€å•æ›¿æ¢ï¼‰
- æˆ‘ä»¬çš„æ–¹æ¡ˆï¼š2 å°æ—¶ï¼ˆAST + AI å¢å¼ºï¼‰
- **æ•ˆç‡æå‡ï¼š50-66%** â­â­â­â­â­

---

## âœ… æ£€æŸ¥æ¸…å•

### æ›¿æ¢å‰
- [ ] å¤‡ä»½å·²åˆ›å»º
- [ ] æ˜ å°„è¡¨å·²åŠ è½½
- [ ] ä½¿ç”¨æ¨¡å¼å·²ç¡®è®¤
- [ ] AST å·¥å…·å·²æµ‹è¯•

### æ›¿æ¢ä¸­
- [ ] æ¯ä¸ªæ–‡ä»¶æ›¿æ¢åç«‹å³éªŒè¯
- [ ] å¤±è´¥ç«‹å³å›æ»š
- [ ] é€šè¿‡åç«‹å³æäº¤

### æ›¿æ¢å
- [ ] æ‰€æœ‰æ–‡ä»¶å·²æ›¿æ¢
- [ ] ç±»å‹æ£€æŸ¥é€šè¿‡
- [ ] Lint æ£€æŸ¥é€šè¿‡
- [ ] æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] ç¡¬ç¼–ç æ£€æŸ¥ï¼š0 ä¸ªé—æ¼
- [ ] AI å®¡æ ¸é€šè¿‡

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### å¿…é¡»è¾¾åˆ°
- âœ… ç¡¬ç¼–ç ï¼š0 å¤„ï¼ˆ100% æ›¿æ¢ï¼‰
- âœ… ç±»å‹é”™è¯¯ï¼š0 ä¸ª
- âœ… Lint é”™è¯¯ï¼š0 ä¸ª
- âœ… æµ‹è¯•å¤±è´¥ï¼š0 ä¸ª
- âœ… åŠŸèƒ½æ­£å¸¸ï¼š100%

### è´¨é‡æŒ‡æ ‡
- âœ… æ›¿æ¢å‡†ç¡®ç‡ï¼š> 99.9%
- âœ… ä»£ç å¯è¯»æ€§ï¼šä¿æŒæˆ–æå‡
- âœ… æ€§èƒ½å½±å“ï¼š< 50ms
- âœ… ç±»å‹å®‰å…¨ï¼š100%

---

## ğŸ“„ è¾“å‡ºæ–‡ä»¶

### æ›¿æ¢åç”Ÿæˆ
- `src/i18n/locales/zh-TW.ts` - å®Œæ•´çš„ zh-TW ç¿»è¯‘
- `src/i18n/types.ts` - æ›´æ–°çš„ç±»å‹å®šä¹‰
- `i18n_replacement_status.json` - æ›¿æ¢çŠ¶æ€æ–‡ä»¶ï¼ˆæ›´æ–°ï¼‰

### éªŒè¯æŠ¥å‘Š
- `replacement_verification.json` - æ›¿æ¢éªŒè¯ç»“æœ
- `ai_review_report.json` - AI å®¡æ ¸æŠ¥å‘Š

### çŠ¶æ€è·Ÿè¸ªæ–‡ä»¶
- `i18n_complete_final_with_status.json` - å¸¦çŠ¶æ€çš„æå–ç»“æœ
- `i18n_replacement_status.json` - æ›¿æ¢çŠ¶æ€ï¼ˆå·²æ›¿æ¢/å¾…æ›¿æ¢åˆ—è¡¨ï¼‰

---

## ğŸ“Š å½“å‰çŠ¶æ€ï¼ˆ2025-01-23ï¼‰

### æå–çŠ¶æ€
- âœ… **å·²æå–**: 1945 ä¸ªå†…å®¹
- âœ… **å·²ç”Ÿæˆ keys**: 1939 ä¸ªå”¯ä¸€ keys
- âœ… **æ‰«ææ–‡ä»¶**: 177 ä¸ªæ–‡ä»¶
- âœ… **æ‰«æç›®å½•**: handlers, domain, services, db

### æ›¿æ¢çŠ¶æ€
- âœ… **å·²æ›¿æ¢**: 20 ä¸ªï¼ˆ1.03%ï¼‰
- âŒ **å¾…æ›¿æ¢**: 1925 ä¸ªï¼ˆ98.97%ï¼‰
- âŒ **æ•°æ®åº“**: æœªæ›´æ–°ï¼ˆæ•°æ®ä»ç„¶æ˜¯ä¸­æ–‡ï¼‰

### æ•°æ®åº“ç¡¬ç¼–ç 
- âœ… **å·²æå–**: SQL æ–‡ä»¶ä¸­çš„ä¸­æ–‡å·²å…¨éƒ¨æå–
- âŒ **æœªæ›¿æ¢**: æ•°æ®åº“ä¸­çš„æ•°æ®ä»ç„¶æ˜¯ä¸­æ–‡
- âŒ **æœªç”Ÿæˆè¿ç§»è„šæœ¬**: éœ€è¦ç”Ÿæˆè¿ç§»è„šæœ¬æ›´æ–°æ•°æ®åº“

---

## âš ï¸ é£é™©ä¸åº”å¯¹

### é£é™© 1: æ›¿æ¢é”™è¯¯
**åº”å¯¹**ï¼š
- âœ… AST ç²¾ç¡®è§£æï¼ˆTypeScript Compiler APIï¼‰
- âœ… AI éªŒè¯æ¯ä¸ªæ›¿æ¢ï¼ˆCursor AI å®¡æ ¸ï¼‰
- âœ… å®æ—¶æµ‹è¯•ï¼ˆæ›¿æ¢åç«‹å³éªŒè¯ï¼‰
- âœ… å¤šå±‚éªŒè¯ï¼ˆè¯­æ³•ã€ç±»å‹ã€é€»è¾‘ï¼‰

### é£é™© 2: é—æ¼æ›¿æ¢
**åº”å¯¹**ï¼š
- âœ… æ›¿æ¢åç¡¬ç¼–ç æ£€æŸ¥ï¼ˆè‡ªåŠ¨è„šæœ¬ï¼‰
- âœ… AI æ‰«æé—æ¼ï¼ˆCursor AI å…¨æ–‡ä»¶æ‰«æï¼‰
- âœ… äººå·¥æŠ½æŸ¥ï¼ˆéšæœº 10% æ–‡ä»¶ï¼‰
- âœ… è¦†ç›–ç‡æŠ¥å‘Šï¼ˆç¡®ä¿ 100%ï¼‰

### é£é™© 3: ç±»å‹é”™è¯¯
**åº”å¯¹**ï¼š
- âœ… è‡ªåŠ¨æ›´æ–° types.tsï¼ˆä» keys ç”Ÿæˆï¼‰
- âœ… TypeScript ä¸¥æ ¼æ£€æŸ¥ï¼ˆ`strict: true`ï¼‰
- âœ… ç¼–è¯‘éªŒè¯ï¼ˆ`tsc --noEmit`ï¼‰
- âœ… ç±»å‹å®‰å…¨ä¿è¯ï¼ˆæ‰€æœ‰ key éƒ½æœ‰ç±»å‹ï¼‰

### é£é™© 4: é€»è¾‘ç ´å
**åº”å¯¹**ï¼š
- âœ… AI æ£€æŸ¥é€»è¾‘æ­£ç¡®æ€§ï¼ˆCursor AI åˆ†æï¼‰
- âœ… å…¨é¢æµ‹è¯•ï¼ˆå•å…ƒæµ‹è¯• + Smoke Testï¼‰
- âœ… ç°åº¦å‘å¸ƒï¼ˆå…ˆåœ¨ staging æµ‹è¯•ï¼‰
- âœ… å›æ»šæœºåˆ¶ï¼ˆ5 åˆ†é’Ÿå†…å¯å›æ»šï¼‰

### é£é™© 5: æ€§èƒ½å½±å“
**åº”å¯¹**ï¼š
- âœ… æ€§èƒ½æµ‹è¯•ï¼ˆå“åº”æ—¶é—´ < 50msï¼‰
- âœ… ç¼“å­˜ä¼˜åŒ–ï¼ˆi18n ç»“æœç¼“å­˜ï¼‰
- âœ… ç›‘æ§æŒ‡æ ‡ï¼ˆå®æ—¶ç›‘æ§ï¼‰

### é£é™© 6: å¯¼å…¥ç¼ºå¤±
**åº”å¯¹**ï¼š
- âœ… è‡ªåŠ¨æ·»åŠ  importï¼ˆImportManagerï¼‰
- âœ… è‡ªåŠ¨æ·»åŠ  i18n å®ä¾‹ï¼ˆç¡®ä¿æ¯ä¸ªå‡½æ•°éƒ½æœ‰ï¼‰
- âœ… éªŒè¯è„šæœ¬ï¼ˆæ£€æŸ¥æ‰€æœ‰æ–‡ä»¶ï¼‰

---

## ğŸ¤– Cursor AI å¢å¼ºåŠŸèƒ½

### 1. æ›¿æ¢å‰ AI åˆ†æ
**åŠŸèƒ½**ï¼š
- åˆ†æä»£ç ä¸Šä¸‹æ–‡
- ç¡®è®¤æ›¿æ¢ä½ç½®æ­£ç¡®
- æ£€æŸ¥æ˜¯å¦æœ‰å‰¯ä½œç”¨

**Prompt ç¤ºä¾‹**ï¼š
```
åˆ†æä»¥ä¸‹ä»£ç æ›¿æ¢æ˜¯å¦å®‰å…¨ï¼š

åŸå§‹ä»£ç ï¼š
${originalCode}

æ›¿æ¢åï¼š
${newCode}

ä¸Šä¸‹æ–‡ï¼š
- æ–‡ä»¶ï¼š${filePath}
- å‡½æ•°ï¼š${functionName}
- è¡Œå·ï¼š${lineNumber}

è¯·æ£€æŸ¥ï¼š
1. æ›¿æ¢æ˜¯å¦æ­£ç¡®
2. é€»è¾‘æ˜¯å¦æ”¹å˜
3. å‚æ•°æ˜¯å¦åŒ¹é…
4. ç±»å‹æ˜¯å¦å®‰å…¨
```

### 2. æ›¿æ¢ä¸­ AI å®æ—¶éªŒè¯
**åŠŸèƒ½**ï¼š
- æ¯ä¸ªæ›¿æ¢åç«‹å³éªŒè¯
- å‘ç°é”™è¯¯ç«‹å³åœæ­¢
- æä¾›ä¿®å¤å»ºè®®

### 3. æ›¿æ¢å AI å…¨é¢å®¡æŸ¥
**åŠŸèƒ½**ï¼š
- å®¡æŸ¥æ•´ä¸ªæ–‡ä»¶
- æ£€æŸ¥é€»è¾‘å®Œæ•´æ€§
- éªŒè¯ç±»å‹å®‰å…¨
- ç¡®è®¤æ— é—æ¼

### 4. AI æ™ºèƒ½ä¿®å¤
**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨ä¿®å¤å¸¸è§é”™è¯¯
- ä¼˜åŒ–ä»£ç ç»“æ„
- æ”¹è¿›å¯è¯»æ€§

---

## ğŸ“Š è´¨é‡ä¿è¯æµç¨‹

### æ›¿æ¢å‰æ£€æŸ¥ï¼ˆPre-Replacementï¼‰
1. âœ… å¤‡ä»½æ–‡ä»¶
2. âœ… åŠ è½½æ˜ å°„è¡¨
3. âœ… AI åˆ†ææ›¿æ¢è®¡åˆ’
4. âœ… ç¡®è®¤æ— å†²çª

### æ›¿æ¢ä¸­æ£€æŸ¥ï¼ˆDuring Replacementï¼‰
1. âœ… AST ç²¾ç¡®è§£æ
2. âœ… å®æ—¶è¯­æ³•æ£€æŸ¥
3. âœ… AI éªŒè¯æ¯ä¸ªæ›¿æ¢
4. âœ… å¤±è´¥ç«‹å³å›æ»š

### æ›¿æ¢åæ£€æŸ¥ï¼ˆPost-Replacementï¼‰
1. âœ… è¯­æ³•æ£€æŸ¥ï¼ˆlintï¼‰
2. âœ… ç±»å‹æ£€æŸ¥ï¼ˆtscï¼‰
3. âœ… é€»è¾‘æ£€æŸ¥ï¼ˆAIï¼‰
4. âœ… æµ‹è¯•éªŒè¯ï¼ˆtestï¼‰
5. âœ… ç¡¬ç¼–ç æ£€æŸ¥ï¼ˆ0 ä¸ªé—æ¼ï¼‰

### æœ€ç»ˆæ£€æŸ¥ï¼ˆFinal Verificationï¼‰
1. âœ… AI å…¨é¢å®¡æŸ¥
2. âœ… äººå·¥æŠ½æŸ¥
3. âœ… æ€§èƒ½æµ‹è¯•
4. âœ… å®Œæ•´ Smoke Test

---

## ğŸš€ æ‰§è¡Œé¡ºåºå»ºè®®ï¼ˆæ¨èæµç¨‹ï¼‰

### æ¨èé¡ºåºï¼šå…ˆæ›¿æ¢ï¼Œå†ç¿»è¯‘ï¼Œå†æµ‹è¯•

**ç†ç”±**ï¼š
1. âœ… æ›¿æ¢åä»£ç å·²ç»ä½¿ç”¨ `i18n.t()`ï¼Œå¯¼å…¥ç¿»è¯‘åç«‹å³ç”Ÿæ•ˆ
2. âœ… å¯ä»¥å…ˆæµ‹è¯•æ›¿æ¢æ˜¯å¦æ­£ç¡®ï¼ˆä½¿ç”¨ zh-TW ç¿»è¯‘ï¼‰
3. âœ… å¯¼å…¥è‹±æ–‡ç¿»è¯‘åï¼Œå¯ä»¥ç«‹å³æµ‹è¯•ä¸­è‹±æ–‡åˆ‡æ¢
4. âœ… å¦‚æœæ›¿æ¢æœ‰é—®é¢˜ï¼Œå¯ä»¥å›æ»šï¼Œç¿»è¯‘å·¥ä½œä¸ä¼šç™½è´¹ï¼ˆCSV æ–‡ä»¶è¿˜åœ¨ï¼‰

### è¯¦ç»†æ‰§è¡Œæ­¥éª¤

#### Step 1: å®‰å…¨å¤‡ä»½ï¼ˆ5 åˆ†é’Ÿï¼‰âœ… å¿…é¡»

```bash
# 1. åˆ›å»ºå¤‡ä»½åˆ†æ”¯
git checkout -b backup-before-i18n-replacement-$(date +%Y%m%d)
git push origin backup-before-i18n-replacement-$(date +%Y%m%d)

# 2. æœ¬åœ°å¤‡ä»½
pnpm backup

# 3. æ¨é€åˆ° GitHub
pnpm backup:push

# 4. å›åˆ°ä¸»åˆ†æ”¯
git checkout main
```

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] å¤‡ä»½åˆ†æ”¯å·²åˆ›å»º
- [ ] æœ¬åœ°å¤‡ä»½å·²å®Œæˆ
- [ ] å·²æ¨é€åˆ° GitHub
- [ ] å¯ä»¥éšæ—¶å›æ»š

#### Step 2: æ‰§è¡Œä»£ç æ›¿æ¢ï¼ˆ2 å°æ—¶ï¼‰

**æŒ‰ç…§ Phase 1-8 æ‰§è¡Œæ›¿æ¢**ï¼š
1. å¼€å‘ AST æ›¿æ¢å·¥å…·
2. æ‰§è¡Œæ›¿æ¢ï¼ˆ74 ä¸ªæ–‡ä»¶ï¼‰
3. ç”Ÿæˆ `zh-TW.ts` locale æ–‡ä»¶
4. æ›´æ–° `types.ts`
5. æµ‹è¯•éªŒè¯

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] æ‰€æœ‰ç¡¬ç¼–ç å·²æ›¿æ¢ä¸º `i18n.t()`
- [ ] `zh-TW.ts` å·²ç”Ÿæˆï¼ˆåŒ…å«æ‰€æœ‰ç¿»è¯‘ï¼‰
- [ ] `types.ts` å·²æ›´æ–°
- [ ] `pnpm lint` é€šè¿‡
- [ ] `pnpm typecheck` é€šè¿‡
- [ ] `pnpm test` é€šè¿‡
- [ ] `pnpm check:i18n` æ˜¾ç¤º 0 ä¸ªç¡¬ç¼–ç ï¼ˆæˆ–åªæœ‰å…è®¸çš„ï¼‰

#### Step 3: æµ‹è¯•ä¸­æ–‡ç‰ˆæœ¬ï¼ˆ10 åˆ†é’Ÿï¼‰

**éªŒè¯æ›¿æ¢æ˜¯å¦æ­£ç¡®**ï¼š
```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# 2. æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½ï¼ˆä½¿ç”¨ä¸­æ–‡ï¼‰
# - å¯åŠ¨æµç¨‹
# - ä¸»èœå•
# - ä¸¢ç“¶å­
# - æ¡ç“¶å­
# - ä¸ªäººèµ„æ–™
# - è®¾ç½®
```

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼ˆä¸­æ–‡æ˜¾ç¤ºï¼‰
- [ ] æ²¡æœ‰é”™è¯¯æ¶ˆæ¯
- [ ] æ²¡æœ‰å´©æºƒ
- [ ] UI æ˜¾ç¤ºæ­£å¸¸

**å¦‚æœæµ‹è¯•å¤±è´¥**ï¼š
```bash
# ç«‹å³å›æ»š
git checkout backup-before-i18n-replacement-*
# æˆ–
git reset --hard HEAD~1
```

#### Step 4: å¯¼å…¥è‹±æ–‡ç¿»è¯‘ï¼ˆ5 åˆ†é’Ÿï¼‰

**ä» CSV å¯¼å…¥è‹±æ–‡ç¿»è¯‘**ï¼š
```bash
# 1. ç¡®è®¤ CSV æ–‡ä»¶å­˜åœ¨
ls -lh i18n_for_translation.csv

# 2. å¯¼å…¥è‹±æ–‡ç¿»è¯‘
npx tsx scripts/i18n-import-selected-languages.ts en

# æˆ–ä½¿ç”¨é€šç”¨å¯¼å…¥è„šæœ¬
npx tsx scripts/i18n-import-from-csv.ts i18n_for_translation.csv en
```

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] `src/i18n/locales/en.ts` å·²æ›´æ–°
- [ ] æ‰€æœ‰ keys éƒ½æœ‰è‹±æ–‡ç¿»è¯‘
- [ ] æ²¡æœ‰ç¼ºå¤±çš„ç¿»è¯‘

#### Step 5: æµ‹è¯•ä¸­è‹±æ–‡åˆ‡æ¢ï¼ˆ15 åˆ†é’Ÿï¼‰

**éªŒè¯è¯­è¨€åˆ‡æ¢åŠŸèƒ½**ï¼š
```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# 2. æµ‹è¯•è¯­è¨€åˆ‡æ¢
# - æ–°ç”¨æˆ·ï¼šé€‰æ‹©è‹±æ–‡
# - è€ç”¨æˆ·ï¼šåœ¨è®¾ç½®ä¸­åˆ‡æ¢è¯­è¨€
# - éªŒè¯æ‰€æœ‰é¡µé¢éƒ½æ˜¾ç¤ºè‹±æ–‡
```

**æµ‹è¯•åœºæ™¯**ï¼š
- [ ] æ–°ç”¨æˆ·é€‰æ‹©è‹±æ–‡ â†’ æ‰€æœ‰æ¶ˆæ¯éƒ½æ˜¯è‹±æ–‡
- [ ] è€ç”¨æˆ·åˆ‡æ¢è¯­è¨€ â†’ ç«‹å³ç”Ÿæ•ˆ
- [ ] ä¸»èœå• â†’ è‹±æ–‡
- [ ] ä¸¢ç“¶å­ â†’ è‹±æ–‡
- [ ] æ¡ç“¶å­ â†’ è‹±æ–‡
- [ ] ä¸ªäººèµ„æ–™ â†’ è‹±æ–‡
- [ ] è®¾ç½® â†’ è‹±æ–‡
- [ ] é”™è¯¯æ¶ˆæ¯ â†’ è‹±æ–‡

**å¦‚æœæµ‹è¯•å¤±è´¥**ï¼š
```bash
# å›æ»šåˆ° Step 2 ä¹‹åçš„çŠ¶æ€ï¼ˆæ›¿æ¢å®Œæˆï¼Œä½†åªæœ‰ä¸­æ–‡ï¼‰
git checkout backup-after-replacement-zh-TW-only
```

#### Step 6: å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œç¿»è¯‘å…¶ä»–è¯­è¨€ï¼ˆå¯é€‰ï¼‰

**å¦‚æœä¸­è‹±æ–‡åˆ‡æ¢æµ‹è¯•é€šè¿‡**ï¼š
1. ç¿»è¯‘å…¶ä»– 32 ç§è¯­è¨€
2. å¯¼å…¥æ‰€æœ‰è¯­è¨€ç¿»è¯‘
3. æµ‹è¯•æ‰€æœ‰è¯­è¨€åˆ‡æ¢

---

## ğŸ”„ å›æ»šç­–ç•¥

### å›æ»šç‚¹ 1: æ›¿æ¢åï¼ˆStep 2 ä¹‹åï¼‰

**å¦‚æœæ›¿æ¢æœ‰é—®é¢˜**ï¼š
```bash
# å›æ»šåˆ°æ›¿æ¢å‰
git checkout backup-before-i18n-replacement-*
```

### å›æ»šç‚¹ 2: å¯¼å…¥è‹±æ–‡åï¼ˆStep 4 ä¹‹åï¼‰

**å¦‚æœè‹±æ–‡ç¿»è¯‘æœ‰é—®é¢˜**ï¼š
```bash
# å›æ»šåˆ°åªæœ‰ä¸­æ–‡çš„çŠ¶æ€
git checkout backup-after-replacement-zh-TW-only
```

### å›æ»šç‚¹ 3: æµ‹è¯•å¤±è´¥ï¼ˆStep 5 ä¹‹åï¼‰

**å¦‚æœä¸­è‹±æ–‡åˆ‡æ¢æœ‰é—®é¢˜**ï¼š
```bash
# å›æ»šåˆ°å¯¼å…¥è‹±æ–‡å‰çš„çŠ¶æ€
git checkout backup-after-replacement-zh-TW-only
```

---

## ğŸ“‹ å®Œæ•´æ‰§è¡Œè®¡åˆ’

### Phase A: å‡†å¤‡ä¸å¤‡ä»½ï¼ˆ5 åˆ†é’Ÿï¼‰
- [ ] åˆ›å»ºå¤‡ä»½åˆ†æ”¯
- [ ] æœ¬åœ°å¤‡ä»½
- [ ] æ¨é€åˆ° GitHub

### Phase B: ä»£ç æ›¿æ¢ï¼ˆ2 å°æ—¶ï¼‰
- [ ] å¼€å‘ AST æ›¿æ¢å·¥å…·
- [ ] æ‰§è¡Œæ›¿æ¢ï¼ˆ74 ä¸ªæ–‡ä»¶ï¼‰
- [ ] ç”Ÿæˆ `zh-TW.ts`
- [ ] æ›´æ–° `types.ts`
- [ ] æµ‹è¯•éªŒè¯
- [ ] **åˆ›å»ºå¤‡ä»½ç‚¹**ï¼š`backup-after-replacement-zh-TW-only`

### Phase C: æµ‹è¯•ä¸­æ–‡ç‰ˆæœ¬ï¼ˆ10 åˆ†é’Ÿï¼‰
- [ ] å¯åŠ¨å¼€å‘æœåŠ¡å™¨
- [ ] æµ‹è¯•æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- [ ] éªŒè¯ä¸­æ–‡æ˜¾ç¤ºæ­£å¸¸

### Phase D: å¯¼å…¥è‹±æ–‡ç¿»è¯‘ï¼ˆ5 åˆ†é’Ÿï¼‰
- [ ] ç¡®è®¤ CSV æ–‡ä»¶å­˜åœ¨
- [ ] å¯¼å…¥è‹±æ–‡ç¿»è¯‘
- [ ] éªŒè¯å¯¼å…¥æˆåŠŸ

### Phase E: æµ‹è¯•ä¸­è‹±æ–‡åˆ‡æ¢ï¼ˆ15 åˆ†é’Ÿï¼‰
- [ ] æµ‹è¯•æ–°ç”¨æˆ·é€‰æ‹©è‹±æ–‡
- [ ] æµ‹è¯•è€ç”¨æˆ·åˆ‡æ¢è¯­è¨€
- [ ] éªŒè¯æ‰€æœ‰é¡µé¢éƒ½æ˜¾ç¤ºè‹±æ–‡

### Phase F: å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œç¿»è¯‘å…¶ä»–è¯­è¨€ï¼ˆå¯é€‰ï¼‰
- [ ] ç¿»è¯‘å…¶ä»– 32 ç§è¯­è¨€
- [ ] å¯¼å…¥æ‰€æœ‰è¯­è¨€ç¿»è¯‘
- [ ] æµ‹è¯•æ‰€æœ‰è¯­è¨€åˆ‡æ¢

---

## ğŸš€ å‡†å¤‡å¼€å§‹

**ç¡®è®¤æ¸…å•**ï¼š
- [x] å¤‡ä»½å·²åˆ›å»ºï¼ˆ`backup-before-replacement-*`ï¼‰
- [x] æå–ç»“æœå·²ç¡®è®¤ï¼ˆ1939 ä¸ª keysï¼‰
- [ ] AST å·¥å…·å·²å‡†å¤‡ï¼ˆå¾…å¼€å‘ï¼‰
- [ ] AI éªŒè¯å·²é›†æˆï¼ˆå¾…å¼€å‘ï¼‰
- [ ] æµ‹è¯•ç¯å¢ƒå·²å‡†å¤‡

**å½“å‰çŠ¶æ€**ï¼š
- âœ… å¤‡ä»½ï¼šå·²å®Œæˆ
- âœ… æå–ï¼š100% å®Œæˆ
- â³ æ›¿æ¢ï¼šå¾…å¼€å§‹

---

## ğŸ“‹ æ‰§è¡Œé¡ºåº

### Step 1: å¼€å‘ AST æ›¿æ¢å·¥å…·ï¼ˆ15 åˆ†é’Ÿï¼‰
- åˆ›å»º `scripts/ast-replace-i18n.ts`
- å®ç° AST è§£æå’Œæ›¿æ¢
- æµ‹è¯•å•ä¸ªæ–‡ä»¶

### Step 2: é›†æˆ AI éªŒè¯ï¼ˆ10 åˆ†é’Ÿï¼‰
- åˆ›å»º `scripts/ai-verify-replacement.ts`
- é›†æˆ Cursor AI éªŒè¯
- æµ‹è¯•éªŒè¯æµç¨‹

### Step 3: æ‰§è¡Œæ›¿æ¢ï¼ˆ30 åˆ†é’Ÿï¼‰
- æŒ‰ä¼˜å…ˆçº§é¡ºåºæ›¿æ¢æ–‡ä»¶
- å®æ—¶éªŒè¯å’Œæµ‹è¯•
- å¤±è´¥ç«‹å³å›æ»š

### Step 4: ç”Ÿæˆ Locale å’Œ Typesï¼ˆ10 åˆ†é’Ÿï¼‰
- ç”Ÿæˆ `zh-TW.ts`
- æ›´æ–° `types.ts`
- éªŒè¯å®Œæ•´æ€§

### Step 5: å…¨é¢æµ‹è¯•ï¼ˆ20 åˆ†é’Ÿï¼‰
- Lint æ£€æŸ¥
- ç±»å‹æ£€æŸ¥
- å•å…ƒæµ‹è¯•
- Smoke Test

### Step 6: AI æœ€ç»ˆå®¡æ ¸ï¼ˆ10 åˆ†é’Ÿï¼‰
- Cursor AI å…¨é¢å®¡æŸ¥
- ç¡®è®¤æ— é—æ¼
- ç¡®è®¤æ— é”™è¯¯

---

## ğŸ—„ï¸ æ•°æ®åº“ç¡¬ç¼–ç å¤„ç†

### æ•°æ®åº“ç¡¬ç¼–ç çŠ¶æ€

**æå–çŠ¶æ€**ï¼ˆâœ… å·²å®Œæˆï¼‰ï¼š
- âœ… SQL æ–‡ä»¶å·²æ‰«æï¼š8 ä¸ªæ–‡ä»¶åŒ…å«ä¸­æ–‡
  - `0030_create_tasks_table.sql` - ä»»åŠ¡è¡¨ï¼ˆä»»åŠ¡åç§°å’Œæè¿°ï¼‰
  - `0046_add_country_confirmation_task.sql` - å›½å®¶ç¡®è®¤ä»»åŠ¡
  - `0041_create_matching_history.sql` - åŒ¹é…å†å²
  - `0027_create_quota_prompts.sql` - é…é¢æç¤º
  - `0026_create_official_ads.sql` - å®˜æ–¹å¹¿å‘Š
  - `0020_create_broadcast_and_maintenance_tables.sql` - å¹¿æ’­å’Œç»´æŠ¤
  - `src/db/schema.sql` - æ•°æ®åº“ç»“æ„
  - `src/db/queries/bottles.ts` - SQL æ³¨é‡Šä¸­çš„ä¸­æ–‡
- âœ… ä¸­æ–‡å†…å®¹å·²æå–ï¼šæ‰€æœ‰æ•°æ®åº“ä¸­çš„ä¸­æ–‡ç¡¬ç¼–ç éƒ½å·²æå–åˆ° `i18n_complete_final.json`
- âœ… å·²ç”Ÿæˆ i18n keysï¼šå·²ä¸ºæ•°æ®åº“å†…å®¹ç”Ÿæˆ keys

**æ›¿æ¢çŠ¶æ€**ï¼ˆâŒ æœªå¼€å§‹ï¼‰ï¼š
- âŒ æ•°æ®åº“æœªæ›´æ–°ï¼šæ•°æ®åº“ä¸­çš„æ•°æ®ä»ç„¶æ˜¯ä¸­æ–‡
- âŒ æœªç”Ÿæˆè¿ç§»è„šæœ¬ï¼šè¿˜æ²¡æœ‰ç”Ÿæˆæ›´æ–°æ•°æ®åº“çš„è¿ç§»è„šæœ¬
- âŒ ä»£ç æœªæ›´æ–°ï¼šè¯»å–æ•°æ®åº“æ•°æ®çš„ä»£ç è¿˜æ²¡æœ‰ä½¿ç”¨ `i18n.t()`

### æ•°æ®åº“ç¡¬ç¼–ç ç¤ºä¾‹

**tasks è¡¨**ï¼ˆä¸»è¦é—®é¢˜ï¼‰ï¼š
```sql
-- å½“å‰çŠ¶æ€ï¼ˆä¸­æ–‡ï¼‰
INSERT INTO tasks (id, category, name, description, ...) VALUES
('task_interests', 'profile', 'å¡«å¯«èˆˆè¶£æ¨™ç±¤', 'è®“åˆ¥äººæ›´äº†è§£ä½ ', ...),
('task_bio', 'profile', 'å®Œå–„è‡ªæˆ‘ä»‹ç´¹', 'å¯«ä¸‹ä½ çš„æ•…äº‹ï¼ˆè‡³å°‘ 20 å­—ï¼‰', ...),
('task_first_bottle', 'action', 'ä¸Ÿå‡ºç¬¬ä¸€å€‹ç“¶å­', 'é–‹å§‹ä½ çš„äº¤å‹ä¹‹æ—…', ...);
```

**éœ€è¦æ›¿æ¢ä¸º**ï¼š
```sql
-- æ›¿æ¢åï¼ˆi18n keysï¼‰
INSERT INTO tasks (id, category, name, description, ...) VALUES
('task_interests', 'profile', 'tasks.name.interests', 'tasks.description.interests', ...),
('task_bio', 'profile', 'tasks.name.bio', 'tasks.description.bio', ...),
('task_first_bottle', 'action', 'tasks.name.first_bottle', 'tasks.description.first_bottle', ...);
```

### æ•°æ®åº“è¿ç§»ç­–ç•¥

#### æ–¹æ¡ˆ Aï¼šç›´æ¥æ›¿æ¢ï¼ˆæ¨èï¼‰

**æ­¥éª¤**ï¼š

1. **ç”Ÿæˆè¿ç§»è„šæœ¬**ï¼š
   ```bash
   npx tsx scripts/generate-db-migration.ts
   ```

2. **è¿ç§»è„šæœ¬å†…å®¹**ï¼ˆç¤ºä¾‹ï¼‰ï¼š
   ```sql
   -- Migration: Update tasks table to use i18n keys
   -- Date: 2025-01-23
   
   UPDATE tasks 
   SET name = 'tasks.name.interests',
       description = 'tasks.description.interests'
   WHERE id = 'task_interests';
   
   UPDATE tasks 
   SET name = 'tasks.name.bio',
       description = 'tasks.description.bio'
   WHERE id = 'task_bio';
   
   -- ... å…¶ä»–ä»»åŠ¡
   ```

3. **æ‰§è¡Œè¿ç§»**ï¼š
   ```bash
   # åœ¨ staging ç¯å¢ƒæµ‹è¯•
   npx wrangler d1 execute <db-name> \
     --file=src/db/migrations/XXXX_update_tasks_to_i18n_keys.sql \
     --env staging \
     --remote
   ```

4. **æ›´æ–°ä»£ç **ï¼š
   ```typescript
   // æ›¿æ¢å‰
   const taskName = task.name;  // ç›´æ¥ä½¿ç”¨æ•°æ®åº“ä¸­çš„ä¸­æ–‡
   
   // æ›¿æ¢å
   const { createI18n } = await import('~/i18n');
   const i18n = createI18n(user.language_pref || 'zh-TW');
   const taskName = i18n.t(task.name);  // ä½¿ç”¨ i18n key
   ```

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `src/telegram/handlers/tasks.ts` - ä»»åŠ¡æ˜¾ç¤º
- `src/domain/tasks.ts` - ä»»åŠ¡é€»è¾‘
- å…¶ä»–è¯»å–ä»»åŠ¡æ•°æ®çš„æ–‡ä»¶

#### æ–¹æ¡ˆ Bï¼šæ·»åŠ æ–°å­—æ®µï¼ˆæ¸è¿›å¼ï¼‰

**æ­¥éª¤**ï¼š
1. æ·»åŠ  `name_key` å’Œ `description_key` å­—æ®µ
2. æ–°æ•°æ®ä½¿ç”¨ keysï¼Œæ—§æ•°æ®ä¿æŒä¸­æ–‡
3. ä»£ç ä¸­å…¼å®¹å¤„ç†
4. é€æ­¥è¿ç§»æ—§æ•°æ®

**ä¼˜ç‚¹**ï¼šå¯ä»¥å›æ»š  
**ç¼ºç‚¹**ï¼šéœ€è¦ç»´æŠ¤ä¸¤å¥—æ•°æ®

### æ•°æ®åº“è¿ç§»è„šæœ¬ç”Ÿæˆ

**è„šæœ¬ä½ç½®**ï¼š`scripts/generate-db-migration.ts`

**åŠŸèƒ½**ï¼š
1. è¯»å– `i18n_complete_final.json` ä¸­çš„æ•°æ®åº“ç›¸å…³å†…å®¹
2. è¯»å– `i18n_keys_mapping_fixed.json` è·å– key æ˜ å°„
3. ç”Ÿæˆ SQL è¿ç§»è„šæœ¬
4. éªŒè¯è„šæœ¬æ­£ç¡®æ€§

**è¾“å‡ºæ–‡ä»¶**ï¼š
- `src/db/migrations/XXXX_update_tasks_to_i18n_keys.sql`
- `src/db/migrations/XXXX_update_quota_prompts_to_i18n_keys.sql`
- å…¶ä»–è¡¨çš„è¿ç§»è„šæœ¬

### æ•°æ®åº“æ›¿æ¢æ£€æŸ¥æ¸…å•

- [ ] è¿ç§»è„šæœ¬å·²ç”Ÿæˆ
- [ ] è¿ç§»è„šæœ¬å·²åœ¨ staging æµ‹è¯•
- [ ] ä»£ç å·²æ›´æ–°ï¼ˆä½¿ç”¨ `i18n.t()`ï¼‰
- [ ] ä»»åŠ¡æ˜¾ç¤ºæ­£å¸¸
- [ ] ä»»åŠ¡å®Œæˆæ­£å¸¸
- [ ] ä»»åŠ¡å¥–åŠ±æ­£å¸¸
- [ ] å…¶ä»–è¡¨çš„æ•°æ®æ­£å¸¸

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### å¿…é¡»è¾¾åˆ°
- âœ… ç¡¬ç¼–ç ï¼š0 å¤„ï¼ˆ100% æ›¿æ¢ï¼ŒåŒ…æ‹¬æ•°æ®åº“ï¼‰
- âœ… ç±»å‹é”™è¯¯ï¼š0 ä¸ª
- âœ… Lint é”™è¯¯ï¼š0 ä¸ª
- âœ… æµ‹è¯•å¤±è´¥ï¼š0 ä¸ª
- âœ… åŠŸèƒ½æ­£å¸¸ï¼š100%
- âœ… æ•°æ®åº“è¿ç§»ï¼šå·²å®Œæˆ

### è´¨é‡æŒ‡æ ‡
- âœ… æ›¿æ¢å‡†ç¡®ç‡ï¼š> 99.9%
- âœ… ä»£ç å¯è¯»æ€§ï¼šä¿æŒæˆ–æå‡
- âœ… æ€§èƒ½å½±å“ï¼š< 50ms
- âœ… ç±»å‹å®‰å…¨ï¼š100%

**å¦‚æœéƒ½ç¡®è®¤ï¼Œå¯ä»¥å¼€å§‹æ‰§è¡Œæ›¿æ¢ï¼** ğŸš€

---

**ç»´æŠ¤è€…**: AI Assistant  
**æ—¥æœŸ**: 2025-01-23  
**ç‰ˆæœ¬**: 1.1.0ï¼ˆå·²æ·»åŠ æ•°æ®åº“ç¡¬ç¼–ç å¤„ç†ï¼‰

