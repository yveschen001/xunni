# ğŸš€ XunNi Bot - æœ¬åœ°é–‹ç™¼å¿«é€Ÿé–‹å§‹

## âœ… **æœ€ç°¡å–®çš„æ–¹å¼ï¼šä¸€æ¢å‘½ä»¤å•Ÿå‹•**

```bash
pnpm dev:polling
```

å°±é€™éº¼ç°¡å–®ï¼ğŸ‰

---

## ğŸ“‹ **å®Œæ•´æ­¥é©Ÿ**

### **1. ç¢ºèªç’°å¢ƒè®Šæ•¸**

ç¢ºä¿ `.dev.vars` æ–‡ä»¶å­˜åœ¨ä¸¦åŒ…å«ï¼š

```bash
TELEGRAM_BOT_TOKEN=ä½ çš„_BOT_TOKEN
OPENAI_API_KEY=ä½ çš„_OPENAI_KEY
GOOGLE_GEMINI_API_KEY=ä½ çš„_GEMINI_KEY
# ... å…¶ä»–é…ç½®
```

### **2. å•Ÿå‹•æœ¬åœ°é–‹ç™¼**

```bash
# æ–¹å¼ 1: ä½¿ç”¨ npm scriptï¼ˆæ¨è–¦ï¼‰
pnpm dev:polling

# æ–¹å¼ 2: ä½¿ç”¨å•Ÿå‹•è…³æœ¬
chmod +x scripts/start-local-dev.sh
./scripts/start-local-dev.sh

# æ–¹å¼ 3: æ‰‹å‹•å•Ÿå‹•
pnpm tsx scripts/dev-polling.ts
```

### **3. æ¸¬è©¦ä½ çš„ Bot**

1. æ‰“é–‹ Telegram
2. æ‰¾åˆ°ä½ çš„ Bot
3. ç™¼é€ `/start`
4. æŸ¥çœ‹çµ‚ç«¯è¼¸å‡º

---

## ğŸ¯ **ä½ æœƒçœ‹åˆ°ä»€éº¼**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ¤– XunNi Bot - Local Development (Polling Mode)     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Environment: development
ğŸ”‘ Bot Token: 8226418094:AAE5wfp_...
ğŸ—„ï¸  Database: Local D1 (via Wrangler)
ğŸ”„ Mode: Long Polling (30s timeout)

ğŸ”§ Removing webhook to enable polling...
âœ… Webhook removed successfully
ğŸš€ Starting to poll for updates...
ğŸ’¡ Send a message to your bot to test!

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“¬ Received 1 update(s) (Total: 1)

ğŸ“¨ Processing update 123456789
Update: {
  "update_id": 123456789,
  "message": {
    "message_id": 1,
    "from": { ... },
    "text": "/start"
  }
}
âœ… Update processed: 200 OK

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## ğŸ”§ **é–‹ç™¼å·¥ä½œæµç¨‹**

### **ä¿®æ”¹ä»£ç¢¼**

1. ç·¨è¼¯ä»»ä½• `src/` ä¸‹çš„æ–‡ä»¶
2. ä¿å­˜
3. **é‡å•Ÿè…³æœ¬**ï¼ˆæŒ‰ `Ctrl+C` ç„¶å¾Œé‡æ–°é‹è¡Œ `pnpm dev:polling`ï¼‰

### **æŸ¥çœ‹æ•¸æ“šåº«**

```bash
# åœ¨å¦ä¸€å€‹çµ‚ç«¯çª—å£
wrangler d1 execute DB --local --command "SELECT * FROM users LIMIT 10"
```

### **é‹è¡Œæ¸¬è©¦**

```bash
# åœ¨å¦ä¸€å€‹çµ‚ç«¯çª—å£
pnpm test
```

---

## ğŸ’¡ **å¸¸è¦‹å•é¡Œ**

### **Q: ç‚ºä»€éº¼éœ€è¦é‡å•Ÿè…³æœ¬ï¼Ÿ**

A: Polling æ¨¡å¼ä¸æ”¯æŒç†±é‡è¼‰ã€‚ä¿®æ”¹ä»£ç¢¼å¾Œéœ€è¦é‡å•Ÿã€‚

### **Q: å¦‚ä½•åˆ‡æ›å› Webhook æ¨¡å¼ï¼Ÿ**

A: ç•¶ Cloudflare æ¢å¾©å¾Œï¼š

```bash
# 1. åœæ­¢ polling æ¨¡å¼ï¼ˆCtrl+Cï¼‰
# 2. éƒ¨ç½²åˆ° Cloudflare
pnpm deploy:staging

# 3. è¨­ç½® Webhook
curl -X POST "https://api.telegram.org/botä½ çš„TOKEN/setWebhook" \
  -d "url=https://ä½ çš„workeråœ°å€.workers.dev/webhook"
```

### **Q: æ•¸æ“šåº«åœ¨å“ªè£¡ï¼Ÿ**

A: æœ¬åœ°é–‹ç™¼ä½¿ç”¨ Wrangler çš„æœ¬åœ° D1 æ•¸æ“šåº«ï¼Œæ•¸æ“šå­˜å„²åœ¨ï¼š
```
.wrangler/state/v3/d1/miniflare-D1DatabaseObject/
```

### **Q: å¦‚ä½•é‡ç½®æœ¬åœ°æ•¸æ“šåº«ï¼Ÿ**

```bash
# åˆªé™¤æœ¬åœ°æ•¸æ“šåº«
rm -rf .wrangler/state/

# é‡æ–°å•Ÿå‹•æœƒè‡ªå‹•å‰µå»ºæ–°æ•¸æ“šåº«
pnpm dev:polling
```

---

## ğŸ‰ **å„ªé»**

âœ… **ç„¡éœ€ ngrok** - ä¸éœ€è¦å…¬ç¶²åœ°å€  
âœ… **ç„¡éœ€ Cloudflare** - å®Œå…¨æœ¬åœ°é‹è¡Œ  
âœ… **çœŸå¯¦æ¸¬è©¦** - ä½¿ç”¨çœŸå¯¦çš„ Telegram Bot  
âœ… **å®Œæ•´åŠŸèƒ½** - æ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥æ¸¬è©¦  
âœ… **ç°¡å–®å¿«é€Ÿ** - ä¸€æ¢å‘½ä»¤å•Ÿå‹•  

---

## ğŸš¨ **æ³¨æ„äº‹é …**

âš ï¸ **Polling æ¨¡å¼æœƒè‡ªå‹•åˆªé™¤ Webhook**
- å•Ÿå‹•æ™‚æœƒèª¿ç”¨ `deleteWebhook` API
- ç¢ºä¿ä¸æœƒå½±éŸ¿ç”Ÿç”¢ç’°å¢ƒçš„ Bot

âš ï¸ **ä¸æ”¯æŒç†±é‡è¼‰**
- ä¿®æ”¹ä»£ç¢¼å¾Œéœ€è¦é‡å•Ÿè…³æœ¬
- ä½¿ç”¨ `Ctrl+C` åœæ­¢ï¼Œç„¶å¾Œé‡æ–°é‹è¡Œ

âš ï¸ **æœ¬åœ°æ•¸æ“šåº«**
- æ•¸æ“šä¸æœƒåŒæ­¥åˆ°é ç¨‹
- é‡ç½®æœ¬åœ°æ•¸æ“šåº«ä¸æœƒå½±éŸ¿ç”Ÿç”¢ç’°å¢ƒ

---

## ğŸ“š **ä¸‹ä¸€æ­¥**

ç¾åœ¨ä½ å¯ä»¥ï¼š

1. âœ… **é–‹å§‹é–‹ç™¼å»£å‘Šç³»çµ±**
2. âœ… **æ¸¬è©¦æ–°åŠŸèƒ½**
3. âœ… **ä¿®å¾© Bug**
4. âœ… **é‹è¡Œæ¸¬è©¦**

ç­‰ Cloudflare æ¢å¾©å¾Œå†éƒ¨ç½²åˆ°é ç¨‹ï¼

---

## ğŸ†˜ **éœ€è¦å¹«åŠ©ï¼Ÿ**

å¦‚æœé‡åˆ°å•é¡Œï¼š

1. æª¢æŸ¥ `.dev.vars` æ˜¯å¦æ­£ç¢º
2. ç¢ºèª `TELEGRAM_BOT_TOKEN` æœ‰æ•ˆ
3. æŸ¥çœ‹çµ‚ç«¯éŒ¯èª¤ä¿¡æ¯
4. æª¢æŸ¥ Bot æ˜¯å¦è¢«å…¶ä»–é€²ç¨‹ä½¿ç”¨

**Happy Coding! ğŸš€**

