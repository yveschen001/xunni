# 管理員系統手動測試指南

**最後更新：** 2025-11-17  
**測試環境：** Staging (@xunni_dev_bot)  
**測試人員：** 超級管理員（ID: 396943893）

---

## 📋 測試前準備

### 1. 確認身份

你的 Telegram ID：`396943893`（超級管理員）

### 2. 測試用戶

- **測試用戶 ID**：`7788737902`
- 用於測試封禁、解封、凍結功能

### 3. 環境確認

- Bot：`@xunni_dev_bot`
- 環境：Staging
- 版本：`bad98539-60c8-49d2-9e9d-3c58e3240f84`

---

## 🧪 測試用例

### 測試 1：查看管理員列表

**命令：**
```
/admin_list
```

**預期結果：**
- ✅ 顯示 "👥 **管理員列表**"
- ✅ 顯示總數（至少 1 位）
- ✅ 顯示你的 ID：`396943893`
- ✅ 顯示角色：`🔱 超級管理員`
- ✅ 顯示暱稱和用戶名
- ✅ 底部顯示提示：使用 /admin_add 和 /admin_remove

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 2：封禁用戶（1 小時）

**命令：**
```
/admin_ban 7788737902 1
```

**預期結果：**
- ✅ 顯示 "✅ 已封禁用戶"
- ✅ 顯示用戶 ID：`7788737902`
- ✅ 顯示暱稱（如果已註冊）
- ✅ 顯示封禁時長：1 小時
- ✅ 顯示解封時間（當前時間 + 1 小時）

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 3：被封禁用戶無法使用 Bot

**步驟：**
1. 切換到測試用戶帳號（ID: 7788737902）
2. 發送任意命令，例如：`/menu`

**預期結果：**
- ✅ 收到友善的封禁通知
- ✅ 包含 "暫時無法使用" 或 "異常行為"
- ✅ 顯示預計恢復時間
- ✅ 顯示剩餘時間
- ✅ 提示查看規則：`/rules`
- ✅ 提示可以申訴：`/appeal`
- ❌ **不顯示**具體封禁原因

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 4：查看封禁記錄

**命令：**
```
/admin_bans 7788737902
```

**預期結果：**
- ✅ 顯示 "📋 用戶封禁歷史"
- ✅ 顯示用戶 ID：`7788737902`
- ✅ 顯示封禁次數
- ✅ 顯示當前狀態（已封禁）
- ✅ 顯示封禁記錄列表
- ✅ 每條記錄包含：封禁時間、原因、時長、狀態

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 5：解除封禁

**命令：**
```
/admin_unban 7788737902
```

**預期結果：**
- ✅ 顯示 "✅ 已解除封禁"
- ✅ 顯示用戶 ID：`7788737902`
- ✅ 顯示暱稱（如果已註冊）
- ✅ 確認消息已發送給用戶

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 6：解封後用戶可以正常使用

**步驟：**
1. 切換到測試用戶帳號（ID: 7788737902）
2. 發送命令：`/menu`

**預期結果：**
- ✅ 收到正常的主選單
- ✅ 顯示各種功能按鈕
- ❌ **不顯示**封禁通知

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 7：凍結用戶（48 小時）

**命令：**
```
/admin_freeze 7788737902 48
```

**預期結果：**
- ✅ 顯示 "✅ 已凍結用戶"
- ✅ 顯示用戶 ID：`7788737902`
- ✅ 顯示暱稱（如果已註冊）
- ✅ 顯示凍結時長：48 小時（2 天）
- ✅ 顯示解凍時間（當前時間 + 48 小時）

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 8：被凍結用戶無法使用 Bot

**步驟：**
1. 切換到測試用戶帳號（ID: 7788737902）
2. 發送任意命令，例如：`/throw`

**預期結果：**
- ✅ 收到友善的封禁通知
- ✅ 顯示預計恢復時間（48 小時後）
- ✅ 顯示剩餘時間（約 2 天）

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 9：再次解除封禁（清理）

**命令：**
```
/admin_unban 7788737902
```

**預期結果：**
- ✅ 顯示 "✅ 已解除封禁"
- ✅ 用戶可以正常使用

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 10：永久封禁

**命令：**
```
/admin_ban 7788737902 permanent
```

**預期結果：**
- ✅ 顯示 "✅ 已封禁用戶"
- ✅ 顯示封禁時長：永久
- ✅ 解封時間顯示為 "永久"

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 11：永久封禁的用戶收到的通知

**步驟：**
1. 切換到測試用戶帳號（ID: 7788737902）
2. 發送任意命令

**預期結果：**
- ✅ 收到友善的永久封禁通知
- ✅ 包含 "已停用" 或 "嚴重違規"
- ✅ 提示查看規則：`/rules`
- ✅ 提示可以申訴：`/appeal`
- ❌ **不顯示**具體封禁原因

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 12：最終清理

**命令：**
```
/admin_unban 7788737902
```

**預期結果：**
- ✅ 成功解除永久封禁
- ✅ 用戶可以正常使用

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

## 🔒 權限測試

### 測試 13：/help 命令顯示正確的命令列表

**命令：**
```
/help
```

**預期結果：**

#### 超級管理員應該看到：

**核心功能**（所有用戶都有）：
- /start, /menu, /throw, /catch, /profile, /edit_profile, /mbti, /stats, /chats, /vip

**安全功能**（所有用戶都有）：
- /block, /report, /appeal, /appeal_status

**管理員功能**（管理員和超級管理員）：
- /admin_ban, /admin_unban, /admin_freeze
- /admin_bans, /admin_appeals
- /admin_approve, /admin_reject

**超級管理員功能**（只有超級管理員）：
- /admin_list
- /admin_add
- /admin_remove
- /broadcast
- /dev_info
- /dev_reset

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 14：添加管理員（提示）

**命令：**
```
/admin_add 123456789
```

**預期結果：**
- ✅ 顯示 "⚠️ **注意**"
- ✅ 說明需要手動修改配置文件
- ✅ 提供詳細步驟：
  1. 編輯 `wrangler.toml`
  2. 找到 `ADMIN_USER_IDS` 變數
  3. 添加用戶 ID
  4. 格式示例
  5. 重新部署命令
- ✅ 顯示用戶資訊（如果存在）
- ✅ 提示可以在 Cloudflare Dashboard 修改

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 15：移除管理員（提示）

**命令：**
```
/admin_remove 123456789
```

**預期結果：**
- ✅ 顯示 "⚠️ **注意**"
- ✅ 說明需要手動修改配置文件
- ✅ 提供詳細步驟
- ✅ 顯示用戶資訊（如果存在）

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

### 測試 16：無法封禁管理員

**命令：**
```
/admin_ban 396943893 1
```

**預期結果：**
- ✅ 顯示 "❌ 無法封禁管理員帳號。"
- ✅ 不創建任何封禁記錄

**實際結果：**
```
[ ] 通過
[ ] 失敗

備註：_______________________
```

---

## 📊 測試總結

### 測試統計

- **總測試數**：16
- **通過數**：_____
- **失敗數**：_____
- **成功率**：_____%

### 發現的問題

1. ___________________________________
2. ___________________________________
3. ___________________________________

### 需要改進的地方

1. ___________________________________
2. ___________________________________
3. ___________________________________

---

## 🎯 快速測試腳本

如果你想快速測試所有功能，可以按順序執行以下命令：

```bash
# 1. 查看管理員列表
/admin_list

# 2. 封禁測試用戶（1 小時）
/admin_ban 7788737902 1

# 3. 查看封禁記錄
/admin_bans 7788737902

# 4. 切換到測試用戶，嘗試使用 Bot
/menu

# 5. 切換回管理員，解除封禁
/admin_unban 7788737902

# 6. 切換到測試用戶，確認可以使用
/menu

# 7. 切換回管理員，凍結用戶（48 小時）
/admin_freeze 7788737902 48

# 8. 切換到測試用戶，確認被凍結
/throw

# 9. 切換回管理員，解除封禁
/admin_unban 7788737902

# 10. 測試永久封禁
/admin_ban 7788737902 permanent

# 11. 切換到測試用戶，確認永久封禁通知
/catch

# 12. 切換回管理員，最終清理
/admin_unban 7788737902

# 13. 測試 /help 命令
/help

# 14. 測試添加管理員提示
/admin_add 123456789

# 15. 測試移除管理員提示
/admin_remove 123456789

# 16. 測試無法封禁管理員
/admin_ban 396943893 1
```

---

## 📝 測試完成後

### 1. 填寫測試報告

將測試結果填入上方的 `[ ] 通過` 或 `[ ] 失敗` 框框。

### 2. 記錄問題

如果發現任何問題，請記錄在 "發現的問題" 部分。

### 3. 提供反饋

告訴我測試結果，我會根據你的反饋進行修復和改進。

---

**測試日期：** ___________________  
**測試人員：** ___________________  
**測試環境：** Staging (@xunni_dev_bot)  
**測試版本：** bad98539-60c8-49d2-9e9d-3c58e3240f84

